"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/add.tsx
var add_exports = {};
__export(add_exports, {
  default: () => Add
});
module.exports = __toCommonJS(add_exports);

// src/components/form.tsx
var import_api3 = require("@raycast/api");

// node_modules/@raycast/utils/dist/module.js
var import_react = __toESM(require("react"));
var import_api = require("@raycast/api");
var import_node_fs = __toESM(require("node:fs"));
var import_node_path = __toESM(require("node:path"));
var import_jsx_runtime = require("react/jsx-runtime");
function $c718fd03aba6111c$export$80e5033e369189f3(error, options) {
  const message = error instanceof Error ? error.message : String(error);
  return (0, import_api.showToast)({
    style: (0, import_api.Toast).Style.Failure,
    title: options?.title ?? "Something went wrong",
    message: options?.message ?? message,
    primaryAction: options?.primaryAction ?? $c718fd03aba6111c$var$handleErrorToastAction(error),
    secondaryAction: options?.primaryAction ? $c718fd03aba6111c$var$handleErrorToastAction(error) : void 0
  });
}
var $c718fd03aba6111c$var$handleErrorToastAction = (error) => {
  let privateExtension = true;
  let title = "[Extension Name]...";
  let extensionURL = "";
  try {
    const packageJSON = JSON.parse((0, import_node_fs.readFileSync)((0, import_node_path.join)((0, import_api.environment).assetsPath, "..", "package.json"), "utf8"));
    title = `[${packageJSON.title}]...`;
    extensionURL = `https://raycast.com/${packageJSON.owner || packageJSON.author}/${packageJSON.name}`;
    if (!packageJSON.owner || packageJSON.access === "public") privateExtension = false;
  } catch (err) {
  }
  const fallback = (0, import_api.environment).isDevelopment || privateExtension;
  const stack = error instanceof Error ? error?.stack || error?.message || "" : String(error);
  return {
    title: fallback ? "Copy Logs" : "Report Error",
    onAction(toast) {
      toast.hide();
      if (fallback) (0, import_api.Clipboard).copy(stack);
      else (0, import_api.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(title)}&extension-url=${encodeURI(extensionURL)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${stack}
\`\`\`
`)}`);
    }
  };
};

// src/components/form.tsx
var import_react2 = require("react");

// src/utils/storage.ts
var import_api2 = require("@raycast/api");
function storage() {
}
storage.getPreferences = async () => (0, import_api2.getPreferenceValues)();
storage.getBadges = async () => {
  const apps = await (0, import_api2.getApplications)();
  const badges = JSON.parse(await import_api2.LocalStorage.getItem("badges") || "{}");
  Object.entries(badges).forEach(([bundleId, badge]) => {
    const app = apps.filter((app2) => app2.bundleId === bundleId).pop();
    if (!app) {
      delete badges[bundleId];
      return;
    }
    badge.app = app;
    badge.status = { count: 0, indeterminate: false };
  });
  return badges;
};
storage.sortBadges = (badges) => Object.values(badges).sort((a, b) => a.app.name.localeCompare(
  b.app.name,
  Intl.DateTimeFormat().resolvedOptions().locale,
  { sensitivity: "base" }
));
storage.saveBadge = async (badge) => {
  const badges = await storage.getBadges();
  badges[badge.bundleId] = badge;
  await import_api2.LocalStorage.setItem("badges", JSON.stringify(badges));
};
storage.deleteBadge = async (badge) => {
  const badges = await storage.getBadges();
  if (!badges[badge.bundleId])
    return;
  delete badges[badge.bundleId];
  await import_api2.LocalStorage.setItem("badges", JSON.stringify(badges));
};
storage.deleteAllBadges = async () => import_api2.LocalStorage.removeItem("badges");

// src/components/form.tsx
var import_jsx_runtime2 = require("react/jsx-runtime");
function BadgeForm(props) {
  const { badge } = props;
  const { pop } = (0, import_api3.useNavigation)();
  const [apps, setApps] = (0, import_react2.useState)([]);
  (0, import_react2.useEffect)(() => {
    (async () => setApps(await (0, import_api3.getApplications)()))();
  }, []);
  const onSubmit = async (values) => {
    try {
      if (badge)
        values.bundleId = badge.bundleId;
      storage.saveBadge(values).then(pop);
    } catch (error) {
      await $c718fd03aba6111c$export$80e5033e369189f3(error.message);
    }
  };
  return /* @__PURE__ */ (0, import_jsx_runtime2.jsxs)(
    import_api3.Form,
    {
      isLoading: !apps.length,
      navigationTitle: !badge ? "Add Badge" : "Edit Badge",
      actions: /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.ActionPanel, { children: /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Action.SubmitForm, { title: "Submit", onSubmit }) }),
      children: [
        badge && /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Form.Description, { text: badge.app.name }),
        !badge && /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(
          import_api3.Form.Dropdown,
          {
            id: "bundleId",
            info: "Choose the application to monitor for badges. Keep in mind that not all applications utilize badges for notifications.",
            children: apps.map((app) => /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(
              import_api3.Form.Dropdown.Item,
              {
                value: app.bundleId || app.name,
                title: app.name,
                icon: { fileIcon: app.path }
              },
              app.bundleId || app.name
            ))
          }
        ),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(
          import_api3.Form.Checkbox,
          {
            id: "showInactive",
            label: "Show badges when this application is closed",
            info: "When the application is closed and kept in the Dock, the badges will continue to appear in the menu bar.",
            defaultValue: !badge && true || badge.showInactive
          }
        ),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(
          import_api3.Form.Checkbox,
          {
            id: "showIndeterminate",
            label: "Show indeterminate badges",
            info: "An indeterminate badge is displayed in the Dock as a dot without a count. When enabled, the badge count increases by one.",
            defaultValue: !badge && true || badge.showIndeterminate
          }
        ),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Form.Description, { text: "" }),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Form.Separator, {}),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Form.Description, { text: "" }),
        /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(import_api3.Form.Description, { text: "Applications must be open or kept in the Dock for badge counts to appear in the menu bar. Additionally, Raycast requires the Automation and Accessibility permissions in order to read the Dock badges." })
      ]
    }
  );
}

// src/add.tsx
var import_jsx_runtime3 = require("react/jsx-runtime");
function Add() {
  return /* @__PURE__ */ (0, import_jsx_runtime3.jsx)(BadgeForm, {});
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL3NyYy9hZGQudHN4IiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9zcmMvY29tcG9uZW50cy9mb3JtLnRzeCIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL2luZGV4LnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvdXNlUHJvbWlzZS50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZURlZXBNZW1vLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvdXNlTGF0ZXN0LnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvc2hvd0ZhaWx1cmVUb2FzdC50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZUNhY2hlZFN0YXRlLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvaGVscGVycy50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3ZlbmRvcnMvdHlwZS1oYXNoZXIudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy91c2VDYWNoZWRQcm9taXNlLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvdXNlRmV0Y2gudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9mZXRjaC11dGlscy50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZUV4ZWMudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9leGVjLXV0aWxzLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvdmVuZG9ycy9zaWduYWwtZXhpdC50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZVN0cmVhbUpTT04udHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy92ZW5kb3JzL3N0cmVhbS1jaGFpbi50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3ZlbmRvcnMvc3RyZWFtLWpzb24udHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy91c2VTUUwudHN4IiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvc3FsLXV0aWxzLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvdXNlRm9ybS50c3giLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy91c2VBSS50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZUZyZWNlbmN5U29ydGluZy50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL3VzZUxvY2FsU3RvcmFnZS50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL2ljb24vaW5kZXgudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9pY29uL2F2YXRhci50cyIsICIuLi8uLi8uLi8uLi8uLi8uLi9Wb2x1bWVzL0RhdGEvZm91bmRhdGlvbnMvcGx1Z2lucy9iYWRnZXIvbm9kZV9tb2R1bGVzL0ByYXljYXN0L3V0aWxzL2Rpc3Qvc3JjL2ljb24vY29sb3IudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9pY29uL2Zhdmljb24udHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9pY29uL3Byb2dyZXNzLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvb2F1dGgvaW5kZXgudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9vYXV0aC9PQXV0aFNlcnZpY2UudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9vYXV0aC9wcm92aWRlcnMudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9vYXV0aC93aXRoQWNjZXNzVG9rZW4udHN4IiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvY3JlYXRlRGVlcGxpbmsudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL25vZGVfbW9kdWxlcy9AcmF5Y2FzdC91dGlscy9kaXN0L3NyYy9leGVjdXRlU1FMLnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvcnVuLWFwcGxlc2NyaXB0LnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvcnVuLXBvd2Vyc2hlbGwtc2NyaXB0LnRzIiwgIi4uLy4uLy4uLy4uLy4uLy4uL1ZvbHVtZXMvRGF0YS9mb3VuZGF0aW9ucy9wbHVnaW5zL2JhZGdlci9ub2RlX21vZHVsZXMvQHJheWNhc3QvdXRpbHMvZGlzdC9zcmMvY2FjaGUudHMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vVm9sdW1lcy9EYXRhL2ZvdW5kYXRpb25zL3BsdWdpbnMvYmFkZ2VyL3NyYy91dGlscy9zdG9yYWdlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgQmFkZ2VGb3JtIGZyb20gJy4vY29tcG9uZW50cy9mb3JtJ1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBBZGQoKSB7XG4gIHJldHVybiA8QmFkZ2VGb3JtIC8+XG59XG4iLCAiaW1wb3J0IHR5cGUgeyBBcHBsaWNhdGlvbiB9IGZyb20gJ0ByYXljYXN0L2FwaSdcbmltcG9ydCB7IEFjdGlvbiwgQWN0aW9uUGFuZWwsIEZvcm0sIGdldEFwcGxpY2F0aW9ucywgdXNlTmF2aWdhdGlvbiB9IGZyb20gJ0ByYXljYXN0L2FwaSdcbmltcG9ydCB7IHNob3dGYWlsdXJlVG9hc3QgfSBmcm9tICdAcmF5Y2FzdC91dGlscydcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBzdG9yYWdlIGZyb20gJy4uL3V0aWxzL3N0b3JhZ2UudHMnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEJhZGdlRm9ybShwcm9wczogeyBiYWRnZT86IEJhZGdlciB9KSB7XG4gIGNvbnN0IHsgYmFkZ2UgfSA9IHByb3BzXG4gIGNvbnN0IHsgcG9wIH0gPSB1c2VOYXZpZ2F0aW9uKClcbiAgY29uc3QgW2FwcHMsIHNldEFwcHNdID0gdXNlU3RhdGU8QXBwbGljYXRpb25bXT4oW10pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAoYXN5bmMgKCkgPT4gc2V0QXBwcyhhd2FpdCBnZXRBcHBsaWNhdGlvbnMoKSkpKClcbiAgfSwgW10pXG5cbiAgY29uc3Qgb25TdWJtaXQgPSBhc3luYyAodmFsdWVzOiBCYWRnZXIpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGJhZGdlKVxuICAgICAgICB2YWx1ZXMuYnVuZGxlSWQgPSBiYWRnZS5idW5kbGVJZFxuICAgICAgc3RvcmFnZS5zYXZlQmFkZ2UodmFsdWVzKS50aGVuKHBvcClcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhd2FpdCBzaG93RmFpbHVyZVRvYXN0KChlcnJvciBhcyBFcnJvcikubWVzc2FnZSlcbiAgICB9XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxGb3JtXG4gICAgICBpc0xvYWRpbmc9eyFhcHBzLmxlbmd0aH1cbiAgICAgIG5hdmlnYXRpb25UaXRsZT17IWJhZGdlID8gJ0FkZCBCYWRnZScgOiAnRWRpdCBCYWRnZSd9XG4gICAgICBhY3Rpb25zPXsoXG4gICAgICAgIDxBY3Rpb25QYW5lbD5cbiAgICAgICAgICA8QWN0aW9uLlN1Ym1pdEZvcm0gdGl0bGU9XCJTdWJtaXRcIiBvblN1Ym1pdD17b25TdWJtaXR9IC8+XG4gICAgICAgIDwvQWN0aW9uUGFuZWw+XG4gICAgICApfVxuICAgID5cbiAgICAgIHtiYWRnZSAmJiA8Rm9ybS5EZXNjcmlwdGlvbiB0ZXh0PXtiYWRnZS5hcHAubmFtZX0gLz59XG5cbiAgICAgIHshYmFkZ2UgJiYgKFxuICAgICAgICA8Rm9ybS5Ecm9wZG93blxuICAgICAgICAgIGlkPVwiYnVuZGxlSWRcIlxuICAgICAgICAgIGluZm89XCJDaG9vc2UgdGhlIGFwcGxpY2F0aW9uIHRvIG1vbml0b3IgZm9yIGJhZGdlcy4gS2VlcCBpbiBtaW5kIHRoYXQgbm90IGFsbCBhcHBsaWNhdGlvbnMgdXRpbGl6ZSBiYWRnZXMgZm9yIG5vdGlmaWNhdGlvbnMuXCJcbiAgICAgICAgPlxuICAgICAgICAgIHthcHBzLm1hcChhcHAgPT4gKFxuICAgICAgICAgICAgPEZvcm0uRHJvcGRvd24uSXRlbVxuICAgICAgICAgICAgICBrZXk9e2FwcC5idW5kbGVJZCB8fCBhcHAubmFtZX1cbiAgICAgICAgICAgICAgdmFsdWU9e2FwcC5idW5kbGVJZCB8fCBhcHAubmFtZX1cbiAgICAgICAgICAgICAgdGl0bGU9e2FwcC5uYW1lfVxuICAgICAgICAgICAgICBpY29uPXt7IGZpbGVJY29uOiBhcHAucGF0aCB9fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9Gb3JtLkRyb3Bkb3duPlxuICAgICAgKX1cblxuICAgICAgPEZvcm0uQ2hlY2tib3hcbiAgICAgICAgaWQ9XCJzaG93SW5hY3RpdmVcIlxuICAgICAgICBsYWJlbD1cIlNob3cgYmFkZ2VzIHdoZW4gdGhpcyBhcHBsaWNhdGlvbiBpcyBjbG9zZWRcIlxuICAgICAgICBpbmZvPVwiV2hlbiB0aGUgYXBwbGljYXRpb24gaXMgY2xvc2VkIGFuZCBrZXB0IGluIHRoZSBEb2NrLCB0aGUgYmFkZ2VzIHdpbGwgY29udGludWUgdG8gYXBwZWFyIGluIHRoZSBtZW51IGJhci5cIlxuICAgICAgICBkZWZhdWx0VmFsdWU9eyghYmFkZ2UgJiYgdHJ1ZSkgfHwgYmFkZ2Uuc2hvd0luYWN0aXZlfVxuICAgICAgLz5cbiAgICAgIDxGb3JtLkNoZWNrYm94XG4gICAgICAgIGlkPVwic2hvd0luZGV0ZXJtaW5hdGVcIlxuICAgICAgICBsYWJlbD1cIlNob3cgaW5kZXRlcm1pbmF0ZSBiYWRnZXNcIlxuICAgICAgICBpbmZvPVwiQW4gaW5kZXRlcm1pbmF0ZSBiYWRnZSBpcyBkaXNwbGF5ZWQgaW4gdGhlIERvY2sgYXMgYSBkb3Qgd2l0aG91dCBhIGNvdW50LiBXaGVuIGVuYWJsZWQsIHRoZSBiYWRnZSBjb3VudCBpbmNyZWFzZXMgYnkgb25lLlwiXG4gICAgICAgIGRlZmF1bHRWYWx1ZT17KCFiYWRnZSAmJiB0cnVlKSB8fCBiYWRnZS5zaG93SW5kZXRlcm1pbmF0ZX1cbiAgICAgIC8+XG5cbiAgICAgIDxGb3JtLkRlc2NyaXB0aW9uIHRleHQ9XCJcIiAvPlxuICAgICAgPEZvcm0uU2VwYXJhdG9yIC8+XG4gICAgICA8Rm9ybS5EZXNjcmlwdGlvbiB0ZXh0PVwiXCIgLz5cblxuICAgICAgPEZvcm0uRGVzY3JpcHRpb24gdGV4dD1cIkFwcGxpY2F0aW9ucyBtdXN0IGJlIG9wZW4gb3Iga2VwdCBpbiB0aGUgRG9jayBmb3IgYmFkZ2UgY291bnRzIHRvIGFwcGVhciBpbiB0aGUgbWVudSBiYXIuIEFkZGl0aW9uYWxseSwgUmF5Y2FzdCByZXF1aXJlcyB0aGUgQXV0b21hdGlvbiBhbmQgQWNjZXNzaWJpbGl0eSBwZXJtaXNzaW9ucyBpbiBvcmRlciB0byByZWFkIHRoZSBEb2NrIGJhZGdlcy5cIiAvPlxuICAgIDwvRm9ybT5cbiAgKVxufVxuIiwgIi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwibm9kZVwiIC8+XG5cbmV4cG9ydCB7IHVzZVByb21pc2UgfSBmcm9tIFwiLi91c2VQcm9taXNlXCI7XG5leHBvcnQgeyB1c2VDYWNoZWRTdGF0ZSB9IGZyb20gXCIuL3VzZUNhY2hlZFN0YXRlXCI7XG5leHBvcnQgeyB1c2VDYWNoZWRQcm9taXNlIH0gZnJvbSBcIi4vdXNlQ2FjaGVkUHJvbWlzZVwiO1xuZXhwb3J0IHsgdXNlRmV0Y2ggfSBmcm9tIFwiLi91c2VGZXRjaFwiO1xuZXhwb3J0IHsgdXNlRXhlYyB9IGZyb20gXCIuL3VzZUV4ZWNcIjtcbmV4cG9ydCB7IHVzZVN0cmVhbUpTT04gfSBmcm9tIFwiLi91c2VTdHJlYW1KU09OXCI7XG5leHBvcnQgeyB1c2VTUUwgfSBmcm9tIFwiLi91c2VTUUxcIjtcbmV4cG9ydCB7IHVzZUZvcm0sIEZvcm1WYWxpZGF0aW9uIH0gZnJvbSBcIi4vdXNlRm9ybVwiO1xuZXhwb3J0IHsgdXNlQUkgfSBmcm9tIFwiLi91c2VBSVwiO1xuZXhwb3J0IHsgdXNlRnJlY2VuY3lTb3J0aW5nIH0gZnJvbSBcIi4vdXNlRnJlY2VuY3lTb3J0aW5nXCI7XG5leHBvcnQgeyB1c2VMb2NhbFN0b3JhZ2UgfSBmcm9tIFwiLi91c2VMb2NhbFN0b3JhZ2VcIjtcblxuZXhwb3J0IHsgZ2V0QXZhdGFySWNvbiwgZ2V0RmF2aWNvbiwgZ2V0UHJvZ3Jlc3NJY29uIH0gZnJvbSBcIi4vaWNvblwiO1xuXG5leHBvcnQgeyBPQXV0aFNlcnZpY2UsIHdpdGhBY2Nlc3NUb2tlbiwgZ2V0QWNjZXNzVG9rZW4gfSBmcm9tIFwiLi9vYXV0aFwiO1xuXG5leHBvcnQgeyBjcmVhdGVEZWVwbGluaywgY3JlYXRlRXh0ZW5zaW9uRGVlcGxpbmssIGNyZWF0ZVNjcmlwdENvbW1hbmREZWVwbGluaywgRGVlcGxpbmtUeXBlIH0gZnJvbSBcIi4vY3JlYXRlRGVlcGxpbmtcIjtcbmV4cG9ydCB7IGV4ZWN1dGVTUUwgfSBmcm9tIFwiLi9leGVjdXRlU1FMXCI7XG5leHBvcnQgeyBydW5BcHBsZVNjcmlwdCB9IGZyb20gXCIuL3J1bi1hcHBsZXNjcmlwdFwiO1xuZXhwb3J0IHsgcnVuUG93ZXJTaGVsbFNjcmlwdCB9IGZyb20gXCIuL3J1bi1wb3dlcnNoZWxsLXNjcmlwdFwiO1xuZXhwb3J0IHsgc2hvd0ZhaWx1cmVUb2FzdCB9IGZyb20gXCIuL3Nob3dGYWlsdXJlVG9hc3RcIjtcbmV4cG9ydCB7IHdpdGhDYWNoZSB9IGZyb20gXCIuL2NhY2hlXCI7XG5cbmV4cG9ydCB0eXBlIHsgUHJvbWlzZU9wdGlvbnMgfSBmcm9tIFwiLi91c2VQcm9taXNlXCI7XG5leHBvcnQgdHlwZSB7IENhY2hlZFByb21pc2VPcHRpb25zIH0gZnJvbSBcIi4vdXNlQ2FjaGVkUHJvbWlzZVwiO1xuZXhwb3J0IHR5cGUge1xuICBPQXV0aFNlcnZpY2VPcHRpb25zLFxuICBPbkF1dGhvcml6ZVBhcmFtcyxcbiAgV2l0aEFjY2Vzc1Rva2VuQ29tcG9uZW50T3JGbixcbiAgUHJvdmlkZXJXaXRoRGVmYXVsdENsaWVudE9wdGlvbnMsXG4gIFByb3ZpZGVyT3B0aW9ucyxcbn0gZnJvbSBcIi4vb2F1dGhcIjtcbmV4cG9ydCB0eXBlIHsgQXN5bmNTdGF0ZSwgTXV0YXRlUHJvbWlzZSB9IGZyb20gXCIuL3R5cGVzXCI7XG4iLCAiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VDYWxsYmFjaywgUmVmT2JqZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBlbnZpcm9ubWVudCwgTGF1bmNoVHlwZSwgVG9hc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5pbXBvcnQgeyB1c2VEZWVwTWVtbyB9IGZyb20gXCIuL3VzZURlZXBNZW1vXCI7XG5pbXBvcnQge1xuICBGdW5jdGlvblJldHVybmluZ1Byb21pc2UsXG4gIE11dGF0ZVByb21pc2UsXG4gIFVzZVByb21pc2VSZXR1cm5UeXBlLFxuICBBc3luY1N0YXRlLFxuICBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsXG4gIFVud3JhcFJldHVybixcbiAgUGFnaW5hdGlvbk9wdGlvbnMsXG59IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyB1c2VMYXRlc3QgfSBmcm9tIFwiLi91c2VMYXRlc3RcIjtcbmltcG9ydCB7IHNob3dGYWlsdXJlVG9hc3QgfSBmcm9tIFwiLi9zaG93RmFpbHVyZVRvYXN0XCI7XG5cbmV4cG9ydCB0eXBlIFByb21pc2VPcHRpb25zPFQgZXh0ZW5kcyBGdW5jdGlvblJldHVybmluZ1Byb21pc2UgfCBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2U+ID0ge1xuICAvKipcbiAgICogQSByZWZlcmVuY2UgdG8gYW4gYEFib3J0Q29udHJvbGxlcmAgdG8gY2FuY2VsIGEgcHJldmlvdXMgY2FsbCB3aGVuIHRyaWdnZXJpbmcgYSBuZXcgb25lXG4gICAqL1xuICBhYm9ydGFibGU/OiBSZWZPYmplY3Q8QWJvcnRDb250cm9sbGVyIHwgbnVsbCB8IHVuZGVmaW5lZD47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGFjdHVhbGx5IGV4ZWN1dGUgdGhlIGZ1bmN0aW9uIG9yIG5vdC5cbiAgICogVGhpcyBpcyB1c2VmdWwgZm9yIGNhc2VzIHdoZXJlIG9uZSBvZiB0aGUgZnVuY3Rpb24ncyBhcmd1bWVudHMgZGVwZW5kcyBvbiBzb21ldGhpbmcgdGhhdFxuICAgKiBtaWdodCBub3QgYmUgYXZhaWxhYmxlIHJpZ2h0IGF3YXkgKGZvciBleGFtcGxlLCBkZXBlbmRzIG9uIHNvbWUgdXNlciBpbnB1dHMpLiBCZWNhdXNlIFJlYWN0IHJlcXVpcmVzXG4gICAqIGV2ZXJ5IGhvb2tzIHRvIGJlIGRlZmluZWQgb24gdGhlIHJlbmRlciwgdGhpcyBmbGFnIGVuYWJsZXMgeW91IHRvIGRlZmluZSB0aGUgaG9vayByaWdodCBhd2F5IGJ1dFxuICAgKiB3YWl0IHV0aWwgeW91IGhhdmUgYWxsIHRoZSBhcmd1bWVudHMgcmVhZHkgdG8gZXhlY3V0ZSB0aGUgZnVuY3Rpb24uXG4gICAqL1xuICBleGVjdXRlPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIE9wdGlvbnMgZm9yIHRoZSBnZW5lcmljIGZhaWx1cmUgdG9hc3QuXG4gICAqIEl0IGFsbG93cyB5b3UgdG8gY3VzdG9taXplIHRoZSB0aXRsZSwgbWVzc2FnZSwgYW5kIHByaW1hcnkgYWN0aW9uIG9mIHRoZSBmYWlsdXJlIHRvYXN0LlxuICAgKi9cbiAgZmFpbHVyZVRvYXN0T3B0aW9ucz86IFBhcnRpYWw8UGljazxUb2FzdC5PcHRpb25zLCBcInRpdGxlXCIgfCBcInByaW1hcnlBY3Rpb25cIiB8IFwibWVzc2FnZVwiPj47XG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiBhbiBleGVjdXRpb24gZmFpbHMuIEJ5IGRlZmF1bHQgaXQgd2lsbCBsb2cgdGhlIGVycm9yIGFuZCBzaG93XG4gICAqIGEgZ2VuZXJpYyBmYWlsdXJlIHRvYXN0LlxuICAgKi9cbiAgb25FcnJvcj86IChlcnJvcjogRXJyb3IpID0+IHZvaWQgfCBQcm9taXNlPHZvaWQ+O1xuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gYW4gZXhlY3V0aW9uIHN1Y2NlZWRzLlxuICAgKi9cbiAgb25EYXRhPzogKGRhdGE6IFVud3JhcFJldHVybjxUPiwgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zPFVud3JhcFJldHVybjxUPj4pID0+IHZvaWQgfCBQcm9taXNlPHZvaWQ+O1xuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gYW4gZXhlY3V0aW9uIHdpbGwgc3RhcnRcbiAgICovXG4gIG9uV2lsbEV4ZWN1dGU/OiAocGFyYW1ldGVyczogUGFyYW1ldGVyczxUPikgPT4gdm9pZDtcbn07XG5cbi8qKlxuICogV3JhcHMgYW4gYXN5bmNocm9ub3VzIGZ1bmN0aW9uIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgUHJvbWlzZSBpbiBhbm90aGVyIGZ1bmN0aW9uLCBhbmQgcmV0dXJucyB0aGUge0BsaW5rIEFzeW5jU3RhdGV9IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24uXG4gKlxuICogQHJlbWFyayBUaGlzIG92ZXJsb2FkIHNob3VsZCBiZSB1c2VkIHdoZW4gd29ya2luZyB3aXRoIHBhZ2luYXRlZCBkYXRhIHNvdXJjZXMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYFxuICogaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gXCJub2RlOnRpbWVycy9wcm9taXNlc1wiO1xuICogaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbiAqIGltcG9ydCB7IExpc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG4gKiBpbXBvcnQgeyB1c2VQcm9taXNlIH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoXCJcIik7XG4gKlxuICogICBjb25zdCB7IGlzTG9hZGluZywgZGF0YSwgcGFnaW5hdGlvbiB9ID0gdXNlUHJvbWlzZShcbiAqICAgICAoc2VhcmNoVGV4dDogc3RyaW5nKSA9PiBhc3luYyAob3B0aW9uczogeyBwYWdlOiBudW1iZXIgfSkgPT4ge1xuICogICAgICAgYXdhaXQgc2V0VGltZW91dCgyMDApO1xuICogICAgICAgY29uc3QgbmV3RGF0YSA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDI1IH0sIChfdiwgaW5kZXgpID0+ICh7XG4gKiAgICAgICAgIGluZGV4LFxuICogICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UsXG4gKiAgICAgICAgIHRleHQ6IHNlYXJjaFRleHQsXG4gKiAgICAgICB9KSk7XG4gKiAgICAgICByZXR1cm4geyBkYXRhOiBuZXdEYXRhLCBoYXNNb3JlOiBvcHRpb25zLnBhZ2UgPCAxMCB9O1xuICogICAgIH0sXG4gKiAgICAgW3NlYXJjaFRleHRdXG4gKiAgICk7XG4gKlxuICogICByZXR1cm4gKFxuICogICAgIDxMaXN0IGlzTG9hZGluZz17aXNMb2FkaW5nfSBvblNlYXJjaFRleHRDaGFuZ2U9e3NldFNlYXJjaFRleHR9IHBhZ2luYXRpb249e3BhZ2luYXRpb259PlxuICogICAgICAge2RhdGE/Lm1hcCgoaXRlbSkgPT4gKFxuICogICAgICAgICA8TGlzdC5JdGVtXG4gKiAgICAgICAgICAga2V5PXtgJHtpdGVtLnBhZ2V9ICR7aXRlbS5pbmRleH0gJHtpdGVtLnRleHR9YH1cbiAqICAgICAgICAgICB0aXRsZT17YFBhZ2UgJHtpdGVtLnBhZ2V9IEl0ZW0gJHtpdGVtLmluZGV4fWB9XG4gKiAgICAgICAgICAgc3VidGl0bGU9e2l0ZW0udGV4dH1cbiAqICAgICAgICAgLz5cbiAqICAgICAgICkpfVxuICogICAgIDwvTGlzdD5cbiAqICAgKTtcbiAqIH07XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVByb21pc2U8VCBleHRlbmRzIEZ1bmN0aW9uUmV0dXJuaW5nUGFnaW5hdGVkUHJvbWlzZTxbXT4+KFxuICBmbjogVCxcbik6IFVzZVByb21pc2VSZXR1cm5UeXBlPFVud3JhcFJldHVybjxUPj47XG5leHBvcnQgZnVuY3Rpb24gdXNlUHJvbWlzZTxUIGV4dGVuZHMgRnVuY3Rpb25SZXR1cm5pbmdQYWdpbmF0ZWRQcm9taXNlPihcbiAgZm46IFQsXG4gIGFyZ3M6IFBhcmFtZXRlcnM8VD4sXG4gIG9wdGlvbnM/OiBQcm9taXNlT3B0aW9uczxUPixcbik6IFVzZVByb21pc2VSZXR1cm5UeXBlPFVud3JhcFJldHVybjxUPj47XG5cbi8qKlxuICogV3JhcHMgYW4gYXN5bmNocm9ub3VzIGZ1bmN0aW9uIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgUHJvbWlzZSBhbmQgcmV0dXJucyB0aGUge0BsaW5rIEFzeW5jU3RhdGV9IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24uXG4gKlxuICogQHJlbWFyayBUaGUgZnVuY3Rpb24gaXMgYXNzdW1lZCB0byBiZSBjb25zdGFudCAoZWcuIGNoYW5naW5nIGl0IHdvbid0IHRyaWdnZXIgYSByZXZhbGlkYXRpb24pLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IHVzZVByb21pc2UgfSBmcm9tICdAcmF5Y2FzdC91dGlscyc7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgYWJvcnRhYmxlID0gdXNlUmVmPEFib3J0Q29udHJvbGxlcj4oKTtcbiAqICAgY29uc3QgeyBpc0xvYWRpbmcsIGRhdGEsIHJldmFsaWRhdGUgfSA9IHVzZVByb21pc2UoYXN5bmMgKHVybDogc3RyaW5nKSA9PiB7XG4gKiAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsgc2lnbmFsOiBhYm9ydGFibGUuY3VycmVudD8uc2lnbmFsIH0pO1xuICogICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAqICAgICByZXR1cm4gcmVzdWx0XG4gKiAgIH0sXG4gKiAgIFsnaHR0cHM6Ly9hcGkuZXhhbXBsZSddLFxuICogICB7XG4gKiAgICAgYWJvcnRhYmxlXG4gKiAgIH0pO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8RGV0YWlsXG4gKiAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAqICAgICAgIG1hcmtkb3duPXtkYXRhfVxuICogICAgICAgYWN0aW9ucz17XG4gKiAgICAgICAgIDxBY3Rpb25QYW5lbD5cbiAqICAgICAgICAgICA8QWN0aW9uIHRpdGxlPVwiUmVsb2FkXCIgb25BY3Rpb249eygpID0+IHJldmFsaWRhdGUoKX0gLz5cbiAqICAgICAgICAgPC9BY3Rpb25QYW5lbD5cbiAqICAgICAgIH1cbiAqICAgICAvPlxuICogICApO1xuICogfTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUHJvbWlzZTxUIGV4dGVuZHMgRnVuY3Rpb25SZXR1cm5pbmdQcm9taXNlPFtdPj4oZm46IFQpOiBVc2VQcm9taXNlUmV0dXJuVHlwZTxVbndyYXBSZXR1cm48VD4+O1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVByb21pc2U8VCBleHRlbmRzIEZ1bmN0aW9uUmV0dXJuaW5nUHJvbWlzZT4oXG4gIGZuOiBULFxuICBhcmdzOiBQYXJhbWV0ZXJzPFQ+LFxuICBvcHRpb25zPzogUHJvbWlzZU9wdGlvbnM8VD4sXG4pOiBVc2VQcm9taXNlUmV0dXJuVHlwZTxVbndyYXBSZXR1cm48VD4+O1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlUHJvbWlzZTxUIGV4dGVuZHMgRnVuY3Rpb25SZXR1cm5pbmdQcm9taXNlIHwgRnVuY3Rpb25SZXR1cm5pbmdQYWdpbmF0ZWRQcm9taXNlPihcbiAgZm46IFQsXG4gIGFyZ3M/OiBQYXJhbWV0ZXJzPFQ+LFxuICBvcHRpb25zPzogUHJvbWlzZU9wdGlvbnM8VD4sXG4pOiBVc2VQcm9taXNlUmV0dXJuVHlwZTxhbnk+IHtcbiAgY29uc3QgbGFzdENhbGxJZCA9IHVzZVJlZigwKTtcbiAgY29uc3QgW3N0YXRlLCBzZXRdID0gdXNlU3RhdGU8QXN5bmNTdGF0ZTxVbndyYXBSZXR1cm48VD4+Pih7IGlzTG9hZGluZzogdHJ1ZSB9KTtcblxuICBjb25zdCBmblJlZiA9IHVzZUxhdGVzdChmbik7XG4gIGNvbnN0IGxhdGVzdEFib3J0YWJsZSA9IHVzZUxhdGVzdChvcHRpb25zPy5hYm9ydGFibGUpO1xuICBjb25zdCBsYXRlc3RBcmdzID0gdXNlTGF0ZXN0KGFyZ3MgfHwgW10pO1xuICBjb25zdCBsYXRlc3RPbkVycm9yID0gdXNlTGF0ZXN0KG9wdGlvbnM/Lm9uRXJyb3IpO1xuICBjb25zdCBsYXRlc3RPbkRhdGEgPSB1c2VMYXRlc3Qob3B0aW9ucz8ub25EYXRhKTtcbiAgY29uc3QgbGF0ZXN0T25XaWxsRXhlY3V0ZSA9IHVzZUxhdGVzdChvcHRpb25zPy5vbldpbGxFeGVjdXRlKTtcbiAgY29uc3QgbGF0ZXN0RmFpbHVyZVRvYXN0ID0gdXNlTGF0ZXN0KG9wdGlvbnM/LmZhaWx1cmVUb2FzdE9wdGlvbnMpO1xuICBjb25zdCBsYXRlc3RWYWx1ZSA9IHVzZUxhdGVzdChzdGF0ZS5kYXRhKTtcbiAgY29uc3QgbGF0ZXN0Q2FsbGJhY2sgPSB1c2VSZWY8KC4uLmFyZ3M6IFBhcmFtZXRlcnM8VD4pID0+IFByb21pc2U8VW53cmFwUmV0dXJuPFQ+Pj4obnVsbCk7XG5cbiAgY29uc3QgcGFnaW5hdGlvbkFyZ3NSZWYgPSB1c2VSZWY8UGFnaW5hdGlvbk9wdGlvbnM+KHsgcGFnZTogMCB9KTtcbiAgY29uc3QgdXNlUGFnaW5hdGlvblJlZiA9IHVzZVJlZihmYWxzZSk7XG4gIGNvbnN0IGhhc01vcmVSZWYgPSB1c2VSZWYodHJ1ZSk7XG4gIGNvbnN0IHBhZ2VTaXplUmVmID0gdXNlUmVmKDUwKTtcblxuICBjb25zdCBhYm9ydCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAobGF0ZXN0QWJvcnRhYmxlLmN1cnJlbnQpIHtcbiAgICAgIGxhdGVzdEFib3J0YWJsZS5jdXJyZW50LmN1cnJlbnQ/LmFib3J0KCk7XG4gICAgICBsYXRlc3RBYm9ydGFibGUuY3VycmVudC5jdXJyZW50ID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIH1cbiAgICByZXR1cm4gKytsYXN0Q2FsbElkLmN1cnJlbnQ7XG4gIH0sIFtsYXRlc3RBYm9ydGFibGVdKTtcblxuICBjb25zdCBjYWxsYmFjayA9IHVzZUNhbGxiYWNrKFxuICAgICguLi5hcmdzOiBQYXJhbWV0ZXJzPFQ+KTogUHJvbWlzZTxVbndyYXBSZXR1cm48VD4+ID0+IHtcbiAgICAgIGNvbnN0IGNhbGxJZCA9IGFib3J0KCk7XG5cbiAgICAgIGxhdGVzdE9uV2lsbEV4ZWN1dGUuY3VycmVudD8uKGFyZ3MpO1xuXG4gICAgICBzZXQoKHByZXZTdGF0ZSkgPT4gKHsgLi4ucHJldlN0YXRlLCBpc0xvYWRpbmc6IHRydWUgfSkpO1xuXG4gICAgICBjb25zdCBwcm9taXNlT3JQYWdpbmF0ZWRQcm9taXNlID0gYmluZFByb21pc2VJZk5lZWRlZChmblJlZi5jdXJyZW50KSguLi5hcmdzKTtcblxuICAgICAgZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyb3I6IGFueSkge1xuICAgICAgICBpZiAoZXJyb3IubmFtZSA9PSBcIkFib3J0RXJyb3JcIikge1xuICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYWxsSWQgPT09IGxhc3RDYWxsSWQuY3VycmVudCkge1xuICAgICAgICAgIC8vIGhhbmRsZSBlcnJvcnNcbiAgICAgICAgICBpZiAobGF0ZXN0T25FcnJvci5jdXJyZW50KSB7XG4gICAgICAgICAgICBsYXRlc3RPbkVycm9yLmN1cnJlbnQoZXJyb3IpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZW52aXJvbm1lbnQubGF1bmNoVHlwZSAhPT0gTGF1bmNoVHlwZS5CYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgICAgIHNob3dGYWlsdXJlVG9hc3QoZXJyb3IsIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJGYWlsZWQgdG8gZmV0Y2ggbGF0ZXN0IGRhdGFcIixcbiAgICAgICAgICAgICAgICBwcmltYXJ5QWN0aW9uOiB7XG4gICAgICAgICAgICAgICAgICB0aXRsZTogXCJSZXRyeVwiLFxuICAgICAgICAgICAgICAgICAgb25BY3Rpb24odG9hc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3QuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICBsYXRlc3RDYWxsYmFjay5jdXJyZW50Py4oLi4uKChsYXRlc3RBcmdzLmN1cnJlbnQgfHwgW10pIGFzIFBhcmFtZXRlcnM8VD4pKTtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi5sYXRlc3RGYWlsdXJlVG9hc3QuY3VycmVudCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHNldCh7IGVycm9yLCBpc0xvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIHByb21pc2VPclBhZ2luYXRlZFByb21pc2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICB1c2VQYWdpbmF0aW9uUmVmLmN1cnJlbnQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gcHJvbWlzZU9yUGFnaW5hdGVkUHJvbWlzZShwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50KS50aGVuKFxuICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdG9vIGNvbXBsaWNhdGVkIGZvciBUU1xuICAgICAgICAgICh7IGRhdGEsIGhhc01vcmUsIGN1cnNvciB9OiB7IGRhdGE6IFVud3JhcFJldHVybjxUPjsgaGFzTW9yZTogYm9vbGVhbjsgY3Vyc29yPzogYW55IH0pID0+IHtcbiAgICAgICAgICAgIGlmIChjYWxsSWQgPT09IGxhc3RDYWxsSWQuY3VycmVudCkge1xuICAgICAgICAgICAgICBpZiAocGFnaW5hdGlvbkFyZ3NSZWYuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIHBhZ2luYXRpb25BcmdzUmVmLmN1cnJlbnQuY3Vyc29yID0gY3Vyc29yO1xuICAgICAgICAgICAgICAgIHBhZ2luYXRpb25BcmdzUmVmLmN1cnJlbnQubGFzdEl0ZW0gPSBkYXRhPy5bZGF0YS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChsYXRlc3RPbkRhdGEuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIGxhdGVzdE9uRGF0YS5jdXJyZW50KGRhdGEsIHBhZ2luYXRpb25BcmdzUmVmLmN1cnJlbnQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGhhc01vcmUpIHtcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZVJlZi5jdXJyZW50ID0gZGF0YS5sZW5ndGg7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaGFzTW9yZVJlZi5jdXJyZW50ID0gaGFzTW9yZTtcblxuICAgICAgICAgICAgICBzZXQoKHByZXZpb3VzRGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50LnBhZ2UgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB7IGRhdGEsIGlzTG9hZGluZzogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciB3ZSBrbm93IGl0J3MgYW4gYXJyYXkgaGVyZVxuICAgICAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IChwcmV2aW91c0RhdGEuZGF0YSB8fCBbXSk/LmNvbmNhdChkYXRhKSwgaXNMb2FkaW5nOiBmYWxzZSB9O1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAoZXJyb3I6IHVua25vd24pID0+IHtcbiAgICAgICAgICAgIGhhc01vcmVSZWYuY3VycmVudCA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICB9LFxuICAgICAgICApIGFzIFByb21pc2U8VW53cmFwUmV0dXJuPFQ+PjtcbiAgICAgIH1cblxuICAgICAgdXNlUGFnaW5hdGlvblJlZi5jdXJyZW50ID0gZmFsc2U7XG4gICAgICByZXR1cm4gcHJvbWlzZU9yUGFnaW5hdGVkUHJvbWlzZS50aGVuKChkYXRhOiBVbndyYXBSZXR1cm48VD4pID0+IHtcbiAgICAgICAgaWYgKGNhbGxJZCA9PT0gbGFzdENhbGxJZC5jdXJyZW50KSB7XG4gICAgICAgICAgaWYgKGxhdGVzdE9uRGF0YS5jdXJyZW50KSB7XG4gICAgICAgICAgICBsYXRlc3RPbkRhdGEuY3VycmVudChkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2V0KHsgZGF0YSwgaXNMb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSwgaGFuZGxlRXJyb3IpIGFzIFByb21pc2U8VW53cmFwUmV0dXJuPFQ+PjtcbiAgICB9LFxuICAgIFtcbiAgICAgIGxhdGVzdE9uRGF0YSxcbiAgICAgIGxhdGVzdE9uRXJyb3IsXG4gICAgICBsYXRlc3RBcmdzLFxuICAgICAgZm5SZWYsXG4gICAgICBzZXQsXG4gICAgICBsYXRlc3RDYWxsYmFjayxcbiAgICAgIGxhdGVzdE9uV2lsbEV4ZWN1dGUsXG4gICAgICBwYWdpbmF0aW9uQXJnc1JlZixcbiAgICAgIGxhdGVzdEZhaWx1cmVUb2FzdCxcbiAgICAgIGFib3J0LFxuICAgIF0sXG4gICk7XG5cbiAgbGF0ZXN0Q2FsbGJhY2suY3VycmVudCA9IGNhbGxiYWNrO1xuXG4gIGNvbnN0IHJldmFsaWRhdGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgLy8gcmVzZXQgdGhlIHBhZ2luYXRpb25cbiAgICBwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50ID0geyBwYWdlOiAwIH07XG5cbiAgICBjb25zdCBhcmdzID0gKGxhdGVzdEFyZ3MuY3VycmVudCB8fCBbXSkgYXMgUGFyYW1ldGVyczxUPjtcbiAgICByZXR1cm4gY2FsbGJhY2soLi4uYXJncyk7XG4gIH0sIFtjYWxsYmFjaywgbGF0ZXN0QXJnc10pO1xuXG4gIGNvbnN0IG11dGF0ZSA9IHVzZUNhbGxiYWNrPE11dGF0ZVByb21pc2U8QXdhaXRlZDxSZXR1cm5UeXBlPFQ+PiwgdW5kZWZpbmVkPj4oXG4gICAgYXN5bmMgKGFzeW5jVXBkYXRlLCBvcHRpb25zKSA9PiB7XG4gICAgICBsZXQgZGF0YUJlZm9yZU9wdGltaXN0aWNVcGRhdGU6IEF3YWl0ZWQ8UmV0dXJuVHlwZTxUPj4gfCB1bmRlZmluZWQ7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAob3B0aW9ucz8ub3B0aW1pc3RpY1VwZGF0ZSkge1xuICAgICAgICAgIC8vIGNhbmNlbCB0aGUgaW4tZmxpZ2h0IHJlcXVlc3QgdG8gbWFrZSBzdXJlIGl0IHdvbid0IG92ZXJ3cml0ZSB0aGUgb3B0aW1pc3RpYyB1cGRhdGVcbiAgICAgICAgICBhYm9ydCgpO1xuXG4gICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IFwiZnVuY3Rpb25cIiAmJiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBkYXRhIGJlZm9yZSB0aGUgb3B0aW1pc3RpYyB1cGRhdGUsXG4gICAgICAgICAgICAvLyBidXQgb25seSBpZiB3ZSBuZWVkIGl0IChlZy4gb25seSB3aGVuIHdlIHdhbnQgdG8gYXV0b21hdGljYWxseSByb2xsYmFjayBhZnRlcilcbiAgICAgICAgICAgIGRhdGFCZWZvcmVPcHRpbWlzdGljVXBkYXRlID0gc3RydWN0dXJlZENsb25lKGxhdGVzdFZhbHVlLmN1cnJlbnQ/LnZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdXBkYXRlID0gb3B0aW9ucy5vcHRpbWlzdGljVXBkYXRlO1xuICAgICAgICAgIHNldCgocHJldlN0YXRlKSA9PiAoeyAuLi5wcmV2U3RhdGUsIGRhdGE6IHVwZGF0ZShwcmV2U3RhdGUuZGF0YSkgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBhc3luY1VwZGF0ZTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnM/LnJvbGxiYWNrT25FcnJvciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY29uc3QgdXBkYXRlID0gb3B0aW9ucy5yb2xsYmFja09uRXJyb3I7XG4gICAgICAgICAgc2V0KChwcmV2U3RhdGUpID0+ICh7IC4uLnByZXZTdGF0ZSwgZGF0YTogdXBkYXRlKHByZXZTdGF0ZS5kYXRhKSB9KSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucz8ub3B0aW1pc3RpY1VwZGF0ZSAmJiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IGZhbHNlKSB7XG4gICAgICAgICAgc2V0KChwcmV2U3RhdGUpID0+ICh7IC4uLnByZXZTdGF0ZSwgZGF0YTogZGF0YUJlZm9yZU9wdGltaXN0aWNVcGRhdGUgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGlmIChvcHRpb25zPy5zaG91bGRSZXZhbGlkYXRlQWZ0ZXIgIT09IGZhbHNlKSB7XG4gICAgICAgICAgaWYgKGVudmlyb25tZW50LmxhdW5jaFR5cGUgPT09IExhdW5jaFR5cGUuQmFja2dyb3VuZCB8fCBlbnZpcm9ubWVudC5jb21tYW5kTW9kZSA9PT0gXCJtZW51LWJhclwiKSB7XG4gICAgICAgICAgICAvLyB3aGVuIGluIHRoZSBiYWNrZ3JvdW5kIG9yIGluIGEgbWVudSBiYXIsIHdlIGFyZSBnb2luZyB0byBhd2FpdCB0aGUgcmV2YWxpZGF0aW9uXG4gICAgICAgICAgICAvLyB0byBtYWtlIHN1cmUgd2UgZ2V0IHRoZSByaWdodCBkYXRhIGF0IHRoZSBlbmQgb2YgdGhlIG11dGF0aW9uXG4gICAgICAgICAgICBhd2FpdCByZXZhbGlkYXRlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldmFsaWRhdGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIFtyZXZhbGlkYXRlLCBsYXRlc3RWYWx1ZSwgc2V0LCBhYm9ydF0sXG4gICk7XG5cbiAgY29uc3Qgb25Mb2FkTW9yZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50LnBhZ2UgKz0gMTtcbiAgICBjb25zdCBhcmdzID0gKGxhdGVzdEFyZ3MuY3VycmVudCB8fCBbXSkgYXMgUGFyYW1ldGVyczxUPjtcbiAgICBjYWxsYmFjayguLi5hcmdzKTtcbiAgfSwgW3BhZ2luYXRpb25BcmdzUmVmLCBsYXRlc3RBcmdzLCBjYWxsYmFja10pO1xuXG4gIC8vIHJldmFsaWRhdGUgd2hlbiB0aGUgYXJncyBjaGFuZ2VcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyByZXNldCB0aGUgcGFnaW5hdGlvblxuICAgIHBhZ2luYXRpb25BcmdzUmVmLmN1cnJlbnQgPSB7IHBhZ2U6IDAgfTtcblxuICAgIGlmIChvcHRpb25zPy5leGVjdXRlICE9PSBmYWxzZSkge1xuICAgICAgY2FsbGJhY2soLi4uKChhcmdzIHx8IFtdKSBhcyBQYXJhbWV0ZXJzPFQ+KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGNhbmNlbCB0aGUgcHJldmlvdXMgcmVxdWVzdCBpZiB3ZSBkb24ndCB3YW50IHRvIGV4ZWN1dGUgYW55bW9yZVxuICAgICAgYWJvcnQoKTtcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICB9LCBbdXNlRGVlcE1lbW8oW2FyZ3MsIG9wdGlvbnM/LmV4ZWN1dGUsIGNhbGxiYWNrXSksIGxhdGVzdEFib3J0YWJsZSwgcGFnaW5hdGlvbkFyZ3NSZWZdKTtcblxuICAvLyBhYm9ydCByZXF1ZXN0IHdoZW4gdW5tb3VudGluZ1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBhYm9ydCgpO1xuICAgIH07XG4gIH0sIFthYm9ydF0pO1xuXG4gIC8vIHdlIG9ubHkgd2FudCB0byBzaG93IHRoZSBsb2FkaW5nIGluZGljYXRvciBpZiB0aGUgcHJvbWlzZSBpcyBleGVjdXRpbmdcbiAgY29uc3QgaXNMb2FkaW5nID0gb3B0aW9ucz8uZXhlY3V0ZSAhPT0gZmFsc2UgPyBzdGF0ZS5pc0xvYWRpbmcgOiBmYWxzZTtcblxuICAvLyBAdHMtZXhwZWN0LWVycm9yIGxvYWRpbmcgaXMgaGFzIHNvbWUgZml4ZWQgdmFsdWUgaW4gdGhlIGVudW0gd2hpY2hcbiAgY29uc3Qgc3RhdGVXaXRoTG9hZGluZ0ZpeGVkOiBBc3luY1N0YXRlPEF3YWl0ZWQ8UmV0dXJuVHlwZTxUPj4+ID0geyAuLi5zdGF0ZSwgaXNMb2FkaW5nIH07XG5cbiAgY29uc3QgcGFnaW5hdGlvbiA9IHVzZVBhZ2luYXRpb25SZWYuY3VycmVudFxuICAgID8ge1xuICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVSZWYuY3VycmVudCxcbiAgICAgICAgaGFzTW9yZTogaGFzTW9yZVJlZi5jdXJyZW50LFxuICAgICAgICBvbkxvYWRNb3JlLFxuICAgICAgfVxuICAgIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiB7IC4uLnN0YXRlV2l0aExvYWRpbmdGaXhlZCwgcmV2YWxpZGF0ZSwgbXV0YXRlLCBwYWdpbmF0aW9uIH07XG59XG5cbi8qKiBCaW5kIHRoZSBmbiBpZiBpdCdzIGEgUHJvbWlzZSBtZXRob2QgKi9cbmZ1bmN0aW9uIGJpbmRQcm9taXNlSWZOZWVkZWQ8VD4oZm46IFQpOiBUIHtcbiAgaWYgKGZuID09PSAoUHJvbWlzZS5hbGwgYXMgYW55KSkge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdGhpcyBpcyBmaW5lXG4gICAgcmV0dXJuIGZuLmJpbmQoUHJvbWlzZSk7XG4gIH1cbiAgaWYgKGZuID09PSAoUHJvbWlzZS5yYWNlIGFzIGFueSkpIHtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHRoaXMgaXMgZmluZVxuICAgIHJldHVybiBmbi5iaW5kKFByb21pc2UpO1xuICB9XG4gIGlmIChmbiA9PT0gKFByb21pc2UucmVzb2x2ZSBhcyBhbnkpKSB7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciB0aGlzIGlzIGZpbmVcbiAgICByZXR1cm4gZm4uYmluZChQcm9taXNlIGFzIGFueSk7XG4gIH1cbiAgaWYgKGZuID09PSAoUHJvbWlzZS5yZWplY3QgYXMgYW55KSkge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdGhpcyBpcyBmaW5lXG4gICAgcmV0dXJuIGZuLmJpbmQoUHJvbWlzZSk7XG4gIH1cbiAgcmV0dXJuIGZuO1xufVxuIiwgImltcG9ydCB7IHVzZVJlZiwgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgZGVxdWFsIH0gZnJvbSBcImRlcXVhbC9saXRlXCI7XG5cbi8qKlxuICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byBiZSBtZW1vaXplZCAodXN1YWxseSBhIGRlcGVuZGVuY3kgbGlzdClcbiAqIEByZXR1cm5zIGEgbWVtb2l6ZWQgdmVyc2lvbiBvZiB0aGUgdmFsdWUgYXMgbG9uZyBhcyBpdCByZW1haW5zIGRlZXBseSBlcXVhbFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRGVlcE1lbW88VD4odmFsdWU6IFQpIHtcbiAgY29uc3QgcmVmID0gdXNlUmVmPFQ+KHZhbHVlKTtcbiAgY29uc3Qgc2lnbmFsUmVmID0gdXNlUmVmPG51bWJlcj4oMCk7XG5cbiAgaWYgKCFkZXF1YWwodmFsdWUsIHJlZi5jdXJyZW50KSkge1xuICAgIHJlZi5jdXJyZW50ID0gdmFsdWU7XG4gICAgc2lnbmFsUmVmLmN1cnJlbnQgKz0gMTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4gcmVmLmN1cnJlbnQsIFtzaWduYWxSZWYuY3VycmVudF0pO1xufVxuIiwgImltcG9ydCB7IHVzZVJlZiB9IGZyb20gXCJyZWFjdFwiO1xuXG4vKipcbiAqIFJldHVybnMgdGhlIGxhdGVzdCBzdGF0ZS5cbiAqXG4gKiBUaGlzIGlzIG1vc3RseSB1c2VmdWwgdG8gZ2V0IGFjY2VzcyB0byB0aGUgbGF0ZXN0IHZhbHVlIG9mIHNvbWUgcHJvcHMgb3Igc3RhdGUgaW5zaWRlIGFuIGFzeW5jaHJvbm91cyBjYWxsYmFjaywgaW5zdGVhZCBvZiB0aGF0IHZhbHVlIGF0IHRoZSB0aW1lIHRoZSBjYWxsYmFjayB3YXMgY3JlYXRlZCBmcm9tLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlTGF0ZXN0PFQ+KHZhbHVlOiBUKTogeyByZWFkb25seSBjdXJyZW50OiBUIH0ge1xuICBjb25zdCByZWYgPSB1c2VSZWYodmFsdWUpO1xuICByZWYuY3VycmVudCA9IHZhbHVlO1xuICByZXR1cm4gcmVmO1xufVxuIiwgImltcG9ydCAqIGFzIGZzIGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJub2RlOnBhdGhcIjtcbmltcG9ydCB7IENsaXBib2FyZCwgZW52aXJvbm1lbnQsIG9wZW4sIFRvYXN0LCBzaG93VG9hc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5cbi8qKlxuICogU2hvd3MgYSBmYWlsdXJlIFRvYXN0IGZvciBhIGdpdmVuIEVycm9yLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBzaG93SFVEIH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuICogaW1wb3J0IHsgcnVuQXBwbGVTY3JpcHQsIHNob3dGYWlsdXJlVG9hc3QgfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gKiAgIHRyeSB7XG4gKiAgICAgY29uc3QgcmVzID0gYXdhaXQgcnVuQXBwbGVTY3JpcHQoXG4gKiAgICAgICBgXG4gKiAgICAgICBvbiBydW4gYXJndlxuICogICAgICAgICByZXR1cm4gXCJoZWxsbywgXCIgJiBpdGVtIDEgb2YgYXJndiAmIFwiLlwiXG4gKiAgICAgICBlbmQgcnVuXG4gKiAgICAgICBgLFxuICogICAgICAgW1wid29ybGRcIl1cbiAqICAgICApO1xuICogICAgIGF3YWl0IHNob3dIVUQocmVzKTtcbiAqICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAqICAgICBzaG93RmFpbHVyZVRvYXN0KGVycm9yLCB7IHRpdGxlOiBcIkNvdWxkIG5vdCBydW4gQXBwbGVTY3JpcHRcIiB9KTtcbiAqICAgfVxuICogfVxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RmFpbHVyZVRvYXN0KFxuICBlcnJvcjogdW5rbm93bixcbiAgb3B0aW9ucz86IFBhcnRpYWw8UGljazxUb2FzdC5PcHRpb25zLCBcInRpdGxlXCIgfCBcInByaW1hcnlBY3Rpb25cIiB8IFwibWVzc2FnZVwiPj4sXG4pIHtcbiAgY29uc3QgbWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgcmV0dXJuIHNob3dUb2FzdCh7XG4gICAgc3R5bGU6IFRvYXN0LlN0eWxlLkZhaWx1cmUsXG4gICAgdGl0bGU6IG9wdGlvbnM/LnRpdGxlID8/IFwiU29tZXRoaW5nIHdlbnQgd3JvbmdcIixcbiAgICBtZXNzYWdlOiBvcHRpb25zPy5tZXNzYWdlID8/IG1lc3NhZ2UsXG4gICAgcHJpbWFyeUFjdGlvbjogb3B0aW9ucz8ucHJpbWFyeUFjdGlvbiA/PyBoYW5kbGVFcnJvclRvYXN0QWN0aW9uKGVycm9yKSxcbiAgICBzZWNvbmRhcnlBY3Rpb246IG9wdGlvbnM/LnByaW1hcnlBY3Rpb24gPyBoYW5kbGVFcnJvclRvYXN0QWN0aW9uKGVycm9yKSA6IHVuZGVmaW5lZCxcbiAgfSk7XG59XG5cbmNvbnN0IGhhbmRsZUVycm9yVG9hc3RBY3Rpb24gPSAoZXJyb3I6IHVua25vd24pOiBUb2FzdC5BY3Rpb25PcHRpb25zID0+IHtcbiAgbGV0IHByaXZhdGVFeHRlbnNpb24gPSB0cnVlO1xuICBsZXQgdGl0bGUgPSBcIltFeHRlbnNpb24gTmFtZV0uLi5cIjtcbiAgbGV0IGV4dGVuc2lvblVSTCA9IFwiXCI7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFja2FnZUpTT04gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oZW52aXJvbm1lbnQuYXNzZXRzUGF0aCwgXCIuLlwiLCBcInBhY2thZ2UuanNvblwiKSwgXCJ1dGY4XCIpKTtcbiAgICB0aXRsZSA9IGBbJHtwYWNrYWdlSlNPTi50aXRsZX1dLi4uYDtcbiAgICBleHRlbnNpb25VUkwgPSBgaHR0cHM6Ly9yYXljYXN0LmNvbS8ke3BhY2thZ2VKU09OLm93bmVyIHx8IHBhY2thZ2VKU09OLmF1dGhvcn0vJHtwYWNrYWdlSlNPTi5uYW1lfWA7XG4gICAgaWYgKCFwYWNrYWdlSlNPTi5vd25lciB8fCBwYWNrYWdlSlNPTi5hY2Nlc3MgPT09IFwicHVibGljXCIpIHtcbiAgICAgIHByaXZhdGVFeHRlbnNpb24gPSBmYWxzZTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIG5vLW9wXG4gIH1cblxuICAvLyBpZiBpdCdzIGEgcHJpdmF0ZSBleHRlbnNpb24sIHdlIGNhbid0IGNvbnN0cnVjdCB0aGUgVVJMIHRvIHJlcG9ydCB0aGUgZXJyb3JcbiAgLy8gc28gd2UgZmFsbGJhY2sgdG8gY29weWluZyB0aGUgZXJyb3IgdG8gdGhlIGNsaXBib2FyZFxuICBjb25zdCBmYWxsYmFjayA9IGVudmlyb25tZW50LmlzRGV2ZWxvcG1lbnQgfHwgcHJpdmF0ZUV4dGVuc2lvbjtcblxuICBjb25zdCBzdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvcj8uc3RhY2sgfHwgZXJyb3I/Lm1lc3NhZ2UgfHwgXCJcIiA6IFN0cmluZyhlcnJvcik7XG5cbiAgcmV0dXJuIHtcbiAgICB0aXRsZTogZmFsbGJhY2sgPyBcIkNvcHkgTG9nc1wiIDogXCJSZXBvcnQgRXJyb3JcIixcbiAgICBvbkFjdGlvbih0b2FzdCkge1xuICAgICAgdG9hc3QuaGlkZSgpO1xuICAgICAgaWYgKGZhbGxiYWNrKSB7XG4gICAgICAgIENsaXBib2FyZC5jb3B5KHN0YWNrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wZW4oXG4gICAgICAgICAgYGh0dHBzOi8vZ2l0aHViLmNvbS9yYXljYXN0L2V4dGVuc2lvbnMvaXNzdWVzL25ldz8mbGFiZWxzPWV4dGVuc2lvbiUyQ2J1ZyZ0ZW1wbGF0ZT1leHRlbnNpb25fYnVnX3JlcG9ydC55bWwmdGl0bGU9JHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICApfSZleHRlbnNpb24tdXJsPSR7ZW5jb2RlVVJJKGV4dGVuc2lvblVSTCl9JmRlc2NyaXB0aW9uPSR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICAgICAgYCMjIyMgRXJyb3I6XG5cXGBcXGBcXGBcbiR7c3RhY2t9XG5cXGBcXGBcXGBcbmAsXG4gICAgICAgICAgKX1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG59O1xuIiwgImltcG9ydCB7IHVzZUNhbGxiYWNrLCBEaXNwYXRjaCwgU2V0U3RhdGVBY3Rpb24sIHVzZVN5bmNFeHRlcm5hbFN0b3JlLCB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBDYWNoZSB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IHVzZUxhdGVzdCB9IGZyb20gXCIuL3VzZUxhdGVzdFwiO1xuaW1wb3J0IHsgcmVwbGFjZXIsIHJldml2ZXIgfSBmcm9tIFwiLi9oZWxwZXJzXCI7XG5cbmNvbnN0IHJvb3RDYWNoZSA9IC8qICNfX1BVUkVfXyAqLyBTeW1ib2woXCJjYWNoZSB3aXRob3V0IG5hbWVzcGFjZVwiKTtcbmNvbnN0IGNhY2hlTWFwID0gLyogI19fUFVSRV9fICovIG5ldyBNYXA8c3RyaW5nIHwgc3ltYm9sLCBDYWNoZT4oKTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RhdGVmdWwgdmFsdWUsIGFuZCBhIGZ1bmN0aW9uIHRvIHVwZGF0ZSBpdC4gVGhlIHZhbHVlIHdpbGwgYmUga2VwdCBiZXR3ZWVuIGNvbW1hbmQgcnVucy5cbiAqXG4gKiBAcmVtYXJrIFRoZSB2YWx1ZSBuZWVkcyB0byBiZSBKU09OIHNlcmlhbGl6YWJsZS5cbiAqXG4gKiBAcGFyYW0ga2V5IC0gVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBzdGF0ZS4gVGhpcyBjYW4gYmUgdXNlZCB0byBzaGFyZSB0aGUgc3RhdGUgYWNyb3NzIGNvbXBvbmVudHMgYW5kL29yIGNvbW1hbmRzLlxuICogQHBhcmFtIGluaXRpYWxTdGF0ZSAtIFRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBzdGF0ZSBpZiB0aGVyZSBhcmVuJ3QgYW55IGluIHRoZSBDYWNoZSB5ZXQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VDYWNoZWRTdGF0ZTxUPihcbiAga2V5OiBzdHJpbmcsXG4gIGluaXRpYWxTdGF0ZTogVCxcbiAgY29uZmlnPzogeyBjYWNoZU5hbWVzcGFjZT86IHN0cmluZyB9LFxuKTogW1QsIERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPFQ+Pl07XG5leHBvcnQgZnVuY3Rpb24gdXNlQ2FjaGVkU3RhdGU8VCA9IHVuZGVmaW5lZD4oa2V5OiBzdHJpbmcpOiBbVCB8IHVuZGVmaW5lZCwgRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248VCB8IHVuZGVmaW5lZD4+XTtcbmV4cG9ydCBmdW5jdGlvbiB1c2VDYWNoZWRTdGF0ZTxUPihcbiAga2V5OiBzdHJpbmcsXG4gIGluaXRpYWxTdGF0ZT86IFQsXG4gIGNvbmZpZz86IHsgY2FjaGVOYW1lc3BhY2U/OiBzdHJpbmcgfSxcbik6IFtULCBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxUPj5dIHtcbiAgY29uc3QgY2FjaGVLZXkgPSBjb25maWc/LmNhY2hlTmFtZXNwYWNlIHx8IHJvb3RDYWNoZTtcbiAgY29uc3QgY2FjaGUgPVxuICAgIGNhY2hlTWFwLmdldChjYWNoZUtleSkgfHwgY2FjaGVNYXAuc2V0KGNhY2hlS2V5LCBuZXcgQ2FjaGUoeyBuYW1lc3BhY2U6IGNvbmZpZz8uY2FjaGVOYW1lc3BhY2UgfSkpLmdldChjYWNoZUtleSk7XG5cbiAgaWYgKCFjYWNoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgY2FjaGVcIik7XG4gIH1cblxuICBjb25zdCBrZXlSZWYgPSB1c2VMYXRlc3Qoa2V5KTtcbiAgY29uc3QgaW5pdGlhbFZhbHVlUmVmID0gdXNlTGF0ZXN0KGluaXRpYWxTdGF0ZSk7XG5cbiAgY29uc3QgY2FjaGVkU3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShjYWNoZS5zdWJzY3JpYmUsICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGNhY2hlLmdldChrZXlSZWYuY3VycmVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgZ2V0IENhY2hlIGRhdGE6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBzdGF0ZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgY2FjaGVkU3RhdGUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGlmIChjYWNoZWRTdGF0ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY2FjaGVkU3RhdGUsIHJldml2ZXIpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIHRoZSBkYXRhIGdvdCBjb3JydXB0ZWQgc29tZWhvd1xuICAgICAgICBjb25zb2xlLndhcm4oXCJUaGUgY2FjaGVkIGRhdGEgaXMgY29ycnVwdGVkXCIsIGVycik7XG4gICAgICAgIHJldHVybiBpbml0aWFsVmFsdWVSZWYuY3VycmVudDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGluaXRpYWxWYWx1ZVJlZi5jdXJyZW50O1xuICAgIH1cbiAgfSwgW2NhY2hlZFN0YXRlLCBpbml0aWFsVmFsdWVSZWZdKTtcblxuICBjb25zdCBzdGF0ZVJlZiA9IHVzZUxhdGVzdChzdGF0ZSk7XG5cbiAgY29uc3Qgc2V0U3RhdGVBbmRDYWNoZSA9IHVzZUNhbGxiYWNrKFxuICAgICh1cGRhdGVyOiBTZXRTdGF0ZUFjdGlvbjxUPikgPT4ge1xuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUUyBzdHJ1Z2dsZXMgdG8gaW5mZXIgdGhlIHR5cGVzIGFzIFQgY291bGQgcG90ZW50aWFsbHkgYmUgYSBmdW5jdGlvblxuICAgICAgY29uc3QgbmV3VmFsdWUgPSB0eXBlb2YgdXBkYXRlciA9PT0gXCJmdW5jdGlvblwiID8gdXBkYXRlcihzdGF0ZVJlZi5jdXJyZW50KSA6IHVwZGF0ZXI7XG4gICAgICBpZiAodHlwZW9mIG5ld1ZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGNhY2hlLnNldChrZXlSZWYuY3VycmVudCwgXCJ1bmRlZmluZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzdHJpbmdpZmllZFZhbHVlID0gSlNPTi5zdHJpbmdpZnkobmV3VmFsdWUsIHJlcGxhY2VyKTtcbiAgICAgICAgY2FjaGUuc2V0KGtleVJlZi5jdXJyZW50LCBzdHJpbmdpZmllZFZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICB9LFxuICAgIFtjYWNoZSwga2V5UmVmLCBzdGF0ZVJlZl0sXG4gICk7XG5cbiAgcmV0dXJuIFtzdGF0ZSwgc2V0U3RhdGVBbmRDYWNoZV07XG59XG4iLCAiaW1wb3J0IGNyeXB0byBmcm9tIFwibm9kZTpjcnlwdG9cIjtcbmltcG9ydCB7IHR5cGVIYXNoZXIgfSBmcm9tIFwiLi92ZW5kb3JzL3R5cGUtaGFzaGVyXCI7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZXIodGhpczogYW55LCBrZXk6IHN0cmluZywgX3ZhbHVlOiB1bmtub3duKSB7XG4gIGNvbnN0IHZhbHVlID0gdGhpc1trZXldO1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgcmV0dXJuIGBfX3JheWNhc3RfY2FjaGVkX2RhdGVfXyR7dmFsdWUudG9TdHJpbmcoKX1gO1xuICB9XG4gIGlmIChCdWZmZXIuaXNCdWZmZXIodmFsdWUpKSB7XG4gICAgcmV0dXJuIGBfX3JheWNhc3RfY2FjaGVkX2J1ZmZlcl9fJHt2YWx1ZS50b1N0cmluZyhcImJhc2U2NFwiKX1gO1xuICB9XG4gIHJldHVybiBfdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXZpdmVyKF9rZXk6IHN0cmluZywgdmFsdWU6IHVua25vd24pIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5zdGFydHNXaXRoKFwiX19yYXljYXN0X2NhY2hlZF9kYXRlX19cIikpIHtcbiAgICByZXR1cm4gbmV3IERhdGUodmFsdWUucmVwbGFjZShcIl9fcmF5Y2FzdF9jYWNoZWRfZGF0ZV9fXCIsIFwiXCIpKTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmIHZhbHVlLnN0YXJ0c1dpdGgoXCJfX3JheWNhc3RfY2FjaGVkX2J1ZmZlcl9fXCIpKSB7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKHZhbHVlLnJlcGxhY2UoXCJfX3JheWNhc3RfY2FjaGVkX2J1ZmZlcl9fXCIsIFwiXCIpLCBcImJhc2U2NFwiKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNoKG9iamVjdDogYW55KSB7XG4gIGNvbnN0IGhhc2hpbmdTdHJlYW0gPSBjcnlwdG8uY3JlYXRlSGFzaChcInNoYTFcIik7XG4gIGNvbnN0IGhhc2hlciA9IHR5cGVIYXNoZXIoaGFzaGluZ1N0cmVhbSk7XG4gIGhhc2hlci5kaXNwYXRjaChvYmplY3QpO1xuXG4gIHJldHVybiBoYXNoaW5nU3RyZWFtLmRpZ2VzdChcImhleFwiKTtcbn1cbiIsICIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnQgKi9cbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzICovXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG5pbXBvcnQgY3J5cHRvIGZyb20gXCJub2RlOmNyeXB0b1wiO1xuXG4vKiogQ2hlY2sgaWYgdGhlIGdpdmVuIGZ1bmN0aW9uIGlzIGEgbmF0aXZlIGZ1bmN0aW9uICovXG5mdW5jdGlvbiBpc05hdGl2ZUZ1bmN0aW9uKGY6IGFueSkge1xuICBpZiAodHlwZW9mIGYgIT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBleHAgPSAvXmZ1bmN0aW9uXFxzK1xcdypcXHMqXFwoXFxzKlxcKVxccyp7XFxzK1xcW25hdGl2ZSBjb2RlXFxdXFxzK30kL2k7XG4gIHJldHVybiBleHAuZXhlYyhGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChmKSkgIT09IG51bGw7XG59XG5cbmZ1bmN0aW9uIGhhc2hSZXBsYWNlcih2YWx1ZTogYW55KTogc3RyaW5nIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHlwZUhhc2hlcihcbiAgd3JpdGVUbzpcbiAgICB8IGNyeXB0by5IYXNoXG4gICAgfCB7XG4gICAgICAgIGJ1Zjogc3RyaW5nO1xuICAgICAgICB3cml0ZTogKGI6IGFueSkgPT4gdm9pZDtcbiAgICAgICAgZW5kOiAoYjogYW55KSA9PiB2b2lkO1xuICAgICAgICByZWFkOiAoKSA9PiBzdHJpbmc7XG4gICAgICB9LFxuICBjb250ZXh0OiBhbnlbXSA9IFtdLFxuKSB7XG4gIGZ1bmN0aW9uIHdyaXRlKHN0cjogc3RyaW5nKSB7XG4gICAgaWYgKFwidXBkYXRlXCIgaW4gd3JpdGVUbykge1xuICAgICAgcmV0dXJuIHdyaXRlVG8udXBkYXRlKHN0ciwgXCJ1dGY4XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gd3JpdGVUby53cml0ZShzdHIpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZGlzcGF0Y2g6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XG4gICAgICB2YWx1ZSA9IGhhc2hSZXBsYWNlcih2YWx1ZSk7XG5cbiAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gICAgICBpZiAodmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgdGhpc1tcIl9udWxsXCJdKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHRoaXNbXCJfXCIgKyB0eXBlXSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBfb2JqZWN0OiBmdW5jdGlvbiAob2JqZWN0OiBhbnkpIHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAvXFxbb2JqZWN0ICguKilcXF0vaTtcbiAgICAgIGNvbnN0IG9ialN0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpO1xuICAgICAgbGV0IG9ialR5cGUgPSBwYXR0ZXJuLmV4ZWMob2JqU3RyaW5nKT8uWzFdID8/IFwidW5rbm93bjpbXCIgKyBvYmpTdHJpbmcgKyBcIl1cIjtcbiAgICAgIG9ialR5cGUgPSBvYmpUeXBlLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIGxldCBvYmplY3ROdW1iZXIgPSBudWxsIGFzIGFueTtcblxuICAgICAgaWYgKChvYmplY3ROdW1iZXIgPSBjb250ZXh0LmluZGV4T2Yob2JqZWN0KSkgPj0gMCkge1xuICAgICAgICB0aGlzLmRpc3BhdGNoKFwiW0NJUkNVTEFSOlwiICsgb2JqZWN0TnVtYmVyICsgXCJdXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZXh0LnB1c2gob2JqZWN0KTtcbiAgICAgIH1cblxuICAgICAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmplY3QpKSB7XG4gICAgICAgIHdyaXRlKFwiYnVmZmVyOlwiKTtcbiAgICAgICAgcmV0dXJuIHdyaXRlKG9iamVjdC50b1N0cmluZyhcInV0ZjhcIikpO1xuICAgICAgfVxuXG4gICAgICBpZiAob2JqVHlwZSAhPT0gXCJvYmplY3RcIiAmJiBvYmpUeXBlICE9PSBcImZ1bmN0aW9uXCIgJiYgb2JqVHlwZSAhPT0gXCJhc3luY2Z1bmN0aW9uXCIpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBpZiAodGhpc1tcIl9cIiArIG9ialR5cGVdKSB7XG4gICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgIHRoaXNbXCJfXCIgKyBvYmpUeXBlXShvYmplY3QpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBvYmplY3QgdHlwZSBcIicgKyBvYmpUeXBlICsgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTtcbiAgICAgICAga2V5cyA9IGtleXMuc29ydCgpO1xuICAgICAgICAvLyBNYWtlIHN1cmUgdG8gaW5jb3Jwb3JhdGUgc3BlY2lhbCBwcm9wZXJ0aWVzLCBzb1xuICAgICAgICAvLyBUeXBlcyB3aXRoIGRpZmZlcmVudCBwcm90b3R5cGVzIHdpbGwgcHJvZHVjZVxuICAgICAgICAvLyBhIGRpZmZlcmVudCBoYXNoIGFuZCBvYmplY3RzIGRlcml2ZWQgZnJvbVxuICAgICAgICAvLyBkaWZmZXJlbnQgZnVuY3Rpb25zIChgbmV3IEZvb2AsIGBuZXcgQmFyYCkgd2lsbFxuICAgICAgICAvLyBwcm9kdWNlIGRpZmZlcmVudCBoYXNoZXMuXG4gICAgICAgIC8vIFdlIG5ldmVyIGRvIHRoaXMgZm9yIG5hdGl2ZSBmdW5jdGlvbnMgc2luY2Ugc29tZVxuICAgICAgICAvLyBzZWVtIHRvIGJyZWFrIGJlY2F1c2Ugb2YgdGhhdC5cbiAgICAgICAgaWYgKCFpc05hdGl2ZUZ1bmN0aW9uKG9iamVjdCkpIHtcbiAgICAgICAgICBrZXlzLnNwbGljZSgwLCAwLCBcInByb3RvdHlwZVwiLCBcIl9fcHJvdG9fX1wiLCBcImNvbnN0cnVjdG9yXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgd3JpdGUoXCJvYmplY3Q6XCIgKyBrZXlzLmxlbmd0aCArIFwiOlwiKTtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHJldHVybiBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIHNlbGYuZGlzcGF0Y2goa2V5KTtcbiAgICAgICAgICB3cml0ZShcIjpcIik7XG4gICAgICAgICAgc2VsZi5kaXNwYXRjaChvYmplY3Rba2V5XSk7XG4gICAgICAgICAgd3JpdGUoXCIsXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIF9hcnJheTogZnVuY3Rpb24gKGFycjogYW55W10sIHVub3JkZXJlZDogYm9vbGVhbikge1xuICAgICAgdW5vcmRlcmVkID0gdHlwZW9mIHVub3JkZXJlZCAhPT0gXCJ1bmRlZmluZWRcIiA/IHVub3JkZXJlZCA6IGZhbHNlOyAvLyBkZWZhdWx0IHRvIG9wdGlvbnMudW5vcmRlcmVkQXJyYXlzXG5cbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgd3JpdGUoXCJhcnJheTpcIiArIGFyci5sZW5ndGggKyBcIjpcIik7XG4gICAgICBpZiAoIXVub3JkZXJlZCB8fCBhcnIubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5OiBhbnkpIHtcbiAgICAgICAgICBzZWxmLmRpc3BhdGNoKGVudHJ5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gdGhlIHVub3JkZXJlZCBjYXNlIGlzIGEgbGl0dGxlIG1vcmUgY29tcGxpY2F0ZWQ6XG4gICAgICAvLyBzaW5jZSB0aGVyZSBpcyBubyBjYW5vbmljYWwgb3JkZXJpbmcgb24gb2JqZWN0cyxcbiAgICAgIC8vIGkuZS4ge2E6MX0gPCB7YToyfSBhbmQge2E6MX0gPiB7YToyfSBhcmUgYm90aCBmYWxzZSxcbiAgICAgIC8vIHdlIGZpcnN0IHNlcmlhbGl6ZSBlYWNoIGVudHJ5IHVzaW5nIGEgUGFzc1Rocm91Z2ggc3RyZWFtXG4gICAgICAvLyBiZWZvcmUgc29ydGluZy5cbiAgICAgIC8vIGFsc286IHdlIGNhbuKAmXQgdXNlIHRoZSBzYW1lIGNvbnRleHQgYXJyYXkgZm9yIGFsbCBlbnRyaWVzXG4gICAgICAvLyBzaW5jZSB0aGUgb3JkZXIgb2YgaGFzaGluZyBzaG91bGQgKm5vdCogbWF0dGVyLiBpbnN0ZWFkLFxuICAgICAgLy8gd2Uga2VlcCB0cmFjayBvZiB0aGUgYWRkaXRpb25zIHRvIGEgY29weSBvZiB0aGUgY29udGV4dCBhcnJheVxuICAgICAgLy8gYW5kIGFkZCBhbGwgb2YgdGhlbSB0byB0aGUgZ2xvYmFsIGNvbnRleHQgYXJyYXkgd2hlbiB3ZeKAmXJlIGRvbmVcbiAgICAgIGxldCBjb250ZXh0QWRkaXRpb25zOiBhbnlbXSA9IFtdO1xuICAgICAgY29uc3QgZW50cmllcyA9IGFyci5tYXAoZnVuY3Rpb24gKGVudHJ5OiBhbnkpIHtcbiAgICAgICAgY29uc3Qgc3RybSA9IFBhc3NUaHJvdWdoKCk7XG4gICAgICAgIGNvbnN0IGxvY2FsQ29udGV4dCA9IGNvbnRleHQuc2xpY2UoKTsgLy8gbWFrZSBjb3B5XG4gICAgICAgIGNvbnN0IGhhc2hlciA9IHR5cGVIYXNoZXIoc3RybSwgbG9jYWxDb250ZXh0KTtcbiAgICAgICAgaGFzaGVyLmRpc3BhdGNoKGVudHJ5KTtcbiAgICAgICAgLy8gdGFrZSBvbmx5IHdoYXQgd2FzIGFkZGVkIHRvIGxvY2FsQ29udGV4dCBhbmQgYXBwZW5kIGl0IHRvIGNvbnRleHRBZGRpdGlvbnNcbiAgICAgICAgY29udGV4dEFkZGl0aW9ucyA9IGNvbnRleHRBZGRpdGlvbnMuY29uY2F0KGxvY2FsQ29udGV4dC5zbGljZShjb250ZXh0Lmxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gc3RybS5yZWFkKCkudG9TdHJpbmcoKTtcbiAgICAgIH0pO1xuICAgICAgY29udGV4dCA9IGNvbnRleHQuY29uY2F0KGNvbnRleHRBZGRpdGlvbnMpO1xuICAgICAgZW50cmllcy5zb3J0KCk7XG4gICAgICB0aGlzLl9hcnJheShlbnRyaWVzLCBmYWxzZSk7XG4gICAgfSxcbiAgICBfZGF0ZTogZnVuY3Rpb24gKGRhdGU6IERhdGUpIHtcbiAgICAgIHdyaXRlKFwiZGF0ZTpcIiArIGRhdGUudG9KU09OKCkpO1xuICAgIH0sXG4gICAgX3N5bWJvbDogZnVuY3Rpb24gKHN5bTogc3ltYm9sKSB7XG4gICAgICB3cml0ZShcInN5bWJvbDpcIiArIHN5bS50b1N0cmluZygpKTtcbiAgICB9LFxuICAgIF9lcnJvcjogZnVuY3Rpb24gKGVycjogRXJyb3IpIHtcbiAgICAgIHdyaXRlKFwiZXJyb3I6XCIgKyBlcnIudG9TdHJpbmcoKSk7XG4gICAgfSxcbiAgICBfYm9vbGVhbjogZnVuY3Rpb24gKGJvb2w6IGJvb2xlYW4pIHtcbiAgICAgIHdyaXRlKFwiYm9vbDpcIiArIGJvb2wudG9TdHJpbmcoKSk7XG4gICAgfSxcbiAgICBfc3RyaW5nOiBmdW5jdGlvbiAoc3RyaW5nOiBzdHJpbmcpIHtcbiAgICAgIHdyaXRlKFwic3RyaW5nOlwiICsgc3RyaW5nLmxlbmd0aCArIFwiOlwiKTtcbiAgICAgIHdyaXRlKHN0cmluZy50b1N0cmluZygpKTtcbiAgICB9LFxuICAgIF9mdW5jdGlvbjogZnVuY3Rpb24gKGZuOiBhbnkpIHtcbiAgICAgIHdyaXRlKFwiZm46XCIpO1xuICAgICAgaWYgKGlzTmF0aXZlRnVuY3Rpb24oZm4pKSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2goXCJbbmF0aXZlXVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2goZm4udG9TdHJpbmcoKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBjYW4gc3RpbGwgZGlzdGluZ3Vpc2ggbmF0aXZlIGZ1bmN0aW9uc1xuICAgICAgLy8gYnkgdGhlaXIgbmFtZSwgb3RoZXJ3aXNlIFN0cmluZyBhbmQgRnVuY3Rpb24gd2lsbFxuICAgICAgLy8gaGF2ZSB0aGUgc2FtZSBoYXNoXG4gICAgICB0aGlzLmRpc3BhdGNoKFwiZnVuY3Rpb24tbmFtZTpcIiArIFN0cmluZyhmbi5uYW1lKSk7XG5cbiAgICAgIHRoaXMuX29iamVjdChmbik7XG4gICAgfSxcbiAgICBfbnVtYmVyOiBmdW5jdGlvbiAobnVtYmVyOiBudW1iZXIpIHtcbiAgICAgIHdyaXRlKFwibnVtYmVyOlwiICsgbnVtYmVyLnRvU3RyaW5nKCkpO1xuICAgIH0sXG4gICAgX3htbDogZnVuY3Rpb24gKHhtbDogYW55KSB7XG4gICAgICB3cml0ZShcInhtbDpcIiArIHhtbC50b1N0cmluZygpKTtcbiAgICB9LFxuICAgIF9udWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcIk51bGxcIik7XG4gICAgfSxcbiAgICBfdW5kZWZpbmVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcIlVuZGVmaW5lZFwiKTtcbiAgICB9LFxuICAgIF9yZWdleHA6IGZ1bmN0aW9uIChyZWdleDogUmVnRXhwKSB7XG4gICAgICB3cml0ZShcInJlZ2V4OlwiICsgcmVnZXgudG9TdHJpbmcoKSk7XG4gICAgfSxcbiAgICBfdWludDhhcnJheTogZnVuY3Rpb24gKGFycjogVWludDhBcnJheSkge1xuICAgICAgd3JpdGUoXCJ1aW50OGFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfdWludDhjbGFtcGVkYXJyYXk6IGZ1bmN0aW9uIChhcnI6IFVpbnQ4Q2xhbXBlZEFycmF5KSB7XG4gICAgICB3cml0ZShcInVpbnQ4Y2xhbXBlZGFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfaW50OGFycmF5OiBmdW5jdGlvbiAoYXJyOiBJbnQ4QXJyYXkpIHtcbiAgICAgIHdyaXRlKFwiaW50OGFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfdWludDE2YXJyYXk6IGZ1bmN0aW9uIChhcnI6IFVpbnQxNkFycmF5KSB7XG4gICAgICB3cml0ZShcInVpbnQxNmFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfaW50MTZhcnJheTogZnVuY3Rpb24gKGFycjogSW50MTZBcnJheSkge1xuICAgICAgd3JpdGUoXCJpbnQxNmFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfdWludDMyYXJyYXk6IGZ1bmN0aW9uIChhcnI6IFVpbnQzMkFycmF5KSB7XG4gICAgICB3cml0ZShcInVpbnQzMmFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfaW50MzJhcnJheTogZnVuY3Rpb24gKGFycjogSW50MzJBcnJheSkge1xuICAgICAgd3JpdGUoXCJpbnQzMmFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfZmxvYXQzMmFycmF5OiBmdW5jdGlvbiAoYXJyOiBGbG9hdDMyQXJyYXkpIHtcbiAgICAgIHdyaXRlKFwiZmxvYXQzMmFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfZmxvYXQ2NGFycmF5OiBmdW5jdGlvbiAoYXJyOiBGbG9hdDY0QXJyYXkpIHtcbiAgICAgIHdyaXRlKFwiZmxvYXQ2NGFycmF5OlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKSk7XG4gICAgfSxcbiAgICBfYXJyYXlidWZmZXI6IGZ1bmN0aW9uIChhcnI6IEFycmF5QnVmZmVyKSB7XG4gICAgICB3cml0ZShcImFycmF5YnVmZmVyOlwiKTtcbiAgICAgIHRoaXMuZGlzcGF0Y2gobmV3IFVpbnQ4QXJyYXkoYXJyKSk7XG4gICAgfSxcbiAgICBfdXJsOiBmdW5jdGlvbiAodXJsOiBVUkwpIHtcbiAgICAgIHdyaXRlKFwidXJsOlwiICsgdXJsLnRvU3RyaW5nKCkpO1xuICAgIH0sXG4gICAgX21hcDogZnVuY3Rpb24gKG1hcDogTWFwPGFueSwgYW55Pikge1xuICAgICAgd3JpdGUoXCJtYXA6XCIpO1xuICAgICAgY29uc3QgYXJyID0gQXJyYXkuZnJvbShtYXApO1xuICAgICAgdGhpcy5fYXJyYXkoYXJyLCB0cnVlKTtcbiAgICB9LFxuICAgIF9zZXQ6IGZ1bmN0aW9uIChzZXQ6IFNldDxhbnk+KSB7XG4gICAgICB3cml0ZShcInNldDpcIik7XG4gICAgICBjb25zdCBhcnIgPSBBcnJheS5mcm9tKHNldCk7XG4gICAgICB0aGlzLl9hcnJheShhcnIsIHRydWUpO1xuICAgIH0sXG4gICAgX2ZpbGU6IGZ1bmN0aW9uIChmaWxlOiBhbnkpIHtcbiAgICAgIHdyaXRlKFwiZmlsZTpcIik7XG4gICAgICB0aGlzLmRpc3BhdGNoKFtmaWxlLm5hbWUsIGZpbGUuc2l6ZSwgZmlsZS50eXBlLCBmaWxlLmxhc3RNb2RpZmllZF0pO1xuICAgIH0sXG4gICAgX2Jsb2I6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBcIkhhc2hpbmcgQmxvYiBvYmplY3RzIGlzIGN1cnJlbnRseSBub3Qgc3VwcG9ydGVkXFxuXCIgK1xuICAgICAgICAgIFwiKHNlZSBodHRwczovL2dpdGh1Yi5jb20vcHVsZW9zL29iamVjdC1oYXNoL2lzc3Vlcy8yNilcXG5cIiArXG4gICAgICAgICAgJ1VzZSBcIm9wdGlvbnMucmVwbGFjZXJcIiBvciBcIm9wdGlvbnMuaWdub3JlVW5rbm93blwiXFxuJyxcbiAgICAgICk7XG4gICAgfSxcbiAgICBfZG9td2luZG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcImRvbXdpbmRvd1wiKTtcbiAgICB9LFxuICAgIF9iaWdpbnQ6IGZ1bmN0aW9uIChudW1iZXI6IGJpZ2ludCkge1xuICAgICAgd3JpdGUoXCJiaWdpbnQ6XCIgKyBudW1iZXIudG9TdHJpbmcoKSk7XG4gICAgfSxcbiAgICAvKiBOb2RlLmpzIHN0YW5kYXJkIG5hdGl2ZSBvYmplY3RzICovXG4gICAgX3Byb2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwicHJvY2Vzc1wiKTtcbiAgICB9LFxuICAgIF90aW1lcjogZnVuY3Rpb24gKCkge1xuICAgICAgd3JpdGUoXCJ0aW1lclwiKTtcbiAgICB9LFxuICAgIF9waXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcInBpcGVcIik7XG4gICAgfSxcbiAgICBfdGNwOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcInRjcFwiKTtcbiAgICB9LFxuICAgIF91ZHA6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwidWRwXCIpO1xuICAgIH0sXG4gICAgX3R0eTogZnVuY3Rpb24gKCkge1xuICAgICAgd3JpdGUoXCJ0dHlcIik7XG4gICAgfSxcbiAgICBfc3RhdHdhdGNoZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwic3RhdHdhdGNoZXJcIik7XG4gICAgfSxcbiAgICBfc2VjdXJlY29udGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgd3JpdGUoXCJzZWN1cmVjb250ZXh0XCIpO1xuICAgIH0sXG4gICAgX2Nvbm5lY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwiY29ubmVjdGlvblwiKTtcbiAgICB9LFxuICAgIF96bGliOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcInpsaWJcIik7XG4gICAgfSxcbiAgICBfY29udGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgd3JpdGUoXCJjb250ZXh0XCIpO1xuICAgIH0sXG4gICAgX25vZGVzY3JpcHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwibm9kZXNjcmlwdFwiKTtcbiAgICB9LFxuICAgIF9odHRwcGFyc2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcImh0dHBwYXJzZXJcIik7XG4gICAgfSxcbiAgICBfZGF0YXZpZXc6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdyaXRlKFwiZGF0YXZpZXdcIik7XG4gICAgfSxcbiAgICBfc2lnbmFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcInNpZ25hbFwiKTtcbiAgICB9LFxuICAgIF9mc2V2ZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICB3cml0ZShcImZzZXZlbnRcIik7XG4gICAgfSxcbiAgICBfdGxzd3JhcDogZnVuY3Rpb24gKCkge1xuICAgICAgd3JpdGUoXCJ0bHN3cmFwXCIpO1xuICAgIH0sXG4gIH07XG59XG5cbi8vIE1pbmktaW1wbGVtZW50YXRpb24gb2Ygc3RyZWFtLlBhc3NUaHJvdWdoXG4vLyBXZSBhcmUgZmFyIGZyb20gaGF2aW5nIG5lZWQgZm9yIHRoZSBmdWxsIGltcGxlbWVudGF0aW9uLCBhbmQgd2UgY2FuXG4vLyBtYWtlIGFzc3VtcHRpb25zIGxpa2UgXCJtYW55IHdyaXRlcywgdGhlbiBvbmx5IG9uZSBmaW5hbCByZWFkXCJcbi8vIGFuZCB3ZSBjYW4gaWdub3JlIGVuY29kaW5nIHNwZWNpZmljc1xuZnVuY3Rpb24gUGFzc1Rocm91Z2goKSB7XG4gIHJldHVybiB7XG4gICAgYnVmOiBcIlwiLFxuXG4gICAgd3JpdGU6IGZ1bmN0aW9uIChiOiBzdHJpbmcpIHtcbiAgICAgIHRoaXMuYnVmICs9IGI7XG4gICAgfSxcblxuICAgIGVuZDogZnVuY3Rpb24gKGI6IHN0cmluZykge1xuICAgICAgdGhpcy5idWYgKz0gYjtcbiAgICB9LFxuXG4gICAgcmVhZDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuYnVmO1xuICAgIH0sXG4gIH07XG59XG4iLCAiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZUNhbGxiYWNrIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQge1xuICBGdW5jdGlvblJldHVybmluZ1Byb21pc2UsXG4gIFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlLFxuICBNdXRhdGVQcm9taXNlLFxuICBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsXG4gIFVud3JhcFJldHVybixcbiAgUGFnaW5hdGlvbk9wdGlvbnMsXG59IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyB1c2VDYWNoZWRTdGF0ZSB9IGZyb20gXCIuL3VzZUNhY2hlZFN0YXRlXCI7XG5pbXBvcnQgeyB1c2VQcm9taXNlLCBQcm9taXNlT3B0aW9ucyB9IGZyb20gXCIuL3VzZVByb21pc2VcIjtcbmltcG9ydCB7IHVzZUxhdGVzdCB9IGZyb20gXCIuL3VzZUxhdGVzdFwiO1xuaW1wb3J0IHsgaGFzaCB9IGZyb20gXCIuL2hlbHBlcnNcIjtcblxuLy8gU3ltYm9sIHRvIGRpZmZlcmVudGlhdGUgYW4gZW1wdHkgY2FjaGUgZnJvbSBgdW5kZWZpbmVkYFxuY29uc3QgZW1wdHlDYWNoZSA9IC8qICNfX1BVUkVfXyAqLyBTeW1ib2woKTtcblxuZXhwb3J0IHR5cGUgQ2FjaGVkUHJvbWlzZU9wdGlvbnM8XG4gIFQgZXh0ZW5kcyBGdW5jdGlvblJldHVybmluZ1Byb21pc2UgfCBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsXG4gIFUsXG4+ID0gUHJvbWlzZU9wdGlvbnM8VD4gJiB7XG4gIC8qKlxuICAgKiBUaGUgaW5pdGlhbCBkYXRhIGlmIHRoZXJlIGFyZW4ndCBhbnkgaW4gdGhlIENhY2hlIHlldC5cbiAgICovXG4gIGluaXRpYWxEYXRhPzogVTtcbiAgLyoqXG4gICAqIFRlbGxzIHRoZSBob29rIHRvIGtlZXAgdGhlIHByZXZpb3VzIHJlc3VsdHMgaW5zdGVhZCBvZiByZXR1cm5pbmcgdGhlIGluaXRpYWwgdmFsdWVcbiAgICogaWYgdGhlcmUgYXJlbid0IGFueSBpbiB0aGUgY2FjaGUgZm9yIHRoZSBuZXcgYXJndW1lbnRzLlxuICAgKiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgd2hlbiB1c2VkIGZvciBkYXRhIGZvciBhIExpc3QgdG8gYXZvaWQgZmxpY2tlcmluZy5cbiAgICovXG4gIGtlZXBQcmV2aW91c0RhdGE/OiBib29sZWFuO1xufTtcblxuLyoqXG4gKiBXcmFwcyBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24gb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBQcm9taXNlIGluIGFub3RoZXIgZnVuY3Rpb24sIGFuZCByZXR1cm5zIHRoZSB7QGxpbmsgQXN5bmNTdGF0ZX0gY29ycmVzcG9uZGluZyB0byB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmdW5jdGlvbi4gVGhlIGxhc3QgdmFsdWUgd2lsbCBiZSBrZXB0IGJldHdlZW4gY29tbWFuZCBydW5zLlxuICpcbiAqIEByZW1hcmsgVGhpcyBvdmVybG9hZCBzaG91bGQgYmUgdXNlZCB3aGVuIHdvcmtpbmcgd2l0aCBwYWdpbmF0ZWQgZGF0YSBzb3VyY2VzLlxuICogQHJlbWFyayBXaGVuIHBhZ2luYXRpbmcsIG9ubHkgdGhlIGZpcnN0IHBhZ2Ugd2lsbCBiZSBjYWNoZWQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYFxuICogaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gXCJub2RlOnRpbWVycy9wcm9taXNlc1wiO1xuICogaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbiAqIGltcG9ydCB7IExpc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG4gKiBpbXBvcnQgeyB1c2VDYWNoZWRQcm9taXNlIH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoXCJcIik7XG4gKlxuICogICBjb25zdCB7IGlzTG9hZGluZywgZGF0YSwgcGFnaW5hdGlvbiB9ID0gdXNlQ2FjaGVkUHJvbWlzZShcbiAqICAgICAoc2VhcmNoVGV4dDogc3RyaW5nKSA9PiBhc3luYyAob3B0aW9uczogeyBwYWdlOiBudW1iZXIgfSkgPT4ge1xuICogICAgICAgYXdhaXQgc2V0VGltZW91dCgyMDApO1xuICogICAgICAgY29uc3QgbmV3RGF0YSA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDI1IH0sIChfdiwgaW5kZXgpID0+ICh7XG4gKiAgICAgICAgIGluZGV4LFxuICogICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UsXG4gKiAgICAgICAgIHRleHQ6IHNlYXJjaFRleHQsXG4gKiAgICAgICB9KSk7XG4gKiAgICAgICByZXR1cm4geyBkYXRhOiBuZXdEYXRhLCBoYXNNb3JlOiBvcHRpb25zLnBhZ2UgPCAxMCB9O1xuICogICAgIH0sXG4gKiAgICAgW3NlYXJjaFRleHRdLFxuICogICApO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8TGlzdCBpc0xvYWRpbmc9e2lzTG9hZGluZ30gb25TZWFyY2hUZXh0Q2hhbmdlPXtzZXRTZWFyY2hUZXh0fSBwYWdpbmF0aW9uPXtwYWdpbmF0aW9ufT5cbiAqICAgICAgIHtkYXRhPy5tYXAoKGl0ZW0pID0+IChcbiAqICAgICAgICAgPExpc3QuSXRlbVxuICogICAgICAgICAgIGtleT17YCR7aXRlbS5wYWdlfSAke2l0ZW0uaW5kZXh9ICR7aXRlbS50ZXh0fWB9XG4gKiAgICAgICAgICAgdGl0bGU9e2BQYWdlICR7aXRlbS5wYWdlfSBJdGVtICR7aXRlbS5pbmRleH1gfVxuICogICAgICAgICAgIHN1YnRpdGxlPXtpdGVtLnRleHR9XG4gKiAgICAgICAgIC8+XG4gKiAgICAgICApKX1cbiAqICAgICA8L0xpc3Q+XG4gKiAgICk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUNhY2hlZFByb21pc2U8VCBleHRlbmRzIEZ1bmN0aW9uUmV0dXJuaW5nUGFnaW5hdGVkUHJvbWlzZTxbXT4+KFxuICBmbjogVCxcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFVud3JhcFJldHVybjxUPiwgdW5kZWZpbmVkPjtcbmV4cG9ydCBmdW5jdGlvbiB1c2VDYWNoZWRQcm9taXNlPFQgZXh0ZW5kcyBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsIFUgZXh0ZW5kcyBhbnlbXSA9IGFueVtdPihcbiAgZm46IFQsXG4gIGFyZ3M6IFBhcmFtZXRlcnM8VD4sXG4gIG9wdGlvbnM/OiBDYWNoZWRQcm9taXNlT3B0aW9uczxULCBVPixcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFVud3JhcFJldHVybjxUPiwgVT47XG5cbi8qKlxuICogV3JhcHMgYW4gYXN5bmNocm9ub3VzIGZ1bmN0aW9uIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgUHJvbWlzZSBhbmQgcmV0dXJucyB0aGUge0BsaW5rIEFzeW5jU3RhdGV9IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24uIFRoZSBsYXN0IHZhbHVlIHdpbGwgYmUga2VwdCBiZXR3ZWVuIGNvbW1hbmQgcnVucy5cbiAqXG4gKiBAcmVtYXJrIFRoZSB2YWx1ZSBuZWVkcyB0byBiZSBKU09OIHNlcmlhbGl6YWJsZS5cbiAqIEByZW1hcmsgVGhlIGZ1bmN0aW9uIGlzIGFzc3VtZWQgdG8gYmUgY29uc3RhbnQgKGVnLiBjaGFuZ2luZyBpdCB3b24ndCB0cmlnZ2VyIGEgcmV2YWxpZGF0aW9uKS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBpbXBvcnQgeyB1c2VDYWNoZWRQcm9taXNlIH0gZnJvbSAnQHJheWNhc3QvdXRpbHMnO1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIENvbW1hbmQoKSB7XG4gKiAgIGNvbnN0IGFib3J0YWJsZSA9IHVzZVJlZjxBYm9ydENvbnRyb2xsZXI+KCk7XG4gKiAgIGNvbnN0IHsgaXNMb2FkaW5nLCBkYXRhLCByZXZhbGlkYXRlIH0gPSB1c2VDYWNoZWRQcm9taXNlKGFzeW5jICh1cmw6IHN0cmluZykgPT4ge1xuICogICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7IHNpZ25hbDogYWJvcnRhYmxlLmN1cnJlbnQ/LnNpZ25hbCB9KTtcbiAqICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gKiAgICAgcmV0dXJuIHJlc3VsdFxuICogICB9LFxuICogICBbJ2h0dHBzOi8vYXBpLmV4YW1wbGUnXSxcbiAqICAge1xuICogICAgIGFib3J0YWJsZVxuICogICB9KTtcbiAqXG4gKiAgIHJldHVybiAoXG4gKiAgICAgPERldGFpbFxuICogICAgICAgaXNMb2FkaW5nPXtpc0xvYWRpbmd9XG4gKiAgICAgICBtYXJrZG93bj17ZGF0YX1cbiAqICAgICAgIGFjdGlvbnM9e1xuICogICAgICAgICA8QWN0aW9uUGFuZWw+XG4gKiAgICAgICAgICAgPEFjdGlvbiB0aXRsZT1cIlJlbG9hZFwiIG9uQWN0aW9uPXsoKSA9PiByZXZhbGlkYXRlKCl9IC8+XG4gKiAgICAgICAgIDwvQWN0aW9uUGFuZWw+XG4gKiAgICAgICB9XG4gKiAgICAgLz5cbiAqICAgKTtcbiAqIH07XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUNhY2hlZFByb21pc2U8VCBleHRlbmRzIEZ1bmN0aW9uUmV0dXJuaW5nUHJvbWlzZTxbXT4+KFxuICBmbjogVCxcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFVud3JhcFJldHVybjxUPiwgdW5kZWZpbmVkPjtcbmV4cG9ydCBmdW5jdGlvbiB1c2VDYWNoZWRQcm9taXNlPFQgZXh0ZW5kcyBGdW5jdGlvblJldHVybmluZ1Byb21pc2UsIFUgPSB1bmRlZmluZWQ+KFxuICBmbjogVCxcbiAgYXJnczogUGFyYW1ldGVyczxUPixcbiAgb3B0aW9ucz86IENhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+LFxuKTogVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGU8VW53cmFwUmV0dXJuPFQ+LCBVPjtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUNhY2hlZFByb21pc2U8XG4gIFQgZXh0ZW5kcyBGdW5jdGlvblJldHVybmluZ1Byb21pc2UgfCBGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIFUgZXh0ZW5kcyBhbnlbXSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZCxcbj4oZm46IFQsIGFyZ3M/OiBQYXJhbWV0ZXJzPFQ+LCBvcHRpb25zPzogQ2FjaGVkUHJvbWlzZU9wdGlvbnM8VCwgVT4pIHtcbiAgLyoqXG4gICAqIFRoZSBob29rIGdlbmVyYXRlcyBhIGNhY2hlIGtleSBmcm9tIHRoZSBwcm9taXNlIGl0IHJlY2VpdmVzICYgaXRzIGFyZ3VtZW50cy5cbiAgICogU29tZXRpbWVzIHRoYXQncyBub3QgZW5vdWdoIHRvIGd1YXJhbnRlZSB1bmlxdWVuZXNzLCBzbyBob29rcyB0aGF0IGJ1aWxkIG9uIHRvcCBvZiBgdXNlQ2FjaGVkUHJvbWlzZWAgY2FuXG4gICAqIHVzZSBhbiBgaW50ZXJuYWxfY2FjaGVLZXlTdWZmaXhgIHRvIGhlbHAgaXQuXG4gICAqXG4gICAqIEByZW1hcmsgRm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgKi9cbiAgY29uc3Qge1xuICAgIGluaXRpYWxEYXRhLFxuICAgIGtlZXBQcmV2aW91c0RhdGEsXG4gICAgaW50ZXJuYWxfY2FjaGVLZXlTdWZmaXgsXG4gICAgLi4udXNlUHJvbWlzZU9wdGlvbnNcbiAgfTogQ2FjaGVkUHJvbWlzZU9wdGlvbnM8VCwgVT4gJiB7IGludGVybmFsX2NhY2hlS2V5U3VmZml4Pzogc3RyaW5nIH0gPSBvcHRpb25zIHx8IHt9O1xuICBjb25zdCBsYXN0VXBkYXRlRnJvbSA9IHVzZVJlZjxcImNhY2hlXCIgfCBcInByb21pc2VcIj4obnVsbCk7XG5cbiAgY29uc3QgW2NhY2hlZERhdGEsIG11dGF0ZUNhY2hlXSA9IHVzZUNhY2hlZFN0YXRlPHR5cGVvZiBlbXB0eUNhY2hlIHwgKFVud3JhcFJldHVybjxUPiB8IFUpPihcbiAgICBoYXNoKGFyZ3MgfHwgW10pICsgaW50ZXJuYWxfY2FjaGVLZXlTdWZmaXgsXG4gICAgZW1wdHlDYWNoZSxcbiAgICB7XG4gICAgICBjYWNoZU5hbWVzcGFjZTogaGFzaChmbiksXG4gICAgfSxcbiAgKTtcblxuICAvLyBVc2UgYSByZWYgdG8gc3RvcmUgcHJldmlvdXMgcmV0dXJuZWQgZGF0YS4gVXNlIHRoZSBpbml0YWwgZGF0YSBhcyBpdHMgaW5pdGFsIHZhbHVlIGZyb20gdGhlIGNhY2hlLlxuICBjb25zdCBsYWdneURhdGFSZWYgPSB1c2VSZWY8QXdhaXRlZDxSZXR1cm5UeXBlPFQ+PiB8IFU+KGNhY2hlZERhdGEgIT09IGVtcHR5Q2FjaGUgPyBjYWNoZWREYXRhIDogKGluaXRpYWxEYXRhIGFzIFUpKTtcbiAgY29uc3QgcGFnaW5hdGlvbkFyZ3NSZWYgPSB1c2VSZWY8UGFnaW5hdGlvbk9wdGlvbnM8VW53cmFwUmV0dXJuPFQ+IHwgVT4gfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbiAgY29uc3Qge1xuICAgIG11dGF0ZTogX211dGF0ZSxcbiAgICByZXZhbGlkYXRlLFxuICAgIC4uLnN0YXRlXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciBmbiBoYXMgdGhlIHNhbWUgc2lnbmF0dXJlIGluIGJvdGggdXNlUHJvbWlzZSBhbmQgdXNlQ2FjaGVkUHJvbWlzZVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIH0gPSB1c2VQcm9taXNlKGZuLCBhcmdzIHx8IChbXSBhcyBhbnkgYXMgUGFyYW1ldGVyczxUPiksIHtcbiAgICAuLi51c2VQcm9taXNlT3B0aW9ucyxcbiAgICBvbkRhdGEoZGF0YSwgcGFnaW5hdGlvbikge1xuICAgICAgcGFnaW5hdGlvbkFyZ3NSZWYuY3VycmVudCA9IHBhZ2luYXRpb247XG4gICAgICBpZiAodXNlUHJvbWlzZU9wdGlvbnMub25EYXRhKSB7XG4gICAgICAgIHVzZVByb21pc2VPcHRpb25zLm9uRGF0YShkYXRhLCBwYWdpbmF0aW9uKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYWdpbmF0aW9uICYmIHBhZ2luYXRpb24ucGFnZSA+IDApIHtcbiAgICAgICAgLy8gZG9uJ3QgY2FjaGUgYmV5b25kIHRoZSBmaXJzdCBwYWdlXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxhc3RVcGRhdGVGcm9tLmN1cnJlbnQgPSBcInByb21pc2VcIjtcbiAgICAgIGxhZ2d5RGF0YVJlZi5jdXJyZW50ID0gZGF0YTtcbiAgICAgIG11dGF0ZUNhY2hlKGRhdGEpO1xuICAgIH0sXG4gIH0pO1xuXG4gIGxldCByZXR1cm5lZERhdGE6IFUgfCBBd2FpdGVkPFJldHVyblR5cGU8VD4+IHwgVW53cmFwUmV0dXJuPFQ+O1xuICBjb25zdCBwYWdpbmF0aW9uID0gc3RhdGUucGFnaW5hdGlvbjtcbiAgLy8gd2hlbiBwYWdpbmF0aW5nLCBvbmx5IHRoZSBmaXJzdCBwYWdlIGdldHMgY2FjaGVkLCBzbyB3ZSByZXR1cm4gdGhlIGRhdGEgd2UgZ2V0IGZyb20gYHVzZVByb21pc2VgLCBiZWNhdXNlXG4gIC8vIGl0IHdpbGwgYmUgYWNjdW11bGF0ZWQuXG4gIGlmIChwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50ICYmIHBhZ2luYXRpb25BcmdzUmVmLmN1cnJlbnQucGFnZSA+IDAgJiYgc3RhdGUuZGF0YSkge1xuICAgIHJldHVybmVkRGF0YSA9IHN0YXRlLmRhdGEgYXMgVW53cmFwUmV0dXJuPFQ+O1xuICAgIC8vIGlmIHRoZSBsYXRlc3QgdXBkYXRlIGlmIGZyb20gdGhlIFByb21pc2UsIHdlIGtlZXAgaXRcbiAgfSBlbHNlIGlmIChsYXN0VXBkYXRlRnJvbS5jdXJyZW50ID09PSBcInByb21pc2VcIikge1xuICAgIHJldHVybmVkRGF0YSA9IGxhZ2d5RGF0YVJlZi5jdXJyZW50O1xuICB9IGVsc2UgaWYgKGtlZXBQcmV2aW91c0RhdGEgJiYgY2FjaGVkRGF0YSAhPT0gZW1wdHlDYWNoZSkge1xuICAgIC8vIGlmIHdlIHdhbnQgdG8ga2VlcCB0aGUgbGF0ZXN0IGRhdGEsIHdlIHBpY2sgdGhlIGNhY2hlIGJ1dCBvbmx5IGlmIGl0J3Mgbm90IGVtcHR5XG4gICAgcmV0dXJuZWREYXRhID0gY2FjaGVkRGF0YTtcbiAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgcGFnaW5hdGlvbi5oYXNNb3JlID0gdHJ1ZTtcbiAgICAgIHBhZ2luYXRpb24ucGFnZVNpemUgPSBjYWNoZWREYXRhLmxlbmd0aDtcbiAgICB9XG4gIH0gZWxzZSBpZiAoa2VlcFByZXZpb3VzRGF0YSAmJiBjYWNoZWREYXRhID09PSBlbXB0eUNhY2hlKSB7XG4gICAgLy8gaWYgdGhlIGNhY2hlIGlzIGVtcHR5LCB3ZSB3aWxsIHJldHVybiB0aGUgcHJldmlvdXMgZGF0YVxuICAgIHJldHVybmVkRGF0YSA9IGxhZ2d5RGF0YVJlZi5jdXJyZW50O1xuICAgIC8vIHRoZXJlIGFyZSBubyBzcGVjaWFsIGNhc2VzLCBzbyBlaXRoZXIgcmV0dXJuIHRoZSBjYWNoZSBvciBpbml0aWFsIGRhdGFcbiAgfSBlbHNlIGlmIChjYWNoZWREYXRhICE9PSBlbXB0eUNhY2hlKSB7XG4gICAgcmV0dXJuZWREYXRhID0gY2FjaGVkRGF0YTtcbiAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgcGFnaW5hdGlvbi5oYXNNb3JlID0gdHJ1ZTtcbiAgICAgIHBhZ2luYXRpb24ucGFnZVNpemUgPSBjYWNoZWREYXRhLmxlbmd0aDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuZWREYXRhID0gaW5pdGlhbERhdGEgYXMgVTtcbiAgfVxuXG4gIGNvbnN0IGxhdGVzdERhdGEgPSB1c2VMYXRlc3QocmV0dXJuZWREYXRhKTtcblxuICAvLyB3ZSByZXdyaXRlIHRoZSBtdXRhdGUgZnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBjYWNoZSBpbnN0ZWFkXG4gIGNvbnN0IG11dGF0ZSA9IHVzZUNhbGxiYWNrPE11dGF0ZVByb21pc2U8QXdhaXRlZDxSZXR1cm5UeXBlPFQ+PiB8IFU+PihcbiAgICBhc3luYyAoYXN5bmNVcGRhdGUsIG9wdGlvbnMpID0+IHtcbiAgICAgIGxldCBkYXRhQmVmb3JlT3B0aW1pc3RpY1VwZGF0ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChvcHRpb25zPy5vcHRpbWlzdGljVXBkYXRlKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IFwiZnVuY3Rpb25cIiAmJiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBkYXRhIGJlZm9yZSB0aGUgb3B0aW1pc3RpYyB1cGRhdGUsXG4gICAgICAgICAgICAvLyBidXQgb25seSBpZiB3ZSBuZWVkIGl0IChlZy4gb25seSB3aGVuIHdlIHdhbnQgdG8gYXV0b21hdGljYWxseSByb2xsYmFjayBhZnRlcilcbiAgICAgICAgICAgIGRhdGFCZWZvcmVPcHRpbWlzdGljVXBkYXRlID0gc3RydWN0dXJlZENsb25lKGxhdGVzdERhdGEuY3VycmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGRhdGEgPSBvcHRpb25zLm9wdGltaXN0aWNVcGRhdGUobGF0ZXN0RGF0YS5jdXJyZW50KTtcbiAgICAgICAgICBsYXN0VXBkYXRlRnJvbS5jdXJyZW50ID0gXCJjYWNoZVwiO1xuICAgICAgICAgIGxhZ2d5RGF0YVJlZi5jdXJyZW50ID0gZGF0YTtcbiAgICAgICAgICBtdXRhdGVDYWNoZShkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgX211dGF0ZShhc3luY1VwZGF0ZSwgeyBzaG91bGRSZXZhbGlkYXRlQWZ0ZXI6IG9wdGlvbnM/LnNob3VsZFJldmFsaWRhdGVBZnRlciB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnM/LnJvbGxiYWNrT25FcnJvciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY29uc3QgZGF0YSA9IG9wdGlvbnMucm9sbGJhY2tPbkVycm9yKGxhdGVzdERhdGEuY3VycmVudCk7XG4gICAgICAgICAgbGFzdFVwZGF0ZUZyb20uY3VycmVudCA9IFwiY2FjaGVcIjtcbiAgICAgICAgICBsYWdneURhdGFSZWYuY3VycmVudCA9IGRhdGE7XG4gICAgICAgICAgbXV0YXRlQ2FjaGUoZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucz8ub3B0aW1pc3RpY1VwZGF0ZSAmJiBvcHRpb25zPy5yb2xsYmFja09uRXJyb3IgIT09IGZhbHNlKSB7XG4gICAgICAgICAgbGFzdFVwZGF0ZUZyb20uY3VycmVudCA9IFwiY2FjaGVcIjtcbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHdoZW4gdW5kZWZpbmVkLCBpdCdzIGV4cGVjdGVkXG4gICAgICAgICAgbGFnZ3lEYXRhUmVmLmN1cnJlbnQgPSBkYXRhQmVmb3JlT3B0aW1pc3RpY1VwZGF0ZTtcbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHdoZW4gdW5kZWZpbmVkLCBpdCdzIGV4cGVjdGVkXG4gICAgICAgICAgbXV0YXRlQ2FjaGUoZGF0YUJlZm9yZU9wdGltaXN0aWNVcGRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9LFxuICAgIFttdXRhdGVDYWNoZSwgX211dGF0ZSwgbGF0ZXN0RGF0YSwgbGFnZ3lEYXRhUmVmLCBsYXN0VXBkYXRlRnJvbV0sXG4gICk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoY2FjaGVkRGF0YSAhPT0gZW1wdHlDYWNoZSkge1xuICAgICAgbGFzdFVwZGF0ZUZyb20uY3VycmVudCA9IFwiY2FjaGVcIjtcbiAgICAgIGxhZ2d5RGF0YVJlZi5jdXJyZW50ID0gY2FjaGVkRGF0YTtcbiAgICB9XG4gIH0sIFtjYWNoZWREYXRhXSk7XG5cbiAgcmV0dXJuIHtcbiAgICBkYXRhOiByZXR1cm5lZERhdGEsXG4gICAgaXNMb2FkaW5nOiBzdGF0ZS5pc0xvYWRpbmcsXG4gICAgZXJyb3I6IHN0YXRlLmVycm9yLFxuICAgIG11dGF0ZTogcGFnaW5hdGlvbkFyZ3NSZWYuY3VycmVudCAmJiBwYWdpbmF0aW9uQXJnc1JlZi5jdXJyZW50LnBhZ2UgPiAwID8gX211dGF0ZSA6IG11dGF0ZSxcbiAgICBwYWdpbmF0aW9uLFxuICAgIHJldmFsaWRhdGUsXG4gIH07XG59XG4iLCAiaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZU1lbW8sIHVzZVJlZiB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlQ2FjaGVkUHJvbWlzZSwgQ2FjaGVkUHJvbWlzZU9wdGlvbnMgfSBmcm9tIFwiLi91c2VDYWNoZWRQcm9taXNlXCI7XG5pbXBvcnQgeyB1c2VMYXRlc3QgfSBmcm9tIFwiLi91c2VMYXRlc3RcIjtcbmltcG9ydCB7IEZ1bmN0aW9uUmV0dXJuaW5nUGFnaW5hdGVkUHJvbWlzZSwgRnVuY3Rpb25SZXR1cm5pbmdQcm9taXNlLCBVc2VDYWNoZWRQcm9taXNlUmV0dXJuVHlwZSB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBpc0pTT04gfSBmcm9tIFwiLi9mZXRjaC11dGlsc1wiO1xuaW1wb3J0IHsgaGFzaCB9IGZyb20gXCIuL2hlbHBlcnNcIjtcblxuYXN5bmMgZnVuY3Rpb24gZGVmYXVsdFBhcnNpbmcocmVzcG9uc2U6IFJlc3BvbnNlKSB7XG4gIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7XG4gIH1cblxuICBjb25zdCBjb250ZW50VHlwZUhlYWRlciA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpO1xuXG4gIGlmIChjb250ZW50VHlwZUhlYWRlciAmJiBpc0pTT04oY29udGVudFR5cGVIZWFkZXIpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0TWFwcGluZzxWLCBUIGV4dGVuZHMgdW5rbm93bltdPihyZXN1bHQ6IFYpOiB7IGRhdGE6IFQ7IGhhc01vcmU/OiBib29sZWFuOyBjdXJzb3I/OiBhbnkgfSB7XG4gIHJldHVybiB7IGRhdGE6IHJlc3VsdCBhcyB1bmtub3duIGFzIFQsIGhhc01vcmU6IGZhbHNlIH07XG59XG5cbnR5cGUgUmVxdWVzdEluZm8gPSBzdHJpbmcgfCBVUkwgfCBnbG9iYWxUaGlzLlJlcXVlc3Q7XG50eXBlIFBhZ2luYXRlZFJlcXVlc3RJbmZvID0gKHBhZ2luYXRpb246IHsgcGFnZTogbnVtYmVyOyBsYXN0SXRlbT86IGFueTsgY3Vyc29yPzogYW55IH0pID0+IFJlcXVlc3RJbmZvO1xuXG4vKipcbiAqIEZldGNoZXMgdGhlIHBhZ2luYXRlZFVSTCBhbmQgcmV0dXJucyB0aGUge0BsaW5rIEFzeW5jU3RhdGV9IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZmV0Y2guIFRoZSBsYXN0IHZhbHVlIHdpbGwgYmUga2VwdCBiZXR3ZWVuIGNvbW1hbmQgcnVucy5cbiAqXG4gKiBAcmVtYXJrIFRoaXMgb3ZlcmxvYWQgc2hvdWxkIGJlIHVzZWQgd2hlbiB3b3JraW5nIHdpdGggcGFnaW5hdGVkIGRhdGEgc291cmNlcy5cbiAqIEByZW1hcmsgV2hlbiBwYWdpbmF0aW5nLCBvbmx5IHRoZSBmaXJzdCBwYWdlIHdpbGwgYmUgY2FjaGVkLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IEljb24sIEltYWdlLCBMaXN0IH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuICogaW1wb3J0IHsgdXNlRmV0Y2ggfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqIGltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG4gKlxuICogdHlwZSBTZWFyY2hSZXN1bHQgPSB7IGNvbXBhbmllczogQ29tcGFueVtdOyBwYWdlOiBudW1iZXI7IHRvdGFsUGFnZXM6IG51bWJlciB9O1xuICogdHlwZSBDb21wYW55ID0geyBpZDogbnVtYmVyOyBuYW1lOiBzdHJpbmc7IHNtYWxsTG9nb1VybD86IHN0cmluZyB9O1xuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoXCJcIik7XG4gKiAgIGNvbnN0IHsgaXNMb2FkaW5nLCBkYXRhLCBwYWdpbmF0aW9uIH0gPSB1c2VGZXRjaChcbiAqICAgICAob3B0aW9ucykgPT5cbiAqICAgICAgIFwiaHR0cHM6Ly9hcGkueWNvbWJpbmF0b3IuY29tL3YwLjEvY29tcGFuaWVzP1wiICtcbiAqICAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMoeyBwYWdlOiBTdHJpbmcob3B0aW9ucy5wYWdlICsgMSksIHE6IHNlYXJjaFRleHQgfSkudG9TdHJpbmcoKSxcbiAqICAgICB7XG4gKiAgICAgICBtYXBSZXN1bHQocmVzdWx0OiBTZWFyY2hSZXN1bHQpIHtcbiAqICAgICAgICAgcmV0dXJuIHtcbiAqICAgICAgICAgICBkYXRhOiByZXN1bHQuY29tcGFuaWVzLFxuICogICAgICAgICAgIGhhc01vcmU6IHJlc3VsdC5wYWdlIDwgcmVzdWx0LnRvdGFsUGFnZXMsXG4gKiAgICAgICAgIH07XG4gKiAgICAgICB9LFxuICogICAgICAga2VlcFByZXZpb3VzRGF0YTogdHJ1ZSxcbiAqICAgICAgIGluaXRpYWxEYXRhOiBbXSxcbiAqICAgICB9LFxuICogICApO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8TGlzdCBpc0xvYWRpbmc9e2lzTG9hZGluZ30gcGFnaW5hdGlvbj17cGFnaW5hdGlvbn0gb25TZWFyY2hUZXh0Q2hhbmdlPXtzZXRTZWFyY2hUZXh0fT5cbiAqICAgICAgIHtkYXRhLm1hcCgoY29tcGFueSkgPT4gKFxuICogICAgICAgICA8TGlzdC5JdGVtXG4gKiAgICAgICAgICAga2V5PXtjb21wYW55LmlkfVxuICogICAgICAgICAgIGljb249e3sgc291cmNlOiBjb21wYW55LnNtYWxsTG9nb1VybCA/PyBJY29uLk1pbnVzQ2lyY2xlLCBtYXNrOiBJbWFnZS5NYXNrLlJvdW5kZWRSZWN0YW5nbGUgfX1cbiAqICAgICAgICAgICB0aXRsZT17Y29tcGFueS5uYW1lfVxuICogICAgICAgICAvPlxuICogICAgICAgKSl9XG4gKiAgICAgPC9MaXN0PlxuICogICApO1xuICogfVxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VGZXRjaDxWID0gdW5rbm93biwgVSA9IHVuZGVmaW5lZCwgVCBleHRlbmRzIHVua25vd25bXSA9IHVua25vd25bXT4oXG4gIHVybDogUGFnaW5hdGVkUmVxdWVzdEluZm8sXG4gIG9wdGlvbnM6IFJlcXVlc3RJbml0ICYge1xuICAgIG1hcFJlc3VsdDogKHJlc3VsdDogVikgPT4geyBkYXRhOiBUOyBoYXNNb3JlPzogYm9vbGVhbjsgY3Vyc29yPzogYW55IH07XG4gICAgcGFyc2VSZXNwb25zZT86IChyZXNwb25zZTogUmVzcG9uc2UpID0+IFByb21pc2U8Vj47XG4gIH0gJiBPbWl0PENhY2hlZFByb21pc2VPcHRpb25zPCh1cmw6IFJlcXVlc3RJbmZvLCBvcHRpb25zPzogUmVxdWVzdEluaXQpID0+IFByb21pc2U8VD4sIFU+LCBcImFib3J0YWJsZVwiPixcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFQsIFU+O1xuLyoqXG4gKiBGZXRjaCB0aGUgVVJMIGFuZCByZXR1cm5zIHRoZSB7QGxpbmsgQXN5bmNTdGF0ZX0gY29ycmVzcG9uZGluZyB0byB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmZXRjaC4gVGhlIGxhc3QgdmFsdWUgd2lsbCBiZSBrZXB0IGJldHdlZW4gY29tbWFuZCBydW5zLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IHVzZUZldGNoIH0gZnJvbSAnQHJheWNhc3QvdXRpbHMnO1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIENvbW1hbmQoKSB7XG4gKiAgIGNvbnN0IHsgaXNMb2FkaW5nLCBkYXRhLCByZXZhbGlkYXRlIH0gPSB1c2VGZXRjaCgnaHR0cHM6Ly9hcGkuZXhhbXBsZScpO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8RGV0YWlsXG4gKiAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAqICAgICAgIG1hcmtkb3duPXtkYXRhfVxuICogICAgICAgYWN0aW9ucz17XG4gKiAgICAgICAgIDxBY3Rpb25QYW5lbD5cbiAqICAgICAgICAgICA8QWN0aW9uIHRpdGxlPVwiUmVsb2FkXCIgb25BY3Rpb249eygpID0+IHJldmFsaWRhdGUoKX0gLz5cbiAqICAgICAgICAgPC9BY3Rpb25QYW5lbD5cbiAqICAgICAgIH1cbiAqICAgICAvPlxuICogICApO1xuICogfTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRmV0Y2g8ViA9IHVua25vd24sIFUgPSB1bmRlZmluZWQsIFQgPSBWPihcbiAgdXJsOiBSZXF1ZXN0SW5mbyxcbiAgb3B0aW9ucz86IFJlcXVlc3RJbml0ICYge1xuICAgIG1hcFJlc3VsdD86IChyZXN1bHQ6IFYpID0+IHsgZGF0YTogVDsgaGFzTW9yZT86IGJvb2xlYW47IGN1cnNvcj86IGFueSB9O1xuICAgIHBhcnNlUmVzcG9uc2U/OiAocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiBQcm9taXNlPFY+O1xuICB9ICYgT21pdDxDYWNoZWRQcm9taXNlT3B0aW9uczwodXJsOiBSZXF1ZXN0SW5mbywgb3B0aW9ucz86IFJlcXVlc3RJbml0KSA9PiBQcm9taXNlPFQ+LCBVPiwgXCJhYm9ydGFibGVcIj4sXG4pOiBVc2VDYWNoZWRQcm9taXNlUmV0dXJuVHlwZTxULCBVPiAmIHsgcGFnaW5hdGlvbjogdW5kZWZpbmVkIH07XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VGZXRjaDxWID0gdW5rbm93biwgVSA9IHVuZGVmaW5lZCwgVCBleHRlbmRzIHVua25vd25bXSA9IHVua25vd25bXT4oXG4gIHVybDogUmVxdWVzdEluZm8gfCBQYWdpbmF0ZWRSZXF1ZXN0SW5mbyxcbiAgb3B0aW9ucz86IFJlcXVlc3RJbml0ICYge1xuICAgIG1hcFJlc3VsdD86IChyZXN1bHQ6IFYpID0+IHsgZGF0YTogVDsgaGFzTW9yZT86IGJvb2xlYW47IGN1cnNvcj86IGFueSB9O1xuICAgIHBhcnNlUmVzcG9uc2U/OiAocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiBQcm9taXNlPFY+O1xuICB9ICYgT21pdDxDYWNoZWRQcm9taXNlT3B0aW9uczwodXJsOiBSZXF1ZXN0SW5mbywgb3B0aW9ucz86IFJlcXVlc3RJbml0KSA9PiBQcm9taXNlPFQ+LCBVPiwgXCJhYm9ydGFibGVcIj4sXG4pOiBVc2VDYWNoZWRQcm9taXNlUmV0dXJuVHlwZTxULCBVPiB7XG4gIGNvbnN0IHtcbiAgICBwYXJzZVJlc3BvbnNlLFxuICAgIG1hcFJlc3VsdCxcbiAgICBpbml0aWFsRGF0YSxcbiAgICBleGVjdXRlLFxuICAgIGtlZXBQcmV2aW91c0RhdGEsXG4gICAgb25FcnJvcixcbiAgICBvbkRhdGEsXG4gICAgb25XaWxsRXhlY3V0ZSxcbiAgICBmYWlsdXJlVG9hc3RPcHRpb25zLFxuICAgIC4uLmZldGNoT3B0aW9uc1xuICB9ID0gb3B0aW9ucyB8fCB7fTtcblxuICBjb25zdCB1c2VDYWNoZWRQcm9taXNlT3B0aW9uczogQ2FjaGVkUHJvbWlzZU9wdGlvbnM8KHVybDogUmVxdWVzdEluZm8sIG9wdGlvbnM/OiBSZXF1ZXN0SW5pdCkgPT4gUHJvbWlzZTxUPiwgVT4gPSB7XG4gICAgaW5pdGlhbERhdGEsXG4gICAgZXhlY3V0ZSxcbiAgICBrZWVwUHJldmlvdXNEYXRhLFxuICAgIG9uRXJyb3IsXG4gICAgb25EYXRhLFxuICAgIG9uV2lsbEV4ZWN1dGUsXG4gICAgZmFpbHVyZVRvYXN0T3B0aW9ucyxcbiAgfTtcblxuICBjb25zdCBwYXJzZVJlc3BvbnNlUmVmID0gdXNlTGF0ZXN0KHBhcnNlUmVzcG9uc2UgfHwgZGVmYXVsdFBhcnNpbmcpO1xuICBjb25zdCBtYXBSZXN1bHRSZWYgPSB1c2VMYXRlc3QobWFwUmVzdWx0IHx8IGRlZmF1bHRNYXBwaW5nKTtcbiAgY29uc3QgdXJsUmVmID0gdXNlUmVmPFJlcXVlc3RJbmZvIHwgUGFnaW5hdGVkUmVxdWVzdEluZm8+KG51bGwpO1xuICBjb25zdCBmaXJzdFBhZ2VVcmxSZWYgPSB1c2VSZWY8UmVxdWVzdEluZm8gfCB1bmRlZmluZWQ+KG51bGwpO1xuICBjb25zdCBmaXJzdFBhZ2VVcmwgPSB0eXBlb2YgdXJsID09PSBcImZ1bmN0aW9uXCIgPyB1cmwoeyBwYWdlOiAwIH0pIDogdW5kZWZpbmVkO1xuICAvKipcbiAgICogV2hlbiBwYWdpbmF0aW5nLCBgdXJsYCBpcyBhIGBQYWdpbmF0ZWRSZXF1ZXN0SW5mb2AsIHNvIHdlIG9ubHkgd2FudCB0byB1cGRhdGUgdGhlIHJlZiB3aGVuIHRoZSBgZmlyc3RQYWdlVXJsYCBjaGFuZ2VzLlxuICAgKiBXaGVuIG5vdCBwYWdpbmF0aW5nLCBgdXJsYCBpcyBhIGBSZXF1ZXN0SW5mb2AsIHNvIHdlIHdhbnQgdG8gdXBkYXRlIHRoZSByZWYgd2hlbmV2ZXIgYHVybGAgY2hhbmdlcy5cbiAgICovXG4gIGlmICghdXJsUmVmLmN1cnJlbnQgfHwgdHlwZW9mIGZpcnN0UGFnZVVybFJlZi5jdXJyZW50ID09PSBcInVuZGVmaW5lZFwiIHx8IGZpcnN0UGFnZVVybFJlZi5jdXJyZW50ICE9PSBmaXJzdFBhZ2VVcmwpIHtcbiAgICB1cmxSZWYuY3VycmVudCA9IHVybDtcbiAgfVxuICBmaXJzdFBhZ2VVcmxSZWYuY3VycmVudCA9IGZpcnN0UGFnZVVybDtcbiAgY29uc3QgYWJvcnRhYmxlID0gdXNlUmVmPEFib3J0Q29udHJvbGxlcj4obnVsbCk7XG5cbiAgY29uc3QgcGFnaW5hdGVkRm46IEZ1bmN0aW9uUmV0dXJuaW5nUGFnaW5hdGVkUHJvbWlzZTxbUGFnaW5hdGVkUmVxdWVzdEluZm8sIHR5cGVvZiBmZXRjaE9wdGlvbnNdLCBUPiA9IHVzZUNhbGxiYWNrKFxuICAgICh1cmw6IFBhZ2luYXRlZFJlcXVlc3RJbmZvLCBvcHRpb25zPzogUmVxdWVzdEluaXQpID0+IGFzeW5jIChwYWdpbmF0aW9uOiB7IHBhZ2U6IG51bWJlciB9KSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwocGFnaW5hdGlvbiksIHsgc2lnbmFsOiBhYm9ydGFibGUuY3VycmVudD8uc2lnbmFsLCAuLi5vcHRpb25zIH0pO1xuICAgICAgY29uc3QgcGFyc2VkID0gKGF3YWl0IHBhcnNlUmVzcG9uc2VSZWYuY3VycmVudChyZXMpKSBhcyBWO1xuICAgICAgcmV0dXJuIG1hcFJlc3VsdFJlZi5jdXJyZW50Py4ocGFyc2VkKTtcbiAgICB9LFxuICAgIFtwYXJzZVJlc3BvbnNlUmVmLCBtYXBSZXN1bHRSZWZdLFxuICApO1xuICBjb25zdCBmbjogRnVuY3Rpb25SZXR1cm5pbmdQcm9taXNlPFtSZXF1ZXN0SW5mbywgUmVxdWVzdEluaXQ/XSwgVD4gPSB1c2VDYWxsYmFjayhcbiAgICBhc3luYyAodXJsOiBSZXF1ZXN0SW5mbywgb3B0aW9ucz86IFJlcXVlc3RJbml0KSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHsgc2lnbmFsOiBhYm9ydGFibGUuY3VycmVudD8uc2lnbmFsLCAuLi5vcHRpb25zIH0pO1xuICAgICAgY29uc3QgcGFyc2VkID0gKGF3YWl0IHBhcnNlUmVzcG9uc2VSZWYuY3VycmVudChyZXMpKSBhcyBWO1xuICAgICAgY29uc3QgbWFwcGVkID0gbWFwUmVzdWx0UmVmLmN1cnJlbnQocGFyc2VkKTtcbiAgICAgIHJldHVybiBtYXBwZWQ/LmRhdGEgYXMgdW5rbm93biBhcyBUO1xuICAgIH0sXG4gICAgW3BhcnNlUmVzcG9uc2VSZWYsIG1hcFJlc3VsdFJlZl0sXG4gICk7XG5cbiAgY29uc3QgcHJvbWlzZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChmaXJzdFBhZ2VVcmxSZWYuY3VycmVudCkge1xuICAgICAgcmV0dXJuIHBhZ2luYXRlZEZuO1xuICAgIH1cbiAgICByZXR1cm4gZm47XG4gIH0sIFtmaXJzdFBhZ2VVcmxSZWYsIGZuLCBwYWdpbmF0ZWRGbl0pO1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3IgbGFzdEl0ZW0gY2FuJ3QgYmUgaW5mZXJyZWQgcHJvcGVybHlcbiAgcmV0dXJuIHVzZUNhY2hlZFByb21pc2UocHJvbWlzZSwgW3VybFJlZi5jdXJyZW50IGFzIFBhZ2luYXRlZFJlcXVlc3RJbmZvLCBmZXRjaE9wdGlvbnNdLCB7XG4gICAgLi4udXNlQ2FjaGVkUHJvbWlzZU9wdGlvbnMsXG4gICAgaW50ZXJuYWxfY2FjaGVLZXlTdWZmaXg6IGZpcnN0UGFnZVVybFJlZi5jdXJyZW50ICsgaGFzaChtYXBSZXN1bHRSZWYuY3VycmVudCkgKyBoYXNoKHBhcnNlUmVzcG9uc2VSZWYuY3VycmVudCksXG4gICAgYWJvcnRhYmxlLFxuICB9KTtcbn1cbiIsICJleHBvcnQgZnVuY3Rpb24gaXNKU09OKGNvbnRlbnRUeXBlSGVhZGVyOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gIGlmIChjb250ZW50VHlwZUhlYWRlcikge1xuICAgIGNvbnN0IG1lZGlhVHlwZSA9IHBhcnNlQ29udGVudFR5cGUoY29udGVudFR5cGVIZWFkZXIpO1xuXG4gICAgaWYgKCFtZWRpYVR5cGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAobWVkaWFUeXBlLnN1YnR5cGUgPT09IFwianNvblwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAobWVkaWFUeXBlLnN1ZmZpeCA9PT0gXCJqc29uXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChtZWRpYVR5cGUuc3VmZml4ICYmIC9cXGJqc29uXFxiL2kudGVzdChtZWRpYVR5cGUuc3VmZml4KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKG1lZGlhVHlwZS5zdWJ0eXBlICYmIC9cXGJqc29uXFxiL2kudGVzdChtZWRpYVR5cGUuc3VidHlwZSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogUmVnRXhwIHRvIG1hdGNoIHR5cGUgaW4gUkZDIDY4Mzggd2l0aCBhbiBvcHRpb25hbCB0cmFpbGluZyBgO2AgYmVjYXVzZSBzb21lIEFwcGxlIEFQSXMgcmV0dXJucyBvbmUuLi5cbiAqXG4gKiB0eXBlLW5hbWUgPSByZXN0cmljdGVkLW5hbWVcbiAqIHN1YnR5cGUtbmFtZSA9IHJlc3RyaWN0ZWQtbmFtZVxuICogcmVzdHJpY3RlZC1uYW1lID0gcmVzdHJpY3RlZC1uYW1lLWZpcnN0ICoxMjZyZXN0cmljdGVkLW5hbWUtY2hhcnNcbiAqIHJlc3RyaWN0ZWQtbmFtZS1maXJzdCAgPSBBTFBIQSAvIERJR0lUXG4gKiByZXN0cmljdGVkLW5hbWUtY2hhcnMgID0gQUxQSEEgLyBESUdJVCAvIFwiIVwiIC8gXCIjXCIgL1xuICogICAgICAgICAgICAgICAgICAgICAgICAgIFwiJFwiIC8gXCImXCIgLyBcIi1cIiAvIFwiXlwiIC8gXCJfXCJcbiAqIHJlc3RyaWN0ZWQtbmFtZS1jaGFycyA9LyBcIi5cIiA7IENoYXJhY3RlcnMgYmVmb3JlIGZpcnN0IGRvdCBhbHdheXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOyBzcGVjaWZ5IGEgZmFjZXQgbmFtZVxuICogcmVzdHJpY3RlZC1uYW1lLWNoYXJzID0vIFwiK1wiIDsgQ2hhcmFjdGVycyBhZnRlciBsYXN0IHBsdXMgYWx3YXlzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsgc3BlY2lmeSBhIHN0cnVjdHVyZWQgc3ludGF4IHN1ZmZpeFxuICogQUxQSEEgPSAgJXg0MS01QSAvICV4NjEtN0EgICA7IEEtWiAvIGEtelxuICogRElHSVQgPSAgJXgzMC0zOSAgICAgICAgICAgICA7IDAtOVxuICovXG5jb25zdCBNRURJQV9UWVBFX1JFR0VYUCA9IC9eKFtBLVphLXowLTldW0EtWmEtejAtOSEjJCZeXy1dezAsMTI2fSlcXC8oW0EtWmEtejAtOV1bQS1aYS16MC05ISMkJl5fListXXswLDEyNn0pOz8kLztcblxuZnVuY3Rpb24gcGFyc2VDb250ZW50VHlwZShoZWFkZXI6IHN0cmluZykge1xuICBjb25zdCBoZWFkZXJEZWxpbWl0YXRpb25pbmRleCA9IGhlYWRlci5pbmRleE9mKFwiO1wiKTtcbiAgY29uc3QgY29udGVudFR5cGUgPSBoZWFkZXJEZWxpbWl0YXRpb25pbmRleCAhPT0gLTEgPyBoZWFkZXIuc2xpY2UoMCwgaGVhZGVyRGVsaW1pdGF0aW9uaW5kZXgpLnRyaW0oKSA6IGhlYWRlci50cmltKCk7XG5cbiAgY29uc3QgbWF0Y2ggPSBNRURJQV9UWVBFX1JFR0VYUC5leGVjKGNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkudG9Mb3dlckNhc2UoKSk7XG5cbiAgaWYgKCFtYXRjaCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHR5cGUgPSBtYXRjaFsxXTtcbiAgbGV0IHN1YnR5cGUgPSBtYXRjaFsyXTtcbiAgbGV0IHN1ZmZpeDtcblxuICAvLyBzdWZmaXggYWZ0ZXIgbGFzdCArXG4gIGNvbnN0IGluZGV4ID0gc3VidHlwZS5sYXN0SW5kZXhPZihcIitcIik7XG4gIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICBzdWZmaXggPSBzdWJ0eXBlLnN1YnN0cmluZyhpbmRleCArIDEpO1xuICAgIHN1YnR5cGUgPSBzdWJ0eXBlLnN1YnN0cmluZygwLCBpbmRleCk7XG4gIH1cblxuICByZXR1cm4geyB0eXBlLCBzdWJ0eXBlLCBzdWZmaXggfTtcbn1cbiIsICIvKlxuICogSW5zcGlyZWQgYnkgRXhlY2FcbiAqL1xuXG5pbXBvcnQgY2hpbGRQcm9jZXNzIGZyb20gXCJub2RlOmNoaWxkX3Byb2Nlc3NcIjtcbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VSZWYgfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgdXNlQ2FjaGVkUHJvbWlzZSwgQ2FjaGVkUHJvbWlzZU9wdGlvbnMgfSBmcm9tIFwiLi91c2VDYWNoZWRQcm9taXNlXCI7XG5pbXBvcnQgeyB1c2VMYXRlc3QgfSBmcm9tIFwiLi91c2VMYXRlc3RcIjtcbmltcG9ydCB7IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlIH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7XG4gIGdldFNwYXduZWRQcm9taXNlLFxuICBnZXRTcGF3bmVkUmVzdWx0LFxuICBoYW5kbGVPdXRwdXQsXG4gIGRlZmF1bHRQYXJzaW5nLFxuICBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyLFxufSBmcm9tIFwiLi9leGVjLXV0aWxzXCI7XG5cbnR5cGUgRXhlY09wdGlvbnMgPSB7XG4gIC8qKlxuICAgKiBJZiBgdHJ1ZWAsIHJ1bnMgdGhlIGNvbW1hbmQgaW5zaWRlIG9mIGEgc2hlbGwuIFVzZXMgYC9iaW4vc2hgLiBBIGRpZmZlcmVudCBzaGVsbCBjYW4gYmUgc3BlY2lmaWVkIGFzIGEgc3RyaW5nLiBUaGUgc2hlbGwgc2hvdWxkIHVuZGVyc3RhbmQgdGhlIGAtY2Agc3dpdGNoLlxuICAgKlxuICAgKiBXZSByZWNvbW1lbmQgYWdhaW5zdCB1c2luZyB0aGlzIG9wdGlvbiBzaW5jZSBpdCBpczpcbiAgICogLSBub3QgY3Jvc3MtcGxhdGZvcm0sIGVuY291cmFnaW5nIHNoZWxsLXNwZWNpZmljIHN5bnRheC5cbiAgICogLSBzbG93ZXIsIGJlY2F1c2Ugb2YgdGhlIGFkZGl0aW9uYWwgc2hlbGwgaW50ZXJwcmV0YXRpb24uXG4gICAqIC0gdW5zYWZlLCBwb3RlbnRpYWxseSBhbGxvd2luZyBjb21tYW5kIGluamVjdGlvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHNoZWxsPzogYm9vbGVhbiB8IHN0cmluZztcbiAgLyoqXG4gICAqIFN0cmlwIHRoZSBmaW5hbCBuZXdsaW5lIGNoYXJhY3RlciBmcm9tIHRoZSBvdXRwdXQuXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHN0cmlwRmluYWxOZXdsaW5lPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEN1cnJlbnQgd29ya2luZyBkaXJlY3Rvcnkgb2YgdGhlIGNoaWxkIHByb2Nlc3MuXG4gICAqIEBkZWZhdWx0IHByb2Nlc3MuY3dkKClcbiAgICovXG4gIGN3ZD86IHN0cmluZztcbiAgLyoqXG4gICAqIEVudmlyb25tZW50IGtleS12YWx1ZSBwYWlycy4gRXh0ZW5kcyBhdXRvbWF0aWNhbGx5IGZyb20gYHByb2Nlc3MuZW52YC5cbiAgICogQGRlZmF1bHQgcHJvY2Vzcy5lbnZcbiAgICovXG4gIGVudj86IE5vZGVKUy5Qcm9jZXNzRW52O1xuICAvKipcbiAgICogU3BlY2lmeSB0aGUgY2hhcmFjdGVyIGVuY29kaW5nIHVzZWQgdG8gZGVjb2RlIHRoZSBzdGRvdXQgYW5kIHN0ZGVyciBvdXRwdXQuIElmIHNldCB0byBgXCJidWZmZXJcImAsIHRoZW4gc3Rkb3V0IGFuZCBzdGRlcnIgd2lsbCBiZSBhIEJ1ZmZlciBpbnN0ZWFkIG9mIGEgc3RyaW5nLlxuICAgKlxuICAgKiBAZGVmYXVsdCBcInV0ZjhcIlxuICAgKi9cbiAgZW5jb2Rpbmc/OiBCdWZmZXJFbmNvZGluZyB8IFwiYnVmZmVyXCI7XG4gIC8qKlxuICAgKiBXcml0ZSBzb21lIGlucHV0IHRvIHRoZSBgc3RkaW5gIG9mIHlvdXIgYmluYXJ5LlxuICAgKi9cbiAgaW5wdXQ/OiBzdHJpbmcgfCBCdWZmZXI7XG4gIC8qKiBJZiB0aW1lb3V0IGlzIGdyZWF0ZXIgdGhhbiBgMGAsIHRoZSBwYXJlbnQgd2lsbCBzZW5kIHRoZSBzaWduYWwgYFNJR1RFUk1gIGlmIHRoZSBjaGlsZCBydW5zIGxvbmdlciB0aGFuIHRpbWVvdXQgbWlsbGlzZWNvbmRzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAxMDAwMFxuICAgKi9cbiAgdGltZW91dD86IG51bWJlcjtcbn07XG5cbmNvbnN0IFNQQUNFU19SRUdFWFAgPSAvICsvZztcbmZ1bmN0aW9uIHBhcnNlQ29tbWFuZChjb21tYW5kOiBzdHJpbmcsIGFyZ3M/OiBzdHJpbmdbXSkge1xuICBpZiAoYXJncykge1xuICAgIHJldHVybiBbY29tbWFuZCwgLi4uYXJnc107XG4gIH1cbiAgY29uc3QgdG9rZW5zOiBzdHJpbmdbXSA9IFtdO1xuICBmb3IgKGNvbnN0IHRva2VuIG9mIGNvbW1hbmQudHJpbSgpLnNwbGl0KFNQQUNFU19SRUdFWFApKSB7XG4gICAgLy8gQWxsb3cgc3BhY2VzIHRvIGJlIGVzY2FwZWQgYnkgYSBiYWNrc2xhc2ggaWYgbm90IG1lYW50IGFzIGEgZGVsaW1pdGVyXG4gICAgY29uc3QgcHJldmlvdXNUb2tlbiA9IHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV07XG4gICAgaWYgKHByZXZpb3VzVG9rZW4gJiYgcHJldmlvdXNUb2tlbi5lbmRzV2l0aChcIlxcXFxcIikpIHtcbiAgICAgIC8vIE1lcmdlIHByZXZpb3VzIHRva2VuIHdpdGggY3VycmVudCBvbmVcbiAgICAgIHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV0gPSBgJHtwcmV2aW91c1Rva2VuLnNsaWNlKDAsIC0xKX0gJHt0b2tlbn1gO1xuICAgIH0gZWxzZSB7XG4gICAgICB0b2tlbnMucHVzaCh0b2tlbik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRva2Vucztcbn1cblxudHlwZSBFeGVjQ2FjaGVkUHJvbWlzZU9wdGlvbnM8VCwgVT4gPSBPbWl0PFxuICBDYWNoZWRQcm9taXNlT3B0aW9uczxcbiAgICAoX2NvbW1hbmQ6IHN0cmluZywgX2FyZ3M6IHN0cmluZ1tdLCBfb3B0aW9ucz86IEV4ZWNPcHRpb25zLCBpbnB1dD86IHN0cmluZyB8IEJ1ZmZlcikgPT4gUHJvbWlzZTxUPixcbiAgICBVXG4gID4sXG4gIFwiYWJvcnRhYmxlXCJcbj47XG5cbi8qKlxuICogRXhlY3V0ZXMgYSBjb21tYW5kIGFuZCByZXR1cm5zIHRoZSB7QGxpbmsgQXN5bmNTdGF0ZX0gY29ycmVzcG9uZGluZyB0byB0aGUgZXhlY3V0aW9uIG9mIHRoZSBjb21tYW5kLiBUaGUgbGFzdCB2YWx1ZSB3aWxsIGJlIGtlcHQgYmV0d2VlbiBjb21tYW5kIHJ1bnMuXG4gKlxuICogQHJlbWFyayBXaGVuIHNwZWNpZnlpbmcgdGhlIGFyZ3VtZW50cyB2aWEgdGhlIGBjb21tYW5kYCBzdHJpbmcsIGlmIHRoZSBmaWxlIG9yIGFuIGFyZ3VtZW50IG9mIHRoZSBjb21tYW5kIGNvbnRhaW5zIHNwYWNlcywgdGhleSBtdXN0IGJlIGVzY2FwZWQgd2l0aCBiYWNrc2xhc2hlcy4gVGhpcyBtYXR0ZXJzIGVzcGVjaWFsbHkgaWYgYGNvbW1hbmRgIGlzIG5vdCBhIGNvbnN0YW50IGJ1dCBhIHZhcmlhYmxlLCBmb3IgZXhhbXBsZSB3aXRoIGBfX2Rpcm5hbWVgIG9yIGBwcm9jZXNzLmN3ZCgpYC4gRXhjZXB0IGZvciBzcGFjZXMsIG5vIGVzY2FwaW5nL3F1b3RpbmcgaXMgbmVlZGVkLlxuICpcbiAqIFRoZSBgc2hlbGxgIG9wdGlvbiBtdXN0IGJlIHVzZWQgaWYgdGhlIGNvbW1hbmQgdXNlcyBzaGVsbC1zcGVjaWZpYyBmZWF0dXJlcyAoZm9yIGV4YW1wbGUsIGAmJmAgb3IgYHx8YCksIGFzIG9wcG9zZWQgdG8gYmVpbmcgYSBzaW1wbGUgZmlsZSBmb2xsb3dlZCBieSBpdHMgYXJndW1lbnRzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IHVzZUV4ZWMgfSBmcm9tICdAcmF5Y2FzdC91dGlscyc7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgeyBpc0xvYWRpbmcsIGRhdGEsIHJldmFsaWRhdGUgfSA9IHVzZUV4ZWMoXCJicmV3XCIsIFtcImluZm9cIiwgXCItLWpzb249djJcIiwgXCItLWluc3RhbGxlZFwiXSk7XG4gKiAgIGNvbnN0IHJlc3VsdHMgPSB1c2VNZW1vPHt9W10+KCgpID0+IEpTT04ucGFyc2UoZGF0YSB8fCBcIltdXCIpLCBbZGF0YV0pO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8TGlzdCBpc0xvYWRpbmc9e2lzTG9hZGluZ30+XG4gKiAgICAgIHsoZGF0YSB8fCBbXSkubWFwKChpdGVtKSA9PiAoXG4gKiAgICAgICAgPExpc3QuSXRlbSBrZXk9e2l0ZW0uaWR9IHRpdGxlPXtpdGVtLm5hbWV9IC8+XG4gKiAgICAgICkpfVxuICogICAgPC9MaXN0PlxuICogICApO1xuICogfTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRXhlYzxUID0gQnVmZmVyLCBVID0gdW5kZWZpbmVkPihcbiAgY29tbWFuZDogc3RyaW5nLFxuICBvcHRpb25zOiB7XG4gICAgcGFyc2VPdXRwdXQ/OiBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyPFQsIEJ1ZmZlciwgRXhlY09wdGlvbnM+O1xuICB9ICYgRXhlY09wdGlvbnMgJiB7XG4gICAgICBlbmNvZGluZzogXCJidWZmZXJcIjtcbiAgICB9ICYgRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+LFxuKTogVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGU8VCwgVT47XG5leHBvcnQgZnVuY3Rpb24gdXNlRXhlYzxUID0gc3RyaW5nLCBVID0gdW5kZWZpbmVkPihcbiAgY29tbWFuZDogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIHBhcnNlT3V0cHV0PzogUGFyc2VFeGVjT3V0cHV0SGFuZGxlcjxULCBzdHJpbmcsIEV4ZWNPcHRpb25zPjtcbiAgfSAmIEV4ZWNPcHRpb25zICYge1xuICAgICAgZW5jb2Rpbmc/OiBCdWZmZXJFbmNvZGluZztcbiAgICB9ICYgRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+LFxuKTogVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGU8VCwgVT47XG5leHBvcnQgZnVuY3Rpb24gdXNlRXhlYzxUID0gQnVmZmVyLCBVID0gdW5kZWZpbmVkPihcbiAgZmlsZTogc3RyaW5nLFxuICAvKipcbiAgICogVGhlIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBmaWxlLiBObyBlc2NhcGluZy9xdW90aW5nIGlzIG5lZWRlZC5cbiAgICpcbiAgICogSWYgZGVmaW5lZCwgdGhlIGNvbW1hbmRzIG5lZWRzIHRvIGJlIGEgZmlsZSB0byBleGVjdXRlLiBJZiB1bmRlZmluZWQsIHRoZSBhcmd1bWVudHMgd2lsbCBiZSBwYXJzZWQgZnJvbSB0aGUgY29tbWFuZC5cbiAgICovXG4gIGFyZ3M6IHN0cmluZ1tdLFxuICBvcHRpb25zOiB7XG4gICAgcGFyc2VPdXRwdXQ/OiBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyPFQsIEJ1ZmZlciwgRXhlY09wdGlvbnM+O1xuICB9ICYgRXhlY09wdGlvbnMgJiB7XG4gICAgICBlbmNvZGluZzogXCJidWZmZXJcIjtcbiAgICB9ICYgRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+LFxuKTogVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGU8VCwgVT47XG5leHBvcnQgZnVuY3Rpb24gdXNlRXhlYzxUID0gc3RyaW5nLCBVID0gdW5kZWZpbmVkPihcbiAgZmlsZTogc3RyaW5nLFxuICAvKipcbiAgICogVGhlIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBmaWxlLiBObyBlc2NhcGluZy9xdW90aW5nIGlzIG5lZWRlZC5cbiAgICpcbiAgICogSWYgZGVmaW5lZCwgdGhlIGNvbW1hbmRzIG5lZWRzIHRvIGJlIGEgZmlsZSB0byBleGVjdXRlLiBJZiB1bmRlZmluZWQsIHRoZSBhcmd1bWVudHMgd2lsbCBiZSBwYXJzZWQgZnJvbSB0aGUgY29tbWFuZC5cbiAgICovXG4gIGFyZ3M6IHN0cmluZ1tdLFxuICBvcHRpb25zPzoge1xuICAgIHBhcnNlT3V0cHV0PzogUGFyc2VFeGVjT3V0cHV0SGFuZGxlcjxULCBzdHJpbmcsIEV4ZWNPcHRpb25zPjtcbiAgfSAmIEV4ZWNPcHRpb25zICYge1xuICAgICAgZW5jb2Rpbmc/OiBCdWZmZXJFbmNvZGluZztcbiAgICB9ICYgRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+LFxuKTogVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGU8VCwgVT47XG5leHBvcnQgZnVuY3Rpb24gdXNlRXhlYzxULCBVID0gdW5kZWZpbmVkPihcbiAgY29tbWFuZDogc3RyaW5nLFxuICBvcHRpb25zT3JBcmdzPzpcbiAgICB8IHN0cmluZ1tdXG4gICAgfCAoe1xuICAgICAgICBwYXJzZU91dHB1dD86IFBhcnNlRXhlY091dHB1dEhhbmRsZXI8VCwgQnVmZmVyLCBFeGVjT3B0aW9ucz4gfCBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyPFQsIHN0cmluZywgRXhlY09wdGlvbnM+O1xuICAgICAgfSAmIEV4ZWNPcHRpb25zICZcbiAgICAgICAgRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+KSxcbiAgb3B0aW9ucz86IHtcbiAgICBwYXJzZU91dHB1dD86IFBhcnNlRXhlY091dHB1dEhhbmRsZXI8VCwgQnVmZmVyLCBFeGVjT3B0aW9ucz4gfCBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyPFQsIHN0cmluZywgRXhlY09wdGlvbnM+O1xuICB9ICYgRXhlY09wdGlvbnMgJlxuICAgIEV4ZWNDYWNoZWRQcm9taXNlT3B0aW9uczxULCBVPixcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFQsIFU+IHtcbiAgY29uc3Qge1xuICAgIHBhcnNlT3V0cHV0LFxuICAgIGlucHV0LFxuICAgIG9uRGF0YSxcbiAgICBvbldpbGxFeGVjdXRlLFxuICAgIGluaXRpYWxEYXRhLFxuICAgIGV4ZWN1dGUsXG4gICAga2VlcFByZXZpb3VzRGF0YSxcbiAgICBvbkVycm9yLFxuICAgIGZhaWx1cmVUb2FzdE9wdGlvbnMsXG4gICAgLi4uZXhlY09wdGlvbnNcbiAgfSA9IEFycmF5LmlzQXJyYXkob3B0aW9uc09yQXJncykgPyBvcHRpb25zIHx8IHt9IDogb3B0aW9uc09yQXJncyB8fCB7fTtcblxuICBjb25zdCB1c2VDYWNoZWRQcm9taXNlT3B0aW9uczogRXhlY0NhY2hlZFByb21pc2VPcHRpb25zPFQsIFU+ID0ge1xuICAgIGluaXRpYWxEYXRhLFxuICAgIGV4ZWN1dGUsXG4gICAga2VlcFByZXZpb3VzRGF0YSxcbiAgICBvbkVycm9yLFxuICAgIG9uRGF0YSxcbiAgICBvbldpbGxFeGVjdXRlLFxuICAgIGZhaWx1cmVUb2FzdE9wdGlvbnMsXG4gIH07XG5cbiAgY29uc3QgYWJvcnRhYmxlID0gdXNlUmVmPEFib3J0Q29udHJvbGxlcj4obnVsbCk7XG4gIGNvbnN0IHBhcnNlT3V0cHV0UmVmID0gdXNlTGF0ZXN0KHBhcnNlT3V0cHV0IHx8IGRlZmF1bHRQYXJzaW5nKTtcblxuICBjb25zdCBmbiA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIChfY29tbWFuZDogc3RyaW5nLCBfYXJnczogc3RyaW5nW10sIF9vcHRpb25zPzogRXhlY09wdGlvbnMsIGlucHV0Pzogc3RyaW5nIHwgQnVmZmVyKSA9PiB7XG4gICAgICBjb25zdCBbZmlsZSwgLi4uYXJnc10gPSBwYXJzZUNvbW1hbmQoX2NvbW1hbmQsIF9hcmdzKTtcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBbZmlsZSwgLi4uYXJnc10uam9pbihcIiBcIik7XG5cbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIHN0cmlwRmluYWxOZXdsaW5lOiB0cnVlLFxuICAgICAgICAuLi5fb3B0aW9ucyxcbiAgICAgICAgdGltZW91dDogX29wdGlvbnM/LnRpbWVvdXQgfHwgMTAwMDAsXG4gICAgICAgIHNpZ25hbDogYWJvcnRhYmxlLmN1cnJlbnQ/LnNpZ25hbCxcbiAgICAgICAgZW5jb2Rpbmc6IF9vcHRpb25zPy5lbmNvZGluZyA9PT0gbnVsbCA/IFwiYnVmZmVyXCIgOiBfb3B0aW9ucz8uZW5jb2RpbmcgfHwgXCJ1dGY4XCIsXG4gICAgICAgIGVudjogeyBQQVRIOiBcIi91c3IvbG9jYWwvYmluOi91c3IvYmluOi9iaW46L3Vzci9zYmluOi9zYmluXCIsIC4uLnByb2Nlc3MuZW52LCAuLi5fb3B0aW9ucz8uZW52IH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzcGF3bmVkID0gY2hpbGRQcm9jZXNzLnNwYXduKGZpbGUsIGFyZ3MsIG9wdGlvbnMpO1xuICAgICAgY29uc3Qgc3Bhd25lZFByb21pc2UgPSBnZXRTcGF3bmVkUHJvbWlzZShzcGF3bmVkLCBvcHRpb25zKTtcblxuICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgIHNwYXduZWQuc3RkaW4uZW5kKGlucHV0KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW3sgZXJyb3IsIGV4aXRDb2RlLCBzaWduYWwsIHRpbWVkT3V0IH0sIHN0ZG91dFJlc3VsdCwgc3RkZXJyUmVzdWx0XSA9IGF3YWl0IGdldFNwYXduZWRSZXN1bHQoXG4gICAgICAgIHNwYXduZWQsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHNwYXduZWRQcm9taXNlLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHN0ZG91dCA9IGhhbmRsZU91dHB1dChvcHRpb25zLCBzdGRvdXRSZXN1bHQpO1xuICAgICAgY29uc3Qgc3RkZXJyID0gaGFuZGxlT3V0cHV0KG9wdGlvbnMsIHN0ZGVyclJlc3VsdCk7XG5cbiAgICAgIHJldHVybiBwYXJzZU91dHB1dFJlZi5jdXJyZW50KHtcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciB0b28gbWFueSBnZW5lcmljcywgSSBnaXZlIHVwXG4gICAgICAgIHN0ZG91dCxcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciB0b28gbWFueSBnZW5lcmljcywgSSBnaXZlIHVwXG4gICAgICAgIHN0ZGVycixcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGV4aXRDb2RlLFxuICAgICAgICBzaWduYWwsXG4gICAgICAgIHRpbWVkT3V0LFxuICAgICAgICBjb21tYW5kLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBwYXJlbnRFcnJvcjogbmV3IEVycm9yKCksXG4gICAgICB9KSBhcyBUO1xuICAgIH0sXG4gICAgW3BhcnNlT3V0cHV0UmVmXSxcbiAgKTtcblxuICAvLyBAdHMtZXhwZWN0LWVycm9yIFQgY2FuJ3QgYmUgYSBQcm9taXNlIHNvIGl0J3MgYWN0dWFsbHkgdGhlIHNhbWVcbiAgcmV0dXJuIHVzZUNhY2hlZFByb21pc2UoZm4sIFtjb21tYW5kLCBBcnJheS5pc0FycmF5KG9wdGlvbnNPckFyZ3MpID8gb3B0aW9uc09yQXJncyA6IFtdLCBleGVjT3B0aW9ucywgaW5wdXRdLCB7XG4gICAgLi4udXNlQ2FjaGVkUHJvbWlzZU9wdGlvbnMsXG4gICAgYWJvcnRhYmxlLFxuICB9KTtcbn1cbiIsICJpbXBvcnQgY2hpbGRQcm9jZXNzIGZyb20gXCJub2RlOmNoaWxkX3Byb2Nlc3NcIjtcbmltcG9ydCB7IGNvbnN0YW50cyBhcyBCdWZmZXJDb25zdGFudHMgfSBmcm9tIFwibm9kZTpidWZmZXJcIjtcbmltcG9ydCBTdHJlYW0gZnJvbSBcIm5vZGU6c3RyZWFtXCI7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tIFwibm9kZTp1dGlsXCI7XG5pbXBvcnQgeyBvbkV4aXQgfSBmcm9tIFwiLi92ZW5kb3JzL3NpZ25hbC1leGl0XCI7XG5cbmV4cG9ydCB0eXBlIFNwYXduZWRQcm9taXNlID0gUHJvbWlzZTx7XG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsO1xuICBlcnJvcj86IEVycm9yO1xuICBzaWduYWw6IE5vZGVKUy5TaWduYWxzIHwgbnVsbDtcbiAgdGltZWRPdXQ6IGJvb2xlYW47XG59PjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNwYXduZWRQcm9taXNlKFxuICBzcGF3bmVkOiBjaGlsZFByb2Nlc3MuQ2hpbGRQcm9jZXNzV2l0aG91dE51bGxTdHJlYW1zLFxuICB7IHRpbWVvdXQgfTogeyB0aW1lb3V0PzogbnVtYmVyIH0gPSB7fSxcbik6IFNwYXduZWRQcm9taXNlIHtcbiAgY29uc3Qgc3Bhd25lZFByb21pc2U6IFNwYXduZWRQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHNwYXduZWQub24oXCJleGl0XCIsIChleGl0Q29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICByZXNvbHZlKHsgZXhpdENvZGUsIHNpZ25hbCwgdGltZWRPdXQ6IGZhbHNlIH0pO1xuICAgIH0pO1xuXG4gICAgc3Bhd25lZC5vbihcImVycm9yXCIsIChlcnJvcikgPT4ge1xuICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICB9KTtcblxuICAgIGlmIChzcGF3bmVkLnN0ZGluKSB7XG4gICAgICBzcGF3bmVkLnN0ZGluLm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XG4gICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IHJlbW92ZUV4aXRIYW5kbGVyID0gb25FeGl0KCgpID0+IHtcbiAgICBzcGF3bmVkLmtpbGwoKTtcbiAgfSk7XG5cbiAgaWYgKHRpbWVvdXQgPT09IDAgfHwgdGltZW91dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHNwYXduZWRQcm9taXNlLmZpbmFsbHkoKCkgPT4gcmVtb3ZlRXhpdEhhbmRsZXIoKSk7XG4gIH1cblxuICBsZXQgdGltZW91dElkOiBOb2RlSlMuVGltZW91dDtcbiAgY29uc3QgdGltZW91dFByb21pc2U6IFNwYXduZWRQcm9taXNlID0gbmV3IFByb21pc2UoKF9yZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHNwYXduZWQua2lsbChcIlNJR1RFUk1cIik7XG4gICAgICByZWplY3QoT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoXCJUaW1lZCBvdXRcIiksIHsgdGltZWRPdXQ6IHRydWUsIHNpZ25hbDogXCJTSUdURVJNXCIgfSkpO1xuICAgIH0sIHRpbWVvdXQpO1xuICB9KTtcblxuICBjb25zdCBzYWZlU3Bhd25lZFByb21pc2UgPSBzcGF3bmVkUHJvbWlzZS5maW5hbGx5KCgpID0+IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgfSk7XG5cbiAgcmV0dXJuIFByb21pc2UucmFjZShbdGltZW91dFByb21pc2UsIHNhZmVTcGF3bmVkUHJvbWlzZV0pLmZpbmFsbHkoKCkgPT4gcmVtb3ZlRXhpdEhhbmRsZXIoKSk7XG59XG5cbmNsYXNzIE1heEJ1ZmZlckVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihcIlRoZSBvdXRwdXQgaXMgdG9vIGJpZ1wiKTtcbiAgICB0aGlzLm5hbWUgPSBcIk1heEJ1ZmZlckVycm9yXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gYnVmZmVyU3RyZWFtPFQgZXh0ZW5kcyBzdHJpbmcgfCBCdWZmZXI+KG9wdGlvbnM6IHsgZW5jb2Rpbmc6IEJ1ZmZlckVuY29kaW5nIHwgXCJidWZmZXJcIiB9KSB7XG4gIGNvbnN0IHsgZW5jb2RpbmcgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGlzQnVmZmVyID0gZW5jb2RpbmcgPT09IFwiYnVmZmVyXCI7XG5cbiAgLy8gQHRzLWV4cGVjdC1lcnJvciBtaXNzaW5nIHRoZSBtZXRob2RzIHdlIGFyZSBhZGRpbmcgYmVsb3dcbiAgY29uc3Qgc3RyZWFtOiBTdHJlYW0uUGFzc1Rocm91Z2ggJiB7IGdldEJ1ZmZlcmVkVmFsdWU6ICgpID0+IFQ7IGdldEJ1ZmZlcmVkTGVuZ3RoOiAoKSA9PiBudW1iZXIgfSA9XG4gICAgbmV3IFN0cmVhbS5QYXNzVGhyb3VnaCh7IG9iamVjdE1vZGU6IGZhbHNlIH0pO1xuXG4gIGlmIChlbmNvZGluZyAmJiBlbmNvZGluZyAhPT0gXCJidWZmZXJcIikge1xuICAgIHN0cmVhbS5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG4gIH1cblxuICBsZXQgbGVuZ3RoID0gMDtcbiAgY29uc3QgY2h1bmtzOiBhbnlbXSA9IFtdO1xuXG4gIHN0cmVhbS5vbihcImRhdGFcIiwgKGNodW5rKSA9PiB7XG4gICAgY2h1bmtzLnB1c2goY2h1bmspO1xuXG4gICAgbGVuZ3RoICs9IGNodW5rLmxlbmd0aDtcbiAgfSk7XG5cbiAgc3RyZWFtLmdldEJ1ZmZlcmVkVmFsdWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChpc0J1ZmZlciA/IEJ1ZmZlci5jb25jYXQoY2h1bmtzLCBsZW5ndGgpIDogY2h1bmtzLmpvaW4oXCJcIikpIGFzIFQ7XG4gIH07XG5cbiAgc3RyZWFtLmdldEJ1ZmZlcmVkTGVuZ3RoID0gKCkgPT4gbGVuZ3RoO1xuXG4gIHJldHVybiBzdHJlYW07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFN0cmVhbTxUIGV4dGVuZHMgc3RyaW5nIHwgQnVmZmVyPihcbiAgaW5wdXRTdHJlYW06IFN0cmVhbS5SZWFkYWJsZSxcbiAgb3B0aW9uczogeyBlbmNvZGluZzogQnVmZmVyRW5jb2RpbmcgfCBcImJ1ZmZlclwiIH0sXG4pIHtcbiAgY29uc3Qgc3RyZWFtID0gYnVmZmVyU3RyZWFtPFQ+KG9wdGlvbnMpO1xuXG4gIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCByZWplY3RQcm9taXNlID0gKGVycm9yOiBFcnJvciAmIHsgYnVmZmVyZWREYXRhPzogVCB9KSA9PiB7XG4gICAgICAvLyBEb24ndCByZXRyaWV2ZSBhbiBvdmVyc2l6ZWQgYnVmZmVyLlxuICAgICAgaWYgKGVycm9yICYmIHN0cmVhbS5nZXRCdWZmZXJlZExlbmd0aCgpIDw9IEJ1ZmZlckNvbnN0YW50cy5NQVhfTEVOR1RIKSB7XG4gICAgICAgIGVycm9yLmJ1ZmZlcmVkRGF0YSA9IHN0cmVhbS5nZXRCdWZmZXJlZFZhbHVlKCk7XG4gICAgICB9XG5cbiAgICAgIHJlamVjdChlcnJvcik7XG4gICAgfTtcblxuICAgIChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcm9taXNpZnkoU3RyZWFtLnBpcGVsaW5lKShpbnB1dFN0cmVhbSwgc3RyZWFtKTtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVqZWN0UHJvbWlzZShlcnJvciBhcyBhbnkpO1xuICAgICAgfVxuICAgIH0pKCk7XG5cbiAgICBzdHJlYW0ub24oXCJkYXRhXCIsICgpID0+IHtcbiAgICAgIC8vIDgwbWJcbiAgICAgIGlmIChzdHJlYW0uZ2V0QnVmZmVyZWRMZW5ndGgoKSA+IDEwMDAgKiAxMDAwICogODApIHtcbiAgICAgICAgcmVqZWN0UHJvbWlzZShuZXcgTWF4QnVmZmVyRXJyb3IoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIHJldHVybiBzdHJlYW0uZ2V0QnVmZmVyZWRWYWx1ZSgpO1xufVxuXG4vLyBPbiBmYWlsdXJlLCBgcmVzdWx0LnN0ZG91dHxzdGRlcnJgIHNob3VsZCBjb250YWluIHRoZSBjdXJyZW50bHkgYnVmZmVyZWQgc3RyZWFtXG5hc3luYyBmdW5jdGlvbiBnZXRCdWZmZXJlZERhdGE8VCBleHRlbmRzIHN0cmluZyB8IEJ1ZmZlcj4oc3RyZWFtOiBTdHJlYW0uUmVhZGFibGUsIHN0cmVhbVByb21pc2U6IFByb21pc2U8VD4pIHtcbiAgc3RyZWFtLmRlc3Ryb3koKTtcblxuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBzdHJlYW1Qcm9taXNlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiAoZXJyb3IgYXMgYW55IGFzIHsgYnVmZmVyZWREYXRhOiBUIH0pLmJ1ZmZlcmVkRGF0YTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3Bhd25lZFJlc3VsdDxUIGV4dGVuZHMgc3RyaW5nIHwgQnVmZmVyPihcbiAgeyBzdGRvdXQsIHN0ZGVyciB9OiBjaGlsZFByb2Nlc3MuQ2hpbGRQcm9jZXNzV2l0aG91dE51bGxTdHJlYW1zLFxuICB7IGVuY29kaW5nIH06IHsgZW5jb2Rpbmc6IEJ1ZmZlckVuY29kaW5nIHwgXCJidWZmZXJcIiB9LFxuICBwcm9jZXNzRG9uZTogU3Bhd25lZFByb21pc2UsXG4pIHtcbiAgY29uc3Qgc3Rkb3V0UHJvbWlzZSA9IGdldFN0cmVhbTxUPihzdGRvdXQsIHsgZW5jb2RpbmcgfSk7XG4gIGNvbnN0IHN0ZGVyclByb21pc2UgPSBnZXRTdHJlYW08VD4oc3RkZXJyLCB7IGVuY29kaW5nIH0pO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKFtwcm9jZXNzRG9uZSwgc3Rkb3V0UHJvbWlzZSwgc3RkZXJyUHJvbWlzZV0pO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAgIHtcbiAgICAgICAgZXJyb3I6IGVycm9yIGFzIEVycm9yLFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgc2lnbmFsOiBlcnJvci5zaWduYWwgYXMgTm9kZUpTLlNpZ25hbHMgfCBudWxsLFxuICAgICAgICB0aW1lZE91dDogKGVycm9yLnRpbWVkT3V0IGFzIGJvb2xlYW4pIHx8IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIGdldEJ1ZmZlcmVkRGF0YShzdGRvdXQsIHN0ZG91dFByb21pc2UpLFxuICAgICAgZ2V0QnVmZmVyZWREYXRhKHN0ZGVyciwgc3RkZXJyUHJvbWlzZSksXG4gICAgXSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc3RyaXBGaW5hbE5ld2xpbmU8VCBleHRlbmRzIHN0cmluZyB8IEJ1ZmZlcj4oaW5wdXQ6IFQpIHtcbiAgY29uc3QgTEYgPSB0eXBlb2YgaW5wdXQgPT09IFwic3RyaW5nXCIgPyBcIlxcblwiIDogXCJcXG5cIi5jaGFyQ29kZUF0KDApO1xuICBjb25zdCBDUiA9IHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIiA/IFwiXFxyXCIgOiBcIlxcclwiLmNoYXJDb2RlQXQoMCk7XG5cbiAgaWYgKGlucHV0W2lucHV0Lmxlbmd0aCAtIDFdID09PSBMRikge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3Igd2UgYXJlIGRvaW5nIHNvbWUgbmFzdHkgc3R1ZmYgaGVyZVxuICAgIGlucHV0ID0gaW5wdXQuc2xpY2UoMCwgLTEpO1xuICB9XG5cbiAgaWYgKGlucHV0W2lucHV0Lmxlbmd0aCAtIDFdID09PSBDUikge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3Igd2UgYXJlIGRvaW5nIHNvbWUgbmFzdHkgc3R1ZmYgaGVyZVxuICAgIGlucHV0ID0gaW5wdXQuc2xpY2UoMCwgLTEpO1xuICB9XG5cbiAgcmV0dXJuIGlucHV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlT3V0cHV0PFQgZXh0ZW5kcyBzdHJpbmcgfCBCdWZmZXI+KG9wdGlvbnM6IHsgc3RyaXBGaW5hbE5ld2xpbmU/OiBib29sZWFuIH0sIHZhbHVlOiBUKSB7XG4gIGlmIChvcHRpb25zLnN0cmlwRmluYWxOZXdsaW5lKSB7XG4gICAgcmV0dXJuIHN0cmlwRmluYWxOZXdsaW5lKHZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0RXJyb3JQcmVmaXgoe1xuICB0aW1lZE91dCxcbiAgdGltZW91dCxcbiAgc2lnbmFsLFxuICBleGl0Q29kZSxcbn06IHtcbiAgZXhpdENvZGU6IG51bWJlciB8IG51bGw7XG4gIHNpZ25hbDogTm9kZUpTLlNpZ25hbHMgfCBudWxsO1xuICB0aW1lZE91dDogYm9vbGVhbjtcbiAgdGltZW91dD86IG51bWJlcjtcbn0pIHtcbiAgaWYgKHRpbWVkT3V0KSB7XG4gICAgcmV0dXJuIGB0aW1lZCBvdXQgYWZ0ZXIgJHt0aW1lb3V0fSBtaWxsaXNlY29uZHNgO1xuICB9XG5cbiAgaWYgKHNpZ25hbCAhPT0gdW5kZWZpbmVkICYmIHNpZ25hbCAhPT0gbnVsbCkge1xuICAgIHJldHVybiBgd2FzIGtpbGxlZCB3aXRoICR7c2lnbmFsfWA7XG4gIH1cblxuICBpZiAoZXhpdENvZGUgIT09IHVuZGVmaW5lZCAmJiBleGl0Q29kZSAhPT0gbnVsbCkge1xuICAgIHJldHVybiBgZmFpbGVkIHdpdGggZXhpdCBjb2RlICR7ZXhpdENvZGV9YDtcbiAgfVxuXG4gIHJldHVybiBcImZhaWxlZFwiO1xufVxuXG5mdW5jdGlvbiBtYWtlRXJyb3Ioe1xuICBzdGRvdXQsXG4gIHN0ZGVycixcbiAgZXJyb3IsXG4gIHNpZ25hbCxcbiAgZXhpdENvZGUsXG4gIGNvbW1hbmQsXG4gIHRpbWVkT3V0LFxuICBvcHRpb25zLFxuICBwYXJlbnRFcnJvcixcbn06IHtcbiAgc3Rkb3V0OiBzdHJpbmcgfCBCdWZmZXI7XG4gIHN0ZGVycjogc3RyaW5nIHwgQnVmZmVyO1xuICBlcnJvcj86IEVycm9yO1xuICBleGl0Q29kZTogbnVtYmVyIHwgbnVsbDtcbiAgc2lnbmFsOiBOb2RlSlMuU2lnbmFscyB8IG51bGw7XG4gIHRpbWVkT3V0OiBib29sZWFuO1xuICBjb21tYW5kOiBzdHJpbmc7XG4gIG9wdGlvbnM/OiB7IHRpbWVvdXQ/OiBudW1iZXIgfTtcbiAgcGFyZW50RXJyb3I6IEVycm9yO1xufSkge1xuICBjb25zdCBwcmVmaXggPSBnZXRFcnJvclByZWZpeCh7IHRpbWVkT3V0LCB0aW1lb3V0OiBvcHRpb25zPy50aW1lb3V0LCBzaWduYWwsIGV4aXRDb2RlIH0pO1xuICBjb25zdCBleGVjYU1lc3NhZ2UgPSBgQ29tbWFuZCAke3ByZWZpeH06ICR7Y29tbWFuZH1gO1xuICBjb25zdCBzaG9ydE1lc3NhZ2UgPSBlcnJvciA/IGAke2V4ZWNhTWVzc2FnZX1cXG4ke2Vycm9yLm1lc3NhZ2V9YCA6IGV4ZWNhTWVzc2FnZTtcbiAgY29uc3QgbWVzc2FnZSA9IFtzaG9ydE1lc3NhZ2UsIHN0ZGVyciwgc3Rkb3V0XS5maWx0ZXIoQm9vbGVhbikuam9pbihcIlxcblwiKTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIG5vdCBvbiBFcnJvclxuICAgIGVycm9yLm9yaWdpbmFsTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gIH0gZWxzZSB7XG4gICAgZXJyb3IgPSBwYXJlbnRFcnJvcjtcbiAgfVxuXG4gIGVycm9yLm1lc3NhZ2UgPSBtZXNzYWdlO1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3Igbm90IG9uIEVycm9yXG4gIGVycm9yLnNob3J0TWVzc2FnZSA9IHNob3J0TWVzc2FnZTtcbiAgLy8gQHRzLWV4cGVjdC1lcnJvciBub3Qgb24gRXJyb3JcbiAgZXJyb3IuY29tbWFuZCA9IGNvbW1hbmQ7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3Igbm90IG9uIEVycm9yXG4gIGVycm9yLmV4aXRDb2RlID0gZXhpdENvZGU7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3Igbm90IG9uIEVycm9yXG4gIGVycm9yLnNpZ25hbCA9IHNpZ25hbDtcbiAgLy8gQHRzLWV4cGVjdC1lcnJvciBub3Qgb24gRXJyb3JcbiAgZXJyb3Iuc3Rkb3V0ID0gc3Rkb3V0O1xuICAvLyBAdHMtZXhwZWN0LWVycm9yIG5vdCBvbiBFcnJvclxuICBlcnJvci5zdGRlcnIgPSBzdGRlcnI7XG5cbiAgaWYgKFwiYnVmZmVyZWREYXRhXCIgaW4gZXJyb3IpIHtcbiAgICBkZWxldGUgZXJyb3JbXCJidWZmZXJlZERhdGFcIl07XG4gIH1cblxuICByZXR1cm4gZXJyb3I7XG59XG5cbmV4cG9ydCB0eXBlIFBhcnNlRXhlY091dHB1dEhhbmRsZXI8XG4gIFQsXG4gIERlY29kZWRPdXRwdXQgZXh0ZW5kcyBzdHJpbmcgfCBCdWZmZXIgPSBzdHJpbmcgfCBCdWZmZXIsXG4gIE9wdGlvbnMgPSB1bmtub3duLFxuPiA9IChhcmdzOiB7XG4gIC8qKiBUaGUgb3V0cHV0IG9mIHRoZSBwcm9jZXNzIG9uIHN0ZG91dC4gKi9cbiAgc3Rkb3V0OiBEZWNvZGVkT3V0cHV0O1xuICAvKiogVGhlIG91dHB1dCBvZiB0aGUgcHJvY2VzcyBvbiBzdGRlcnIuICovXG4gIHN0ZGVycjogRGVjb2RlZE91dHB1dDtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgLyoqIFRoZSBudW1lcmljIGV4aXQgY29kZSBvZiB0aGUgcHJvY2VzcyB0aGF0IHdhcyBydW4uICovXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsO1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHNpZ25hbCB0aGF0IHdhcyB1c2VkIHRvIHRlcm1pbmF0ZSB0aGUgcHJvY2Vzcy4gRm9yIGV4YW1wbGUsIFNJR0ZQRS5cbiAgICpcbiAgICogSWYgYSBzaWduYWwgdGVybWluYXRlZCB0aGUgcHJvY2VzcywgdGhpcyBwcm9wZXJ0eSBpcyBkZWZpbmVkLiBPdGhlcndpc2UgaXQgaXMgbnVsbC5cbiAgICovXG4gIHNpZ25hbDogTm9kZUpTLlNpZ25hbHMgfCBudWxsO1xuICAvKiogV2hldGhlciB0aGUgcHJvY2VzcyB0aW1lZCBvdXQuICovXG4gIHRpbWVkT3V0OiBib29sZWFuO1xuICAvKiogVGhlIGNvbW1hbmQgdGhhdCB3YXMgcnVuLCBmb3IgbG9nZ2luZyBwdXJwb3Nlcy4gKi9cbiAgY29tbWFuZDogc3RyaW5nO1xuICBvcHRpb25zPzogT3B0aW9ucztcbn0pID0+IFQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWZhdWx0UGFyc2luZzxUIGV4dGVuZHMgc3RyaW5nIHwgQnVmZmVyPih7XG4gIHN0ZG91dCxcbiAgc3RkZXJyLFxuICBlcnJvcixcbiAgZXhpdENvZGUsXG4gIHNpZ25hbCxcbiAgdGltZWRPdXQsXG4gIGNvbW1hbmQsXG4gIG9wdGlvbnMsXG4gIHBhcmVudEVycm9yLFxufToge1xuICBzdGRvdXQ6IFQ7XG4gIHN0ZGVycjogVDtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgZXhpdENvZGU6IG51bWJlciB8IG51bGw7XG4gIHNpZ25hbDogTm9kZUpTLlNpZ25hbHMgfCBudWxsO1xuICB0aW1lZE91dDogYm9vbGVhbjtcbiAgY29tbWFuZDogc3RyaW5nO1xuICBvcHRpb25zPzogeyB0aW1lb3V0PzogbnVtYmVyIH07XG4gIHBhcmVudEVycm9yOiBFcnJvcjtcbn0pIHtcbiAgaWYgKGVycm9yIHx8IGV4aXRDb2RlICE9PSAwIHx8IHNpZ25hbCAhPT0gbnVsbCkge1xuICAgIGNvbnN0IHJldHVybmVkRXJyb3IgPSBtYWtlRXJyb3Ioe1xuICAgICAgZXJyb3IsXG4gICAgICBleGl0Q29kZSxcbiAgICAgIHNpZ25hbCxcbiAgICAgIHN0ZG91dCxcbiAgICAgIHN0ZGVycixcbiAgICAgIGNvbW1hbmQsXG4gICAgICB0aW1lZE91dCxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBwYXJlbnRFcnJvcixcbiAgICB9KTtcblxuICAgIHRocm93IHJldHVybmVkRXJyb3I7XG4gIH1cblxuICByZXR1cm4gc3Rkb3V0O1xufVxuIiwgIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudCAqL1xuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSAqL1xuLy8gTm90ZTogc2luY2UgbnljIHVzZXMgdGhpcyBtb2R1bGUgdG8gb3V0cHV0IGNvdmVyYWdlLCBhbnkgbGluZXNcbi8vIHRoYXQgYXJlIGluIHRoZSBkaXJlY3Qgc3luYyBmbG93IG9mIG55YydzIG91dHB1dENvdmVyYWdlIGFyZVxuLy8gaWdub3JlZCwgc2luY2Ugd2UgY2FuIG5ldmVyIGdldCBjb3ZlcmFnZSBmb3IgdGhlbS5cbi8vIGdyYWIgYSByZWZlcmVuY2UgdG8gbm9kZSdzIHJlYWwgcHJvY2VzcyBvYmplY3QgcmlnaHQgYXdheVxuXG5jb25zdCBwcm9jZXNzT2sgPSAocHJvY2VzczogYW55KSA9PlxuICAhIXByb2Nlc3MgJiZcbiAgdHlwZW9mIHByb2Nlc3MgPT09IFwib2JqZWN0XCIgJiZcbiAgdHlwZW9mIHByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPT09IFwiZnVuY3Rpb25cIiAmJlxuICB0eXBlb2YgcHJvY2Vzcy5lbWl0ID09PSBcImZ1bmN0aW9uXCIgJiZcbiAgdHlwZW9mIHByb2Nlc3MucmVhbGx5RXhpdCA9PT0gXCJmdW5jdGlvblwiICYmXG4gIHR5cGVvZiBwcm9jZXNzLmxpc3RlbmVycyA9PT0gXCJmdW5jdGlvblwiICYmXG4gIHR5cGVvZiBwcm9jZXNzLmtpbGwgPT09IFwiZnVuY3Rpb25cIiAmJlxuICB0eXBlb2YgcHJvY2Vzcy5waWQgPT09IFwibnVtYmVyXCIgJiZcbiAgdHlwZW9mIHByb2Nlc3Mub24gPT09IFwiZnVuY3Rpb25cIjtcbmNvbnN0IGtFeGl0RW1pdHRlciA9IC8qICNfX1BVUkVfXyAqLyBTeW1ib2wuZm9yKFwic2lnbmFsLWV4aXQgZW1pdHRlclwiKTtcbi8vIHRlZW55IHNwZWNpYWwgcHVycG9zZSBlZVxuY2xhc3MgRW1pdHRlciB7XG4gIGVtaXR0ZWQgPSB7XG4gICAgYWZ0ZXJFeGl0OiBmYWxzZSxcbiAgICBleGl0OiBmYWxzZSxcbiAgfTtcbiAgbGlzdGVuZXJzID0ge1xuICAgIGFmdGVyRXhpdDogW10sXG4gICAgZXhpdDogW10sXG4gIH07XG4gIGNvdW50ID0gMDtcbiAgaWQgPSBNYXRoLnJhbmRvbSgpO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaWYgKGdsb2JhbFtrRXhpdEVtaXR0ZXJdKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICByZXR1cm4gZ2xvYmFsW2tFeGl0RW1pdHRlcl07XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnbG9iYWwsIGtFeGl0RW1pdHRlciwge1xuICAgICAgdmFsdWU6IHRoaXMsXG4gICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgfSk7XG4gIH1cbiAgb24oZXY6IGFueSwgZm46IGFueSkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB0aGlzLmxpc3RlbmVyc1tldl0ucHVzaChmbik7XG4gIH1cbiAgcmVtb3ZlTGlzdGVuZXIoZXY6IGFueSwgZm46IGFueSkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5saXN0ZW5lcnNbZXZdO1xuICAgIGNvbnN0IGkgPSBsaXN0LmluZGV4T2YoZm4pO1xuICAgIC8qIGM4IGlnbm9yZSBzdGFydCAqL1xuICAgIGlmIChpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvKiBjOCBpZ25vcmUgc3RvcCAqL1xuICAgIGlmIChpID09PSAwICYmIGxpc3QubGVuZ3RoID09PSAxKSB7XG4gICAgICBsaXN0Lmxlbmd0aCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3Quc3BsaWNlKGksIDEpO1xuICAgIH1cbiAgfVxuICBlbWl0KGV2OiBhbnksIGNvZGU6IGFueSwgc2lnbmFsOiBhbnkpOiBhbnkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBpZiAodGhpcy5lbWl0dGVkW2V2XSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgdGhpcy5lbWl0dGVkW2V2XSA9IHRydWU7XG4gICAgbGV0IHJldCA9IGZhbHNlO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMubGlzdGVuZXJzW2V2XSkge1xuICAgICAgcmV0ID0gZm4oY29kZSwgc2lnbmFsKSA9PT0gdHJ1ZSB8fCByZXQ7XG4gICAgfVxuICAgIGlmIChldiA9PT0gXCJleGl0XCIpIHtcbiAgICAgIHJldCA9IHRoaXMuZW1pdChcImFmdGVyRXhpdFwiLCBjb2RlLCBzaWduYWwpIHx8IHJldDtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfVxufVxuXG5jbGFzcyBTaWduYWxFeGl0RmFsbGJhY2sge1xuICBvbkV4aXQoKSB7XG4gICAgcmV0dXJuICgpID0+IHt9O1xuICB9XG4gIGxvYWQoKSB7fVxuICB1bmxvYWQoKSB7fVxufVxuY2xhc3MgU2lnbmFsRXhpdCB7XG4gIC8vIFwiU0lHSFVQXCIgdGhyb3dzIGFuIGBFTk9TWVNgIGVycm9yIG9uIFdpbmRvd3MsXG4gIC8vIHNvIHVzZSBhIHN1cHBvcnRlZCBzaWduYWwgaW5zdGVhZFxuICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgLy8gQHRzLWlnbm9yZVxuICAjaHVwU2lnID0gcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gXCJ3aW4zMlwiID8gXCJTSUdJTlRcIiA6IFwiU0lHSFVQXCI7XG4gIC8qIGM4IGlnbm9yZSBzdG9wICovXG4gICNlbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcbiAgI3Byb2Nlc3M6IGFueTtcbiAgI29yaWdpbmFsUHJvY2Vzc0VtaXQ6IGFueTtcbiAgI29yaWdpbmFsUHJvY2Vzc1JlYWxseUV4aXQ6IGFueTtcbiAgI3NpZ0xpc3RlbmVycyA9IHt9O1xuICAjbG9hZGVkID0gZmFsc2U7XG4gICNzaWduYWxzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdHJ1Y3Rvcihwcm9jZXNzOiBhbnkpIHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIG5vdCB0aGUgc2V0IG9mIGFsbCBwb3NzaWJsZSBzaWduYWxzLlxuICAgICAqXG4gICAgICogSXQgSVMsIGhvd2V2ZXIsIHRoZSBzZXQgb2YgYWxsIHNpZ25hbHMgdGhhdCB0cmlnZ2VyXG4gICAgICogYW4gZXhpdCBvbiBlaXRoZXIgTGludXggb3IgQlNEIHN5c3RlbXMuICBMaW51eCBpcyBhXG4gICAgICogc3VwZXJzZXQgb2YgdGhlIHNpZ25hbCBuYW1lcyBzdXBwb3J0ZWQgb24gQlNELCBhbmRcbiAgICAgKiB0aGUgdW5rbm93biBzaWduYWxzIGp1c3QgZmFpbCB0byByZWdpc3Rlciwgc28gd2UgY2FuXG4gICAgICogY2F0Y2ggdGhhdCBlYXNpbHkgZW5vdWdoLlxuICAgICAqXG4gICAgICogV2luZG93cyBzaWduYWxzIGFyZSBhIGRpZmZlcmVudCBzZXQsIHNpbmNlIHRoZXJlIGFyZVxuICAgICAqIHNpZ25hbHMgdGhhdCB0ZXJtaW5hdGUgV2luZG93cyBwcm9jZXNzZXMsIGJ1dCBkb24ndFxuICAgICAqIHRlcm1pbmF0ZSAob3IgZG9uJ3QgZXZlbiBleGlzdCkgb24gUG9zaXggc3lzdGVtcy5cbiAgICAgKlxuICAgICAqIERvbid0IGJvdGhlciB3aXRoIFNJR0tJTEwuICBJdCdzIHVuY2F0Y2hhYmxlLCB3aGljaFxuICAgICAqIG1lYW5zIHRoYXQgd2UgY2FuJ3QgZmlyZSBhbnkgY2FsbGJhY2tzIGFueXdheS5cbiAgICAgKlxuICAgICAqIElmIGEgdXNlciBkb2VzIGhhcHBlbiB0byByZWdpc3RlciBhIGhhbmRsZXIgb24gYSBub24tXG4gICAgICogZmF0YWwgc2lnbmFsIGxpa2UgU0lHV0lOQ0ggb3Igc29tZXRoaW5nLCBhbmQgdGhlblxuICAgICAqIGV4aXQsIGl0J2xsIGVuZCB1cCBmaXJpbmcgYHByb2Nlc3MuZW1pdCgnZXhpdCcpYCwgc29cbiAgICAgKiB0aGUgaGFuZGxlciB3aWxsIGJlIGZpcmVkIGFueXdheS5cbiAgICAgKlxuICAgICAqIFNJR0JVUywgU0lHRlBFLCBTSUdTRUdWIGFuZCBTSUdJTEwsIHdoZW4gbm90IHJhaXNlZFxuICAgICAqIGFydGlmaWNpYWxseSwgaW5oZXJlbnRseSBsZWF2ZSB0aGUgcHJvY2VzcyBpbiBhXG4gICAgICogc3RhdGUgZnJvbSB3aGljaCBpdCBpcyBub3Qgc2FmZSB0byB0cnkgYW5kIGVudGVyIEpTXG4gICAgICogbGlzdGVuZXJzLlxuICAgICAqL1xuICAgIHRoaXMuI3NpZ25hbHMucHVzaChcIlNJR0hVUFwiLCBcIlNJR0lOVFwiLCBcIlNJR1RFUk1cIik7XG4gICAgaWYgKGdsb2JhbFRoaXMucHJvY2Vzcy5wbGF0Zm9ybSAhPT0gXCJ3aW4zMlwiKSB7XG4gICAgICB0aGlzLiNzaWduYWxzLnB1c2goXG4gICAgICAgIFwiU0lHQUxSTVwiLFxuICAgICAgICBcIlNJR0FCUlRcIixcbiAgICAgICAgXCJTSUdWVEFMUk1cIixcbiAgICAgICAgXCJTSUdYQ1BVXCIsXG4gICAgICAgIFwiU0lHWEZTWlwiLFxuICAgICAgICBcIlNJR1VTUjJcIixcbiAgICAgICAgXCJTSUdUUkFQXCIsXG4gICAgICAgIFwiU0lHU1lTXCIsXG4gICAgICAgIFwiU0lHUVVJVFwiLFxuICAgICAgICBcIlNJR0lPVFwiLFxuICAgICAgICAvLyBzaG91bGQgZGV0ZWN0IHByb2ZpbGVyIGFuZCBlbmFibGUvZGlzYWJsZSBhY2NvcmRpbmdseS5cbiAgICAgICAgLy8gc2VlICMyMVxuICAgICAgICAvLyAnU0lHUFJPRidcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChnbG9iYWxUaGlzLnByb2Nlc3MucGxhdGZvcm0gPT09IFwibGludXhcIikge1xuICAgICAgdGhpcy4jc2lnbmFscy5wdXNoKFwiU0lHSU9cIiwgXCJTSUdQT0xMXCIsIFwiU0lHUFdSXCIsIFwiU0lHU1RLRkxUXCIpO1xuICAgIH1cbiAgICB0aGlzLiNwcm9jZXNzID0gcHJvY2VzcztcbiAgICAvLyB7IDxzaWduYWw+OiA8bGlzdGVuZXIgZm4+LCAuLi4gfVxuICAgIHRoaXMuI3NpZ0xpc3RlbmVycyA9IHt9O1xuICAgIGZvciAoY29uc3Qgc2lnIG9mIHRoaXMuI3NpZ25hbHMpIHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRoaXMuI3NpZ0xpc3RlbmVyc1tzaWddID0gKCkgPT4ge1xuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gb3RoZXIgbGlzdGVuZXJzLCBhbiBleGl0IGlzIGNvbWluZyFcbiAgICAgICAgLy8gU2ltcGxlc3Qgd2F5OiByZW1vdmUgdXMgYW5kIHRoZW4gcmUtc2VuZCB0aGUgc2lnbmFsLlxuICAgICAgICAvLyBXZSBrbm93IHRoYXQgdGhpcyB3aWxsIGtpbGwgdGhlIHByb2Nlc3MsIHNvIHdlIGNhblxuICAgICAgICAvLyBzYWZlbHkgZW1pdCBub3cuXG4gICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuI3Byb2Nlc3MubGlzdGVuZXJzKHNpZyk7XG4gICAgICAgIGxldCB7IGNvdW50IH0gPSB0aGlzLiNlbWl0dGVyO1xuICAgICAgICAvLyBUaGlzIGlzIGEgd29ya2Fyb3VuZCBmb3IgdGhlIGZhY3QgdGhhdCBzaWduYWwtZXhpdCB2MyBhbmQgc2lnbmFsXG4gICAgICAgIC8vIGV4aXQgdjQgYXJlIG5vdCBhd2FyZSBvZiBlYWNoIG90aGVyLCBhbmQgZWFjaCB3aWxsIGF0dGVtcHQgdG8gbGV0XG4gICAgICAgIC8vIHRoZSBvdGhlciBoYW5kbGUgaXQsIHNvIG5laXRoZXIgb2YgdGhlbSBkby4gVG8gY29ycmVjdCB0aGlzLCB3ZVxuICAgICAgICAvLyBkZXRlY3QgaWYgd2UncmUgdGhlIG9ubHkgaGFuZGxlciAqZXhjZXB0KiBmb3IgcHJldmlvdXMgdmVyc2lvbnNcbiAgICAgICAgLy8gb2Ygc2lnbmFsLWV4aXQsIGFuZCBpbmNyZW1lbnQgYnkgdGhlIGNvdW50IG9mIGxpc3RlbmVycyBpdCBoYXNcbiAgICAgICAgLy8gY3JlYXRlZC5cbiAgICAgICAgLyogYzggaWdub3JlIHN0YXJ0ICovXG4gICAgICAgIGNvbnN0IHAgPSBwcm9jZXNzO1xuICAgICAgICBpZiAodHlwZW9mIHAuX19zaWduYWxfZXhpdF9lbWl0dGVyX18gPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHAuX19zaWduYWxfZXhpdF9lbWl0dGVyX18uY291bnQgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICBjb3VudCArPSBwLl9fc2lnbmFsX2V4aXRfZW1pdHRlcl9fLmNvdW50O1xuICAgICAgICB9XG4gICAgICAgIC8qIGM4IGlnbm9yZSBzdG9wICovXG4gICAgICAgIGlmIChsaXN0ZW5lcnMubGVuZ3RoID09PSBjb3VudCkge1xuICAgICAgICAgIHRoaXMudW5sb2FkKCk7XG4gICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy4jZW1pdHRlci5lbWl0KFwiZXhpdFwiLCBudWxsLCBzaWcpO1xuICAgICAgICAgIC8qIGM4IGlnbm9yZSBzdGFydCAqL1xuICAgICAgICAgIGNvbnN0IHMgPSBzaWcgPT09IFwiU0lHSFVQXCIgPyB0aGlzLiNodXBTaWcgOiBzaWc7XG4gICAgICAgICAgaWYgKCFyZXQpIHByb2Nlc3Mua2lsbChwcm9jZXNzLnBpZCwgcyk7XG4gICAgICAgICAgLyogYzggaWdub3JlIHN0b3AgKi9cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgdGhpcy4jb3JpZ2luYWxQcm9jZXNzUmVhbGx5RXhpdCA9IHByb2Nlc3MucmVhbGx5RXhpdDtcbiAgICB0aGlzLiNvcmlnaW5hbFByb2Nlc3NFbWl0ID0gcHJvY2Vzcy5lbWl0O1xuICB9XG4gIG9uRXhpdChjYjogYW55LCBvcHRzOiBhbnkpIHtcbiAgICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgICBpZiAoIXByb2Nlc3NPayh0aGlzLiNwcm9jZXNzKSkge1xuICAgICAgcmV0dXJuICgpID0+IHt9O1xuICAgIH1cbiAgICAvKiBjOCBpZ25vcmUgc3RvcCAqL1xuICAgIGlmICh0aGlzLiNsb2FkZWQgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmxvYWQoKTtcbiAgICB9XG4gICAgY29uc3QgZXYgPSBvcHRzPy5hbHdheXNMYXN0ID8gXCJhZnRlckV4aXRcIiA6IFwiZXhpdFwiO1xuICAgIHRoaXMuI2VtaXR0ZXIub24oZXYsIGNiKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy4jZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihldiwgY2IpO1xuICAgICAgaWYgKHRoaXMuI2VtaXR0ZXIubGlzdGVuZXJzW1wiZXhpdFwiXS5sZW5ndGggPT09IDAgJiYgdGhpcy4jZW1pdHRlci5saXN0ZW5lcnNbXCJhZnRlckV4aXRcIl0ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMudW5sb2FkKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBsb2FkKCkge1xuICAgIGlmICh0aGlzLiNsb2FkZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy4jbG9hZGVkID0gdHJ1ZTtcbiAgICAvLyBUaGlzIGlzIHRoZSBudW1iZXIgb2Ygb25TaWduYWxFeGl0J3MgdGhhdCBhcmUgaW4gcGxheS5cbiAgICAvLyBJdCdzIGltcG9ydGFudCBzbyB0aGF0IHdlIGNhbiBjb3VudCB0aGUgY29ycmVjdCBudW1iZXIgb2ZcbiAgICAvLyBsaXN0ZW5lcnMgb24gc2lnbmFscywgYW5kIGRvbid0IHdhaXQgZm9yIHRoZSBvdGhlciBvbmUgdG9cbiAgICAvLyBoYW5kbGUgaXQgaW5zdGVhZCBvZiB1cy5cbiAgICB0aGlzLiNlbWl0dGVyLmNvdW50ICs9IDE7XG4gICAgZm9yIChjb25zdCBzaWcgb2YgdGhpcy4jc2lnbmFscykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBmbiA9IHRoaXMuI3NpZ0xpc3RlbmVyc1tzaWddO1xuICAgICAgICBpZiAoZm4pIHRoaXMuI3Byb2Nlc3Mub24oc2lnLCBmbik7XG4gICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgIC8vIG5vLW9wXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuI3Byb2Nlc3MuZW1pdCA9IChldjogYW55LCAuLi5hOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLiNwcm9jZXNzRW1pdChldiwgLi4uYSk7XG4gICAgfTtcbiAgICB0aGlzLiNwcm9jZXNzLnJlYWxseUV4aXQgPSAoY29kZTogYW55KSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy4jcHJvY2Vzc1JlYWxseUV4aXQoY29kZSk7XG4gICAgfTtcbiAgfVxuICB1bmxvYWQoKSB7XG4gICAgaWYgKCF0aGlzLiNsb2FkZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy4jbG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy4jc2lnbmFscy5mb3JFYWNoKChzaWcpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGNvbnN0IGxpc3RlbmVyID0gdGhpcy4jc2lnTGlzdGVuZXJzW3NpZ107XG4gICAgICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgICAgIGlmICghbGlzdGVuZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTGlzdGVuZXIgbm90IGRlZmluZWQgZm9yIHNpZ25hbDogXCIgKyBzaWcpO1xuICAgICAgfVxuICAgICAgLyogYzggaWdub3JlIHN0b3AgKi9cbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuI3Byb2Nlc3MucmVtb3ZlTGlzdGVuZXIoc2lnLCBsaXN0ZW5lcik7XG4gICAgICAgIC8qIGM4IGlnbm9yZSBzdGFydCAqL1xuICAgICAgfSBjYXRjaCAoXykge1xuICAgICAgICAvLyBuby1vcFxuICAgICAgfVxuICAgICAgLyogYzggaWdub3JlIHN0b3AgKi9cbiAgICB9KTtcbiAgICB0aGlzLiNwcm9jZXNzLmVtaXQgPSB0aGlzLiNvcmlnaW5hbFByb2Nlc3NFbWl0O1xuICAgIHRoaXMuI3Byb2Nlc3MucmVhbGx5RXhpdCA9IHRoaXMuI29yaWdpbmFsUHJvY2Vzc1JlYWxseUV4aXQ7XG4gICAgdGhpcy4jZW1pdHRlci5jb3VudCAtPSAxO1xuICB9XG4gICNwcm9jZXNzUmVhbGx5RXhpdChjb2RlOiBhbnkpIHtcbiAgICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgICBpZiAoIXByb2Nlc3NPayh0aGlzLiNwcm9jZXNzKSkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHRoaXMuI3Byb2Nlc3MuZXhpdENvZGUgPSBjb2RlIHx8IDA7XG4gICAgLyogYzggaWdub3JlIHN0b3AgKi9cbiAgICB0aGlzLiNlbWl0dGVyLmVtaXQoXCJleGl0XCIsIHRoaXMuI3Byb2Nlc3MuZXhpdENvZGUsIG51bGwpO1xuICAgIHJldHVybiB0aGlzLiNvcmlnaW5hbFByb2Nlc3NSZWFsbHlFeGl0LmNhbGwodGhpcy4jcHJvY2VzcywgdGhpcy4jcHJvY2Vzcy5leGl0Q29kZSk7XG4gIH1cbiAgI3Byb2Nlc3NFbWl0KGV2OiBhbnksIC4uLmFyZ3M6IGFueSkge1xuICAgIGNvbnN0IG9nID0gdGhpcy4jb3JpZ2luYWxQcm9jZXNzRW1pdDtcbiAgICBpZiAoZXYgPT09IFwiZXhpdFwiICYmIHByb2Nlc3NPayh0aGlzLiNwcm9jZXNzKSkge1xuICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHRoaXMuI3Byb2Nlc3MuZXhpdENvZGUgPSBhcmdzWzBdO1xuICAgICAgICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgICAgIH1cbiAgICAgIC8qIGM4IGlnbm9yZSBzdGFydCAqL1xuICAgICAgY29uc3QgcmV0ID0gb2cuY2FsbCh0aGlzLiNwcm9jZXNzLCBldiwgLi4uYXJncyk7XG4gICAgICAvKiBjOCBpZ25vcmUgc3RhcnQgKi9cbiAgICAgIHRoaXMuI2VtaXR0ZXIuZW1pdChcImV4aXRcIiwgdGhpcy4jcHJvY2Vzcy5leGl0Q29kZSwgbnVsbCk7XG4gICAgICAvKiBjOCBpZ25vcmUgc3RvcCAqL1xuICAgICAgcmV0dXJuIHJldDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG9nLmNhbGwodGhpcy4jcHJvY2VzcywgZXYsIC4uLmFyZ3MpO1xuICAgIH1cbiAgfVxufVxuXG5sZXQgc2lnbmFsRXhpdDogU2lnbmFsRXhpdCB8IFNpZ25hbEV4aXRGYWxsYmFjayB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgY29uc3Qgb25FeGl0ID0gKFxuICBjYjogYW55LFxuICBvcHRzPzoge1xuICAgIGFsd2F5c0xhc3Q/OiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICB9LFxuKSA9PiB7XG4gIGlmICghc2lnbmFsRXhpdCkge1xuICAgIHNpZ25hbEV4aXQgPSBwcm9jZXNzT2socHJvY2VzcykgPyBuZXcgU2lnbmFsRXhpdChwcm9jZXNzKSA6IG5ldyBTaWduYWxFeGl0RmFsbGJhY2soKTtcbiAgfVxuICByZXR1cm4gc2lnbmFsRXhpdC5vbkV4aXQoY2IsIG9wdHMpO1xufTtcbiIsICJpbXBvcnQgeyBlbnZpcm9ubWVudCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IGNyZWF0ZVJlYWRTdHJlYW0sIGNyZWF0ZVdyaXRlU3RyZWFtLCBta2RpclN5bmMsIFN0YXRzIH0gZnJvbSBcIm5vZGU6ZnNcIjtcbmltcG9ydCB7IHN0YXQgfSBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xuaW1wb3J0IHsgam9pbiwgbm9ybWFsaXplIH0gZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHsgcGlwZWxpbmUgfSBmcm9tIFwibm9kZTpzdHJlYW0vcHJvbWlzZXNcIjtcbmltcG9ydCB7IHVzZVJlZiB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IENoYWluIGZyb20gXCIuL3ZlbmRvcnMvc3RyZWFtLWNoYWluXCI7XG5pbXBvcnQgeyBwYXJzZXIsIFBpY2tQYXJzZXIsIFN0cmVhbUFycmF5IH0gZnJvbSBcIi4vdmVuZG9ycy9zdHJlYW0tanNvblwiO1xuaW1wb3J0IHsgaXNKU09OIH0gZnJvbSBcIi4vZmV0Y2gtdXRpbHNcIjtcbmltcG9ydCB7IEZsYXR0ZW4sIEZ1bmN0aW9uUmV0dXJuaW5nUGFnaW5hdGVkUHJvbWlzZSwgVXNlQ2FjaGVkUHJvbWlzZVJldHVyblR5cGUgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgQ2FjaGVkUHJvbWlzZU9wdGlvbnMsIHVzZUNhY2hlZFByb21pc2UgfSBmcm9tIFwiLi91c2VDYWNoZWRQcm9taXNlXCI7XG5pbXBvcnQgeyBoYXNoIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG50eXBlIFJlcXVlc3RJbmZvID0gc3RyaW5nIHwgVVJMIHwgZ2xvYmFsVGhpcy5SZXF1ZXN0O1xuXG5hc3luYyBmdW5jdGlvbiBjYWNoZSh1cmw6IFJlcXVlc3RJbmZvLCBkZXN0aW5hdGlvbjogc3RyaW5nLCBmZXRjaE9wdGlvbnM/OiBSZXF1ZXN0SW5pdCkge1xuICBpZiAodHlwZW9mIHVybCA9PT0gXCJvYmplY3RcIiB8fCB1cmwuc3RhcnRzV2l0aChcImh0dHA6Ly9cIikgfHwgdXJsLnN0YXJ0c1dpdGgoXCJodHRwczovL1wiKSkge1xuICAgIHJldHVybiBhd2FpdCBjYWNoZVVSTCh1cmwsIGRlc3RpbmF0aW9uLCBmZXRjaE9wdGlvbnMpO1xuICB9IGVsc2UgaWYgKHVybC5zdGFydHNXaXRoKFwiZmlsZTovL1wiKSkge1xuICAgIHJldHVybiBhd2FpdCBjYWNoZUZpbGUoXG4gICAgICBub3JtYWxpemUoZGVjb2RlVVJJQ29tcG9uZW50KG5ldyBVUkwodXJsKS5wYXRobmFtZSkpLFxuICAgICAgZGVzdGluYXRpb24sXG4gICAgICBmZXRjaE9wdGlvbnM/LnNpZ25hbCA/IGZldGNoT3B0aW9ucy5zaWduYWwgOiB1bmRlZmluZWQsXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJPbmx5IEhUVFAoUykgb3IgZmlsZSBVUkxzIGFyZSBzdXBwb3J0ZWRcIik7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gY2FjaGVVUkwodXJsOiBSZXF1ZXN0SW5mbywgZGVzdGluYXRpb246IHN0cmluZywgZmV0Y2hPcHRpb25zPzogUmVxdWVzdEluaXQpIHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIGZldGNoT3B0aW9ucyk7XG5cbiAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmZXRjaCBVUkxcIik7XG4gIH1cblxuICBpZiAoIWlzSlNPTihyZXNwb25zZS5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVUkwgZG9lcyBub3QgcmV0dXJuIEpTT05cIik7XG4gIH1cbiAgaWYgKCFyZXNwb25zZS5ib2R5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHJldHJpZXZlIGV4cGVjdGVkIEpTT04gY29udGVudDogUmVzcG9uc2UgYm9keSBpcyBtaXNzaW5nIG9yIGluYWNjZXNzaWJsZS5cIik7XG4gIH1cbiAgYXdhaXQgcGlwZWxpbmUoXG4gICAgcmVzcG9uc2UuYm9keSBhcyB1bmtub3duIGFzIE5vZGVKUy5SZWFkYWJsZVN0cmVhbSxcbiAgICBjcmVhdGVXcml0ZVN0cmVhbShkZXN0aW5hdGlvbiksXG4gICAgZmV0Y2hPcHRpb25zPy5zaWduYWwgPyB7IHNpZ25hbDogZmV0Y2hPcHRpb25zLnNpZ25hbCB9IDogdW5kZWZpbmVkLFxuICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjYWNoZUZpbGUoc291cmNlOiBzdHJpbmcsIGRlc3RpbmF0aW9uOiBzdHJpbmcsIGFib3J0U2lnbmFsPzogQWJvcnRTaWduYWwpIHtcbiAgYXdhaXQgcGlwZWxpbmUoXG4gICAgY3JlYXRlUmVhZFN0cmVhbShzb3VyY2UpLFxuICAgIGNyZWF0ZVdyaXRlU3RyZWFtKGRlc3RpbmF0aW9uKSxcbiAgICBhYm9ydFNpZ25hbCA/IHsgc2lnbmFsOiBhYm9ydFNpZ25hbCB9IDogdW5kZWZpbmVkLFxuICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjYWNoZVVSTElmTmVjZXNzYXJ5KFxuICB1cmw6IFJlcXVlc3RJbmZvLFxuICBmb2xkZXI6IHN0cmluZyxcbiAgZmlsZU5hbWU6IHN0cmluZyxcbiAgZm9yY2VVcGRhdGU6IGJvb2xlYW4sXG4gIGZldGNoT3B0aW9ucz86IFJlcXVlc3RJbml0LFxuKSB7XG4gIGNvbnN0IGRlc3RpbmF0aW9uID0gam9pbihmb2xkZXIsIGZpbGVOYW1lKTtcblxuICB0cnkge1xuICAgIGF3YWl0IHN0YXQoZm9sZGVyKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIG1rZGlyU3luYyhmb2xkZXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGF3YWl0IGNhY2hlKHVybCwgZGVzdGluYXRpb24sIGZldGNoT3B0aW9ucyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChmb3JjZVVwZGF0ZSkge1xuICAgIGF3YWl0IGNhY2hlKHVybCwgZGVzdGluYXRpb24sIGZldGNoT3B0aW9ucyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IHN0YXRzOiBTdGF0cyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgdHJ5IHtcbiAgICBzdGF0cyA9IGF3YWl0IHN0YXQoZGVzdGluYXRpb24pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgY2FjaGUodXJsLCBkZXN0aW5hdGlvbiwgZmV0Y2hPcHRpb25zKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodHlwZW9mIHVybCA9PT0gXCJvYmplY3RcIiB8fCB1cmwuc3RhcnRzV2l0aChcImh0dHA6Ly9cIikgfHwgdXJsLnN0YXJ0c1dpdGgoXCJodHRwczovL1wiKSkge1xuICAgIGNvbnN0IGhlYWRSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyAuLi5mZXRjaE9wdGlvbnMsIG1ldGhvZDogXCJIRUFEXCIgfSk7XG4gICAgaWYgKCFoZWFkUmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBVUkxcIik7XG4gICAgfVxuXG4gICAgaWYgKCFpc0pTT04oaGVhZFJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVVJMIGRvZXMgbm90IHJldHVybiBKU09OXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGxhc3RNb2RpZmllZCA9IERhdGUucGFyc2UoaGVhZFJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwibGFzdC1tb2RpZmllZFwiKSA/PyBcIlwiKTtcbiAgICBpZiAoc3RhdHMuc2l6ZSA9PT0gMCB8fCBOdW1iZXIuaXNOYU4obGFzdE1vZGlmaWVkKSB8fCBsYXN0TW9kaWZpZWQgPiBzdGF0cy5tdGltZU1zKSB7XG4gICAgICBhd2FpdCBjYWNoZSh1cmwsIGRlc3RpbmF0aW9uLCBmZXRjaE9wdGlvbnMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1cmwuc3RhcnRzV2l0aChcImZpbGU6Ly9cIikpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc291cmNlU3RhdHMgPSBhd2FpdCBzdGF0KG5vcm1hbGl6ZShkZWNvZGVVUklDb21wb25lbnQobmV3IFVSTCh1cmwpLnBhdGhuYW1lKSkpO1xuICAgICAgaWYgKHNvdXJjZVN0YXRzLm10aW1lTXMgPiBzdGF0cy5tdGltZU1zKSB7XG4gICAgICAgIGF3YWl0IGNhY2hlKHVybCwgZGVzdGluYXRpb24sIGZldGNoT3B0aW9ucyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU291cmNlIGZpbGUgY291bGQgbm90IGJlIHJlYWRcIik7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgSFRUUChTKSBvciBmaWxlIFVSTHMgYXJlIHN1cHBvcnRlZFwiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiogc3RyZWFtSnNvbkZpbGU8VD4oXG4gIGZpbGVQYXRoOiBzdHJpbmcsXG4gIHBhZ2VTaXplOiBudW1iZXIsXG4gIGFib3J0U2lnbmFsPzogQWJvcnRTaWduYWwsXG4gIGRhdGFQYXRoPzogc3RyaW5nIHwgUmVnRXhwLFxuICBmaWx0ZXJGbj86IChpdGVtOiBGbGF0dGVuPFQ+KSA9PiBib29sZWFuLFxuICB0cmFuc2Zvcm1Gbj86IChpdGVtOiBhbnkpID0+IFQsXG4pOiBBc3luY0dlbmVyYXRvcjxUIGV4dGVuZHMgdW5rbm93bltdID8gVCA6IFRbXT4ge1xuICBsZXQgcGFnZTogVCBleHRlbmRzIHVua25vd25bXSA/IFQgOiBUW10gPSBbXSBhcyBUIGV4dGVuZHMgdW5rbm93bltdID8gVCA6IFRbXTtcblxuICBjb25zdCBwaXBlbGluZSA9IENoYWluKFtcbiAgICBjcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoKSxcbiAgICBkYXRhUGF0aCA/IFBpY2tQYXJzZXIoeyBmaWx0ZXI6IGRhdGFQYXRoIH0pIDogcGFyc2VyKCksXG4gICAgU3RyZWFtQXJyYXkoKSxcbiAgICAoZGF0YTogYW55KSA9PiB0cmFuc2Zvcm1Gbj8uKGRhdGEudmFsdWUpID8/IGRhdGEudmFsdWUsXG4gIF0pO1xuXG4gIGFib3J0U2lnbmFsPy5hZGRFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgKCkgPT4ge1xuICAgIHBpcGVsaW5lLmRlc3Ryb3koKTtcbiAgfSk7XG5cbiAgdHJ5IHtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IGRhdGEgb2YgcGlwZWxpbmUpIHtcbiAgICAgIGlmIChhYm9ydFNpZ25hbD8uYWJvcnRlZCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBpZiAoIWZpbHRlckZuIHx8IGZpbHRlckZuKGRhdGEpKSB7XG4gICAgICAgIHBhZ2UucHVzaChkYXRhKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYWdlLmxlbmd0aCA+PSBwYWdlU2l6ZSkge1xuICAgICAgICB5aWVsZCBwYWdlO1xuICAgICAgICBwYWdlID0gW10gYXMgVCBleHRlbmRzIHVua25vd25bXSA/IFQgOiBUW107XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgcGlwZWxpbmUuZGVzdHJveSgpO1xuICAgIHRocm93IGU7XG4gIH1cblxuICBpZiAocGFnZS5sZW5ndGggPiAwKSB7XG4gICAgeWllbGQgcGFnZTtcbiAgfVxuXG4gIHJldHVybiBbXTtcbn1cblxudHlwZSBPcHRpb25zPFQ+ID0ge1xuICAvKipcbiAgICogVGhlIGhvb2sgZXhwZWN0cyB0byBpdGVyYXRlIHRocm91Z2ggYW4gYXJyYXkgb2YgZGF0YSwgc28gYnkgZGVmYXVsdCwgaXQgYXNzdW1lcyB0aGUgSlNPTiBpdCByZWNlaXZlcyBpdHNlbGYgcmVwcmVzZW50cyBhbiBhcnJheS4gSG93ZXZlciwgc29tZXRpbWVzIHRoZSBhcnJheSBvZiBkYXRhIGlzIHdyYXBwZWQgaW4gYW4gb2JqZWN0LFxuICAgKiBpLmUuIGB7IFwic3VjY2Vzc1wiOiB0cnVlLCBcImRhdGFcIjogW+KApl0gfWAsIG9yIGV2ZW4gYHsgXCJzdWNjZXNzXCI6IHRydWUsIFwicmVzdWx0c1wiOiB7IFwiZGF0YVwiOiBb4oCmXSB9IH1gLiBJbiB0aG9zZSBjYXNlcywgeW91IGNhbiB1c2UgYGRhdGFQYXRoYCB0byBzcGVjaWZ5IHdoZXJlIHRoZSBkYXRhIGFycmF5IGNhbiBiZSBmb3VuZC5cbiAgICpcbiAgICogQHJlbWFyayBJZiB5b3VyIEpTT04gb2JqZWN0IGhhcyBtdWx0aXBsZSBhcnJheXMgdGhhdCB5b3Ugd2FudCB0byBzdHJlYW0gZGF0YSBmcm9tLCB5b3UgY2FuIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gc3RyZWFtIHRocm91Z2ggYWxsIG9mIHRoZW0uXG4gICAqXG4gICAqIEBleGFtcGxlIEZvciBgeyBcInN1Y2Nlc3NcIjogdHJ1ZSwgXCJkYXRhXCI6IFvigKZdIH1gLCBkYXRhUGF0aCB3b3VsZCBiZSBgZGF0YWBcbiAgICogQGV4YW1wbGUgRm9yIGB7IFwic3VjY2Vzc1wiOiB0cnVlLCBcInJlc3VsdHNcIjogeyBcImRhdGFcIjogW+KApl0gfSB9YCwgZGF0YVBhdGggd291bGQgYmUgYHJlc3VsdHMuZGF0YWBcbiAgICogQGV4YW1wbGUgRm9yIGB7IFwic3VjY2Vzc1wiOiB0cnVlLCBcInJlc3VsdHNcIjogeyBcImZpcnN0X2xpc3RcIjogW+KApl0sIFwic2Vjb25kX2xpc3RcIjogW+KApl0sIFwidGhpcmRfbGlzdFwiOiBb4oCmXSB9IH1gLCBkYXRhUGF0aCB3b3VsZCBiZSBgL15yZXN1bHRzXFwuKGZpcnN0X2xpc3R8c2Vjb25kX2xpc3R8dGhpcmRfbGlzdCkkXG4vYC5cbiAgICovXG4gIGRhdGFQYXRoPzogc3RyaW5nIHwgUmVnRXhwO1xuICAvKipcbiAgICogQSBmdW5jdGlvbiB0byBkZWNpZGUgd2hldGhlciBhIHBhcnRpY3VsYXIgaXRlbSBzaG91bGQgYmUga2VwdCBvciBub3QuXG4gICAqIERlZmF1bHRzIHRvIGB1bmRlZmluZWRgLCBrZWVwaW5nIGFueSBlbmNvdW50ZXJlZCBpdGVtLlxuICAgKlxuICAgKiBAcmVtYXJrIFRoZSBob29rIHdpbGwgcmV2YWxpZGF0ZSBldmVyeSB0aW1lIHRoZSBmaWx0ZXIgZnVuY3Rpb24gY2hhbmdlcywgc28geW91IG5lZWQgdG8gdXNlIFt1c2VDYWxsYmFja10oaHR0cHM6Ly9yZWFjdC5kZXYvcmVmZXJlbmNlL3JlYWN0L3VzZUNhbGxiYWNrKSB0byBtYWtlIHN1cmUgaXQgb25seSBjaGFuZ2VzIHdoZW4gaXQgbmVlZHMgdG8uXG4gICAqL1xuICBmaWx0ZXI/OiAoaXRlbTogRmxhdHRlbjxUPikgPT4gYm9vbGVhbjtcbiAgLyoqXG4gICAqIEEgZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBpdGVtIGFzIGl0IGlzIGVuY291bnRlcmVkLiBVc2VmdWwgZm9yIGEgY291cGxlIG9mIHRoaW5nczpcbiAgICogMS4gZW5zdXJpbmcgdGhhdCBhbGwgaXRlbXMgaGF2ZSB0aGUgZXhwZWN0ZWQgcHJvcGVydGllcywgYW5kLCBhcyBvbiBvcHRpbWl6YXRpb24sIGZvciBnZXR0aW5nIHJpZCBvZiB0aGUgcHJvcGVydGllcyB0aGF0IHlvdSBkb24ndCBjYXJlIGFib3V0LlxuICAgKiAyLiB3aGVuIHRvcC1sZXZlbCBvYmplY3RzIGFjdHVhbGx5IHJlcHJlc2VudCBuZXN0ZWQgZGF0YSwgd2hpY2ggc2hvdWxkIGJlIGZsYXR0ZW5lZC4gSW4gdGhpcyBjYXNlLCBgdHJhbnNmb3JtYCBjYW4gcmV0dXJuIGFuIGFycmF5IG9mIGl0ZW1zLCBhbmQgdGhlIGhvb2sgd2lsbCBzdHJlYW0gdGhyb3VnaCBlYWNoIG9uZSBvZiB0aG9zZSBpdGVtcyxcbiAgICogcGFzc2luZyB0aGVtIHRvIGBmaWx0ZXJgIGV0Yy5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gYSBwYXNzdGhyb3VnaCBmdW5jdGlvbiBpZiBub3QgcHJvdmlkZWQuXG4gICAqXG4gICAqIEByZW1hcmsgVGhlIGhvb2sgd2lsbCByZXZhbGlkYXRlIGV2ZXJ5IHRpbWUgdGhlIHRyYW5zZm9ybSBmdW5jdGlvbiBjaGFuZ2VzLCBzbyBpdCBpcyBpbXBvcnRhbnQgdG8gdXNlIFt1c2VDYWxsYmFja10oaHR0cHM6Ly9yZWFjdC5kZXYvcmVmZXJlbmNlL3JlYWN0L3VzZUNhbGxiYWNrKSB0byBlbnN1cmUgaXQgb25seSBjaGFuZ2VzIHdoZW4gbmVjZXNzYXJ5IHRvIHByZXZlbnQgdW5uZWNlc3NhcnkgcmUtcmVuZGVycyBvciBjb21wdXRhdGlvbnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYFxuICAgKiAvLyBGb3IgZGF0YTogYHsgXCJkYXRhXCI6IFsgeyBcInR5cGVcIjogXCJmb2xkZXJcIiwgXCJuYW1lXCI6IFwiaXRlbSAxXCIsIFwiY2hpbGRyZW5cIjogWyB7IFwidHlwZVwiOiBcIml0ZW1cIiwgXCJuYW1lXCI6IFwiaXRlbSAyXCIgfSwgeyBcInR5cGVcIjogXCJpdGVtXCIsIFwibmFtZVwiOiBcIml0ZW0gM1wiIH0gXSB9LCB7IFwidHlwZVwiOiBcImZvbGRlclwiLCBcIm5hbWVcIjogXCJpdGVtIDRcIiwgY2hpbGRyZW46IFtdIH0gXSB9YFxuICAgKlxuICAgKiB0eXBlIEl0ZW0gPSB7XG4gICAqICB0eXBlOiBcIml0ZW1cIjtcbiAgICogIG5hbWU6IHN0cmluZztcbiAgICogfTtcbiAgICpcbiAgICogdHlwZSBGb2xkZXIgPSB7XG4gICAqICAgdHlwZTogXCJmb2xkZXJcIjtcbiAgICogICBuYW1lOiBzdHJpbmc7XG4gICAqICAgY2hpbGRyZW46IChJdGVtIHwgRm9sZGVyKVtdO1xuICAgKiB9O1xuICAgKlxuICAgKiBmdW5jdGlvbiBmbGF0dGVuKGl0ZW06IEl0ZW0gfCBGb2xkZXIpOiB7IG5hbWU6IHN0cmluZyB9W10ge1xuICAgKiAgIGNvbnN0IGZsYXR0ZW5lZDogeyBuYW1lOiBzdHJpbmcgfVtdID0gW107XG4gICAqICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJmb2xkZXJcIikge1xuICAgKiAgICAgZmxhdHRlbmVkLnB1c2goLi4uaXRlbS5jaGlsZHJlbi5tYXAoZmxhdHRlbikuZmxhdCgpKTtcbiAgICogICB9XG4gICAqICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJpdGVtXCIpIHtcbiAgICogICAgIGZsYXR0ZW5lZC5wdXNoKHsgbmFtZTogaXRlbS5uYW1lIH0pO1xuICAgKiAgIH1cbiAgICogICByZXR1cm4gZmxhdHRlbmVkO1xuICAgKiB9XG4gICAqXG4gICAqIGNvbnN0IHRyYW5zZm9ybSA9IHVzZUNhbGxiYWNrKGZsYXR0ZW4sIFtdKTtcbiAgICogY29uc3QgZmlsdGVyID0gdXNlQ2FsbGJhY2soKGl0ZW06IHsgbmFtZTogc3RyaW5nIH0pID0+IHtcbiAgICogICDigKZcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICB0cmFuc2Zvcm0/OiAoaXRlbTogYW55KSA9PiBUO1xuICAvKipcbiAgICogVGhlIGFtb3VudCBvZiBpdGVtcyB0byByZXR1cm4gZm9yIGVhY2ggcGFnZS5cbiAgICogRGVmYXVsdHMgdG8gYDIwYC5cbiAgICovXG4gIHBhZ2VTaXplPzogbnVtYmVyO1xufTtcblxuLyoqXG4gKiBUYWtlcyBhIGBodHRwOi8vYCwgYGh0dHBzOi8vYCBvciBgZmlsZTovLy9gIFVSTCBwb2ludGluZyB0byBhIEpTT04gcmVzb3VyY2UsIGNhY2hlcyBpdCB0byB0aGUgY29tbWFuZCdzIHN1cHBvcnRcbiAqIGZvbGRlciwgYW5kIHN0cmVhbXMgdGhyb3VnaCBpdHMgY29udGVudC4gVXNlZnVsIHdoZW4gZGVhbGluZyB3aXRoIGxhcmdlIEpTT04gYXJyYXlzIHdoaWNoIHdvdWxkIGJlIHRvbyBiaWcgdG8gZml0XG4gKiBpbiB0aGUgY29tbWFuZCdzIG1lbW9yeS5cbiAqXG4gKiBAcmVtYXJrIFRoZSBKU09OIHJlc291cmNlIG5lZWRzIHRvIGNvbnNpc3Qgb2YgYW4gYXJyYXkgb2Ygb2JqZWN0c1xuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IExpc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG4gKiBpbXBvcnQgeyB1c2VTdHJlYW1KU09OIH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKlxuICogdHlwZSBGb3JtdWxhID0geyBuYW1lOiBzdHJpbmc7IGRlc2M/OiBzdHJpbmcgfTtcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNYWluKCk6IFJlYWN0LkpTWC5FbGVtZW50IHtcbiAqICAgY29uc3QgeyBkYXRhLCBpc0xvYWRpbmcsIHBhZ2luYXRpb24gfSA9IHVzZVN0cmVhbUpTT048Rm9ybXVsYT4oXCJodHRwczovL2Zvcm11bGFlLmJyZXcuc2gvYXBpL2Zvcm11bGEuanNvblwiKTtcbiAqXG4gKiAgIHJldHVybiAoXG4gKiAgICAgPExpc3QgaXNMb2FkaW5nPXtpc0xvYWRpbmd9IHBhZ2luYXRpb249e3BhZ2luYXRpb259PlxuICogICAgICAgPExpc3QuU2VjdGlvbiB0aXRsZT1cIkZvcm11bGFlXCI+XG4gKiAgICAgICAgIHtkYXRhPy5tYXAoKGQpID0+IDxMaXN0Lkl0ZW0ga2V5PXtkLm5hbWV9IHRpdGxlPXtkLm5hbWV9IHN1YnRpdGxlPXtkLmRlc2N9IC8+KX1cbiAqICAgICAgIDwvTGlzdC5TZWN0aW9uPlxuICogICAgIDwvTGlzdD5cbiAqICAgKTtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IExpc3QgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG4gKiBpbXBvcnQgeyB1c2VTdHJlYW1KU09OIH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKiBpbXBvcnQgeyBob21lZGlyIH0gZnJvbSBcIm9zXCI7XG4gKiBpbXBvcnQgeyBqb2luIH0gZnJvbSBcInBhdGhcIjtcbiAqXG4gKiB0eXBlIEZvcm11bGEgPSB7IG5hbWU6IHN0cmluZzsgZGVzYz86IHN0cmluZyB9O1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1haW4oKTogUmVhY3QuSlNYLkVsZW1lbnQge1xuICogICBjb25zdCB7IGRhdGEsIGlzTG9hZGluZywgcGFnaW5hdGlvbiB9ID0gdXNlU3RyZWFtSlNPTjxGb3JtdWxhPihgZmlsZTovLy8ke2pvaW4oaG9tZWRpcigpLCBcIkRvd25sb2Fkc1wiLCBcImZvcm11bGFlLmpzb25cIil9YCk7XG4gKlxuICogICByZXR1cm4gKFxuICogICAgIDxMaXN0IGlzTG9hZGluZz17aXNMb2FkaW5nfSBwYWdpbmF0aW9uPXtwYWdpbmF0aW9ufT5cbiAqICAgICAgIDxMaXN0LlNlY3Rpb24gdGl0bGU9XCJGb3JtdWxhZVwiPlxuICogICAgICAgICB7ZGF0YT8ubWFwKChkKSA9PiA8TGlzdC5JdGVtIGtleT17ZC5uYW1lfSB0aXRsZT17ZC5uYW1lfSBzdWJ0aXRsZT17ZC5kZXNjfSAvPil9XG4gKiAgICAgICA8L0xpc3QuU2VjdGlvbj5cbiAqICAgICA8L0xpc3Q+XG4gKiAgICk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVN0cmVhbUpTT048VCwgVSA9IHVua25vd24+KHVybDogUmVxdWVzdEluZm8pOiBVc2VDYWNoZWRQcm9taXNlUmV0dXJuVHlwZTxULCBVPjtcblxuLyoqXG4gKiBUYWtlcyBhIGBodHRwOi8vYCwgYGh0dHBzOi8vYCBvciBgZmlsZTovLy9gIFVSTCBwb2ludGluZyB0byBhIEpTT04gcmVzb3VyY2UsIGNhY2hlcyBpdCB0byB0aGUgY29tbWFuZCdzIHN1cHBvcnRcbiAqIGZvbGRlciwgYW5kIHN0cmVhbXMgdGhyb3VnaCBpdHMgY29udGVudC4gVXNlZnVsIHdoZW4gZGVhbGluZyB3aXRoIGxhcmdlIEpTT04gYXJyYXlzIHdoaWNoIHdvdWxkIGJlIHRvbyBiaWcgdG8gZml0XG4gKiBpbiB0aGUgY29tbWFuZCdzIG1lbW9yeS5cbiAqXG4gKiBAcmVtYXJrIFRoZSBKU09OIHJlc291cmNlIG5lZWRzIHRvIGNvbnNpc3Qgb2YgYW4gYXJyYXkgb2Ygb2JqZWN0c1xuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IExpc3QsIGVudmlyb25tZW50IH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuICogaW1wb3J0IHsgdXNlU3RyZWFtSlNPTiB9IGZyb20gXCJAcmF5Y2FzdC91dGlsc1wiO1xuICogaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuICogaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG4gKlxuICogdHlwZSBGb3JtdWxhID0geyBuYW1lOiBzdHJpbmc7IGRlc2M/OiBzdHJpbmcgfTtcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNYWluKCk6IFJlYWN0LkpTWC5FbGVtZW50IHtcbiAqICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoXCJcIik7XG4gKlxuICogICBjb25zdCBmb3JtdWxhRmlsdGVyID0gdXNlQ2FsbGJhY2soXG4gKiAgICAgKGl0ZW06IEZvcm11bGEpID0+IHtcbiAqICAgICAgIGlmICghc2VhcmNoVGV4dCkgcmV0dXJuIHRydWU7XG4gKiAgICAgICByZXR1cm4gaXRlbS5uYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGV4dCk7XG4gKiAgICAgfSxcbiAqICAgICBbc2VhcmNoVGV4dF0sXG4gKiAgICk7XG4gKlxuICogICBjb25zdCBmb3JtdWxhVHJhbnNmb3JtID0gdXNlQ2FsbGJhY2soKGl0ZW06IGFueSk6IEZvcm11bGEgPT4ge1xuICogICAgIHJldHVybiB7IG5hbWU6IGl0ZW0ubmFtZSwgZGVzYzogaXRlbS5kZXNjIH07XG4gKiAgIH0sIFtdKTtcbiAqXG4gKiAgIGNvbnN0IHsgZGF0YSwgaXNMb2FkaW5nLCBwYWdpbmF0aW9uIH0gPSB1c2VTdHJlYW1KU09OKFwiaHR0cHM6Ly9mb3JtdWxhZS5icmV3LnNoL2FwaS9mb3JtdWxhLmpzb25cIiwge1xuICogICAgIGluaXRpYWxEYXRhOiBbXSBhcyBGb3JtdWxhW10sXG4gKiAgICAgcGFnZVNpemU6IDIwLFxuICogICAgIGZpbHRlcjogZm9ybXVsYUZpbHRlcixcbiAqICAgICB0cmFuc2Zvcm06IGZvcm11bGFUcmFuc2Zvcm0sXG4gKiAgIH0pO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8TGlzdCBpc0xvYWRpbmc9e2lzTG9hZGluZ30gcGFnaW5hdGlvbj17cGFnaW5hdGlvbn0gb25TZWFyY2hUZXh0Q2hhbmdlPXtzZXRTZWFyY2hUZXh0fT5cbiAqICAgICAgIDxMaXN0LlNlY3Rpb24gdGl0bGU9XCJGb3JtdWxhZVwiPlxuICogICAgICAgICB7ZGF0YS5tYXAoKGQpID0+IChcbiAqICAgICAgICAgICA8TGlzdC5JdGVtIGtleT17ZC5uYW1lfSB0aXRsZT17ZC5uYW1lfSBzdWJ0aXRsZT17ZC5kZXNjfSAvPlxuICogICAgICAgICApKX1cbiAqICAgICAgIDwvTGlzdC5TZWN0aW9uPlxuICogICAgIDwvTGlzdD5cbiAqICAgKTtcbiAqIH1cbiAqIGBgYCBzdXBwb3J0IGZvbGRlciwgYW5kIHN0cmVhbXMgdGhyb3VnaCBpdHMgY29udGVudC5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBpbXBvcnQgeyBMaXN0LCBlbnZpcm9ubWVudCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IHVzZVN0cmVhbUpTT04gfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqIGltcG9ydCB7IGpvaW4gfSBmcm9tIFwicGF0aFwiO1xuICogaW1wb3J0IHsgaG9tZWRpciB9IGZyb20gXCJvc1wiO1xuICogaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG4gKlxuICogdHlwZSBGb3JtdWxhID0geyBuYW1lOiBzdHJpbmc7IGRlc2M/OiBzdHJpbmcgfTtcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNYWluKCk6IFJlYWN0LkpTWC5FbGVtZW50IHtcbiAqICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoXCJcIik7XG4gKlxuICogICBjb25zdCBmb3JtdWxhRmlsdGVyID0gdXNlQ2FsbGJhY2soXG4gKiAgICAgKGl0ZW06IEZvcm11bGEpID0+IHtcbiAqICAgICAgIGlmICghc2VhcmNoVGV4dCkgcmV0dXJuIHRydWU7XG4gKiAgICAgICByZXR1cm4gaXRlbS5uYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGV4dCk7XG4gKiAgICAgfSxcbiAqICAgICBbc2VhcmNoVGV4dF0sXG4gKiAgICk7XG4gKlxuICogICBjb25zdCBmb3JtdWxhVHJhbnNmb3JtID0gdXNlQ2FsbGJhY2soKGl0ZW06IGFueSk6IEZvcm11bGEgPT4ge1xuICogICAgIHJldHVybiB7IG5hbWU6IGl0ZW0ubmFtZSwgZGVzYzogaXRlbS5kZXNjIH07XG4gKiAgIH0sIFtdKTtcbiAqXG4gKiAgIGNvbnN0IHsgZGF0YSwgaXNMb2FkaW5nLCBwYWdpbmF0aW9uIH0gPSB1c2VTdHJlYW1KU09OKGBmaWxlOi8vLyR7am9pbihob21lZGlyKCksIFwiRG93bmxvYWRzXCIsIFwiZm9ybXVsYWUuanNvblwiKX1gLCB7XG4gKiAgICAgaW5pdGlhbERhdGE6IFtdIGFzIEZvcm11bGFbXSxcbiAqICAgICBwYWdlU2l6ZTogMjAsXG4gKiAgICAgZmlsdGVyOiBmb3JtdWxhRmlsdGVyLFxuICogICAgIHRyYW5zZm9ybTogZm9ybXVsYVRyYW5zZm9ybSxcbiAqICAgfSk7XG4gKlxuICogICByZXR1cm4gKFxuICogICAgIDxMaXN0IGlzTG9hZGluZz17aXNMb2FkaW5nfSBwYWdpbmF0aW9uPXtwYWdpbmF0aW9ufSBvblNlYXJjaFRleHRDaGFuZ2U9e3NldFNlYXJjaFRleHR9PlxuICogICAgICAgPExpc3QuU2VjdGlvbiB0aXRsZT1cIkZvcm11bGFlXCI+XG4gKiAgICAgICAgIHtkYXRhLm1hcCgoZCkgPT4gKFxuICogICAgICAgICAgIDxMaXN0Lkl0ZW0ga2V5PXtkLm5hbWV9IHRpdGxlPXtkLm5hbWV9IHN1YnRpdGxlPXtkLmRlc2N9IC8+XG4gKiAgICAgICAgICkpfVxuICogICAgICAgPC9MaXN0LlNlY3Rpb24+XG4gKiAgICAgPC9MaXN0PlxuICogICApO1xuICogfVxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VTdHJlYW1KU09OPFQsIFUgZXh0ZW5kcyBhbnlbXSA9IGFueVtdPihcbiAgdXJsOiBSZXF1ZXN0SW5mbyxcbiAgb3B0aW9uczogT3B0aW9uczxUPiAmIFJlcXVlc3RJbml0ICYgT21pdDxDYWNoZWRQcm9taXNlT3B0aW9uczxGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsIFU+LCBcImFib3J0YWJsZVwiPixcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFQgZXh0ZW5kcyB1bmtub3duW10gPyBUIDogVFtdLCBVPjtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVN0cmVhbUpTT048VCwgVSBleHRlbmRzIGFueVtdID0gYW55W10+KFxuICB1cmw6IFJlcXVlc3RJbmZvLFxuICBvcHRpb25zPzogT3B0aW9uczxUPiAmIFJlcXVlc3RJbml0ICYgT21pdDxDYWNoZWRQcm9taXNlT3B0aW9uczxGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsIFU+LCBcImFib3J0YWJsZVwiPixcbik6IFVzZUNhY2hlZFByb21pc2VSZXR1cm5UeXBlPFQgZXh0ZW5kcyB1bmtub3duW10gPyBUIDogVFtdLCBVPiB7XG4gIGNvbnN0IHtcbiAgICBpbml0aWFsRGF0YSxcbiAgICBleGVjdXRlLFxuICAgIGtlZXBQcmV2aW91c0RhdGEsXG4gICAgb25FcnJvcixcbiAgICBvbkRhdGEsXG4gICAgb25XaWxsRXhlY3V0ZSxcbiAgICBmYWlsdXJlVG9hc3RPcHRpb25zLFxuICAgIGRhdGFQYXRoLFxuICAgIGZpbHRlcixcbiAgICB0cmFuc2Zvcm0sXG4gICAgcGFnZVNpemUgPSAyMCxcbiAgICAuLi5mZXRjaE9wdGlvbnNcbiAgfSA9IG9wdGlvbnMgPz8ge307XG4gIGNvbnN0IHByZXZpb3VzVXJsID0gdXNlUmVmPFJlcXVlc3RJbmZvPihudWxsKTtcbiAgY29uc3QgcHJldmlvdXNEZXN0aW5hdGlvbiA9IHVzZVJlZjxzdHJpbmc+KG51bGwpO1xuXG4gIGNvbnN0IHVzZUNhY2hlZFByb21pc2VPcHRpb25zOiBDYWNoZWRQcm9taXNlT3B0aW9uczxGdW5jdGlvblJldHVybmluZ1BhZ2luYXRlZFByb21pc2UsIFU+ID0ge1xuICAgIGluaXRpYWxEYXRhLFxuICAgIGV4ZWN1dGUsXG4gICAga2VlcFByZXZpb3VzRGF0YSxcbiAgICBvbkVycm9yLFxuICAgIG9uRGF0YSxcbiAgICBvbldpbGxFeGVjdXRlLFxuICAgIGZhaWx1cmVUb2FzdE9wdGlvbnMsXG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdG9yUmVmID0gdXNlUmVmPEFzeW5jR2VuZXJhdG9yPFQgZXh0ZW5kcyB1bmtub3duW10gPyBUIDogVFtdPiB8IG51bGw+KG51bGwpO1xuICBjb25zdCBjb250cm9sbGVyUmVmID0gdXNlUmVmPEFib3J0Q29udHJvbGxlciB8IG51bGw+KG51bGwpO1xuICBjb25zdCBoYXNNb3JlUmVmID0gdXNlUmVmKGZhbHNlKTtcblxuICByZXR1cm4gdXNlQ2FjaGVkUHJvbWlzZShcbiAgICAoXG4gICAgICB1cmw6IFJlcXVlc3RJbmZvLFxuICAgICAgcGFnZVNpemU6IG51bWJlcixcbiAgICAgIGZldGNoT3B0aW9uczogUmVxdWVzdEluaXQgfCB1bmRlZmluZWQsXG4gICAgICBkYXRhUGF0aDogc3RyaW5nIHwgUmVnRXhwIHwgdW5kZWZpbmVkLFxuICAgICAgZmlsdGVyOiAoKGl0ZW06IEZsYXR0ZW48VD4pID0+IGJvb2xlYW4pIHwgdW5kZWZpbmVkLFxuICAgICAgdHJhbnNmb3JtOiAoKGl0ZW06IHVua25vd24pID0+IFQpIHwgdW5kZWZpbmVkLFxuICAgICkgPT5cbiAgICAgIGFzeW5jICh7IHBhZ2UgfSkgPT4ge1xuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGhhc2godXJsKSArIFwiLmpzb25cIjtcbiAgICAgICAgY29uc3QgZm9sZGVyID0gZW52aXJvbm1lbnQuc3VwcG9ydFBhdGg7XG4gICAgICAgIGlmIChwYWdlID09PSAwKSB7XG4gICAgICAgICAgY29udHJvbGxlclJlZi5jdXJyZW50Py5hYm9ydCgpO1xuICAgICAgICAgIGNvbnRyb2xsZXJSZWYuY3VycmVudCA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IGpvaW4oZm9sZGVyLCBmaWxlTmFtZSk7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogRm9yY2UgdXBkYXRlIHRoZSBjYWNoZSB3aGVuIHRoZSBVUkwgY2hhbmdlcyBidXQgdGhlIGNhY2hlIGRlc3RpbmF0aW9uIGRvZXMgbm90LlxuICAgICAgICAgICAqL1xuICAgICAgICAgIGNvbnN0IGZvcmNlQ2FjaGVVcGRhdGUgPSBCb29sZWFuKFxuICAgICAgICAgICAgcHJldmlvdXNVcmwuY3VycmVudCAmJlxuICAgICAgICAgICAgICBwcmV2aW91c1VybC5jdXJyZW50ICE9PSB1cmwgJiZcbiAgICAgICAgICAgICAgcHJldmlvdXNEZXN0aW5hdGlvbi5jdXJyZW50ICYmXG4gICAgICAgICAgICAgIHByZXZpb3VzRGVzdGluYXRpb24uY3VycmVudCA9PT0gZGVzdGluYXRpb24sXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwcmV2aW91c1VybC5jdXJyZW50ID0gdXJsO1xuICAgICAgICAgIHByZXZpb3VzRGVzdGluYXRpb24uY3VycmVudCA9IGRlc3RpbmF0aW9uO1xuICAgICAgICAgIGF3YWl0IGNhY2hlVVJMSWZOZWNlc3NhcnkodXJsLCBmb2xkZXIsIGZpbGVOYW1lLCBmb3JjZUNhY2hlVXBkYXRlLCB7XG4gICAgICAgICAgICAuLi5mZXRjaE9wdGlvbnMsXG4gICAgICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXJSZWYuY3VycmVudD8uc2lnbmFsLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdlbmVyYXRvclJlZi5jdXJyZW50ID0gc3RyZWFtSnNvbkZpbGUoXG4gICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgIHBhZ2VTaXplLFxuICAgICAgICAgICAgY29udHJvbGxlclJlZi5jdXJyZW50Py5zaWduYWwsXG4gICAgICAgICAgICBkYXRhUGF0aCxcbiAgICAgICAgICAgIGZpbHRlcixcbiAgICAgICAgICAgIHRyYW5zZm9ybSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZ2VuZXJhdG9yUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICByZXR1cm4geyBoYXNNb3JlOiBoYXNNb3JlUmVmLmN1cnJlbnQsIGRhdGE6IFtdIGFzIFQgZXh0ZW5kcyB1bmtub3duW10gPyBUIDogVFtdIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB2YWx1ZTogbmV3RGF0YSwgZG9uZSB9ID0gYXdhaXQgZ2VuZXJhdG9yUmVmLmN1cnJlbnQubmV4dCgpO1xuICAgICAgICBoYXNNb3JlUmVmLmN1cnJlbnQgPSAhZG9uZTtcbiAgICAgICAgcmV0dXJuIHsgaGFzTW9yZTogaGFzTW9yZVJlZi5jdXJyZW50LCBkYXRhOiAobmV3RGF0YSA/PyBbXSkgYXMgVCBleHRlbmRzIHVua25vd25bXSA/IFQgOiBUW10gfTtcbiAgICAgIH0sXG4gICAgW3VybCwgcGFnZVNpemUsIGZldGNoT3B0aW9ucywgZGF0YVBhdGgsIGZpbHRlciwgdHJhbnNmb3JtXSxcbiAgICB1c2VDYWNoZWRQcm9taXNlT3B0aW9ucyxcbiAgKTtcbn1cbiIsICIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnQgKi9cbmltcG9ydCB7IFJlYWRhYmxlLCBXcml0YWJsZSwgRHVwbGV4IH0gZnJvbSBcIm5vZGU6c3RyZWFtXCI7XG5cbmV4cG9ydCBjb25zdCBub25lID0gLyogI19fUFVSRV9fICovIFN5bWJvbC5mb3IoXCJvYmplY3Qtc3RyZWFtLm5vbmVcIik7XG5jb25zdCBzdG9wID0gLyogI19fUFVSRV9fICovIFN5bWJvbC5mb3IoXCJvYmplY3Qtc3RyZWFtLnN0b3BcIik7XG5cbmNvbnN0IGZpbmFsU3ltYm9sID0gLyogI19fUFVSRV9fICovIFN5bWJvbC5mb3IoXCJvYmplY3Qtc3RyZWFtLmZpbmFsXCIpO1xuY29uc3QgbWFueVN5bWJvbCA9IC8qICNfX1BVUkVfXyAqLyBTeW1ib2wuZm9yKFwib2JqZWN0LXN0cmVhbS5tYW55XCIpO1xuY29uc3QgZmx1c2hTeW1ib2wgPSAvKiAjX19QVVJFX18gKi8gU3ltYm9sLmZvcihcIm9iamVjdC1zdHJlYW0uZmx1c2hcIik7XG5jb25zdCBmTGlzdFN5bWJvbCA9IC8qICNfX1BVUkVfXyAqLyBTeW1ib2wuZm9yKFwib2JqZWN0LXN0cmVhbS5mTGlzdFwiKTtcblxuY29uc3QgZmluYWxWYWx1ZSA9ICh2YWx1ZTogYW55KSA9PiAoeyBbZmluYWxTeW1ib2xdOiAxLCB2YWx1ZSB9KTtcbmV4cG9ydCBjb25zdCBtYW55ID0gKHZhbHVlczogYW55KSA9PiAoeyBbbWFueVN5bWJvbF06IDEsIHZhbHVlcyB9KTtcblxuY29uc3QgaXNGaW5hbFZhbHVlID0gKG86IGFueSkgPT4gbyAmJiBvW2ZpbmFsU3ltYm9sXSA9PT0gMTtcbmNvbnN0IGlzTWFueSA9IChvOiBhbnkpID0+IG8gJiYgb1ttYW55U3ltYm9sXSA9PT0gMTtcbmNvbnN0IGlzRmx1c2hhYmxlID0gKG86IGFueSkgPT4gbyAmJiBvW2ZsdXNoU3ltYm9sXSA9PT0gMTtcbmNvbnN0IGlzRnVuY3Rpb25MaXN0ID0gKG86IGFueSkgPT4gbyAmJiBvW2ZMaXN0U3ltYm9sXSA9PT0gMTtcblxuY29uc3QgZ2V0RmluYWxWYWx1ZSA9IChvOiBhbnkpID0+IG8udmFsdWU7XG5jb25zdCBnZXRNYW55VmFsdWVzID0gKG86IGFueSkgPT4gby52YWx1ZXM7XG5jb25zdCBnZXRGdW5jdGlvbkxpc3QgPSAobzogYW55KSA9PiBvLmZMaXN0O1xuXG5leHBvcnQgY29uc3QgY29tYmluZU1hbnlNdXQgPSAoYTogYW55LCBiOiBhbnkpID0+IHtcbiAgY29uc3QgdmFsdWVzID0gYSA9PT0gbm9uZSA/IFtdIDogYT8uW21hbnlTeW1ib2xdID09PSAxID8gYS52YWx1ZXMgOiBbYV07XG4gIGlmIChiID09PSBub25lKSB7XG4gICAgLy8gZG8gbm90aGluZ1xuICB9IGVsc2UgaWYgKGI/LlttYW55U3ltYm9sXSA9PT0gMSkge1xuICAgIHZhbHVlcy5wdXNoKC4uLmIudmFsdWVzKTtcbiAgfSBlbHNlIHtcbiAgICB2YWx1ZXMucHVzaChiKTtcbiAgfVxuICByZXR1cm4gbWFueSh2YWx1ZXMpO1xufTtcblxuZXhwb3J0IGNvbnN0IGZsdXNoYWJsZSA9ICh3cml0ZTogKHZhbHVlOiBhbnkpID0+IGFueSwgZmluYWwgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGZuID0gZmluYWwgPyAodmFsdWU6IGFueSkgPT4gKHZhbHVlID09PSBub25lID8gZmluYWxWYWx1ZSh1bmRlZmluZWQpIDogd3JpdGUodmFsdWUpKSA6IHdyaXRlO1xuICAvLyBAdHMtaWdub3JlXG4gIGZuW2ZsdXNoU3ltYm9sXSA9IDE7XG4gIHJldHVybiBmbjtcbn07XG5cbmNvbnN0IHNldEZ1bmN0aW9uTGlzdCA9IChvOiBhbnksIGZuczogYW55KSA9PiB7XG4gIG8uZkxpc3QgPSBmbnM7XG4gIG9bZkxpc3RTeW1ib2xdID0gMTtcbiAgcmV0dXJuIG87XG59O1xuXG4vLyBpcypOb2RlU3RyZWFtIGZ1bmN0aW9ucyB0YWtlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iL21hc3Rlci9saWIvaW50ZXJuYWwvc3RyZWFtcy91dGlscy5qc1xuY29uc3QgaXNSZWFkYWJsZU5vZGVTdHJlYW0gPSAob2JqOiBhbnkpID0+XG4gIG9iaiAmJlxuICB0eXBlb2Ygb2JqLnBpcGUgPT09IFwiZnVuY3Rpb25cIiAmJlxuICB0eXBlb2Ygb2JqLm9uID09PSBcImZ1bmN0aW9uXCIgJiZcbiAgKCFvYmouX3dyaXRhYmxlU3RhdGUgfHwgKHR5cGVvZiBvYmouX3JlYWRhYmxlU3RhdGUgPT09IFwib2JqZWN0XCIgPyBvYmouX3JlYWRhYmxlU3RhdGUucmVhZGFibGUgOiBudWxsKSAhPT0gZmFsc2UpICYmIC8vIER1cGxleFxuICAoIW9iai5fd3JpdGFibGVTdGF0ZSB8fCBvYmouX3JlYWRhYmxlU3RhdGUpOyAvLyBXcml0YWJsZSBoYXMgLnBpcGUuXG5cbmNvbnN0IGlzV3JpdGFibGVOb2RlU3RyZWFtID0gKG9iajogYW55KSA9PlxuICBvYmogJiZcbiAgdHlwZW9mIG9iai53cml0ZSA9PT0gXCJmdW5jdGlvblwiICYmXG4gIHR5cGVvZiBvYmoub24gPT09IFwiZnVuY3Rpb25cIiAmJlxuICAoIW9iai5fcmVhZGFibGVTdGF0ZSB8fCAodHlwZW9mIG9iai5fd3JpdGFibGVTdGF0ZSA9PT0gXCJvYmplY3RcIiA/IG9iai5fd3JpdGFibGVTdGF0ZS53cml0YWJsZSA6IG51bGwpICE9PSBmYWxzZSk7IC8vIER1cGxleFxuXG5jb25zdCBpc0R1cGxleE5vZGVTdHJlYW0gPSAob2JqOiBhbnkpID0+XG4gIG9iaiAmJlxuICB0eXBlb2Ygb2JqLnBpcGUgPT09IFwiZnVuY3Rpb25cIiAmJlxuICBvYmouX3JlYWRhYmxlU3RhdGUgJiZcbiAgdHlwZW9mIG9iai5vbiA9PT0gXCJmdW5jdGlvblwiICYmXG4gIHR5cGVvZiBvYmoud3JpdGUgPT09IFwiZnVuY3Rpb25cIjtcblxuY29uc3QgaXNSZWFkYWJsZVdlYlN0cmVhbSA9IChvYmo6IGFueSkgPT4gb2JqICYmIGdsb2JhbFRoaXMuUmVhZGFibGVTdHJlYW0gJiYgb2JqIGluc3RhbmNlb2YgZ2xvYmFsVGhpcy5SZWFkYWJsZVN0cmVhbTtcblxuY29uc3QgaXNXcml0YWJsZVdlYlN0cmVhbSA9IChvYmo6IGFueSkgPT4gb2JqICYmIGdsb2JhbFRoaXMuV3JpdGFibGVTdHJlYW0gJiYgb2JqIGluc3RhbmNlb2YgZ2xvYmFsVGhpcy5Xcml0YWJsZVN0cmVhbTtcblxuY29uc3QgaXNEdXBsZXhXZWJTdHJlYW0gPSAob2JqOiBhbnkpID0+XG4gIG9iaiAmJlxuICBnbG9iYWxUaGlzLlJlYWRhYmxlU3RyZWFtICYmXG4gIG9iai5yZWFkYWJsZSBpbnN0YW5jZW9mIGdsb2JhbFRoaXMuUmVhZGFibGVTdHJlYW0gJiZcbiAgZ2xvYmFsVGhpcy5Xcml0YWJsZVN0cmVhbSAmJlxuICBvYmoud3JpdGFibGUgaW5zdGFuY2VvZiBnbG9iYWxUaGlzLldyaXRhYmxlU3RyZWFtO1xuXG5jb25zdCBncm91cEZ1bmN0aW9ucyA9IChvdXRwdXQ6IGFueSwgZm46IGFueSwgaW5kZXg6IGFueSwgZm5zOiBhbnkpID0+IHtcbiAgaWYgKFxuICAgIGlzRHVwbGV4Tm9kZVN0cmVhbShmbikgfHxcbiAgICAoIWluZGV4ICYmIGlzUmVhZGFibGVOb2RlU3RyZWFtKGZuKSkgfHxcbiAgICAoaW5kZXggPT09IGZucy5sZW5ndGggLSAxICYmIGlzV3JpdGFibGVOb2RlU3RyZWFtKGZuKSlcbiAgKSB7XG4gICAgb3V0cHV0LnB1c2goZm4pO1xuICAgIHJldHVybiBvdXRwdXQ7XG4gIH1cbiAgaWYgKGlzRHVwbGV4V2ViU3RyZWFtKGZuKSkge1xuICAgIG91dHB1dC5wdXNoKER1cGxleC5mcm9tV2ViKGZuLCB7IG9iamVjdE1vZGU6IHRydWUgfSkpO1xuICAgIHJldHVybiBvdXRwdXQ7XG4gIH1cbiAgaWYgKCFpbmRleCAmJiBpc1JlYWRhYmxlV2ViU3RyZWFtKGZuKSkge1xuICAgIG91dHB1dC5wdXNoKFJlYWRhYmxlLmZyb21XZWIoZm4sIHsgb2JqZWN0TW9kZTogdHJ1ZSB9KSk7XG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfVxuICBpZiAoaW5kZXggPT09IGZucy5sZW5ndGggLSAxICYmIGlzV3JpdGFibGVXZWJTdHJlYW0oZm4pKSB7XG4gICAgb3V0cHV0LnB1c2goV3JpdGFibGUuZnJvbVdlYihmbiwgeyBvYmplY3RNb2RlOiB0cnVlIH0pKTtcbiAgICByZXR1cm4gb3V0cHV0O1xuICB9XG4gIGlmICh0eXBlb2YgZm4gIT0gXCJmdW5jdGlvblwiKSB0aHJvdyBUeXBlRXJyb3IoXCJJdGVtICNcIiArIGluZGV4ICsgXCIgaXMgbm90IGEgcHJvcGVyIHN0cmVhbSwgbm9yIGEgZnVuY3Rpb24uXCIpO1xuICBpZiAoIW91dHB1dC5sZW5ndGgpIG91dHB1dC5wdXNoKFtdKTtcbiAgY29uc3QgbGFzdCA9IG91dHB1dFtvdXRwdXQubGVuZ3RoIC0gMV07XG4gIGlmIChBcnJheS5pc0FycmF5KGxhc3QpKSB7XG4gICAgbGFzdC5wdXNoKGZuKTtcbiAgfSBlbHNlIHtcbiAgICBvdXRwdXQucHVzaChbZm5dKTtcbiAgfVxuICByZXR1cm4gb3V0cHV0O1xufTtcblxuY2xhc3MgU3RvcCBleHRlbmRzIEVycm9yIHt9XG5cbmV4cG9ydCBjb25zdCBhc1N0cmVhbSA9IChmbjogYW55KSA9PiB7XG4gIGlmICh0eXBlb2YgZm4gIT0gXCJmdW5jdGlvblwiKSB0aHJvdyBUeXBlRXJyb3IoXCJPbmx5IGEgZnVuY3Rpb24gaXMgYWNjZXB0ZWQgYXMgdGhlIGZpcnN0IGFyZ3VtZW50XCIpO1xuXG4gIC8vIHB1bXAgdmFyaWFibGVzXG4gIGxldCBwYXVzZWQgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgbGV0IHJlc29sdmVQYXVzZWQ6ICgodmFsdWU6IHZvaWQgfCBQcm9taXNlTGlrZTx2b2lkPikgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgY29uc3QgcXVldWU6IGFueVtdID0gW107XG5cbiAgLy8gcGF1c2UvcmVzdW1lXG4gIGNvbnN0IHJlc3VtZTogYW55ID0gKCkgPT4ge1xuICAgIGlmICghcmVzb2x2ZVBhdXNlZCkgcmV0dXJuO1xuICAgIHJlc29sdmVQYXVzZWQoKTtcbiAgICByZXNvbHZlUGF1c2VkID0gbnVsbDtcbiAgICBwYXVzZWQgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgfTtcbiAgY29uc3QgcGF1c2U6IGFueSA9ICgpID0+IHtcbiAgICBpZiAocmVzb2x2ZVBhdXNlZCkgcmV0dXJuO1xuICAgIHBhdXNlZCA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiAocmVzb2x2ZVBhdXNlZCA9IHJlc29sdmUpKTtcbiAgfTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG4gIGxldCBzdHJlYW06IER1cGxleDsgLy8gd2lsbCBiZSBhc3NpZ25lZCBsYXRlclxuXG4gIC8vIGRhdGEgcHJvY2Vzc2luZ1xuICBjb25zdCBwdXNoUmVzdWx0czogYW55ID0gKHZhbHVlczogYW55KSA9PiB7XG4gICAgaWYgKHZhbHVlcyAmJiB0eXBlb2YgdmFsdWVzLm5leHQgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAvLyBnZW5lcmF0b3JcbiAgICAgIHF1ZXVlLnB1c2godmFsdWVzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gYXJyYXlcbiAgICBxdWV1ZS5wdXNoKHZhbHVlc1tTeW1ib2wuaXRlcmF0b3JdKCkpO1xuICB9O1xuICBjb25zdCBwdW1wOiBhbnkgPSBhc3luYyAoKSA9PiB7XG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgYXdhaXQgcGF1c2VkO1xuICAgICAgY29uc3QgZ2VuID0gcXVldWVbcXVldWUubGVuZ3RoIC0gMV07XG4gICAgICBsZXQgcmVzdWx0ID0gZ2VuLm5leHQoKTtcbiAgICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdC50aGVuID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCByZXN1bHQ7XG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcXVldWUucG9wKCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgbGV0IHZhbHVlID0gcmVzdWx0LnZhbHVlO1xuICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZS50aGVuID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICB2YWx1ZSA9IGF3YWl0IHZhbHVlO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2FuaXRpemUodmFsdWUpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc2FuaXRpemU6IGFueSA9IGFzeW5jICh2YWx1ZTogYW55KSA9PiB7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IG5vbmUpIHJldHVybjtcbiAgICBpZiAodmFsdWUgPT09IHN0b3ApIHRocm93IG5ldyBTdG9wKCk7XG5cbiAgICBpZiAoaXNNYW55KHZhbHVlKSkge1xuICAgICAgcHVzaFJlc3VsdHMoZ2V0TWFueVZhbHVlcyh2YWx1ZSkpO1xuICAgICAgcmV0dXJuIHB1bXAoKTtcbiAgICB9XG5cbiAgICBpZiAoaXNGaW5hbFZhbHVlKHZhbHVlKSkge1xuICAgICAgLy8gYSBmaW5hbCB2YWx1ZSBpcyBub3Qgc3VwcG9ydGVkLCBpdCBpcyB0cmVhdGVkIGFzIGEgcmVndWxhciB2YWx1ZVxuICAgICAgdmFsdWUgPSBnZXRGaW5hbFZhbHVlKHZhbHVlKTtcbiAgICAgIHJldHVybiBwcm9jZXNzVmFsdWUodmFsdWUpO1xuICAgIH1cblxuICAgIGlmICghc3RyZWFtLnB1c2godmFsdWUpKSB7XG4gICAgICBwYXVzZSgpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcHJvY2Vzc0NodW5rOiBhbnkgPSBhc3luYyAoY2h1bms6IGFueSwgZW5jb2Rpbmc6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGZuKGNodW5rLCBlbmNvZGluZyk7XG4gICAgICBhd2FpdCBwcm9jZXNzVmFsdWUodmFsdWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTdG9wKSB7XG4gICAgICAgIHN0cmVhbS5wdXNoKG51bGwpO1xuICAgICAgICBzdHJlYW0uZGVzdHJveSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHByb2Nlc3NWYWx1ZTogYW55ID0gYXN5bmMgKHZhbHVlOiBhbnkpID0+IHtcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAvLyB0aGVuYWJsZVxuICAgICAgcmV0dXJuIHZhbHVlLnRoZW4oKHZhbHVlOiBhbnkpID0+IHByb2Nlc3NWYWx1ZSh2YWx1ZSkpO1xuICAgIH1cbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlLm5leHQgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAvLyBnZW5lcmF0b3JcbiAgICAgIHB1c2hSZXN1bHRzKHZhbHVlKTtcbiAgICAgIHJldHVybiBwdW1wKCk7XG4gICAgfVxuICAgIHJldHVybiBzYW5pdGl6ZSh2YWx1ZSk7XG4gIH07XG5cbiAgc3RyZWFtID0gbmV3IER1cGxleChcbiAgICBPYmplY3QuYXNzaWduKHsgd3JpdGFibGVPYmplY3RNb2RlOiB0cnVlLCByZWFkYWJsZU9iamVjdE1vZGU6IHRydWUgfSwgdW5kZWZpbmVkLCB7XG4gICAgICB3cml0ZShjaHVuazogYW55LCBlbmNvZGluZzogYW55LCBjYWxsYmFjazogYW55KSB7XG4gICAgICAgIHByb2Nlc3NDaHVuayhjaHVuaywgZW5jb2RpbmcpLnRoZW4oXG4gICAgICAgICAgKCkgPT4gY2FsbGJhY2sobnVsbCksXG4gICAgICAgICAgKGVycm9yOiBhbnkpID0+IGNhbGxiYWNrKGVycm9yKSxcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBmaW5hbChjYWxsYmFjazogYW55KSB7XG4gICAgICAgIGlmICghaXNGbHVzaGFibGUoZm4pKSB7XG4gICAgICAgICAgc3RyZWFtLnB1c2gobnVsbCk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHByb2Nlc3NDaHVuayhub25lLCBudWxsKS50aGVuKFxuICAgICAgICAgICgpID0+IChzdHJlYW0ucHVzaChudWxsKSwgY2FsbGJhY2sobnVsbCkpLFxuICAgICAgICAgIChlcnJvcjogYW55KSA9PiBjYWxsYmFjayhlcnJvciksXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgcmVhZCgpIHtcbiAgICAgICAgcmVzdW1lKCk7XG4gICAgICB9LFxuICAgIH0pLFxuICApO1xuXG4gIHJldHVybiBzdHJlYW07XG59O1xuXG5jb25zdCBwcm9kdWNlU3RyZWFtcyA9IChpdGVtOiBhbnkpID0+IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpIHtcbiAgICBpZiAoIWl0ZW0ubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICBpZiAoaXRlbS5sZW5ndGggPT0gMSkgcmV0dXJuIGl0ZW1bMF0gJiYgYXNTdHJlYW0oaXRlbVswXSk7XG4gICAgcmV0dXJuIGFzU3RyZWFtKGdlbiguLi5pdGVtKSk7XG4gIH1cbiAgcmV0dXJuIGl0ZW07XG59O1xuXG5jb25zdCBuZXh0OiBhbnkgPSBhc3luYyBmdW5jdGlvbiogKHZhbHVlOiBhbnksIGZuczogYW55LCBpbmRleDogYW55KSB7XG4gIGZvciAobGV0IGkgPSBpbmRleDsgaSA8PSBmbnMubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAvLyB0aGVuYWJsZVxuICAgICAgdmFsdWUgPSBhd2FpdCB2YWx1ZTtcbiAgICB9XG4gICAgaWYgKHZhbHVlID09PSBub25lKSBicmVhaztcbiAgICBpZiAodmFsdWUgPT09IHN0b3ApIHRocm93IG5ldyBTdG9wKCk7XG4gICAgaWYgKGlzRmluYWxWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgIHlpZWxkIGdldEZpbmFsVmFsdWUodmFsdWUpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChpc01hbnkodmFsdWUpKSB7XG4gICAgICBjb25zdCB2YWx1ZXMgPSBnZXRNYW55VmFsdWVzKHZhbHVlKTtcbiAgICAgIGlmIChpID09IGZucy5sZW5ndGgpIHtcbiAgICAgICAgeWllbGQqIHZhbHVlcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdmFsdWVzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgeWllbGQqIG5leHQodmFsdWVzW2pdLCBmbnMsIGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZS5uZXh0ID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgLy8gZ2VuZXJhdG9yXG4gICAgICBmb3IgKDs7KSB7XG4gICAgICAgIGxldCBkYXRhID0gdmFsdWUubmV4dCgpO1xuICAgICAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YS50aGVuID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGRhdGEgPSBhd2FpdCBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLmRvbmUpIGJyZWFrO1xuICAgICAgICBpZiAoaSA9PSBmbnMubGVuZ3RoKSB7XG4gICAgICAgICAgeWllbGQgZGF0YS52YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB5aWVsZCogbmV4dChkYXRhLnZhbHVlLCBmbnMsIGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKGkgPT0gZm5zLmxlbmd0aCkge1xuICAgICAgeWllbGQgdmFsdWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgZiA9IGZuc1tpXTtcbiAgICB2YWx1ZSA9IGYodmFsdWUpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2VuID0gKC4uLmZuczogYW55KSA9PiB7XG4gIGZucyA9IGZuc1xuICAgIC5maWx0ZXIoKGZuOiBhbnkpID0+IGZuKVxuICAgIC5mbGF0KEluZmluaXR5KVxuICAgIC5tYXAoKGZuOiBhbnkpID0+IChpc0Z1bmN0aW9uTGlzdChmbikgPyBnZXRGdW5jdGlvbkxpc3QoZm4pIDogZm4pKVxuICAgIC5mbGF0KEluZmluaXR5KTtcbiAgaWYgKCFmbnMubGVuZ3RoKSB7XG4gICAgZm5zID0gWyh4OiBhbnkpID0+IHhdO1xuICB9XG4gIGxldCBmbHVzaGVkID0gZmFsc2U7XG4gIGxldCBnID0gYXN5bmMgZnVuY3Rpb24qICh2YWx1ZTogYW55KSB7XG4gICAgaWYgKGZsdXNoZWQpIHRocm93IEVycm9yKFwiQ2FsbCB0byBhIGZsdXNoZWQgcGlwZS5cIik7XG4gICAgaWYgKHZhbHVlICE9PSBub25lKSB7XG4gICAgICB5aWVsZCogbmV4dCh2YWx1ZSwgZm5zLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmx1c2hlZCA9IHRydWU7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZucy5sZW5ndGg7ICsraSkge1xuICAgICAgICBjb25zdCBmID0gZm5zW2ldO1xuICAgICAgICBpZiAoaXNGbHVzaGFibGUoZikpIHtcbiAgICAgICAgICB5aWVsZCogbmV4dChmKG5vbmUpLCBmbnMsIGkgKyAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgbmVlZFRvRmx1c2ggPSBmbnMuc29tZSgoZm46IGFueSkgPT4gaXNGbHVzaGFibGUoZm4pKTtcbiAgaWYgKG5lZWRUb0ZsdXNoKSBnID0gZmx1c2hhYmxlKGcpO1xuICByZXR1cm4gc2V0RnVuY3Rpb25MaXN0KGcsIGZucyk7XG59O1xuXG5jb25zdCB3cml0ZSA9IChpbnB1dDogYW55LCBjaHVuazogYW55LCBlbmNvZGluZzogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gIGxldCBlcnJvcjogYW55ID0gbnVsbDtcbiAgdHJ5IHtcbiAgICBpbnB1dC53cml0ZShjaHVuaywgZW5jb2RpbmcsIChlOiBhbnkpID0+IGNhbGxiYWNrKGUgfHwgZXJyb3IpKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGVycm9yID0gZTtcbiAgfVxufTtcblxuY29uc3QgZmluYWwgPSAoaW5wdXQ6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICBsZXQgZXJyb3I6IGFueSA9IG51bGw7XG4gIHRyeSB7XG4gICAgaW5wdXQuZW5kKG51bGwsIG51bGwsIChlOiBhbnkpID0+IGNhbGxiYWNrKGUgfHwgZXJyb3IpKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGVycm9yID0gZTtcbiAgfVxufTtcblxuY29uc3QgcmVhZCA9IChvdXRwdXQ6IGFueSkgPT4ge1xuICBvdXRwdXQucmVzdW1lKCk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjaGFpbihmbnM6IGFueSkge1xuICBmbnMgPSBmbnMuZmxhdChJbmZpbml0eSkuZmlsdGVyKChmbjogYW55KSA9PiBmbik7XG5cbiAgY29uc3Qgc3RyZWFtcyA9IGZuc1xuICAgICAgLm1hcCgoZm46IGFueSkgPT4gKGlzRnVuY3Rpb25MaXN0KGZuKSA/IGdldEZ1bmN0aW9uTGlzdChmbikgOiBmbikpXG4gICAgICAuZmxhdChJbmZpbml0eSlcbiAgICAgIC5yZWR1Y2UoZ3JvdXBGdW5jdGlvbnMsIFtdKVxuICAgICAgLm1hcChwcm9kdWNlU3RyZWFtcylcbiAgICAgIC5maWx0ZXIoKHM6IGFueSkgPT4gcyksXG4gICAgaW5wdXQgPSBzdHJlYW1zWzBdLFxuICAgIG91dHB1dCA9IHN0cmVhbXMucmVkdWNlKChvdXRwdXQ6IGFueSwgaXRlbTogYW55KSA9PiAob3V0cHV0ICYmIG91dHB1dC5waXBlKGl0ZW0pKSB8fCBpdGVtKTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG4gIGxldCBzdHJlYW06IER1cGxleDsgLy8gd2lsbCBiZSBhc3NpZ25lZCBsYXRlclxuXG4gIGxldCB3cml0ZU1ldGhvZCA9IChjaHVuazogYW55LCBlbmNvZGluZzogYW55LCBjYWxsYmFjazogYW55KSA9PiB3cml0ZShpbnB1dCwgY2h1bmssIGVuY29kaW5nLCBjYWxsYmFjayksXG4gICAgZmluYWxNZXRob2QgPSAoY2FsbGJhY2s6IGFueSkgPT4gZmluYWwoaW5wdXQsIGNhbGxiYWNrKSxcbiAgICByZWFkTWV0aG9kID0gKCkgPT4gcmVhZChvdXRwdXQpO1xuXG4gIGlmICghaXNXcml0YWJsZU5vZGVTdHJlYW0oaW5wdXQpKSB7XG4gICAgd3JpdGVNZXRob2QgPSAoXzEsIF8yLCBjYWxsYmFjaykgPT4gY2FsbGJhY2sobnVsbCk7XG4gICAgZmluYWxNZXRob2QgPSAoY2FsbGJhY2spID0+IGNhbGxiYWNrKG51bGwpO1xuICAgIGlucHV0Lm9uKFwiZW5kXCIsICgpID0+IHN0cmVhbS5lbmQoKSk7XG4gIH1cblxuICBpZiAoaXNSZWFkYWJsZU5vZGVTdHJlYW0ob3V0cHV0KSkge1xuICAgIG91dHB1dC5vbihcImRhdGFcIiwgKGNodW5rOiBhbnkpID0+ICFzdHJlYW0ucHVzaChjaHVuaykgJiYgb3V0cHV0LnBhdXNlKCkpO1xuICAgIG91dHB1dC5vbihcImVuZFwiLCAoKSA9PiBzdHJlYW0ucHVzaChudWxsKSk7XG4gIH0gZWxzZSB7XG4gICAgcmVhZE1ldGhvZCA9ICgpID0+IHt9OyAvLyBub3BcbiAgICBvdXRwdXQub24oXCJmaW5pc2hcIiwgKCkgPT4gc3RyZWFtLnB1c2gobnVsbCkpO1xuICB9XG5cbiAgc3RyZWFtID0gbmV3IER1cGxleChcbiAgICBPYmplY3QuYXNzaWduKFxuICAgICAgeyB3cml0YWJsZU9iamVjdE1vZGU6IHRydWUsIHJlYWRhYmxlT2JqZWN0TW9kZTogdHJ1ZSB9LFxuICAgICAge1xuICAgICAgICByZWFkYWJsZTogaXNSZWFkYWJsZU5vZGVTdHJlYW0ob3V0cHV0KSxcbiAgICAgICAgd3JpdGFibGU6IGlzV3JpdGFibGVOb2RlU3RyZWFtKGlucHV0KSxcbiAgICAgICAgd3JpdGU6IHdyaXRlTWV0aG9kLFxuICAgICAgICBmaW5hbDogZmluYWxNZXRob2QsXG4gICAgICAgIHJlYWQ6IHJlYWRNZXRob2QsXG4gICAgICB9LFxuICAgICksXG4gICk7XG4gIC8vIEB0cy1pZ25vcmVcbiAgc3RyZWFtLnN0cmVhbXMgPSBzdHJlYW1zO1xuICAvLyBAdHMtaWdub3JlXG4gIHN0cmVhbS5pbnB1dCA9IGlucHV0O1xuICAvLyBAdHMtaWdub3JlXG4gIHN0cmVhbS5vdXRwdXQgPSBvdXRwdXQ7XG5cbiAgaWYgKCFpc1JlYWRhYmxlTm9kZVN0cmVhbShvdXRwdXQpKSB7XG4gICAgc3RyZWFtLnJlc3VtZSgpO1xuICB9XG5cbiAgLy8gY29ubmVjdCBldmVudHNcbiAgc3RyZWFtcy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IGl0ZW0ub24oXCJlcnJvclwiLCAoZXJyb3I6IGFueSkgPT4gc3RyZWFtLmVtaXQoXCJlcnJvclwiLCBlcnJvcikpKTtcblxuICByZXR1cm4gc3RyZWFtO1xufVxuIiwgIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudCAqL1xuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tY29udHJvbC1yZWdleCAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdXNlbGVzcy1lc2NhcGUgKi9cbmltcG9ydCB7IGZsdXNoYWJsZSwgZ2VuLCBtYW55LCBub25lLCBjb21iaW5lTWFueU11dCB9IGZyb20gXCIuL3N0cmVhbS1jaGFpblwiO1xuaW1wb3J0IHsgU3RyaW5nRGVjb2RlciB9IGZyb20gXCJub2RlOnN0cmluZ19kZWNvZGVyXCI7XG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gXCJub2RlOmV2ZW50c1wiO1xuXG5jb25zdCBmaXhVdGY4U3RyZWFtID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdEZWNvZGVyID0gbmV3IFN0cmluZ0RlY29kZXIoKTtcbiAgbGV0IGlucHV0ID0gXCJcIjtcbiAgcmV0dXJuIGZsdXNoYWJsZSgoY2h1bms6IGFueSkgPT4ge1xuICAgIGlmIChjaHVuayA9PT0gbm9uZSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gaW5wdXQgKyBzdHJpbmdEZWNvZGVyLmVuZCgpO1xuICAgICAgaW5wdXQgPSBcIlwiO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjaHVuayA9PSBcInN0cmluZ1wiKSB7XG4gICAgICBpZiAoIWlucHV0KSByZXR1cm4gY2h1bms7XG4gICAgICBjb25zdCByZXN1bHQgPSBpbnB1dCArIGNodW5rO1xuICAgICAgaW5wdXQgPSBcIlwiO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgaWYgKGNodW5rIGluc3RhbmNlb2YgQnVmZmVyKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBpbnB1dCArIHN0cmluZ0RlY29kZXIud3JpdGUoY2h1bmspO1xuICAgICAgaW5wdXQgPSBcIlwiO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIGEgc3RyaW5nIG9yIGEgQnVmZmVyXCIpO1xuICB9KTtcbn07XG5cbmNvbnN0IHBhdHRlcm5zID0ge1xuICB2YWx1ZTE6IC9bXFxcIlxce1xcW1xcXVxcLVxcZF18dHJ1ZVxcYnxmYWxzZVxcYnxudWxsXFxifFxcc3sxLDI1Nn0veSxcbiAgc3RyaW5nOiAvW15cXHgwMC1cXHgxZlxcXCJcXFxcXXsxLDI1Nn18XFxcXFtiZm5ydFxcXCJcXFxcXFwvXXxcXFxcdVtcXGRhLWZBLUZdezR9fFxcXCIveSxcbiAga2V5MTogL1tcXFwiXFx9XXxcXHN7MSwyNTZ9L3ksXG4gIGNvbG9uOiAvXFw6fFxcc3sxLDI1Nn0veSxcbiAgY29tbWE6IC9bXFwsXFxdXFx9XXxcXHN7MSwyNTZ9L3ksXG4gIHdzOiAvXFxzezEsMjU2fS95LFxuICBudW1iZXJTdGFydDogL1xcZC95LFxuICBudW1iZXJEaWdpdDogL1xcZHswLDI1Nn0veSxcbiAgbnVtYmVyRnJhY3Rpb246IC9bXFwuZUVdL3ksXG4gIG51bWJlckV4cG9uZW50OiAvW2VFXS95LFxuICBudW1iZXJFeHBTaWduOiAvWy0rXS95LFxufTtcbmNvbnN0IE1BWF9QQVRURVJOX1NJWkUgPSAxNjtcblxuY29uc3QgdmFsdWVzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0geyB0cnVlOiB0cnVlLCBmYWxzZTogZmFsc2UsIG51bGw6IG51bGwgfSxcbiAgZXhwZWN0ZWQ6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7IG9iamVjdDogXCJvYmplY3RTdG9wXCIsIGFycmF5OiBcImFycmF5U3RvcFwiLCBcIlwiOiBcImRvbmVcIiB9O1xuXG4vLyBsb25nIGhleGFkZWNpbWFsIGNvZGVzOiBcXHVYWFhYXG5jb25zdCBmcm9tSGV4ID0gKHM6IHN0cmluZykgPT4gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChzLnNsaWNlKDIpLCAxNikpO1xuXG4vLyBzaG9ydCBjb2RlczogXFxiIFxcZiBcXG4gXFxyIFxcdCBcXFwiIFxcXFwgXFwvXG5jb25zdCBjb2RlczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgYjogXCJcXGJcIixcbiAgZjogXCJcXGZcIixcbiAgbjogXCJcXG5cIixcbiAgcjogXCJcXHJcIixcbiAgdDogXCJcXHRcIixcbiAgJ1wiJzogJ1wiJyxcbiAgXCJcXFxcXCI6IFwiXFxcXFwiLFxuICBcIi9cIjogXCIvXCIsXG59O1xuXG5jb25zdCBqc29uUGFyc2VyID0gKG9wdGlvbnM/OiBhbnkpID0+IHtcbiAgbGV0IHBhY2tLZXlzID0gdHJ1ZSxcbiAgICBwYWNrU3RyaW5ncyA9IHRydWUsXG4gICAgcGFja051bWJlcnMgPSB0cnVlLFxuICAgIHN0cmVhbUtleXMgPSB0cnVlLFxuICAgIHN0cmVhbVN0cmluZ3MgPSB0cnVlLFxuICAgIHN0cmVhbU51bWJlcnMgPSB0cnVlLFxuICAgIGpzb25TdHJlYW1pbmcgPSBmYWxzZTtcblxuICBpZiAob3B0aW9ucykge1xuICAgIFwicGFja1ZhbHVlc1wiIGluIG9wdGlvbnMgJiYgKHBhY2tLZXlzID0gcGFja1N0cmluZ3MgPSBwYWNrTnVtYmVycyA9IG9wdGlvbnMucGFja1ZhbHVlcyk7XG4gICAgXCJwYWNrS2V5c1wiIGluIG9wdGlvbnMgJiYgKHBhY2tLZXlzID0gb3B0aW9ucy5wYWNrS2V5cyk7XG4gICAgXCJwYWNrU3RyaW5nc1wiIGluIG9wdGlvbnMgJiYgKHBhY2tTdHJpbmdzID0gb3B0aW9ucy5wYWNrU3RyaW5ncyk7XG4gICAgXCJwYWNrTnVtYmVyc1wiIGluIG9wdGlvbnMgJiYgKHBhY2tOdW1iZXJzID0gb3B0aW9ucy5wYWNrTnVtYmVycyk7XG4gICAgXCJzdHJlYW1WYWx1ZXNcIiBpbiBvcHRpb25zICYmIChzdHJlYW1LZXlzID0gc3RyZWFtU3RyaW5ncyA9IHN0cmVhbU51bWJlcnMgPSBvcHRpb25zLnN0cmVhbVZhbHVlcyk7XG4gICAgXCJzdHJlYW1LZXlzXCIgaW4gb3B0aW9ucyAmJiAoc3RyZWFtS2V5cyA9IG9wdGlvbnMuc3RyZWFtS2V5cyk7XG4gICAgXCJzdHJlYW1TdHJpbmdzXCIgaW4gb3B0aW9ucyAmJiAoc3RyZWFtU3RyaW5ncyA9IG9wdGlvbnMuc3RyZWFtU3RyaW5ncyk7XG4gICAgXCJzdHJlYW1OdW1iZXJzXCIgaW4gb3B0aW9ucyAmJiAoc3RyZWFtTnVtYmVycyA9IG9wdGlvbnMuc3RyZWFtTnVtYmVycyk7XG4gICAganNvblN0cmVhbWluZyA9IG9wdGlvbnMuanNvblN0cmVhbWluZztcbiAgfVxuXG4gICFwYWNrS2V5cyAmJiAoc3RyZWFtS2V5cyA9IHRydWUpO1xuICAhcGFja1N0cmluZ3MgJiYgKHN0cmVhbVN0cmluZ3MgPSB0cnVlKTtcbiAgIXBhY2tOdW1iZXJzICYmIChzdHJlYW1OdW1iZXJzID0gdHJ1ZSk7XG5cbiAgbGV0IGRvbmUgPSBmYWxzZSxcbiAgICBleHBlY3QgPSBqc29uU3RyZWFtaW5nID8gXCJkb25lXCIgOiBcInZhbHVlXCIsXG4gICAgcGFyZW50ID0gXCJcIixcbiAgICBvcGVuTnVtYmVyID0gZmFsc2UsXG4gICAgYWNjdW11bGF0b3IgPSBcIlwiLFxuICAgIGJ1ZmZlciA9IFwiXCI7XG5cbiAgY29uc3Qgc3RhY2s6IGFueVtdID0gW107XG5cbiAgcmV0dXJuIGZsdXNoYWJsZSgoYnVmOiBhbnkpID0+IHtcbiAgICBjb25zdCB0b2tlbnM6IGFueVtdID0gW107XG5cbiAgICBpZiAoYnVmID09PSBub25lKSB7XG4gICAgICBkb25lID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnVmZmVyICs9IGJ1ZjtcbiAgICB9XG5cbiAgICBsZXQgbWF0Y2g6IGFueTtcbiAgICBsZXQgdmFsdWU6IGFueTtcbiAgICBsZXQgaW5kZXggPSAwO1xuXG4gICAgbWFpbjogZm9yICg7Oykge1xuICAgICAgc3dpdGNoIChleHBlY3QpIHtcbiAgICAgICAgY2FzZSBcInZhbHVlMVwiOlxuICAgICAgICBjYXNlIFwidmFsdWVcIjpcbiAgICAgICAgICBwYXR0ZXJucy52YWx1ZTEubGFzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgbWF0Y2ggPSBwYXR0ZXJucy52YWx1ZTEuZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChkb25lIHx8IGluZGV4ICsgTUFYX1BBVFRFUk5fU0laRSA8IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgaWYgKGluZGV4IDwgYnVmZmVyLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGNhbm5vdCBwYXJzZSBpbnB1dDogZXhwZWN0ZWQgYSB2YWx1ZVwiKTtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGhhcyBleHBlY3RlZCBhIHZhbHVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAgICAgICAgaWYgKHN0cmVhbVN0cmluZ3MpIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydFN0cmluZ1wiIH0pO1xuICAgICAgICAgICAgICBleHBlY3QgPSBcInN0cmluZ1wiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ7XCI6XG4gICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydE9iamVjdFwiIH0pO1xuICAgICAgICAgICAgICBzdGFjay5wdXNoKHBhcmVudCk7XG4gICAgICAgICAgICAgIHBhcmVudCA9IFwib2JqZWN0XCI7XG4gICAgICAgICAgICAgIGV4cGVjdCA9IFwia2V5MVwiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJbXCI6XG4gICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydEFycmF5XCIgfSk7XG4gICAgICAgICAgICAgIHN0YWNrLnB1c2gocGFyZW50KTtcbiAgICAgICAgICAgICAgcGFyZW50ID0gXCJhcnJheVwiO1xuICAgICAgICAgICAgICBleHBlY3QgPSBcInZhbHVlMVwiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJdXCI6XG4gICAgICAgICAgICAgIGlmIChleHBlY3QgIT09IFwidmFsdWUxXCIpIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBjYW5ub3QgcGFyc2UgaW5wdXQ6IHVuZXhwZWN0ZWQgdG9rZW4gJ10nXCIpO1xuICAgICAgICAgICAgICBpZiAob3Blbk51bWJlcikge1xuICAgICAgICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kTnVtYmVyXCIgfSk7XG4gICAgICAgICAgICAgICAgb3Blbk51bWJlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChwYWNrTnVtYmVycykge1xuICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlclZhbHVlXCIsIHZhbHVlOiBhY2N1bXVsYXRvciB9KTtcbiAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcImVuZEFycmF5XCIgfSk7XG4gICAgICAgICAgICAgIHBhcmVudCA9IHN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgICBleHBlY3QgPSBleHBlY3RlZFtwYXJlbnRdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCItXCI6XG4gICAgICAgICAgICAgIG9wZW5OdW1iZXIgPSB0cnVlO1xuICAgICAgICAgICAgICBpZiAoc3RyZWFtTnVtYmVycykge1xuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydE51bWJlclwiIH0sIHsgbmFtZTogXCJudW1iZXJDaHVua1wiLCB2YWx1ZTogXCItXCIgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcGFja051bWJlcnMgJiYgKGFjY3VtdWxhdG9yID0gXCItXCIpO1xuICAgICAgICAgICAgICBleHBlY3QgPSBcIm51bWJlclN0YXJ0XCI7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIjBcIjpcbiAgICAgICAgICAgICAgb3Blbk51bWJlciA9IHRydWU7XG4gICAgICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB7XG4gICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcInN0YXJ0TnVtYmVyXCIgfSwgeyBuYW1lOiBcIm51bWJlckNodW5rXCIsIHZhbHVlOiBcIjBcIiB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBwYWNrTnVtYmVycyAmJiAoYWNjdW11bGF0b3IgPSBcIjBcIik7XG4gICAgICAgICAgICAgIGV4cGVjdCA9IFwibnVtYmVyRnJhY3Rpb25cIjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiMVwiOlxuICAgICAgICAgICAgY2FzZSBcIjJcIjpcbiAgICAgICAgICAgIGNhc2UgXCIzXCI6XG4gICAgICAgICAgICBjYXNlIFwiNFwiOlxuICAgICAgICAgICAgY2FzZSBcIjVcIjpcbiAgICAgICAgICAgIGNhc2UgXCI2XCI6XG4gICAgICAgICAgICBjYXNlIFwiN1wiOlxuICAgICAgICAgICAgY2FzZSBcIjhcIjpcbiAgICAgICAgICAgIGNhc2UgXCI5XCI6XG4gICAgICAgICAgICAgIG9wZW5OdW1iZXIgPSB0cnVlO1xuICAgICAgICAgICAgICBpZiAoc3RyZWFtTnVtYmVycykge1xuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydE51bWJlclwiIH0sIHsgbmFtZTogXCJudW1iZXJDaHVua1wiLCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcGFja051bWJlcnMgJiYgKGFjY3VtdWxhdG9yID0gdmFsdWUpO1xuICAgICAgICAgICAgICBleHBlY3QgPSBcIm51bWJlckRpZ2l0XCI7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInRydWVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJmYWxzZVwiOlxuICAgICAgICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgICAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGggLSBpbmRleCA9PT0gdmFsdWUubGVuZ3RoICYmICFkb25lKSBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogdmFsdWUgKyBcIlZhbHVlXCIsIHZhbHVlOiB2YWx1ZXNbdmFsdWVdIH0pO1xuICAgICAgICAgICAgICBleHBlY3QgPSBleHBlY3RlZFtwYXJlbnRdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IC8vIHdzXG4gICAgICAgICAgfVxuICAgICAgICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImtleVZhbFwiOlxuICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgcGF0dGVybnMuc3RyaW5nLmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMuc3RyaW5nLmV4ZWMoYnVmZmVyKTtcbiAgICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCBidWZmZXIubGVuZ3RoICYmIChkb25lIHx8IGJ1ZmZlci5sZW5ndGggLSBpbmRleCA+PSA2KSlcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGNhbm5vdCBwYXJzZSBpbnB1dDogZXNjYXBlZCBjaGFyYWN0ZXJzXCIpO1xuICAgICAgICAgICAgaWYgKGRvbmUpIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBoYXMgZXhwZWN0ZWQgYSBzdHJpbmcgdmFsdWVcIik7XG4gICAgICAgICAgICBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKHZhbHVlID09PSAnXCInKSB7XG4gICAgICAgICAgICBpZiAoZXhwZWN0ID09PSBcImtleVZhbFwiKSB7XG4gICAgICAgICAgICAgIGlmIChzdHJlYW1LZXlzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kS2V5XCIgfSk7XG4gICAgICAgICAgICAgIGlmIChwYWNrS2V5cykge1xuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJrZXlWYWx1ZVwiLCB2YWx1ZTogYWNjdW11bGF0b3IgfSk7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBcIlwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGV4cGVjdCA9IFwiY29sb25cIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmIChzdHJlYW1TdHJpbmdzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kU3RyaW5nXCIgfSk7XG4gICAgICAgICAgICAgIGlmIChwYWNrU3RyaW5ncykge1xuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdHJpbmdWYWx1ZVwiLCB2YWx1ZTogYWNjdW11bGF0b3IgfSk7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBcIlwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGV4cGVjdCA9IGV4cGVjdGVkW3BhcmVudF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiAxICYmIHZhbHVlLmNoYXJBdCgwKSA9PT0gXCJcXFxcXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB2YWx1ZS5sZW5ndGggPT0gMiA/IGNvZGVzW3ZhbHVlLmNoYXJBdCgxKV0gOiBmcm9tSGV4KHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChleHBlY3QgPT09IFwia2V5VmFsXCIgPyBzdHJlYW1LZXlzIDogc3RyZWFtU3RyaW5ncykge1xuICAgICAgICAgICAgICB0b2tlbnMucHVzaCh7IG5hbWU6IFwic3RyaW5nQ2h1bmtcIiwgdmFsdWU6IHQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhwZWN0ID09PSBcImtleVZhbFwiID8gcGFja0tleXMgOiBwYWNrU3RyaW5ncykge1xuICAgICAgICAgICAgICBhY2N1bXVsYXRvciArPSB0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZXhwZWN0ID09PSBcImtleVZhbFwiID8gc3RyZWFtS2V5cyA6IHN0cmVhbVN0cmluZ3MpIHtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcInN0cmluZ0NodW5rXCIsIHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChleHBlY3QgPT09IFwia2V5VmFsXCIgPyBwYWNrS2V5cyA6IHBhY2tTdHJpbmdzKSB7XG4gICAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJrZXkxXCI6XG4gICAgICAgIGNhc2UgXCJrZXlcIjpcbiAgICAgICAgICBwYXR0ZXJucy5rZXkxLmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMua2V5MS5leGVjKGJ1ZmZlcik7XG4gICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgYnVmZmVyLmxlbmd0aCB8fCBkb25lKSB0aHJvdyBuZXcgRXJyb3IoXCJQYXJzZXIgY2Fubm90IHBhcnNlIGlucHV0OiBleHBlY3RlZCBhbiBvYmplY3Qga2V5XCIpO1xuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ1wiJykge1xuICAgICAgICAgICAgaWYgKHN0cmVhbUtleXMpIHRva2Vucy5wdXNoKHsgbmFtZTogXCJzdGFydEtleVwiIH0pO1xuICAgICAgICAgICAgZXhwZWN0ID0gXCJrZXlWYWxcIjtcbiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBcIn1cIikge1xuICAgICAgICAgICAgaWYgKGV4cGVjdCAhPT0gXCJrZXkxXCIpIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBjYW5ub3QgcGFyc2UgaW5wdXQ6IHVuZXhwZWN0ZWQgdG9rZW4gJ30nXCIpO1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcImVuZE9iamVjdFwiIH0pO1xuICAgICAgICAgICAgcGFyZW50ID0gc3RhY2sucG9wKCk7XG4gICAgICAgICAgICBleHBlY3QgPSBleHBlY3RlZFtwYXJlbnRdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvblwiOlxuICAgICAgICAgIHBhdHRlcm5zLmNvbG9uLmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMuY29sb24uZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGggfHwgZG9uZSkgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGNhbm5vdCBwYXJzZSBpbnB1dDogZXhwZWN0ZWQgJzonXCIpO1xuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIHZhbHVlID09PSBcIjpcIiAmJiAoZXhwZWN0ID0gXCJ2YWx1ZVwiKTtcbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJhcnJheVN0b3BcIjpcbiAgICAgICAgY2FzZSBcIm9iamVjdFN0b3BcIjpcbiAgICAgICAgICBwYXR0ZXJucy5jb21tYS5sYXN0SW5kZXggPSBpbmRleDtcbiAgICAgICAgICBtYXRjaCA9IHBhdHRlcm5zLmNvbW1hLmV4ZWMoYnVmZmVyKTtcbiAgICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCBidWZmZXIubGVuZ3RoIHx8IGRvbmUpIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBjYW5ub3QgcGFyc2UgaW5wdXQ6IGV4cGVjdGVkICcsJ1wiKTtcbiAgICAgICAgICAgIGJyZWFrIG1haW47IC8vIHdhaXQgZm9yIG1vcmUgaW5wdXRcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZW5OdW1iZXIpIHtcbiAgICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kTnVtYmVyXCIgfSk7XG4gICAgICAgICAgICBvcGVuTnVtYmVyID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAocGFja051bWJlcnMpIHtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlclZhbHVlXCIsIHZhbHVlOiBhY2N1bXVsYXRvciB9KTtcbiAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCIsXCIpIHtcbiAgICAgICAgICAgIGV4cGVjdCA9IGV4cGVjdCA9PT0gXCJhcnJheVN0b3BcIiA/IFwidmFsdWVcIiA6IFwia2V5XCI7XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gXCJ9XCIgfHwgdmFsdWUgPT09IFwiXVwiKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IFwifVwiID8gZXhwZWN0ID09PSBcImFycmF5U3RvcFwiIDogZXhwZWN0ICE9PSBcImFycmF5U3RvcFwiKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBjYW5ub3QgcGFyc2UgaW5wdXQ6IGV4cGVjdGVkICdcIiArIChleHBlY3QgPT09IFwiYXJyYXlTdG9wXCIgPyBcIl1cIiA6IFwifVwiKSArIFwiJ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgbmFtZTogdmFsdWUgPT09IFwifVwiID8gXCJlbmRPYmplY3RcIiA6IFwiZW5kQXJyYXlcIiB9KTtcbiAgICAgICAgICAgIHBhcmVudCA9IHN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgZXhwZWN0ID0gZXhwZWN0ZWRbcGFyZW50XTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5kZXggKz0gdmFsdWUubGVuZ3RoO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICAvLyBudW1iZXIgY2h1bmtzXG4gICAgICAgIGNhc2UgXCJudW1iZXJTdGFydFwiOiAvLyBbMC05XVxuICAgICAgICAgIHBhdHRlcm5zLm51bWJlclN0YXJ0Lmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMubnVtYmVyU3RhcnQuZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGggfHwgZG9uZSkgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGNhbm5vdCBwYXJzZSBpbnB1dDogZXhwZWN0ZWQgYSBzdGFydGluZyBkaWdpdFwiKTtcbiAgICAgICAgICAgIGJyZWFrIG1haW47IC8vIHdhaXQgZm9yIG1vcmUgaW5wdXRcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFsdWUgPSBtYXRjaFswXTtcbiAgICAgICAgICBpZiAoc3RyZWFtTnVtYmVycykgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlckNodW5rXCIsIHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgICBwYWNrTnVtYmVycyAmJiAoYWNjdW11bGF0b3IgKz0gdmFsdWUpO1xuICAgICAgICAgIGV4cGVjdCA9IHZhbHVlID09PSBcIjBcIiA/IFwibnVtYmVyRnJhY3Rpb25cIiA6IFwibnVtYmVyRGlnaXRcIjtcbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJudW1iZXJEaWdpdFwiOiAvLyBbMC05XSpcbiAgICAgICAgICBwYXR0ZXJucy5udW1iZXJEaWdpdC5sYXN0SW5kZXggPSBpbmRleDtcbiAgICAgICAgICBtYXRjaCA9IHBhdHRlcm5zLm51bWJlckRpZ2l0LmV4ZWMoYnVmZmVyKTtcbiAgICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCBidWZmZXIubGVuZ3RoIHx8IGRvbmUpIHRocm93IG5ldyBFcnJvcihcIlBhcnNlciBjYW5ub3QgcGFyc2UgaW5wdXQ6IGV4cGVjdGVkIGEgZGlnaXRcIik7XG4gICAgICAgICAgICBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoc3RyZWFtTnVtYmVycykgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlckNodW5rXCIsIHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgIHBhY2tOdW1iZXJzICYmIChhY2N1bXVsYXRvciArPSB2YWx1ZSk7XG4gICAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZXhwZWN0ID0gXCJudW1iZXJGcmFjdGlvblwiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAgIGV4cGVjdCA9IGV4cGVjdGVkW3BhcmVudF07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm51bWJlckZyYWN0aW9uXCI6IC8vIFtcXC5lRV0/XG4gICAgICAgICAgcGF0dGVybnMubnVtYmVyRnJhY3Rpb24ubGFzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgbWF0Y2ggPSBwYXR0ZXJucy5udW1iZXJGcmFjdGlvbi5leGVjKGJ1ZmZlcik7XG4gICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgYnVmZmVyLmxlbmd0aCB8fCBkb25lKSB7XG4gICAgICAgICAgICAgIGV4cGVjdCA9IGV4cGVjdGVkW3BhcmVudF07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwibnVtYmVyQ2h1bmtcIiwgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICAgIHBhY2tOdW1iZXJzICYmIChhY2N1bXVsYXRvciArPSB2YWx1ZSk7XG4gICAgICAgICAgZXhwZWN0ID0gdmFsdWUgPT09IFwiLlwiID8gXCJudW1iZXJGcmFjU3RhcnRcIiA6IFwibnVtYmVyRXhwU2lnblwiO1xuICAgICAgICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm51bWJlckZyYWNTdGFydFwiOiAvLyBbMC05XVxuICAgICAgICAgIHBhdHRlcm5zLm51bWJlclN0YXJ0Lmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMubnVtYmVyU3RhcnQuZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGggfHwgZG9uZSlcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGFyc2VyIGNhbm5vdCBwYXJzZSBpbnB1dDogZXhwZWN0ZWQgYSBmcmFjdGlvbmFsIHBhcnQgb2YgYSBudW1iZXJcIik7XG4gICAgICAgICAgICBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKHN0cmVhbU51bWJlcnMpIHRva2Vucy5wdXNoKHsgbmFtZTogXCJudW1iZXJDaHVua1wiLCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgICAgcGFja051bWJlcnMgJiYgKGFjY3VtdWxhdG9yICs9IHZhbHVlKTtcbiAgICAgICAgICBleHBlY3QgPSBcIm51bWJlckZyYWNEaWdpdFwiO1xuICAgICAgICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm51bWJlckZyYWNEaWdpdFwiOiAvLyBbMC05XSpcbiAgICAgICAgICBwYXR0ZXJucy5udW1iZXJEaWdpdC5sYXN0SW5kZXggPSBpbmRleDtcbiAgICAgICAgICBtYXRjaCA9IHBhdHRlcm5zLm51bWJlckRpZ2l0LmV4ZWMoYnVmZmVyKTtcbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHN0cmVhbU51bWJlcnMpIHRva2Vucy5wdXNoKHsgbmFtZTogXCJudW1iZXJDaHVua1wiLCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgICAgICBwYWNrTnVtYmVycyAmJiAoYWNjdW11bGF0b3IgKz0gdmFsdWUpO1xuICAgICAgICAgICAgaW5kZXggKz0gdmFsdWUubGVuZ3RoO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCBidWZmZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGV4cGVjdCA9IFwibnVtYmVyRXhwb25lbnRcIjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICBleHBlY3QgPSBleHBlY3RlZFtwYXJlbnRdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrIG1haW47IC8vIHdhaXQgZm9yIG1vcmUgaW5wdXRcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJudW1iZXJFeHBvbmVudFwiOiAvLyBbZUVdP1xuICAgICAgICAgIHBhdHRlcm5zLm51bWJlckV4cG9uZW50Lmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMubnVtYmVyRXhwb25lbnQuZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZXhwZWN0ID0gZXhwZWN0ZWRbcGFyZW50XTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICBleHBlY3QgPSBcImRvbmVcIjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKHN0cmVhbU51bWJlcnMpIHRva2Vucy5wdXNoKHsgbmFtZTogXCJudW1iZXJDaHVua1wiLCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgICAgcGFja051bWJlcnMgJiYgKGFjY3VtdWxhdG9yICs9IHZhbHVlKTtcbiAgICAgICAgICBleHBlY3QgPSBcIm51bWJlckV4cFNpZ25cIjtcbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJudW1iZXJFeHBTaWduXCI6IC8vIFstK10/XG4gICAgICAgICAgcGF0dGVybnMubnVtYmVyRXhwU2lnbi5sYXN0SW5kZXggPSBpbmRleDtcbiAgICAgICAgICBtYXRjaCA9IHBhdHRlcm5zLm51bWJlckV4cFNpZ24uZXhlYyhidWZmZXIpO1xuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZXhwZWN0ID0gXCJudW1iZXJFeHBTdGFydFwiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb25lKSB0aHJvdyBuZXcgRXJyb3IoXCJQYXJzZXIgaGFzIGV4cGVjdGVkIGFuIGV4cG9uZW50IHZhbHVlIG9mIGEgbnVtYmVyXCIpO1xuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwibnVtYmVyQ2h1bmtcIiwgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICAgIHBhY2tOdW1iZXJzICYmIChhY2N1bXVsYXRvciArPSB2YWx1ZSk7XG4gICAgICAgICAgZXhwZWN0ID0gXCJudW1iZXJFeHBTdGFydFwiO1xuICAgICAgICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm51bWJlckV4cFN0YXJ0XCI6IC8vIFswLTldXG4gICAgICAgICAgcGF0dGVybnMubnVtYmVyU3RhcnQubGFzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgbWF0Y2ggPSBwYXR0ZXJucy5udW1iZXJTdGFydC5leGVjKGJ1ZmZlcik7XG4gICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgYnVmZmVyLmxlbmd0aCB8fCBkb25lKVxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXJzZXIgY2Fubm90IHBhcnNlIGlucHV0OiBleHBlY3RlZCBhbiBleHBvbmVudCBwYXJ0IG9mIGEgbnVtYmVyXCIpO1xuICAgICAgICAgICAgYnJlYWsgbWFpbjsgLy8gd2FpdCBmb3IgbW9yZSBpbnB1dFxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoWzBdO1xuICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwibnVtYmVyQ2h1bmtcIiwgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICAgIHBhY2tOdW1iZXJzICYmIChhY2N1bXVsYXRvciArPSB2YWx1ZSk7XG4gICAgICAgICAgZXhwZWN0ID0gXCJudW1iZXJFeHBEaWdpdFwiO1xuICAgICAgICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm51bWJlckV4cERpZ2l0XCI6IC8vIFswLTldKlxuICAgICAgICAgIHBhdHRlcm5zLm51bWJlckRpZ2l0Lmxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgIG1hdGNoID0gcGF0dGVybnMubnVtYmVyRGlnaXQuZXhlYyhidWZmZXIpO1xuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoc3RyZWFtTnVtYmVycykgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlckNodW5rXCIsIHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgIHBhY2tOdW1iZXJzICYmIChhY2N1bXVsYXRvciArPSB2YWx1ZSk7XG4gICAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGJ1ZmZlci5sZW5ndGggfHwgZG9uZSkge1xuICAgICAgICAgICAgICBleHBlY3QgPSBleHBlY3RlZFtwYXJlbnRdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrIG1haW47IC8vIHdhaXQgZm9yIG1vcmUgaW5wdXRcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb25lXCI6XG4gICAgICAgICAgcGF0dGVybnMud3MubGFzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgbWF0Y2ggPSBwYXR0ZXJucy53cy5leGVjKGJ1ZmZlcik7XG4gICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgYnVmZmVyLmxlbmd0aCkge1xuICAgICAgICAgICAgICBpZiAoanNvblN0cmVhbWluZykge1xuICAgICAgICAgICAgICAgIGV4cGVjdCA9IFwidmFsdWVcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXJzZXIgY2Fubm90IHBhcnNlIGlucHV0OiB1bmV4cGVjdGVkIGNoYXJhY3RlcnNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhayBtYWluOyAvLyB3YWl0IGZvciBtb3JlIGlucHV0XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgaWYgKG9wZW5OdW1iZXIpIHtcbiAgICAgICAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kTnVtYmVyXCIgfSk7XG4gICAgICAgICAgICBvcGVuTnVtYmVyID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAocGFja051bWJlcnMpIHtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlclZhbHVlXCIsIHZhbHVlOiBhY2N1bXVsYXRvciB9KTtcbiAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpbmRleCArPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChkb25lICYmIG9wZW5OdW1iZXIpIHtcbiAgICAgIGlmIChzdHJlYW1OdW1iZXJzKSB0b2tlbnMucHVzaCh7IG5hbWU6IFwiZW5kTnVtYmVyXCIgfSk7XG4gICAgICBvcGVuTnVtYmVyID0gZmFsc2U7XG4gICAgICBpZiAocGFja051bWJlcnMpIHtcbiAgICAgICAgdG9rZW5zLnB1c2goeyBuYW1lOiBcIm51bWJlclZhbHVlXCIsIHZhbHVlOiBhY2N1bXVsYXRvciB9KTtcbiAgICAgICAgYWNjdW11bGF0b3IgPSBcIlwiO1xuICAgICAgfVxuICAgIH1cbiAgICBidWZmZXIgPSBidWZmZXIuc2xpY2UoaW5kZXgpO1xuICAgIHJldHVybiB0b2tlbnMubGVuZ3RoID8gbWFueSh0b2tlbnMpIDogbm9uZTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgcGFyc2VyID0gKG9wdGlvbnM/OiBhbnkpID0+IGdlbihmaXhVdGY4U3RyZWFtKCksIGpzb25QYXJzZXIob3B0aW9ucykpO1xuXG5jb25zdCB3aXRoUGFyc2VyID0gKGZuOiBhbnksIG9wdGlvbnM/OiBhbnkpID0+IGdlbihwYXJzZXIob3B0aW9ucyksIGZuKG9wdGlvbnMpKTtcblxuY29uc3QgY2hlY2thYmxlVG9rZW5zID0ge1xuICAgIHN0YXJ0T2JqZWN0OiAxLFxuICAgIHN0YXJ0QXJyYXk6IDEsXG4gICAgc3RhcnRTdHJpbmc6IDEsXG4gICAgc3RhcnROdW1iZXI6IDEsXG4gICAgbnVsbFZhbHVlOiAxLFxuICAgIHRydWVWYWx1ZTogMSxcbiAgICBmYWxzZVZhbHVlOiAxLFxuICAgIHN0cmluZ1ZhbHVlOiAxLFxuICAgIG51bWJlclZhbHVlOiAxLFxuICB9LFxuICBzdG9wVG9rZW5zID0ge1xuICAgIHN0YXJ0T2JqZWN0OiBcImVuZE9iamVjdFwiLFxuICAgIHN0YXJ0QXJyYXk6IFwiZW5kQXJyYXlcIixcbiAgICBzdGFydFN0cmluZzogXCJlbmRTdHJpbmdcIixcbiAgICBzdGFydE51bWJlcjogXCJlbmROdW1iZXJcIixcbiAgfSxcbiAgb3B0aW9uYWxUb2tlbnMgPSB7IGVuZFN0cmluZzogXCJzdHJpbmdWYWx1ZVwiLCBlbmROdW1iZXI6IFwibnVtYmVyVmFsdWVcIiB9O1xuXG5jb25zdCBkZWZhdWx0RmlsdGVyID0gKF9zdGFjazogc3RyaW5nW10sIF9hOiBhbnkpID0+IHRydWU7XG5cbmNvbnN0IHN0cmluZ0ZpbHRlciA9IChzdHJpbmc6IHN0cmluZywgc2VwYXJhdG9yOiBzdHJpbmcpID0+IHtcbiAgY29uc3Qgc3RyaW5nV2l0aFNlcGFyYXRvciA9IHN0cmluZyArIHNlcGFyYXRvcjtcbiAgcmV0dXJuIChzdGFjazogc3RyaW5nW10sIF9hOiBhbnkpID0+IHtcbiAgICBjb25zdCBwYXRoID0gc3RhY2suam9pbihzZXBhcmF0b3IpO1xuICAgIHJldHVybiBwYXRoID09PSBzdHJpbmcgfHwgcGF0aC5zdGFydHNXaXRoKHN0cmluZ1dpdGhTZXBhcmF0b3IpO1xuICB9O1xufTtcblxuY29uc3QgcmVnRXhwRmlsdGVyID0gKHJlZ0V4cDogUmVnRXhwLCBzZXBhcmF0b3I6IHN0cmluZykgPT4ge1xuICByZXR1cm4gKHN0YWNrOiBzdHJpbmdbXSwgX2E6IGFueSkgPT4gcmVnRXhwLnRlc3Qoc3RhY2suam9pbihzZXBhcmF0b3IpKTtcbn07XG5cbmNvbnN0IGZpbHRlckJhc2UgPVxuICAoe1xuICAgIHNwZWNpYWxBY3Rpb24gPSBcImFjY2VwdFwiLFxuICAgIGRlZmF1bHRBY3Rpb24gPSBcImlnbm9yZVwiLFxuICAgIG5vbkNoZWNrYWJsZUFjdGlvbiA9IFwicHJvY2Vzcy1rZXlcIixcbiAgICB0cmFuc2l0aW9uID0gdW5kZWZpbmVkIGFzIGFueSxcbiAgfSA9IHt9KSA9PlxuICAob3B0aW9uczogYW55KSA9PiB7XG4gICAgY29uc3Qgb25jZSA9IG9wdGlvbnM/Lm9uY2UsXG4gICAgICBzZXBhcmF0b3IgPSBvcHRpb25zPy5wYXRoU2VwYXJhdG9yIHx8IFwiLlwiO1xuICAgIGxldCBmaWx0ZXIgPSBkZWZhdWx0RmlsdGVyLFxuICAgICAgc3RyZWFtS2V5cyA9IHRydWU7XG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5maWx0ZXIgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGZpbHRlciA9IG9wdGlvbnMuZmlsdGVyO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy5maWx0ZXIgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBmaWx0ZXIgPSBzdHJpbmdGaWx0ZXIob3B0aW9ucy5maWx0ZXIsIHNlcGFyYXRvcik7XG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZmlsdGVyIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICAgIGZpbHRlciA9IHJlZ0V4cEZpbHRlcihvcHRpb25zLmZpbHRlciwgc2VwYXJhdG9yKTtcbiAgICAgIH1cbiAgICAgIGlmIChcInN0cmVhbVZhbHVlc1wiIGluIG9wdGlvbnMpIHN0cmVhbUtleXMgPSBvcHRpb25zLnN0cmVhbVZhbHVlcztcbiAgICAgIGlmIChcInN0cmVhbUtleXNcIiBpbiBvcHRpb25zKSBzdHJlYW1LZXlzID0gb3B0aW9ucy5zdHJlYW1LZXlzO1xuICAgIH1cbiAgICBjb25zdCBzYW5pdGl6ZWRPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywgeyBmaWx0ZXIsIHN0cmVhbUtleXMsIHNlcGFyYXRvciB9KTtcbiAgICBsZXQgc3RhdGUgPSBcImNoZWNrXCI7XG4gICAgY29uc3Qgc3RhY2s6IGFueVtdID0gW107XG4gICAgbGV0IGRlcHRoID0gMCxcbiAgICAgIHByZXZpb3VzVG9rZW4gPSBcIlwiLFxuICAgICAgZW5kVG9rZW4gPSBcIlwiLFxuICAgICAgb3B0aW9uYWxUb2tlbiA9IFwiXCIsXG4gICAgICBzdGFydFRyYW5zaXRpb24gPSBmYWxzZTtcbiAgICByZXR1cm4gZmx1c2hhYmxlKChjaHVuaykgPT4ge1xuICAgICAgLy8gdGhlIGZsdXNoXG4gICAgICBpZiAoY2h1bmsgPT09IG5vbmUpIHJldHVybiB0cmFuc2l0aW9uID8gdHJhbnNpdGlvbihbXSwgbnVsbCwgXCJmbHVzaFwiLCBzYW5pdGl6ZWRPcHRpb25zKSA6IG5vbmU7XG5cbiAgICAgIC8vIHByb2Nlc3MgdGhlIG9wdGlvbmFsIHZhbHVlIHRva2VuICh1bmZpbmlzaGVkKVxuICAgICAgaWYgKG9wdGlvbmFsVG9rZW4pIHtcbiAgICAgICAgaWYgKG9wdGlvbmFsVG9rZW4gPT09IGNodW5rLm5hbWUpIHtcbiAgICAgICAgICBsZXQgcmV0dXJuVG9rZW4gPSBub25lO1xuICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJwcm9jZXNzLWtleVwiOlxuICAgICAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAxXSA9IGNodW5rLnZhbHVlO1xuICAgICAgICAgICAgICBzdGF0ZSA9IFwiY2hlY2tcIjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYWNjZXB0LXZhbHVlXCI6XG4gICAgICAgICAgICAgIHJldHVyblRva2VuID0gY2h1bms7XG4gICAgICAgICAgICAgIHN0YXRlID0gb25jZSA/IFwicGFzc1wiIDogXCJjaGVja1wiO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHN0YXRlID0gb25jZSA/IFwiYWxsXCIgOiBcImNoZWNrXCI7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRpb25hbFRva2VuID0gXCJcIjtcbiAgICAgICAgICByZXR1cm4gcmV0dXJuVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9uYWxUb2tlbiA9IFwiXCI7XG4gICAgICAgIHN0YXRlID0gb25jZSAmJiBzdGF0ZSAhPT0gXCJwcm9jZXNzLWtleVwiID8gXCJwYXNzXCIgOiBcImNoZWNrXCI7XG4gICAgICB9XG5cbiAgICAgIGxldCByZXR1cm5Ub2tlbjogYW55ID0gbm9uZTtcblxuICAgICAgcmVjaGVjazogZm9yICg7Oykge1xuICAgICAgICAvLyBhY2NlcHQvcmVqZWN0IHRva2Vuc1xuICAgICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgICAgY2FzZSBcInByb2Nlc3Mta2V5XCI6XG4gICAgICAgICAgICBpZiAoY2h1bmsubmFtZSA9PT0gXCJlbmRLZXlcIikgb3B0aW9uYWxUb2tlbiA9IFwia2V5VmFsdWVcIjtcbiAgICAgICAgICAgIHJldHVybiBub25lO1xuICAgICAgICAgIGNhc2UgXCJwYXNzXCI6XG4gICAgICAgICAgICByZXR1cm4gbm9uZTtcbiAgICAgICAgICBjYXNlIFwiYWxsXCI6XG4gICAgICAgICAgICByZXR1cm4gY2h1bms7XG4gICAgICAgICAgY2FzZSBcImFjY2VwdFwiOlxuICAgICAgICAgIGNhc2UgXCJyZWplY3RcIjpcbiAgICAgICAgICAgIGlmIChzdGFydFRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgICAgc3RhcnRUcmFuc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJldHVyblRva2VuID0gdHJhbnNpdGlvbihzdGFjaywgY2h1bmssIHN0YXRlLCBzYW5pdGl6ZWRPcHRpb25zKSB8fCBub25lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3dpdGNoIChjaHVuay5uYW1lKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJzdGFydE9iamVjdFwiOlxuICAgICAgICAgICAgICBjYXNlIFwic3RhcnRBcnJheVwiOlxuICAgICAgICAgICAgICAgICsrZGVwdGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgXCJlbmRPYmplY3RcIjpcbiAgICAgICAgICAgICAgY2FzZSBcImVuZEFycmF5XCI6XG4gICAgICAgICAgICAgICAgLS1kZXB0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gXCJhY2NlcHRcIikge1xuICAgICAgICAgICAgICByZXR1cm5Ub2tlbiA9IGNvbWJpbmVNYW55TXV0KHJldHVyblRva2VuLCBjaHVuayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWRlcHRoKSB7XG4gICAgICAgICAgICAgIGlmIChvbmNlKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUgPSBzdGF0ZSA9PT0gXCJhY2NlcHRcIiA/IFwicGFzc1wiIDogXCJhbGxcIjtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IFwiY2hlY2tcIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJldHVyblRva2VuO1xuICAgICAgICAgIGNhc2UgXCJhY2NlcHQtdmFsdWVcIjpcbiAgICAgICAgICBjYXNlIFwicmVqZWN0LXZhbHVlXCI6XG4gICAgICAgICAgICBpZiAoc3RhcnRUcmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgIHN0YXJ0VHJhbnNpdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICByZXR1cm5Ub2tlbiA9IHRyYW5zaXRpb24oc3RhY2ssIGNodW5rLCBzdGF0ZSwgc2FuaXRpemVkT3B0aW9ucykgfHwgbm9uZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gXCJhY2NlcHQtdmFsdWVcIikge1xuICAgICAgICAgICAgICByZXR1cm5Ub2tlbiA9IGNvbWJpbmVNYW55TXV0KHJldHVyblRva2VuLCBjaHVuayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2h1bmsubmFtZSA9PT0gZW5kVG9rZW4pIHtcbiAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICBvcHRpb25hbFRva2VuID0gb3B0aW9uYWxUb2tlbnNbZW5kVG9rZW5dIHx8IFwiXCI7XG4gICAgICAgICAgICAgIGVuZFRva2VuID0gXCJcIjtcbiAgICAgICAgICAgICAgaWYgKCFvcHRpb25hbFRva2VuKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9uY2UpIHtcbiAgICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhdGUgPT09IFwiYWNjZXB0LXZhbHVlXCIgPyBcInBhc3NcIiA6IFwiYWxsXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHN0YXRlID0gXCJjaGVja1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJldHVyblRva2VuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBsYXN0IGluZGV4IGluIHRoZSBzdGFja1xuICAgICAgICBpZiAodHlwZW9mIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAvLyBhcnJheVxuICAgICAgICAgIHN3aXRjaCAoY2h1bmsubmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcInN0YXJ0T2JqZWN0XCI6XG4gICAgICAgICAgICBjYXNlIFwic3RhcnRBcnJheVwiOlxuICAgICAgICAgICAgY2FzZSBcInN0YXJ0U3RyaW5nXCI6XG4gICAgICAgICAgICBjYXNlIFwic3RhcnROdW1iZXJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJudWxsVmFsdWVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ0cnVlVmFsdWVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJmYWxzZVZhbHVlXCI6XG4gICAgICAgICAgICAgICsrc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm51bWJlclZhbHVlXCI6XG4gICAgICAgICAgICAgIGlmIChwcmV2aW91c1Rva2VuICE9PSBcImVuZE51bWJlclwiKSArK3N0YWNrW3N0YWNrLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdWYWx1ZVwiOlxuICAgICAgICAgICAgICBpZiAocHJldmlvdXNUb2tlbiAhPT0gXCJlbmRTdHJpbmdcIikgKytzdGFja1tzdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChjaHVuay5uYW1lID09PSBcImtleVZhbHVlXCIpIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdID0gY2h1bmsudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlvdXNUb2tlbiA9IGNodW5rLm5hbWU7XG5cbiAgICAgICAgLy8gY2hlY2sgdGhlIHRva2VuXG4gICAgICAgIGNvbnN0IGFjdGlvbiA9XG4gICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgIGNoZWNrYWJsZVRva2Vuc1tjaHVuay5uYW1lXSAhPT0gMSA/IG5vbkNoZWNrYWJsZUFjdGlvbiA6IGZpbHRlcihzdGFjaywgY2h1bmspID8gc3BlY2lhbEFjdGlvbiA6IGRlZmF1bHRBY3Rpb247XG5cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBlbmRUb2tlbiA9IHN0b3BUb2tlbnNbY2h1bmsubmFtZV0gfHwgXCJcIjtcbiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgICAgICBjYXNlIFwicHJvY2Vzcy1rZXlcIjpcbiAgICAgICAgICAgIGlmIChjaHVuay5uYW1lID09PSBcInN0YXJ0S2V5XCIpIHtcbiAgICAgICAgICAgICAgc3RhdGUgPSBcInByb2Nlc3Mta2V5XCI7XG4gICAgICAgICAgICAgIGNvbnRpbnVlIHJlY2hlY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYWNjZXB0LXRva2VuXCI6XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBpZiAoZW5kVG9rZW4gJiYgb3B0aW9uYWxUb2tlbnNbZW5kVG9rZW5dKSB7XG4gICAgICAgICAgICAgIHN0YXRlID0gXCJhY2NlcHQtdmFsdWVcIjtcbiAgICAgICAgICAgICAgc3RhcnRUcmFuc2l0aW9uID0gISF0cmFuc2l0aW9uO1xuICAgICAgICAgICAgICBjb250aW51ZSByZWNoZWNrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRyYW5zaXRpb24pIHJldHVyblRva2VuID0gdHJhbnNpdGlvbihzdGFjaywgY2h1bmssIGFjdGlvbiwgc2FuaXRpemVkT3B0aW9ucyk7XG4gICAgICAgICAgICByZXR1cm5Ub2tlbiA9IGNvbWJpbmVNYW55TXV0KHJldHVyblRva2VuLCBjaHVuayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYWNjZXB0XCI6XG4gICAgICAgICAgICBpZiAoZW5kVG9rZW4pIHtcbiAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICBzdGF0ZSA9IG9wdGlvbmFsVG9rZW5zW2VuZFRva2VuXSA/IFwiYWNjZXB0LXZhbHVlXCIgOiBcImFjY2VwdFwiO1xuICAgICAgICAgICAgICBzdGFydFRyYW5zaXRpb24gPSAhIXRyYW5zaXRpb247XG4gICAgICAgICAgICAgIGNvbnRpbnVlIHJlY2hlY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHJhbnNpdGlvbikgcmV0dXJuVG9rZW4gPSB0cmFuc2l0aW9uKHN0YWNrLCBjaHVuaywgYWN0aW9uLCBzYW5pdGl6ZWRPcHRpb25zKTtcbiAgICAgICAgICAgIHJldHVyblRva2VuID0gY29tYmluZU1hbnlNdXQocmV0dXJuVG9rZW4sIGNodW5rKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJyZWplY3RcIjpcbiAgICAgICAgICAgIGlmIChlbmRUb2tlbikge1xuICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgIHN0YXRlID0gb3B0aW9uYWxUb2tlbnNbZW5kVG9rZW5dID8gXCJyZWplY3QtdmFsdWVcIiA6IFwicmVqZWN0XCI7XG4gICAgICAgICAgICAgIHN0YXJ0VHJhbnNpdGlvbiA9ICEhdHJhbnNpdGlvbjtcbiAgICAgICAgICAgICAgY29udGludWUgcmVjaGVjaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uKSByZXR1cm5Ub2tlbiA9IHRyYW5zaXRpb24oc3RhY2ssIGNodW5rLCBhY3Rpb24sIHNhbml0aXplZE9wdGlvbnMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInBhc3NcIjpcbiAgICAgICAgICAgIHN0YXRlID0gXCJwYXNzXCI7XG4gICAgICAgICAgICBjb250aW51ZSByZWNoZWNrO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIC8vIHVwZGF0ZSB0aGUgc3RhY2tcbiAgICAgIHN3aXRjaCAoY2h1bmsubmFtZSkge1xuICAgICAgICBjYXNlIFwic3RhcnRPYmplY3RcIjpcbiAgICAgICAgICBzdGFjay5wdXNoKG51bGwpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3RhcnRBcnJheVwiOlxuICAgICAgICAgIHN0YWNrLnB1c2goLTEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZW5kT2JqZWN0XCI6XG4gICAgICAgIGNhc2UgXCJlbmRBcnJheVwiOlxuICAgICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmV0dXJuVG9rZW47XG4gICAgfSk7XG4gIH07XG5cbmV4cG9ydCBjb25zdCBQaWNrUGFyc2VyID0gKG9wdGlvbnM/OiBhbnkpID0+IHdpdGhQYXJzZXIoZmlsdGVyQmFzZSgpLCBPYmplY3QuYXNzaWduKHsgcGFja0tleXM6IHRydWUgfSwgb3B0aW9ucykpO1xuXG5jbGFzcyBDb3VudGVyIHtcbiAgZGVwdGg6IG51bWJlcjtcbiAgY29uc3RydWN0b3IoaW5pdGlhbERlcHRoOiBudW1iZXIpIHtcbiAgICB0aGlzLmRlcHRoID0gaW5pdGlhbERlcHRoO1xuICB9XG4gIHN0YXJ0T2JqZWN0KCkge1xuICAgICsrdGhpcy5kZXB0aDtcbiAgfVxuICBlbmRPYmplY3QoKSB7XG4gICAgLS10aGlzLmRlcHRoO1xuICB9XG4gIHN0YXJ0QXJyYXkoKSB7XG4gICAgKyt0aGlzLmRlcHRoO1xuICB9XG4gIGVuZEFycmF5KCkge1xuICAgIC0tdGhpcy5kZXB0aDtcbiAgfVxufVxuXG5jbGFzcyBBc3NlbWJsZXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBzdGF0aWMgY29ubmVjdFRvKHN0cmVhbTogYW55LCBvcHRpb25zOiBhbnkpIHtcbiAgICByZXR1cm4gbmV3IEFzc2VtYmxlcihvcHRpb25zKS5jb25uZWN0VG8oc3RyZWFtKTtcbiAgfVxuXG4gIHN0YWNrOiBhbnk7XG4gIGN1cnJlbnQ6IGFueTtcbiAga2V5OiBhbnk7XG4gIGRvbmU6IGJvb2xlYW47XG4gIHJldml2ZXI6IGFueTtcbiAgLy8gQHRzLWlnbm9yZVxuICBzdHJpbmdWYWx1ZTogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHRhcENoYWluOiAoY2h1bms6IGFueSkgPT4gYW55O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IGFueSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5zdGFjayA9IFtdO1xuICAgIHRoaXMuY3VycmVudCA9IHRoaXMua2V5ID0gbnVsbDtcbiAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICB0aGlzLnJldml2ZXIgPSB0eXBlb2Ygb3B0aW9ucy5yZXZpdmVyID09IFwiZnVuY3Rpb25cIiAmJiBvcHRpb25zLnJldml2ZXI7XG4gICAgICBpZiAodGhpcy5yZXZpdmVyKSB7XG4gICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSB0aGlzLl9zYXZlVmFsdWUgPSB0aGlzLl9zYXZlVmFsdWVXaXRoUmV2aXZlcjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm51bWJlckFzU3RyaW5nKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdGhpcy5udW1iZXJWYWx1ZSA9IHRoaXMuc3RyaW5nVmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy50YXBDaGFpbiA9IChjaHVuaykgPT4ge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgaWYgKHRoaXNbY2h1bmsubmFtZV0pIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzW2NodW5rLm5hbWVdKGNodW5rLnZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuZG9uZSkgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub25lO1xuICAgIH07XG5cbiAgICB0aGlzLnN0cmluZ1ZhbHVlID0gdGhpcy5fc2F2ZVZhbHVlO1xuICB9XG5cbiAgY29ubmVjdFRvKHN0cmVhbTogYW55KSB7XG4gICAgc3RyZWFtLm9uKFwiZGF0YVwiLCAoY2h1bms6IGFueSkgPT4ge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgaWYgKHRoaXNbY2h1bmsubmFtZV0pIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzW2NodW5rLm5hbWVdKGNodW5rLnZhbHVlKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBpZiAodGhpcy5kb25lKSB0aGlzLmVtaXQoXCJkb25lXCIsIHRoaXMpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZ2V0IGRlcHRoKCkge1xuICAgIHJldHVybiAodGhpcy5zdGFjay5sZW5ndGggPj4gMSkgKyAodGhpcy5kb25lID8gMCA6IDEpO1xuICB9XG5cbiAgZ2V0IHBhdGgoKSB7XG4gICAgY29uc3QgcGF0aDogYW55W10gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc3RhY2subGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMuc3RhY2tbaSArIDFdO1xuICAgICAgcGF0aC5wdXNoKGtleSA9PT0gbnVsbCA/IHRoaXMuc3RhY2tbaV0ubGVuZ3RoIDoga2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cblxuICBkcm9wVG9MZXZlbChsZXZlbDogYW55KSB7XG4gICAgaWYgKGxldmVsIDwgdGhpcy5kZXB0aCkge1xuICAgICAgaWYgKGxldmVsID4gMCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IChsZXZlbCAtIDEpIDw8IDE7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuc3RhY2tbaW5kZXhdO1xuICAgICAgICB0aGlzLmtleSA9IHRoaXMuc3RhY2tbaW5kZXggKyAxXTtcbiAgICAgICAgdGhpcy5zdGFjay5zcGxpY2UoaW5kZXgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zdGFjayA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLmtleSA9IG51bGw7XG4gICAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY29uc3VtZShjaHVuazogYW55KSB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHRoaXNbY2h1bmsubmFtZV0gJiYgdGhpc1tjaHVuay5uYW1lXShjaHVuay52YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBrZXlWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5rZXkgPSB2YWx1ZTtcbiAgfVxuXG4gIC8vc3RyaW5nVmFsdWUoKSAtIGFsaWFzZWQgYmVsb3cgdG8gX3NhdmVWYWx1ZSgpXG5cbiAgbnVtYmVyVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHRoaXMuX3NhdmVWYWx1ZShwYXJzZUZsb2F0KHZhbHVlKSk7XG4gIH1cbiAgbnVsbFZhbHVlKCkge1xuICAgIHRoaXMuX3NhdmVWYWx1ZShudWxsKTtcbiAgfVxuICB0cnVlVmFsdWUoKSB7XG4gICAgdGhpcy5fc2F2ZVZhbHVlKHRydWUpO1xuICB9XG4gIGZhbHNlVmFsdWUoKSB7XG4gICAgdGhpcy5fc2F2ZVZhbHVlKGZhbHNlKTtcbiAgfVxuXG4gIHN0YXJ0T2JqZWN0KCkge1xuICAgIGlmICh0aGlzLmRvbmUpIHtcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0YWNrLnB1c2godGhpcy5jdXJyZW50LCB0aGlzLmtleSk7XG4gICAgfVxuICAgIHRoaXMuY3VycmVudCA9IG5ldyBPYmplY3QoKTtcbiAgICB0aGlzLmtleSA9IG51bGw7XG4gIH1cblxuICBlbmRPYmplY3QoKSB7XG4gICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY3VycmVudDtcbiAgICAgIHRoaXMua2V5ID0gdGhpcy5zdGFjay5wb3AoKTtcbiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuc3RhY2sucG9wKCk7XG4gICAgICB0aGlzLl9zYXZlVmFsdWUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHN0YXJ0QXJyYXkoKSB7XG4gICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RhY2sucHVzaCh0aGlzLmN1cnJlbnQsIHRoaXMua2V5KTtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50ID0gW107XG4gICAgdGhpcy5rZXkgPSBudWxsO1xuICB9XG5cbiAgZW5kQXJyYXkoKSB7XG4gICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY3VycmVudDtcbiAgICAgIHRoaXMua2V5ID0gdGhpcy5zdGFjay5wb3AoKTtcbiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuc3RhY2sucG9wKCk7XG4gICAgICB0aGlzLl9zYXZlVmFsdWUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIF9zYXZlVmFsdWUodmFsdWU6IGFueSkge1xuICAgIGlmICh0aGlzLmRvbmUpIHtcbiAgICAgIHRoaXMuY3VycmVudCA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50LnB1c2godmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jdXJyZW50W3RoaXMua2V5XSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmtleSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIF9zYXZlVmFsdWVXaXRoUmV2aXZlcih2YWx1ZTogYW55KSB7XG4gICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5yZXZpdmVyKFwiXCIsIHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuY3VycmVudCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIHZhbHVlID0gdGhpcy5yZXZpdmVyKFwiXCIgKyB0aGlzLmN1cnJlbnQubGVuZ3RoLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMuY3VycmVudC5wdXNoKHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5jdXJyZW50W3RoaXMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSB0aGlzLnJldml2ZXIodGhpcy5rZXksIHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRbdGhpcy5rZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5rZXkgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5jb25zdCBzdHJlYW1CYXNlID1cbiAgKHsgcHVzaCwgZmlyc3QsIGxldmVsIH06IGFueSkgPT5cbiAgKG9wdGlvbnMgPSB7fSBhcyBhbnkpID0+IHtcbiAgICBjb25zdCB7IG9iamVjdEZpbHRlciwgaW5jbHVkZVVuZGVjaWRlZCB9ID0gb3B0aW9ucztcbiAgICBsZXQgYXNtID0gbmV3IEFzc2VtYmxlcihvcHRpb25zKSBhcyBhbnksXG4gICAgICBzdGF0ZSA9IGZpcnN0ID8gXCJmaXJzdFwiIDogXCJjaGVja1wiLFxuICAgICAgc2F2ZWRBc20gPSBudWxsIGFzIGFueTtcblxuICAgIGlmICh0eXBlb2Ygb2JqZWN0RmlsdGVyICE9IFwiZnVuY3Rpb25cIikge1xuICAgICAgLy8gbm8gb2JqZWN0IGZpbHRlciArIG5vIGZpcnN0IGNoZWNrXG4gICAgICBpZiAoc3RhdGUgPT09IFwiY2hlY2tcIilcbiAgICAgICAgcmV0dXJuIChjaHVuazogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKGFzbVtjaHVuay5uYW1lXSkge1xuICAgICAgICAgICAgYXNtW2NodW5rLm5hbWVdKGNodW5rLnZhbHVlKTtcbiAgICAgICAgICAgIGlmIChhc20uZGVwdGggPT09IGxldmVsKSB7XG4gICAgICAgICAgICAgIHJldHVybiBwdXNoKGFzbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBub25lO1xuICAgICAgICB9O1xuICAgICAgLy8gbm8gb2JqZWN0IGZpbHRlclxuICAgICAgcmV0dXJuIChjaHVuazogYW55KSA9PiB7XG4gICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgICBjYXNlIFwiZmlyc3RcIjpcbiAgICAgICAgICAgIGZpcnN0KGNodW5rKTtcbiAgICAgICAgICAgIHN0YXRlID0gXCJhY2NlcHRcIjtcbiAgICAgICAgICAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICBjYXNlIFwiYWNjZXB0XCI6XG4gICAgICAgICAgICBpZiAoYXNtW2NodW5rLm5hbWVdKSB7XG4gICAgICAgICAgICAgIGFzbVtjaHVuay5uYW1lXShjaHVuay52YWx1ZSk7XG4gICAgICAgICAgICAgIGlmIChhc20uZGVwdGggPT09IGxldmVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHB1c2goYXNtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vbmU7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIG9iamVjdCBmaWx0ZXIgKyBhIHBvc3NpYmxlIGZpcnN0IGNoZWNrXG4gICAgcmV0dXJuIChjaHVuazogYW55KSA9PiB7XG4gICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgIGNhc2UgXCJmaXJzdFwiOlxuICAgICAgICAgIGZpcnN0KGNodW5rKTtcbiAgICAgICAgICBzdGF0ZSA9IFwiY2hlY2tcIjtcbiAgICAgICAgLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgIGNhc2UgXCJjaGVja1wiOlxuICAgICAgICAgIGlmIChhc21bY2h1bmsubmFtZV0pIHtcbiAgICAgICAgICAgIGFzbVtjaHVuay5uYW1lXShjaHVuay52YWx1ZSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBvYmplY3RGaWx0ZXIoYXNtKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgc3RhdGUgPSBcImFjY2VwdFwiO1xuICAgICAgICAgICAgICBpZiAoYXNtLmRlcHRoID09PSBsZXZlbCkgcmV0dXJuIHB1c2goYXNtKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBpZiAoYXNtLmRlcHRoID09PSBsZXZlbCkgcmV0dXJuIHB1c2goYXNtLCB0cnVlKTtcbiAgICAgICAgICAgICAgc3RhdGUgPSBcInJlamVjdFwiO1xuICAgICAgICAgICAgICBzYXZlZEFzbSA9IGFzbTtcbiAgICAgICAgICAgICAgYXNtID0gbmV3IENvdW50ZXIoc2F2ZWRBc20uZGVwdGgpO1xuICAgICAgICAgICAgICBzYXZlZEFzbS5kcm9wVG9MZXZlbChsZXZlbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAoYXNtLmRlcHRoID09PSBsZXZlbCkgcmV0dXJuIHB1c2goYXNtLCAhaW5jbHVkZVVuZGVjaWRlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYWNjZXB0XCI6XG4gICAgICAgICAgaWYgKGFzbVtjaHVuay5uYW1lXSkge1xuICAgICAgICAgICAgYXNtW2NodW5rLm5hbWVdKGNodW5rLnZhbHVlKTtcbiAgICAgICAgICAgIGlmIChhc20uZGVwdGggPT09IGxldmVsKSB7XG4gICAgICAgICAgICAgIHN0YXRlID0gXCJjaGVja1wiO1xuICAgICAgICAgICAgICByZXR1cm4gcHVzaChhc20pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlamVjdFwiOlxuICAgICAgICAgIGlmIChhc21bY2h1bmsubmFtZV0pIHtcbiAgICAgICAgICAgIGFzbVtjaHVuay5uYW1lXShjaHVuay52YWx1ZSk7XG4gICAgICAgICAgICBpZiAoYXNtLmRlcHRoID09PSBsZXZlbCkge1xuICAgICAgICAgICAgICBzdGF0ZSA9IFwiY2hlY2tcIjtcbiAgICAgICAgICAgICAgYXNtID0gc2F2ZWRBc207XG4gICAgICAgICAgICAgIHNhdmVkQXNtID0gbnVsbDtcbiAgICAgICAgICAgICAgcmV0dXJuIHB1c2goYXNtLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9uZTtcbiAgICB9O1xuICB9O1xuXG5leHBvcnQgY29uc3QgU3RyZWFtQXJyYXkgPSAob3B0aW9ucz86IGFueSkgPT4ge1xuICBsZXQga2V5ID0gMDtcbiAgcmV0dXJuIHN0cmVhbUJhc2Uoe1xuICAgIGxldmVsOiAxLFxuXG4gICAgZmlyc3QoY2h1bms6IGFueSkge1xuICAgICAgaWYgKGNodW5rLm5hbWUgIT09IFwic3RhcnRBcnJheVwiKSB0aHJvdyBuZXcgRXJyb3IoXCJUb3AtbGV2ZWwgb2JqZWN0IHNob3VsZCBiZSBhbiBhcnJheS5cIik7XG4gICAgfSxcblxuICAgIHB1c2goYXNtOiBhbnksIGRpc2NhcmQ6IGFueSkge1xuICAgICAgaWYgKGFzbS5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICBpZiAoZGlzY2FyZCkge1xuICAgICAgICAgICsra2V5O1xuICAgICAgICAgIGFzbS5jdXJyZW50LnBvcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB7IGtleToga2V5KyssIHZhbHVlOiBhc20uY3VycmVudC5wb3AoKSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9uZTtcbiAgICB9LFxuICB9KShvcHRpb25zKTtcbn07XG4iLCAiaW1wb3J0IHsgTGlzdCwgTWVudUJhckV4dHJhLCBJY29uLCBvcGVuLCBMYXVuY2hUeXBlLCBlbnZpcm9ubWVudCwgQWN0aW9uUGFuZWwsIEFjdGlvbiB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwibm9kZTpmc1wiO1xuaW1wb3J0IG9zIGZyb20gXCJub2RlOm9zXCI7XG5pbXBvcnQgeyB1c2VSZWYsIHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlUHJvbWlzZSwgUHJvbWlzZU9wdGlvbnMgfSBmcm9tIFwiLi91c2VQcm9taXNlXCI7XG5pbXBvcnQgeyB1c2VMYXRlc3QgfSBmcm9tIFwiLi91c2VMYXRlc3RcIjtcbmltcG9ydCB7IHNob3dGYWlsdXJlVG9hc3QgfSBmcm9tIFwiLi9zaG93RmFpbHVyZVRvYXN0XCI7XG5pbXBvcnQgeyBiYXNlRXhlY3V0ZVNRTCwgUGVybWlzc2lvbkVycm9yLCBpc1Blcm1pc3Npb25FcnJvciB9IGZyb20gXCIuL3NxbC11dGlsc1wiO1xuXG4vKipcbiAqIEV4ZWN1dGVzIGEgcXVlcnkgb24gYSBsb2NhbCBTUUwgZGF0YWJhc2UgYW5kIHJldHVybnMgdGhlIHtAbGluayBBc3luY1N0YXRlfSBjb3JyZXNwb25kaW5nIHRvIHRoZSBxdWVyeSBvZiB0aGUgY29tbWFuZC4gVGhlIGxhc3QgdmFsdWUgd2lsbCBiZSBrZXB0IGJldHdlZW4gY29tbWFuZCBydW5zLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGltcG9ydCB7IHVzZVNRTCB9IGZyb20gXCJAcmF5Y2FzdC91dGlsc1wiO1xuICogaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gXCJwYXRoXCI7XG4gKiBpbXBvcnQgeyBob21lZGlyIH0gZnJvbSBcIm9zXCI7XG4gKlxuICogY29uc3QgTk9URVNfREIgPSByZXNvbHZlKGhvbWVkaXIoKSwgXCJMaWJyYXJ5L0dyb3VwIENvbnRhaW5lcnMvZ3JvdXAuY29tLmFwcGxlLm5vdGVzL05vdGVTdG9yZS5zcWxpdGVcIik7XG4gKiBjb25zdCBub3Rlc1F1ZXJ5ID0gYFNFTEVDVCBpZCwgdGl0bGUgRlJPTSAuLi5gO1xuICogdHlwZSBOb3RlSXRlbSA9IHtcbiAqICAgaWQ6IHN0cmluZztcbiAqICAgdGl0bGU6IHN0cmluZztcbiAqIH07XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgeyBpc0xvYWRpbmcsIGRhdGEsIHBlcm1pc3Npb25WaWV3IH0gPSB1c2VTUUw8Tm90ZUl0ZW0+KE5PVEVTX0RCLCBub3Rlc1F1ZXJ5KTtcbiAqXG4gKiAgIGlmIChwZXJtaXNzaW9uVmlldykge1xuICogICAgIHJldHVybiBwZXJtaXNzaW9uVmlldztcbiAqICAgfVxuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8TGlzdCBpc0xvYWRpbmc9e2lzTG9hZGluZ30+XG4gKiAgICAgICB7KGRhdGEgfHwgW10pLm1hcCgoaXRlbSkgPT4gKFxuICogICAgICAgICA8TGlzdC5JdGVtIGtleT17aXRlbS5pZH0gdGl0bGU9e2l0ZW0udGl0bGV9IC8+XG4gKiAgICAgICApKX1cbiAqICAgICA8L0xpc3Q+XG4gKiAgKTtcbiAqIH07XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVNRTDxUID0gdW5rbm93bj4oXG4gIGRhdGFiYXNlUGF0aDogc3RyaW5nLFxuICBxdWVyeTogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIC8qKiBBIHN0cmluZyBleHBsYWluaW5nIHdoeSB0aGUgZXh0ZW5zaW9uIG5lZWRzIGZ1bGwgZGlzayBhY2Nlc3MuIEZvciBleGFtcGxlLCB0aGUgQXBwbGUgTm90ZXMgZXh0ZW5zaW9uIHVzZXMgYFwiVGhpcyBpcyByZXF1aXJlZCB0byBzZWFyY2ggeW91ciBBcHBsZSBOb3Rlcy5cImAuIFdoaWxlIGl0IGlzIG9wdGlvbmFsLCB3ZSByZWNvbW1lbmQgc2V0dGluZyBpdCB0byBoZWxwIHVzZXJzIHVuZGVyc3RhbmQuICovXG4gICAgcGVybWlzc2lvblByaW1pbmc/OiBzdHJpbmc7XG4gIH0gJiBPbWl0PFByb21pc2VPcHRpb25zPChkYXRhYmFzZTogc3RyaW5nLCBxdWVyeTogc3RyaW5nKSA9PiBQcm9taXNlPFRbXT4+LCBcImFib3J0YWJsZVwiPixcbikge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gIGNvbnN0IHsgcGVybWlzc2lvblByaW1pbmcsIC4uLnVzZVByb21pc2VPcHRpb25zIH0gPSBvcHRpb25zIHx8IHt9O1xuXG4gIGNvbnN0IFtwZXJtaXNzaW9uVmlldywgc2V0UGVybWlzc2lvblZpZXddID0gdXNlU3RhdGU8UmVhY3QuSlNYLkVsZW1lbnQgfCBudWxsPihudWxsKTtcbiAgY29uc3QgbGF0ZXN0T3B0aW9ucyA9IHVzZUxhdGVzdChvcHRpb25zIHx8IHt9KTtcbiAgY29uc3QgYWJvcnRhYmxlID0gdXNlUmVmPEFib3J0Q29udHJvbGxlcj4obnVsbCk7XG5cbiAgY29uc3QgaGFuZGxlRXJyb3IgPSB1c2VDYWxsYmFjayhcbiAgICAoX2Vycm9yOiBFcnJvcikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihfZXJyb3IpO1xuICAgICAgY29uc3QgZXJyb3IgPVxuICAgICAgICBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBfZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImF1dGhvcml6YXRpb24gZGVuaWVkXCIpXG4gICAgICAgICAgPyBuZXcgUGVybWlzc2lvbkVycm9yKFwiWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoZSBkYXRhYmFzZS5cIilcbiAgICAgICAgICA6IChfZXJyb3IgYXMgRXJyb3IpO1xuXG4gICAgICBpZiAoaXNQZXJtaXNzaW9uRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgIHNldFBlcm1pc3Npb25WaWV3KDxQZXJtaXNzaW9uRXJyb3JTY3JlZW4gcHJpbWluZz17bGF0ZXN0T3B0aW9ucy5jdXJyZW50LnBlcm1pc3Npb25QcmltaW5nfSAvPik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAobGF0ZXN0T3B0aW9ucy5jdXJyZW50Lm9uRXJyb3IpIHtcbiAgICAgICAgICBsYXRlc3RPcHRpb25zLmN1cnJlbnQub25FcnJvcihlcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGVudmlyb25tZW50LmxhdW5jaFR5cGUgIT09IExhdW5jaFR5cGUuQmFja2dyb3VuZCkge1xuICAgICAgICAgICAgc2hvd0ZhaWx1cmVUb2FzdChlcnJvciwge1xuICAgICAgICAgICAgICB0aXRsZTogXCJDYW5ub3QgcXVlcnkgdGhlIGRhdGFcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgW2xhdGVzdE9wdGlvbnNdLFxuICApO1xuXG4gIGNvbnN0IGZuID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFleGlzdHNTeW5jKGRhdGFiYXNlUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBkYXRhYmFzZSBkb2VzIG5vdCBleGlzdFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXN5bmMgKGRhdGFiYXNlUGF0aDogc3RyaW5nLCBxdWVyeTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBhYm9ydFNpZ25hbCA9IGFib3J0YWJsZS5jdXJyZW50Py5zaWduYWw7XG4gICAgICByZXR1cm4gYmFzZUV4ZWN1dGVTUUw8VD4oZGF0YWJhc2VQYXRoLCBxdWVyeSwgeyBzaWduYWw6IGFib3J0U2lnbmFsIH0pO1xuICAgIH07XG4gIH0sIFtkYXRhYmFzZVBhdGhdKTtcblxuICByZXR1cm4ge1xuICAgIC4uLnVzZVByb21pc2UoZm4sIFtkYXRhYmFzZVBhdGgsIHF1ZXJ5XSwgeyAuLi51c2VQcm9taXNlT3B0aW9ucywgb25FcnJvcjogaGFuZGxlRXJyb3IgfSksXG4gICAgcGVybWlzc2lvblZpZXcsXG4gIH07XG59XG5cbmZ1bmN0aW9uIFBlcm1pc3Npb25FcnJvclNjcmVlbihwcm9wczogeyBwcmltaW5nPzogc3RyaW5nIH0pIHtcbiAgY29uc3QgbWFjb3NWZW50dXJhQW5kTGF0ZXIgPSBwYXJzZUludChvcy5yZWxlYXNlKCkuc3BsaXQoXCIuXCIpWzBdKSA+PSAyMjtcbiAgY29uc3QgcHJlZmVyZW5jZXNTdHJpbmcgPSBtYWNvc1ZlbnR1cmFBbmRMYXRlciA/IFwiU2V0dGluZ3NcIiA6IFwiUHJlZmVyZW5jZXNcIjtcblxuICBjb25zdCBhY3Rpb24gPSBtYWNvc1ZlbnR1cmFBbmRMYXRlclxuICAgID8ge1xuICAgICAgICB0aXRsZTogXCJPcGVuIFN5c3RlbSBTZXR0aW5ncyAtPiBQcml2YWN5XCIsXG4gICAgICAgIHRhcmdldDogXCJ4LWFwcGxlLnN5c3RlbXByZWZlcmVuY2VzOmNvbS5hcHBsZS5wcmVmZXJlbmNlLnNlY3VyaXR5P1ByaXZhY3lfQWxsRmlsZXNcIixcbiAgICAgIH1cbiAgICA6IHtcbiAgICAgICAgdGl0bGU6IFwiT3BlbiBTeXN0ZW0gUHJlZmVyZW5jZXMgLT4gU2VjdXJpdHlcIixcbiAgICAgICAgdGFyZ2V0OiBcIngtYXBwbGUuc3lzdGVtcHJlZmVyZW5jZXM6Y29tLmFwcGxlLnByZWZlcmVuY2Uuc2VjdXJpdHk/UHJpdmFjeV9BbGxGaWxlc1wiLFxuICAgICAgfTtcblxuICBpZiAoZW52aXJvbm1lbnQuY29tbWFuZE1vZGUgPT09IFwibWVudS1iYXJcIikge1xuICAgIHJldHVybiAoXG4gICAgICA8TWVudUJhckV4dHJhIGljb249e0ljb24uV2FybmluZ30gdGl0bGU9e2Vudmlyb25tZW50LmNvbW1hbmROYW1lfT5cbiAgICAgICAgPE1lbnVCYXJFeHRyYS5JdGVtXG4gICAgICAgICAgdGl0bGU9XCJSYXljYXN0IG5lZWRzIGZ1bGwgZGlzayBhY2Nlc3NcIlxuICAgICAgICAgIHRvb2x0aXA9e2BZb3UgY2FuIHJldmVydCB0aGlzIGFjY2VzcyBpbiAke3ByZWZlcmVuY2VzU3RyaW5nfSB3aGVuZXZlciB5b3Ugd2FudGB9XG4gICAgICAgIC8+XG4gICAgICAgIHtwcm9wcy5wcmltaW5nID8gKFxuICAgICAgICAgIDxNZW51QmFyRXh0cmEuSXRlbVxuICAgICAgICAgICAgdGl0bGU9e3Byb3BzLnByaW1pbmd9XG4gICAgICAgICAgICB0b29sdGlwPXtgWW91IGNhbiByZXZlcnQgdGhpcyBhY2Nlc3MgaW4gJHtwcmVmZXJlbmNlc1N0cmluZ30gd2hlbmV2ZXIgeW91IHdhbnRgfVxuICAgICAgICAgIC8+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgICA8TWVudUJhckV4dHJhLlNlcGFyYXRvciAvPlxuICAgICAgICA8TWVudUJhckV4dHJhLkl0ZW0gdGl0bGU9e2FjdGlvbi50aXRsZX0gb25BY3Rpb249eygpID0+IG9wZW4oYWN0aW9uLnRhcmdldCl9IC8+XG4gICAgICA8L01lbnVCYXJFeHRyYT5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8TGlzdD5cbiAgICAgIDxMaXN0LkVtcHR5Vmlld1xuICAgICAgICBpY29uPXt7XG4gICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICBsaWdodDogXCJodHRwczovL3JheWNhc3QuY29tL3VwbG9hZHMvZXh0ZW5zaW9ucy11dGlscy1zZWN1cml0eS1wZXJtaXNzaW9ucy1saWdodC5wbmdcIixcbiAgICAgICAgICAgIGRhcms6IFwiaHR0cHM6Ly9yYXljYXN0LmNvbS91cGxvYWRzL2V4dGVuc2lvbnMtdXRpbHMtc2VjdXJpdHktcGVybWlzc2lvbnMtZGFyay5wbmdcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9fVxuICAgICAgICB0aXRsZT1cIlJheWNhc3QgbmVlZHMgZnVsbCBkaXNrIGFjY2Vzcy5cIlxuICAgICAgICBkZXNjcmlwdGlvbj17YCR7XG4gICAgICAgICAgcHJvcHMucHJpbWluZyA/IHByb3BzLnByaW1pbmcgKyBcIlxcblwiIDogXCJcIlxuICAgICAgICB9WW91IGNhbiByZXZlcnQgdGhpcyBhY2Nlc3MgaW4gJHtwcmVmZXJlbmNlc1N0cmluZ30gd2hlbmV2ZXIgeW91IHdhbnQuYH1cbiAgICAgICAgYWN0aW9ucz17XG4gICAgICAgICAgPEFjdGlvblBhbmVsPlxuICAgICAgICAgICAgPEFjdGlvbi5PcGVuIHsuLi5hY3Rpb259IC8+XG4gICAgICAgICAgPC9BY3Rpb25QYW5lbD5cbiAgICAgICAgfVxuICAgICAgLz5cbiAgICA8L0xpc3Q+XG4gICk7XG59XG4iLCAiaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgeyBjb3B5RmlsZSwgbWtkaXIsIHdyaXRlRmlsZSB9IGZyb20gXCJub2RlOmZzL3Byb21pc2VzXCI7XG5pbXBvcnQgb3MgZnJvbSBcIm5vZGU6b3NcIjtcbmltcG9ydCBjaGlsZFByb2Nlc3MgZnJvbSBcIm5vZGU6Y2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHsgZ2V0U3Bhd25lZFByb21pc2UsIGdldFNwYXduZWRSZXN1bHQgfSBmcm9tIFwiLi9leGVjLXV0aWxzXCI7XG5pbXBvcnQgeyBoYXNoIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG5leHBvcnQgY2xhc3MgUGVybWlzc2lvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIlBlcm1pc3Npb25FcnJvclwiO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1Blcm1pc3Npb25FcnJvcihlcnJvcjogdW5rbm93bik6IGVycm9yIGlzIFBlcm1pc3Npb25FcnJvciB7XG4gIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm5hbWUgPT09IFwiUGVybWlzc2lvbkVycm9yXCI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBiYXNlRXhlY3V0ZVNRTDxUID0gdW5rbm93bj4oXG4gIGRhdGFiYXNlUGF0aDogc3RyaW5nLFxuICBxdWVyeTogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIHNpZ25hbD86IEFib3J0U2lnbmFsO1xuICB9LFxuKTogUHJvbWlzZTxUW10+IHtcbiAgaWYgKCFleGlzdHNTeW5jKGRhdGFiYXNlUGF0aCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZGF0YWJhc2UgZG9lcyBub3QgZXhpc3RcIik7XG4gIH1cblxuICBsZXQgc3FsaXRlMzogdHlwZW9mIGltcG9ydChcIm5vZGU6c3FsaXRlXCIpO1xuICB0cnkge1xuICAgIHNxbGl0ZTMgPSByZXF1aXJlKFwibm9kZTpzcWxpdGVcIik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gSWYgc3FsaXRlMyBpcyBub3QgYXZhaWxhYmxlLCB3ZSBmYWxsYmFjayB0byB1c2luZyB0aGUgc3FsaXRlMyBDTEkgKGF2YWlsYWJsZSBvbiBtYWNPUyBhbmQgTGludXggYnkgZGVmYXVsdCkuXG4gICAgcmV0dXJuIHNxbGl0ZUZhbGxiYWNrPFQ+KGRhdGFiYXNlUGF0aCwgcXVlcnksIG9wdGlvbnMpO1xuICB9XG5cbiAgbGV0IGRiID0gbmV3IHNxbGl0ZTMuRGF0YWJhc2VTeW5jKGRhdGFiYXNlUGF0aCwgeyBvcGVuOiBmYWxzZSwgcmVhZE9ubHk6IHRydWUgfSk7XG5cbiAgY29uc3QgYWJvcnRTaWduYWwgPSBvcHRpb25zPy5zaWduYWw7XG5cbiAgdHJ5IHtcbiAgICBkYi5vcGVuKCk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgaWYgKGVycm9yLm1lc3NhZ2UubWF0Y2goXCIoNSlcIikgfHwgZXJyb3IubWVzc2FnZS5tYXRjaChcIigxNClcIikpIHtcbiAgICAgIC8vIFRoYXQgbWVhbnMgdGhhdCB0aGUgREIgaXMgYnVzeSBiZWNhdXNlIG9mIGFub3RoZXIgYXBwIGlzIGxvY2tpbmcgaXRcbiAgICAgIC8vIFRoaXMgaGFwcGVucyB3aGVuIENocm9tZSBvciBBcmMgaXMgb3BlbmVkOiB0aGV5IGxvY2sgdGhlIEhpc3RvcnkgZGIuXG4gICAgICAvLyBBcyBhbiB1Z2x5IHdvcmthcm91bmQsIHdlIGR1cGxpY2F0ZSB0aGUgZmlsZSBhbmQgcmVhZCB0aGF0IGluc3RlYWRcbiAgICAgIC8vICh3aXRoIHZmcyB1bml4IC0gbm9uZSB0byBqdXN0IG5vdCBjYXJlIGFib3V0IGxvY2tzKVxuICAgICAgbGV0IHdvcmthcm91bmRDb3BpZWREYjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgaWYgKCF3b3JrYXJvdW5kQ29waWVkRGIpIHtcbiAgICAgICAgY29uc3QgdGVtcEZvbGRlciA9IHBhdGguam9pbihvcy50bXBkaXIoKSwgXCJ1c2VTUUxcIiwgaGFzaChkYXRhYmFzZVBhdGgpKTtcbiAgICAgICAgYXdhaXQgbWtkaXIodGVtcEZvbGRlciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgIGNoZWNrQWJvcnRlZChhYm9ydFNpZ25hbCk7XG5cbiAgICAgICAgd29ya2Fyb3VuZENvcGllZERiID0gcGF0aC5qb2luKHRlbXBGb2xkZXIsIFwiZGIuZGJcIik7XG4gICAgICAgIGF3YWl0IGNvcHlGaWxlKGRhdGFiYXNlUGF0aCwgd29ya2Fyb3VuZENvcGllZERiKTtcblxuICAgICAgICBhd2FpdCB3cml0ZUZpbGUod29ya2Fyb3VuZENvcGllZERiICsgXCItc2htXCIsIFwiXCIpO1xuICAgICAgICBhd2FpdCB3cml0ZUZpbGUod29ya2Fyb3VuZENvcGllZERiICsgXCItd2FsXCIsIFwiXCIpO1xuXG4gICAgICAgIGNoZWNrQWJvcnRlZChhYm9ydFNpZ25hbCk7XG4gICAgICB9XG5cbiAgICAgIGRiID0gbmV3IHNxbGl0ZTMuRGF0YWJhc2VTeW5jKHdvcmthcm91bmRDb3BpZWREYiwgeyBvcGVuOiBmYWxzZSwgcmVhZE9ubHk6IHRydWUgfSk7XG4gICAgICBkYi5vcGVuKCk7XG4gICAgICBjaGVja0Fib3J0ZWQoYWJvcnRTaWduYWwpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHN0YXRlbWVudCA9IGRiLnByZXBhcmUocXVlcnkpO1xuICBjaGVja0Fib3J0ZWQoYWJvcnRTaWduYWwpO1xuXG4gIGNvbnN0IHJlc3VsdCA9IHN0YXRlbWVudC5hbGwoKTtcblxuICBkYi5jbG9zZSgpO1xuXG4gIHJldHVybiByZXN1bHQgYXMgVFtdO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzcWxpdGVGYWxsYmFjazxUID0gdW5rbm93bj4oXG4gIGRhdGFiYXNlUGF0aDogc3RyaW5nLFxuICBxdWVyeTogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIHNpZ25hbD86IEFib3J0U2lnbmFsO1xuICB9LFxuKTogUHJvbWlzZTxUW10+IHtcbiAgY29uc3QgYWJvcnRTaWduYWwgPSBvcHRpb25zPy5zaWduYWw7XG5cbiAgbGV0IHNwYXduZWQgPSBjaGlsZFByb2Nlc3Muc3Bhd24oXCJzcWxpdGUzXCIsIFtcIi0tanNvblwiLCBcIi0tcmVhZG9ubHlcIiwgZGF0YWJhc2VQYXRoLCBxdWVyeV0sIHsgc2lnbmFsOiBhYm9ydFNpZ25hbCB9KTtcbiAgbGV0IHNwYXduZWRQcm9taXNlID0gZ2V0U3Bhd25lZFByb21pc2Uoc3Bhd25lZCk7XG4gIGxldCBbeyBlcnJvciwgZXhpdENvZGUsIHNpZ25hbCB9LCBzdGRvdXRSZXN1bHQsIHN0ZGVyclJlc3VsdF0gPSBhd2FpdCBnZXRTcGF3bmVkUmVzdWx0PHN0cmluZz4oXG4gICAgc3Bhd25lZCxcbiAgICB7IGVuY29kaW5nOiBcInV0Zi04XCIgfSxcbiAgICBzcGF3bmVkUHJvbWlzZSxcbiAgKTtcbiAgY2hlY2tBYm9ydGVkKGFib3J0U2lnbmFsKTtcblxuICBpZiAoc3RkZXJyUmVzdWx0Lm1hdGNoKFwiKDUpXCIpIHx8IHN0ZGVyclJlc3VsdC5tYXRjaChcIigxNClcIikpIHtcbiAgICAvLyBUaGF0IG1lYW5zIHRoYXQgdGhlIERCIGlzIGJ1c3kgYmVjYXVzZSBvZiBhbm90aGVyIGFwcCBpcyBsb2NraW5nIGl0XG4gICAgLy8gVGhpcyBoYXBwZW5zIHdoZW4gQ2hyb21lIG9yIEFyYyBpcyBvcGVuZWQ6IHRoZXkgbG9jayB0aGUgSGlzdG9yeSBkYi5cbiAgICAvLyBBcyBhbiB1Z2x5IHdvcmthcm91bmQsIHdlIGR1cGxpY2F0ZSB0aGUgZmlsZSBhbmQgcmVhZCB0aGF0IGluc3RlYWRcbiAgICAvLyAod2l0aCB2ZnMgdW5peCAtIG5vbmUgdG8ganVzdCBub3QgY2FyZSBhYm91dCBsb2NrcylcbiAgICBsZXQgd29ya2Fyb3VuZENvcGllZERiOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgaWYgKCF3b3JrYXJvdW5kQ29waWVkRGIpIHtcbiAgICAgIGNvbnN0IHRlbXBGb2xkZXIgPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIFwidXNlU1FMXCIsIGhhc2goZGF0YWJhc2VQYXRoKSk7XG4gICAgICBhd2FpdCBta2Rpcih0ZW1wRm9sZGVyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIGNoZWNrQWJvcnRlZChhYm9ydFNpZ25hbCk7XG5cbiAgICAgIHdvcmthcm91bmRDb3BpZWREYiA9IHBhdGguam9pbih0ZW1wRm9sZGVyLCBcImRiLmRiXCIpO1xuICAgICAgYXdhaXQgY29weUZpbGUoZGF0YWJhc2VQYXRoLCB3b3JrYXJvdW5kQ29waWVkRGIpO1xuXG4gICAgICBhd2FpdCB3cml0ZUZpbGUod29ya2Fyb3VuZENvcGllZERiICsgXCItc2htXCIsIFwiXCIpO1xuICAgICAgYXdhaXQgd3JpdGVGaWxlKHdvcmthcm91bmRDb3BpZWREYiArIFwiLXdhbFwiLCBcIlwiKTtcblxuICAgICAgY2hlY2tBYm9ydGVkKGFib3J0U2lnbmFsKTtcbiAgICB9XG5cbiAgICBzcGF3bmVkID0gY2hpbGRQcm9jZXNzLnNwYXduKFwic3FsaXRlM1wiLCBbXCItLWpzb25cIiwgXCItLXJlYWRvbmx5XCIsIFwiLS12ZnNcIiwgXCJ1bml4LW5vbmVcIiwgd29ya2Fyb3VuZENvcGllZERiLCBxdWVyeV0sIHtcbiAgICAgIHNpZ25hbDogYWJvcnRTaWduYWwsXG4gICAgfSk7XG4gICAgc3Bhd25lZFByb21pc2UgPSBnZXRTcGF3bmVkUHJvbWlzZShzcGF3bmVkKTtcbiAgICBbeyBlcnJvciwgZXhpdENvZGUsIHNpZ25hbCB9LCBzdGRvdXRSZXN1bHQsIHN0ZGVyclJlc3VsdF0gPSBhd2FpdCBnZXRTcGF3bmVkUmVzdWx0PHN0cmluZz4oXG4gICAgICBzcGF3bmVkLFxuICAgICAgeyBlbmNvZGluZzogXCJ1dGYtOFwiIH0sXG4gICAgICBzcGF3bmVkUHJvbWlzZSxcbiAgICApO1xuICAgIGNoZWNrQWJvcnRlZChhYm9ydFNpZ25hbCk7XG4gIH1cblxuICBpZiAoZXJyb3IgfHwgZXhpdENvZGUgIT09IDAgfHwgc2lnbmFsICE9PSBudWxsKSB7XG4gICAgaWYgKHN0ZGVyclJlc3VsdC5pbmNsdWRlcyhcImF1dGhvcml6YXRpb24gZGVuaWVkXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgUGVybWlzc2lvbkVycm9yKFwiWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoZSBkYXRhYmFzZS5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihzdGRlcnJSZXN1bHQgfHwgXCJVbmtub3duIGVycm9yXCIpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBKU09OLnBhcnNlKHN0ZG91dFJlc3VsdC50cmltKCkgfHwgXCJbXVwiKSBhcyBUW107XG59XG5cbmZ1bmN0aW9uIGNoZWNrQWJvcnRlZChzaWduYWw/OiBBYm9ydFNpZ25hbCkge1xuICBpZiAoc2lnbmFsPy5hYm9ydGVkKSB7XG4gICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJhYm9ydGVkXCIpO1xuICAgIGVycm9yLm5hbWUgPSBcIkFib3J0RXJyb3JcIjtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuIiwgImltcG9ydCB7IEZvcm0gfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZU1lbW8sIHVzZVJlZiwgU2V0U3RhdGVBY3Rpb24gfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVzZUxhdGVzdCB9IGZyb20gXCIuL3VzZUxhdGVzdFwiO1xuXG4vKipcbiAqIFNob3J0aGFuZHMgZm9yIGNvbW1vbiB2YWxpZGF0aW9uIGNhc2VzXG4gKi9cbmV4cG9ydCBlbnVtIEZvcm1WYWxpZGF0aW9uIHtcbiAgLyoqIFNob3cgYW4gZXJyb3Igd2hlbiB0aGUgdmFsdWUgb2YgdGhlIGl0ZW0gaXMgZW1wdHkgKi9cbiAgUmVxdWlyZWQgPSBcInJlcXVpcmVkXCIsXG59XG5cbnR5cGUgVmFsaWRhdGlvbkVycm9yID0gc3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbDtcbnR5cGUgVmFsaWRhdG9yPFZhbHVlVHlwZT4gPSAoKHZhbHVlOiBWYWx1ZVR5cGUgfCB1bmRlZmluZWQpID0+IFZhbGlkYXRpb25FcnJvcikgfCBGb3JtVmFsaWRhdGlvbjtcblxuZnVuY3Rpb24gdmFsaWRhdGlvbkVycm9yPFZhbHVlVHlwZT4oXG4gIHZhbGlkYXRpb246IFZhbGlkYXRvcjxWYWx1ZVR5cGU+IHwgdW5kZWZpbmVkLFxuICB2YWx1ZTogVmFsdWVUeXBlIHwgdW5kZWZpbmVkLFxuKTogVmFsaWRhdGlvbkVycm9yIHtcbiAgaWYgKHZhbGlkYXRpb24pIHtcbiAgICBpZiAodHlwZW9mIHZhbGlkYXRpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuIHZhbGlkYXRpb24odmFsdWUpO1xuICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbiA9PT0gRm9ybVZhbGlkYXRpb24uUmVxdWlyZWQpIHtcbiAgICAgIGxldCB2YWx1ZUlzVmFsaWQgPSB0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsdWUgIT09IG51bGw7XG4gICAgICBpZiAodmFsdWVJc1ZhbGlkKSB7XG4gICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7XG4gICAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgdmFsdWVJc1ZhbGlkID0gdmFsdWUubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJvYmplY3RcIjpcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSB2YWx1ZS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgdmFsdWVJc1ZhbGlkID0gdmFsdWUuZ2V0VGltZSgpID4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF2YWx1ZUlzVmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIFwiVGhlIGl0ZW0gaXMgcmVxdWlyZWRcIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxudHlwZSBWYWxpZGF0aW9uPFQgZXh0ZW5kcyBGb3JtLlZhbHVlcz4gPSB7IFtpZCBpbiBrZXlvZiBUXT86IFZhbGlkYXRvcjxUW2lkXT4gfTtcblxuaW50ZXJmYWNlIEZvcm1Qcm9wczxUIGV4dGVuZHMgRm9ybS5WYWx1ZXM+IHtcbiAgLyoqIEZ1bmN0aW9uIHRvIHBhc3MgdG8gdGhlIGBvblN1Ym1pdGAgcHJvcCBvZiB0aGUgYDxBY3Rpb24uU3VibWl0Rm9ybT5gIGVsZW1lbnQuIEl0IHdyYXBzIHRoZSBpbml0aWFsIGBvblN1Ym1pdGAgYXJndW1lbnQgd2l0aCBzb21lIGdvb2RpZXMgcmVsYXRlZCB0byB0aGUgdmFsaWRhdGlvbi4gKi9cbiAgaGFuZGxlU3VibWl0OiAodmFsdWVzOiBUKSA9PiB2b2lkIHwgYm9vbGVhbiB8IFByb21pc2U8dm9pZCB8IGJvb2xlYW4+O1xuICAvKiogVGhlIHByb3BzIHRoYXQgbXVzdCBiZSBwYXNzZWQgdG8gdGhlIGA8Rm9ybS5JdGVtPmAgZWxlbWVudHMgdG8gaGFuZGxlIHRoZSB2YWxpZGF0aW9ucy4gKi9cbiAgaXRlbVByb3BzOiB7XG4gICAgW2lkIGluIGtleW9mIFJlcXVpcmVkPFQ+XTogUGFydGlhbDxGb3JtLkl0ZW1Qcm9wczxUW2lkXT4+ICYge1xuICAgICAgaWQ6IHN0cmluZztcbiAgICB9O1xuICB9O1xuICAvKiogRnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBwcm9ncmFtbWF0aWNhbGx5IHNldCB0aGUgdmFsaWRhdGlvbiBvZiBhIHNwZWNpZmljIGZpZWxkLiAqL1xuICBzZXRWYWxpZGF0aW9uRXJyb3I6IChpZDoga2V5b2YgVCwgZXJyb3I6IFZhbGlkYXRpb25FcnJvcikgPT4gdm9pZDtcbiAgLyoqIEZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gcHJvZ3JhbW1hdGljYWxseSBzZXQgdGhlIHZhbHVlIG9mIGEgc3BlY2lmaWMgZmllbGQuICovXG4gIHNldFZhbHVlOiA8SyBleHRlbmRzIGtleW9mIFQ+KGlkOiBLLCB2YWx1ZTogU2V0U3RhdGVBY3Rpb248VFtLXT4pID0+IHZvaWQ7XG4gIC8qKiBUaGUgY3VycmVudCB2YWx1ZXMgb2YgdGhlIGZvcm0uICovXG4gIHZhbHVlczogVDtcbiAgLyoqIEZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gcHJvZ3JhbW1hdGljYWxseSBmb2N1cyBhIHNwZWNpZmljIGZpZWxkLiAqL1xuICBmb2N1czogKGlkOiBrZXlvZiBUKSA9PiB2b2lkO1xuICAvKiogRnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byByZXNldCB0aGUgdmFsdWVzIG9mIHRoZSBGb3JtLiAqL1xuICByZXNldDogKGluaXRpYWxWYWx1ZXM/OiBQYXJ0aWFsPFQ+KSA9PiB2b2lkO1xufVxuXG4vKipcbiAqIEhvb2sgdGhhdCBwcm92aWRlcyBhIGhpZ2gtbGV2ZWwgaW50ZXJmYWNlIHRvIHdvcmsgd2l0aCBGb3JtcywgYW5kIG1vcmUgcGFydGljdWxhcmx5LCB3aXRoIEZvcm0gdmFsaWRhdGlvbnMuIEl0IGluY29ycG9yYXRlcyBhbGwgdGhlIGdvb2QgcHJhY3RpY2VzIHRvIHByb3ZpZGUgYSBncmVhdCBVc2VyIEV4cGVyaWVuY2UgZm9yIHlvdXIgRm9ybXMuXG4gKlxuICogQHJldHVybnMgYW4gb2JqZWN0IHdoaWNoIGNvbnRhaW5zIHRoZSBuZWNlc3NhcnkgbWV0aG9kcyBhbmQgcHJvcHMgdG8gcHJvdmlkZSBhIGdvb2QgVXNlciBFeHBlcmllbmNlIGluIHlvdXIgRm9ybS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBpbXBvcnQgeyBBY3Rpb24sIEFjdGlvblBhbmVsLCBGb3JtLCBzaG93VG9hc3QsIFRvYXN0IH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuICogaW1wb3J0IHsgdXNlRm9ybSwgRm9ybVZhbGlkYXRpb24gfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqXG4gKiBpbnRlcmZhY2UgU2lnblVwRm9ybVZhbHVlcyB7XG4gKiAgIG5pY2tuYW1lOiBzdHJpbmc7XG4gKiAgIHBhc3N3b3JkOiBzdHJpbmc7XG4gKiB9XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tbWFuZCgpIHtcbiAqICAgY29uc3QgeyBoYW5kbGVTdWJtaXQsIGl0ZW1Qcm9wcyB9ID0gdXNlRm9ybTxTaWduVXBGb3JtVmFsdWVzPih7XG4gKiAgICAgb25TdWJtaXQodmFsdWVzKSB7XG4gKiAgICAgICBzaG93VG9hc3QoVG9hc3QuU3R5bGUuU3VjY2VzcywgXCJZYXkhXCIsIGAke3ZhbHVlcy5uaWNrbmFtZX0gYWNjb3VudCBjcmVhdGVkYCk7XG4gKiAgICAgfSxcbiAqICAgICB2YWxpZGF0aW9uOiB7XG4gKiAgICAgICBuaWNrbmFtZTogRm9ybVZhbGlkYXRpb24uUmVxdWlyZWQsXG4gKiAgICAgICBwYXNzd29yZDogKHZhbHVlKSA9PiB7XG4gKiAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPCA4KSB7XG4gKiAgICAgICAgICAgcmV0dXJuIFwiUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IHN5bWJvbHNcIjtcbiAqICAgICAgICAgfSBlbHNlIGlmICghdmFsdWUpIHtcbiAqICAgICAgICAgICByZXR1cm4gXCJUaGUgaXRlbSBpcyByZXF1aXJlZFwiO1xuICogICAgICAgICB9XG4gKiAgICAgICB9LFxuICogICAgIH0sXG4gKiAgIH0pO1xuICpcbiAqICAgcmV0dXJuIChcbiAqICAgICA8Rm9ybVxuICogICAgICAgYWN0aW9ucz17XG4gKiAgICAgICAgIDxBY3Rpb25QYW5lbD5cbiAqICAgICAgICAgICA8QWN0aW9uLlN1Ym1pdEZvcm0gdGl0bGU9XCJTdWJtaXRcIiBvblN1Ym1pdD17aGFuZGxlU3VibWl0fSAvPlxuICogICAgICAgICA8L0FjdGlvblBhbmVsPlxuICogICAgICAgfVxuICogICAgID5cbiAqICAgICAgIDxGb3JtLlRleHRGaWVsZCB0aXRsZT1cIk5pY2tuYW1lXCIgcGxhY2Vob2xkZXI9XCJFbnRlciB5b3VyIG5pY2tuYW1lXCIgey4uLml0ZW1Qcm9wcy5uaWNrbmFtZX0gLz5cbiAqICAgICAgIDxGb3JtLlBhc3N3b3JkRmllbGRcbiAqICAgICAgICAgdGl0bGU9XCJQYXNzd29yZFwiXG4gKiAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgcGFzc3dvcmQgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmdcIlxuICogICAgICAgICB7Li4uaXRlbVByb3BzLnBhc3N3b3JkfVxuICogICAgICAgLz5cbiAqICAgICA8L0Zvcm0+XG4gKiAgICk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUZvcm08VCBleHRlbmRzIEZvcm0uVmFsdWVzPihwcm9wczoge1xuICAvKiogQ2FsbGJhY2sgdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBmb3JtIGlzIHN1Ym1pdHRlZCBhbmQgYWxsIHZhbGlkYXRpb25zIHBhc3MuICovXG4gIG9uU3VibWl0OiAodmFsdWVzOiBUKSA9PiB2b2lkIHwgYm9vbGVhbiB8IFByb21pc2U8dm9pZCB8IGJvb2xlYW4+O1xuICAvKiogVGhlIGluaXRpYWwgdmFsdWVzIHRvIHNldCB3aGVuIHRoZSBGb3JtIGlzIGZpcnN0IHJlbmRlcmVkLiAqL1xuICBpbml0aWFsVmFsdWVzPzogUGFydGlhbDxUPjtcbiAgLyoqIFRoZSB2YWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgRm9ybS4gQSB2YWxpZGF0aW9uIGZvciBhIEZvcm0gaXRlbSBpcyBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIGl0ZW0gYXMgYW4gYXJndW1lbnQgYW5kIG11c3QgcmV0dXJuIGEgc3RyaW5nIHdoZW4gdGhlIHZhbGlkYXRpb24gaXMgZmFpbGluZy5cbiAgICpcbiAgICogVGhlcmUgYXJlIGFsc28gc29tZSBzaG9ydGhhbmRzIGZvciBjb21tb24gY2FzZXMsIHNlZSB7QGxpbmsgRm9ybVZhbGlkYXRpb259LlxuICAgKiAqL1xuICB2YWxpZGF0aW9uPzogVmFsaWRhdGlvbjxUPjtcbn0pOiBGb3JtUHJvcHM8VD4ge1xuICBjb25zdCB7IG9uU3VibWl0OiBfb25TdWJtaXQsIHZhbGlkYXRpb24sIGluaXRpYWxWYWx1ZXMgPSB7fSB9ID0gcHJvcHM7XG5cbiAgLy8gQHRzLWV4cGVjdC1lcnJvciBpdCdzIGZpbmUgaWYgd2UgZG9uJ3Qgc3BlY2lmeSBhbGwgdGhlIHZhbHVlc1xuICBjb25zdCBbdmFsdWVzLCBzZXRWYWx1ZXNdID0gdXNlU3RhdGU8VD4oaW5pdGlhbFZhbHVlcyk7XG4gIGNvbnN0IFtlcnJvcnMsIHNldEVycm9yc10gPSB1c2VTdGF0ZTx7IFtpZCBpbiBrZXlvZiBUXT86IFZhbGlkYXRpb25FcnJvciB9Pih7fSk7XG4gIGNvbnN0IHJlZnMgPSB1c2VSZWY8eyBbaWQgaW4ga2V5b2YgVF0/OiBGb3JtLkl0ZW1SZWZlcmVuY2UgfT4oe30pO1xuXG4gIGNvbnN0IGxhdGVzdFZhbGlkYXRpb24gPSB1c2VMYXRlc3Q8VmFsaWRhdGlvbjxUPj4odmFsaWRhdGlvbiB8fCB7fSk7XG4gIGNvbnN0IGxhdGVzdE9uU3VibWl0ID0gdXNlTGF0ZXN0KF9vblN1Ym1pdCk7XG5cbiAgY29uc3QgZm9jdXMgPSB1c2VDYWxsYmFjayhcbiAgICAoaWQ6IGtleW9mIFQpID0+IHtcbiAgICAgIHJlZnMuY3VycmVudFtpZF0/LmZvY3VzKCk7XG4gICAgfSxcbiAgICBbcmVmc10sXG4gICk7XG5cbiAgY29uc3QgaGFuZGxlU3VibWl0ID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKHZhbHVlczogVCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgICAgbGV0IHZhbGlkYXRpb25FcnJvcnM6IGZhbHNlIHwgeyBba2V5IGluIGtleW9mIFRdPzogVmFsaWRhdGlvbkVycm9yIH0gPSBmYWxzZTtcbiAgICAgIGZvciAoY29uc3QgW2lkLCB2YWxpZGF0aW9uXSBvZiBPYmplY3QuZW50cmllcyhsYXRlc3RWYWxpZGF0aW9uLmN1cnJlbnQpKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gdmFsaWRhdGlvbkVycm9yKHZhbGlkYXRpb24sIHZhbHVlc1tpZF0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBpZiAoIXZhbGlkYXRpb25FcnJvcnMpIHtcbiAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnMgPSB7fTtcbiAgICAgICAgICAgIC8vIHdlIGZvY3VzIHRoZSBmaXJzdCBpdGVtIHRoYXQgaGFzIGFuIGVycm9yXG4gICAgICAgICAgICBmb2N1cyhpZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnNbaWQgYXMga2V5b2YgVF0gPSBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHZhbGlkYXRpb25FcnJvcnMpIHtcbiAgICAgICAgc2V0RXJyb3JzKHZhbGlkYXRpb25FcnJvcnMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsYXRlc3RPblN1Ym1pdC5jdXJyZW50KHZhbHVlcyk7XG4gICAgICByZXR1cm4gdHlwZW9mIHJlc3VsdCA9PT0gXCJib29sZWFuXCIgPyByZXN1bHQgOiB0cnVlO1xuICAgIH0sXG4gICAgW2xhdGVzdFZhbGlkYXRpb24sIGxhdGVzdE9uU3VibWl0LCBmb2N1c10sXG4gICk7XG5cbiAgY29uc3Qgc2V0VmFsaWRhdGlvbkVycm9yID0gdXNlQ2FsbGJhY2soXG4gICAgKGlkOiBrZXlvZiBULCBlcnJvcjogVmFsaWRhdGlvbkVycm9yKSA9PiB7XG4gICAgICBzZXRFcnJvcnMoKGVycm9ycykgPT4gKHsgLi4uZXJyb3JzLCBbaWRdOiBlcnJvciB9KSk7XG4gICAgfSxcbiAgICBbc2V0RXJyb3JzXSxcbiAgKTtcblxuICBjb25zdCBzZXRWYWx1ZSA9IHVzZUNhbGxiYWNrKFxuICAgIGZ1bmN0aW9uIDxLIGV4dGVuZHMga2V5b2YgVD4oaWQ6IEssIHZhbHVlOiBTZXRTdGF0ZUFjdGlvbjxUW0tdPikge1xuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUUyBpcyBhbHdheXMgY29uZnVzZWQgYWJvdXQgU2V0U3RhdGVBY3Rpb24sIGJ1dCBpdCdzIGZpbmUgaGVyZVxuICAgICAgc2V0VmFsdWVzKCh2YWx1ZXMpID0+ICh7IC4uLnZhbHVlcywgW2lkXTogdHlwZW9mIHZhbHVlID09PSBcImZ1bmN0aW9uXCIgPyB2YWx1ZSh2YWx1ZXNbaWRdKSA6IHZhbHVlIH0pKTtcbiAgICB9LFxuICAgIFtzZXRWYWx1ZXNdLFxuICApO1xuXG4gIGNvbnN0IGl0ZW1Qcm9wcyA9IHVzZU1lbW88eyBbaWQgaW4ga2V5b2YgUmVxdWlyZWQ8VD5dOiBQYXJ0aWFsPEZvcm0uSXRlbVByb3BzPFRbaWRdPj4gJiB7IGlkOiBzdHJpbmcgfSB9PigoKSA9PiB7XG4gICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBwcm94eSBiZWNhdXNlIHdlIGRvbid0IGFjdHVhbGx5IGhhdmUgYW55IG9iamVjdCB0byBpdGVyYXRlIHRocm91Z2hcbiAgICAvLyBzbyBpbnN0ZWFkIHdlIGR5bmFtaWNhbGx5IGNyZWF0ZSB0aGUgcHJvcHMgd2hlbiByZXF1aXJlZFxuICAgIHJldHVybiBuZXcgUHJveHk8eyBbaWQgaW4ga2V5b2YgUmVxdWlyZWQ8VD5dOiBQYXJ0aWFsPEZvcm0uSXRlbVByb3BzPFRbaWRdPj4gJiB7IGlkOiBzdHJpbmcgfSB9PihcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdGhlIHdob2xlIHBvaW50IG9mIGEgcHJveHkuLi5cbiAgICAgIHt9LFxuICAgICAge1xuICAgICAgICBnZXQodGFyZ2V0LCBpZDoga2V5b2YgVCkge1xuICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBsYXRlc3RWYWxpZGF0aW9uLmN1cnJlbnRbaWRdO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb25DaGFuZ2UodmFsdWUpIHtcbiAgICAgICAgICAgICAgaWYgKGVycm9yc1tpZF0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25FcnJvcih2YWxpZGF0aW9uLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgICAgICAgICAgc2V0VmFsaWRhdGlvbkVycm9yKGlkLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZXRWYWx1ZShpZCwgdmFsdWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQmx1cihldmVudCkge1xuICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25FcnJvcih2YWxpZGF0aW9uLCBldmVudC50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBzZXRWYWxpZGF0aW9uRXJyb3IoaWQsIGVycm9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBlcnJvcnNbaWRdLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAvLyB3ZSBzaG91bGRuJ3QgcmV0dXJuIGB1bmRlZmluZWRgIG90aGVyd2lzZSBpdCB3aWxsIGJlIGFuIHVuY29udHJvbGxlZCBjb21wb25lbnRcbiAgICAgICAgICAgIHZhbHVlOiB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBudWxsIDogdmFsdWUsXG4gICAgICAgICAgICByZWY6IChpbnN0YW5jZTogRm9ybS5JdGVtUmVmZXJlbmNlKSA9PiB7XG4gICAgICAgICAgICAgIHJlZnMuY3VycmVudFtpZF0gPSBpbnN0YW5jZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSBhcyBQYXJ0aWFsPEZvcm0uSXRlbVByb3BzPFRba2V5b2YgVF0+PiAmIHsgaWQ6IHN0cmluZyB9O1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICApO1xuICB9LCBbZXJyb3JzLCBsYXRlc3RWYWxpZGF0aW9uLCBzZXRWYWxpZGF0aW9uRXJyb3IsIHZhbHVlcywgcmVmcywgc2V0VmFsdWVdKTtcblxuICBjb25zdCByZXNldCA9IHVzZUNhbGxiYWNrKFxuICAgICh2YWx1ZXM/OiBQYXJ0aWFsPFQ+KSA9PiB7XG4gICAgICBzZXRFcnJvcnMoe30pO1xuICAgICAgT2JqZWN0LmVudHJpZXMocmVmcy5jdXJyZW50KS5mb3JFYWNoKChbaWQsIHJlZl0pID0+IHtcbiAgICAgICAgaWYgKCF2YWx1ZXM/LltpZF0pIHtcbiAgICAgICAgICByZWY/LnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKHZhbHVlcykge1xuICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIGl0J3MgZmluZSBpZiB3ZSBkb24ndCBzcGVjaWZ5IGFsbCB0aGUgdmFsdWVzXG4gICAgICAgIHNldFZhbHVlcyh2YWx1ZXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3NldFZhbHVlcywgc2V0RXJyb3JzLCByZWZzXSxcbiAgKTtcblxuICByZXR1cm4geyBoYW5kbGVTdWJtaXQsIHNldFZhbGlkYXRpb25FcnJvciwgc2V0VmFsdWUsIHZhbHVlcywgaXRlbVByb3BzLCBmb2N1cywgcmVzZXQgfTtcbn1cbiIsICJpbXBvcnQgeyB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBBSSB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IFByb21pc2VPcHRpb25zLCB1c2VQcm9taXNlIH0gZnJvbSBcIi4vdXNlUHJvbWlzZVwiO1xuaW1wb3J0IHsgRnVuY3Rpb25SZXR1cm5pbmdQcm9taXNlIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuLyoqXG4gKiBTdHJlYW0gYSBwcm9tcHQgY29tcGxldGlvbi5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgRGV0YWlsLCBMYXVuY2hQcm9wcyB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IHVzZSBBSSB9IGZyb20gXCJAcmF5Y2FzdC91dGlsc1wiO1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIENvbW1hbmQocHJvcHM6IExhdW5jaFByb3BzPHsgYXJndW1lbnRzOiB7IHByb21wdDogc3RyaW5nIH0gfT4pIHtcbiAqICAgY29uc3QgeyBpc0xvYWRpbmcsIGRhdGEgfSA9IHVzZUFJKHByb3BzLmFyZ3VtZW50cy5wcm9tcHQpO1xuICpcbiAqICAgcmV0dXJuIDxEZXRhaWwgaXNMb2FkaW5nPXtpc0xvYWRpbmd9IG1hcmtkb3duPXtkYXRhfSAvPjtcbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlQUkoXG4gIHByb21wdDogc3RyaW5nLFxuICBvcHRpb25zOiB7XG4gICAgLyoqXG4gICAgICogQ29uY3JldGUgdGFza3MsIHN1Y2ggYXMgZml4aW5nIGdyYW1tYXIsIHJlcXVpcmUgbGVzcyBjcmVhdGl2aXR5IHdoaWxlIG9wZW4tZW5kZWQgcXVlc3Rpb25zLCBzdWNoIGFzIGdlbmVyYXRpbmcgaWRlYXMsIHJlcXVpcmUgbW9yZS5cbiAgICAgKiBJZiBhIG51bWJlciBpcyBwYXNzZWQsIGl0IG5lZWRzIHRvIGJlIGluIHRoZSByYW5nZSAwLTIuIEZvciBsYXJnZXIgdmFsdWVzLCAyIHdpbGwgYmUgdXNlZC4gRm9yIGxvd2VyIHZhbHVlcywgMCB3aWxsIGJlIHVzZWQuXG4gICAgICovXG4gICAgY3JlYXRpdml0eT86IEFJLkNyZWF0aXZpdHk7XG4gICAgLyoqXG4gICAgICogVGhlIEFJIG1vZGVsIHRvIHVzZSB0byBhbnN3ZXIgdG8gdGhlIHByb21wdC5cbiAgICAgKi9cbiAgICBtb2RlbD86IEFJLk1vZGVsO1xuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdG8gc3RyZWFtIHRoZSBhbnN3ZXIgb3Igb25seSB1cGRhdGUgdGhlIGRhdGEgd2hlbiB0aGUgZW50aXJlIGFuc3dlciBoYXMgYmVlbiByZWNlaXZlZC5cbiAgICAgKi9cbiAgICBzdHJlYW0/OiBib29sZWFuO1xuICB9ICYgT21pdDxQcm9taXNlT3B0aW9uczxGdW5jdGlvblJldHVybmluZ1Byb21pc2U+LCBcImFib3J0YWJsZVwiPiA9IHt9LFxuKSB7XG4gIGNvbnN0IHsgY3JlYXRpdml0eSwgc3RyZWFtLCBtb2RlbCwgLi4udXNlUHJvbWlzZU9wdGlvbnMgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IFtkYXRhLCBzZXREYXRhXSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBhYm9ydGFibGUgPSB1c2VSZWY8QWJvcnRDb250cm9sbGVyPihudWxsKTtcbiAgY29uc3QgeyBpc0xvYWRpbmcsIGVycm9yLCByZXZhbGlkYXRlIH0gPSB1c2VQcm9taXNlKFxuICAgIGFzeW5jIChwcm9tcHQ6IHN0cmluZywgY3JlYXRpdml0eT86IEFJLkNyZWF0aXZpdHksIHNob3VsZFN0cmVhbT86IGJvb2xlYW4pID0+IHtcbiAgICAgIHNldERhdGEoXCJcIik7XG4gICAgICBjb25zdCBzdHJlYW0gPSBBSS5hc2socHJvbXB0LCB7IGNyZWF0aXZpdHksIG1vZGVsLCBzaWduYWw6IGFib3J0YWJsZS5jdXJyZW50Py5zaWduYWwgfSk7XG4gICAgICBpZiAoc2hvdWxkU3RyZWFtID09PSBmYWxzZSkge1xuICAgICAgICBzZXREYXRhKGF3YWl0IHN0cmVhbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHJlYW0ub24oXCJkYXRhXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgc2V0RGF0YSgoeCkgPT4geCArIGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgc3RyZWFtO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3Byb21wdCwgY3JlYXRpdml0eSwgc3RyZWFtXSxcbiAgICB7IC4uLnVzZVByb21pc2VPcHRpb25zLCBhYm9ydGFibGUgfSxcbiAgKTtcblxuICByZXR1cm4geyBpc0xvYWRpbmcsIGRhdGEsIGVycm9yLCByZXZhbGlkYXRlIH07XG59XG4iLCAiaW1wb3J0IHsgdXNlTWVtbywgdXNlQ2FsbGJhY2sgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVzZUxhdGVzdCB9IGZyb20gXCIuL3VzZUxhdGVzdFwiO1xuaW1wb3J0IHsgdXNlQ2FjaGVkU3RhdGUgfSBmcm9tIFwiLi91c2VDYWNoZWRTdGF0ZVwiO1xuXG4vLyBUaGUgYWxnb3JpdGhtIGJlbG93IGlzIGluc3BpcmVkIGJ5IHRoZSBvbmUgdXNlZCBieSBGaXJlZm94OlxuLy8gaHR0cHM6Ly93aWtpLm1vemlsbGEub3JnL1VzZXI6SmVzc2UvTmV3RnJlY2VuY3lcblxudHlwZSBGcmVjZW5jeSA9IHtcbiAgbGFzdFZpc2l0ZWQ6IG51bWJlcjtcbiAgZnJlY2VuY3k6IG51bWJlcjtcbn07XG5cbmNvbnN0IEhBTEZfTElGRV9EQVlTID0gMTA7XG5cbmNvbnN0IE1TX1BFUl9EQVkgPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuXG5jb25zdCBWSVNJVF9UWVBFX1BPSU5UUyA9IHtcbiAgRGVmYXVsdDogMTAwLFxuICBFbWJlZDogMCxcbiAgQm9va21hcms6IDE0MCxcbn07XG5cbmZ1bmN0aW9uIGdldE5ld0ZyZWNlbmN5KGl0ZW0/OiBGcmVjZW5jeSk6IEZyZWNlbmN5IHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgbGFzdFZpc2l0ZWQgPSBpdGVtID8gaXRlbS5sYXN0VmlzaXRlZCA6IDA7XG4gIGNvbnN0IGZyZWNlbmN5ID0gaXRlbSA/IGl0ZW0uZnJlY2VuY3kgOiAwO1xuXG4gIGNvbnN0IHZpc2l0QWdlSW5EYXlzID0gKG5vdyAtIGxhc3RWaXNpdGVkKSAvIE1TX1BFUl9EQVk7XG4gIGNvbnN0IERFQ0FZX1JBVEVfQ09OU1RBTlQgPSBNYXRoLmxvZygyKSAvIChIQUxGX0xJRkVfREFZUyAqIE1TX1BFUl9EQVkpO1xuICBjb25zdCBjdXJyZW50VmlzaXRWYWx1ZSA9IFZJU0lUX1RZUEVfUE9JTlRTLkRlZmF1bHQgKiBNYXRoLmV4cCgtREVDQVlfUkFURV9DT05TVEFOVCAqIHZpc2l0QWdlSW5EYXlzKTtcbiAgY29uc3QgdG90YWxWaXNpdFZhbHVlID0gZnJlY2VuY3kgKyBjdXJyZW50VmlzaXRWYWx1ZTtcblxuICByZXR1cm4ge1xuICAgIGxhc3RWaXNpdGVkOiBub3csXG4gICAgZnJlY2VuY3k6IHRvdGFsVmlzaXRWYWx1ZSxcbiAgfTtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmNvbnN0IGRlZmF1bHRLZXkgPSAoaXRlbTogYW55KTogc3RyaW5nID0+IHtcbiAgaWYgKFxuICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIiAmJlxuICAgICh0eXBlb2YgaXRlbSAhPT0gXCJvYmplY3RcIiB8fCAhaXRlbSB8fCAhKFwiaWRcIiBpbiBpdGVtKSB8fCB0eXBlb2YgaXRlbS5pZCAhPSBcInN0cmluZ1wiKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcGVjaWZ5IGEga2V5IGZ1bmN0aW9uIG9yIG1ha2Ugc3VyZSB5b3VyIGl0ZW1zIGhhdmUgYW4gJ2lkJyBwcm9wZXJ0eVwiKTtcbiAgfVxuICByZXR1cm4gaXRlbS5pZDtcbn07XG5cbi8qKlxuICogU29ydCBhbiBhcnJheSBieSBpdHMgZnJlY2VuY3kgYW5kIHByb3ZpZGUgbWV0aG9kcyB0byB1cGRhdGUgdGhlIGZyZWNlbmN5IG9mIGl0cyBpdGVtcy5cbiAqIEZyZWNlbmN5IGlzIGEgbWVhc3VyZSB0aGF0IGNvbWJpbmVzIGZyZXF1ZW5jeSBhbmQgcmVjZW5jeS4gVGhlIG1vcmUgb2Z0ZW4gYW4gaXRlbSBpcyB2aXNpdGVkL3VzZWQsIGFuZCB0aGUgbW9yZSByZWNlbnRseSBhbiBpdGVtIGlzIHZpc2l0ZWQvdXNlZCwgdGhlIGhpZ2hlciBpdCB3aWxsIHJhbmsuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYFxuICogaW1wb3J0IHsgTGlzdCwgQWN0aW9uUGFuZWwsIEFjdGlvbiwgSWNvbiB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IHVzZUZldGNoLCB1c2VGcmVjZW5jeVNvcnRpbmcgfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBDb21tYW5kKCkge1xuICogICBjb25zdCB7IGlzTG9hZGluZywgZGF0YSB9ID0gdXNlRmV0Y2goXCJodHRwczovL2FwaS5leGFtcGxlXCIpO1xuICogICBjb25zdCB7IGRhdGE6IHNvcnRlZERhdGEsIHZpc2l0SXRlbSwgcmVzZXRSYW5raW5nIH0gPSB1c2VGcmVjZW5jeVNvcnRpbmcoZGF0YSk7XG4gKlxuICogICByZXR1cm4gKFxuICogICAgIDxMaXN0IGlzTG9hZGluZz17aXNMb2FkaW5nfT5cbiAqICAgICAgIHtzb3J0ZWREYXRhLm1hcCgoaXRlbSkgPT4gKFxuICogICAgICAgICA8TGlzdC5JdGVtXG4gKiAgICAgICAgICAga2V5PXtpdGVtLmlkfVxuICogICAgICAgICAgIHRpdGxlPXtpdGVtLnRpdGxlfVxuICogICAgICAgICAgIGFjdGlvbnM9e1xuICogICAgICAgICAgICAgPEFjdGlvblBhbmVsPlxuICogICAgICAgICAgICAgICA8QWN0aW9uLk9wZW5JbkJyb3dzZXIgdXJsPXtpdGVtLnVybH0gb25PcGVuPXsoKSA9PiB2aXNpdEl0ZW0oaXRlbSl9IC8+XG4gKiAgICAgICAgICAgICAgIDxBY3Rpb24uQ29weVRvQ2xpcGJvYXJkIHRpdGxlPVwiQ29weSBMaW5rXCIgY29udGVudD17aXRlbS51cmx9IG9uQ29weT17KCkgPT4gdmlzaXRJdGVtKGl0ZW0pfSAvPlxuICogICAgICAgICAgICAgICA8QWN0aW9uIHRpdGxlPVwiUmVzZXQgUmFua2luZ1wiIGljb249e0ljb24uQXJyb3dDb3VudGVyQ2xvY2t3aXNlfSBvbkFjdGlvbj17KCkgPT4gcmVzZXRSYW5raW5nKGl0ZW0pfSAvPlxuICogICAgICAgICAgICAgPC9BY3Rpb25QYW5lbD5cbiAqICAgICAgICAgICB9XG4gKiAgICAgICAgIC8+XG4gKiAgICAgICApKX1cbiAqICAgICA8L0xpc3Q+XG4gKiAgICk7XG4gKiB9O1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VGcmVjZW5jeVNvcnRpbmc8VCBleHRlbmRzIHsgaWQ6IHN0cmluZyB9PihcbiAgZGF0YT86IFRbXSxcbiAgb3B0aW9ucz86IHsgbmFtZXNwYWNlPzogc3RyaW5nOyBrZXk/OiAoaXRlbTogVCkgPT4gc3RyaW5nOyBzb3J0VW52aXNpdGVkPzogKGE6IFQsIGI6IFQpID0+IG51bWJlciB9LFxuKToge1xuICBkYXRhOiBUW107XG4gIHZpc2l0SXRlbTogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG4gIHJlc2V0UmFua2luZzogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG59O1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUZyZWNlbmN5U29ydGluZzxUPihcbiAgZGF0YTogVFtdIHwgdW5kZWZpbmVkLFxuICBvcHRpb25zOiB7IG5hbWVzcGFjZT86IHN0cmluZzsga2V5OiAoaXRlbTogVCkgPT4gc3RyaW5nOyBzb3J0VW52aXNpdGVkPzogKGE6IFQsIGI6IFQpID0+IG51bWJlciB9LFxuKToge1xuICBkYXRhOiBUW107XG4gIHZpc2l0SXRlbTogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG4gIHJlc2V0UmFua2luZzogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG59O1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUZyZWNlbmN5U29ydGluZzxUPihcbiAgZGF0YT86IFRbXSxcbiAgb3B0aW9ucz86IHsgbmFtZXNwYWNlPzogc3RyaW5nOyBrZXk/OiAoaXRlbTogVCkgPT4gc3RyaW5nOyBzb3J0VW52aXNpdGVkPzogKGE6IFQsIGI6IFQpID0+IG51bWJlciB9LFxuKToge1xuICBkYXRhOiBUW107XG4gIHZpc2l0SXRlbTogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG4gIHJlc2V0UmFua2luZzogKGl0ZW06IFQpID0+IFByb21pc2U8dm9pZD47XG59IHtcbiAgY29uc3Qga2V5UmVmID0gdXNlTGF0ZXN0KG9wdGlvbnM/LmtleSB8fCBkZWZhdWx0S2V5KTtcbiAgY29uc3Qgc29ydFVudmlzaXRlZFJlZiA9IHVzZUxhdGVzdChvcHRpb25zPy5zb3J0VW52aXNpdGVkKTtcblxuICBjb25zdCBbc3RvcmVkRnJlY2VuY2llcywgc2V0U3RvcmVkRnJlY2VuY2llc10gPSB1c2VDYWNoZWRTdGF0ZTxSZWNvcmQ8c3RyaW5nLCBGcmVjZW5jeSB8IHVuZGVmaW5lZD4+KFxuICAgIGByYXljYXN0X2ZyZWNlbmN5XyR7b3B0aW9ucz8ubmFtZXNwYWNlfWAsXG4gICAge30sXG4gICk7XG5cbiAgY29uc3QgdmlzaXRJdGVtID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRnJlY2VuY3koaXRlbTogVCkge1xuICAgICAgY29uc3QgaXRlbUtleSA9IGtleVJlZi5jdXJyZW50KGl0ZW0pO1xuXG4gICAgICBzZXRTdG9yZWRGcmVjZW5jaWVzKChzdG9yZWRGcmVjZW5jaWVzKSA9PiB7XG4gICAgICAgIGNvbnN0IGZyZWNlbmN5ID0gc3RvcmVkRnJlY2VuY2llc1tpdGVtS2V5XTtcbiAgICAgICAgY29uc3QgbmV3RnJlY2VuY3kgPSBnZXROZXdGcmVjZW5jeShmcmVjZW5jeSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5zdG9yZWRGcmVjZW5jaWVzLFxuICAgICAgICAgIFtpdGVtS2V5XTogbmV3RnJlY2VuY3ksXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFtrZXlSZWYsIHNldFN0b3JlZEZyZWNlbmNpZXNdLFxuICApO1xuXG4gIGNvbnN0IHJlc2V0UmFua2luZyA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUZyZWNlbmN5KGl0ZW06IFQpIHtcbiAgICAgIGNvbnN0IGl0ZW1LZXkgPSBrZXlSZWYuY3VycmVudChpdGVtKTtcblxuICAgICAgc2V0U3RvcmVkRnJlY2VuY2llcygoc3RvcmVkRnJlY2VuY2llcykgPT4ge1xuICAgICAgICBjb25zdCBuZXdGcmVuY2VuY2llcyA9IHsgLi4uc3RvcmVkRnJlY2VuY2llcyB9O1xuICAgICAgICBkZWxldGUgbmV3RnJlbmNlbmNpZXNbaXRlbUtleV07XG5cbiAgICAgICAgcmV0dXJuIG5ld0ZyZW5jZW5jaWVzO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBba2V5UmVmLCBzZXRTdG9yZWRGcmVjZW5jaWVzXSxcbiAgKTtcblxuICBjb25zdCBzb3J0ZWREYXRhID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGEuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgZnJlY2VuY3lBID0gc3RvcmVkRnJlY2VuY2llc1trZXlSZWYuY3VycmVudChhKV07XG4gICAgICBjb25zdCBmcmVjZW5jeUIgPSBzdG9yZWRGcmVjZW5jaWVzW2tleVJlZi5jdXJyZW50KGIpXTtcblxuICAgICAgLy8gSWYgYSBoYXMgYSBmcmVjZW5jeSwgYnV0IGIgZG9lc24ndCwgYSBzaG91bGQgY29tZSBmaXJzdFxuICAgICAgaWYgKGZyZWNlbmN5QSAmJiAhZnJlY2VuY3lCKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgYiBoYXMgYSBmcmVjZW5jeSwgYnV0IGEgZG9lc24ndCwgYiBzaG91bGQgY29tZSBmaXJzdFxuICAgICAgaWYgKCFmcmVjZW5jeUEgJiYgZnJlY2VuY3lCKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBib3RoIGZyZWNlbmNpZXMgYXJlIGRlZmluZWQscHV0IHRoZSBvbmUgd2l0aCB0aGUgaGlnaGVyIGZyZWNlbmN5IGZpcnN0XG4gICAgICBpZiAoZnJlY2VuY3lBICYmIGZyZWNlbmN5Qikge1xuICAgICAgICByZXR1cm4gZnJlY2VuY3lCLmZyZWNlbmN5IC0gZnJlY2VuY3lBLmZyZWNlbmN5O1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBib3RoIGZyZWNlbmNpZXMgYXJlIHVuZGVmaW5lZCwga2VlcCB0aGUgb3JpZ2luYWwgb3JkZXJcbiAgICAgIHJldHVybiBzb3J0VW52aXNpdGVkUmVmLmN1cnJlbnQgPyBzb3J0VW52aXNpdGVkUmVmLmN1cnJlbnQoYSwgYikgOiAwO1xuICAgIH0pO1xuICB9LCBbc3RvcmVkRnJlY2VuY2llcywgZGF0YSwga2V5UmVmLCBzb3J0VW52aXNpdGVkUmVmXSk7XG5cbiAgcmV0dXJuIHsgZGF0YTogc29ydGVkRGF0YSwgdmlzaXRJdGVtLCByZXNldFJhbmtpbmcgfTtcbn1cbiIsICJpbXBvcnQgeyBMb2NhbFN0b3JhZ2UgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5pbXBvcnQgeyBzaG93RmFpbHVyZVRvYXN0IH0gZnJvbSBcIi4vc2hvd0ZhaWx1cmVUb2FzdFwiO1xuaW1wb3J0IHsgcmVwbGFjZXIsIHJldml2ZXIgfSBmcm9tIFwiLi9oZWxwZXJzXCI7XG5pbXBvcnQgeyB1c2VQcm9taXNlIH0gZnJvbSBcIi4vdXNlUHJvbWlzZVwiO1xuXG4vKipcbiAqIEEgaG9vayB0byBtYW5hZ2UgYSB2YWx1ZSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cbiAqXG4gKiBAcmVtYXJrIFRoZSB2YWx1ZSBpcyBzdG9yZWQgYXMgYSBKU09OIHN0cmluZyBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cbiAqXG4gKiBAcGFyYW0ga2V5IC0gVGhlIGtleSB0byB1c2UgZm9yIHRoZSB2YWx1ZSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cbiAqIEBwYXJhbSBpbml0aWFsVmFsdWUgLSBUaGUgaW5pdGlhbCB2YWx1ZSB0byB1c2UgaWYgdGhlIGtleSBkb2Vzbid0IGV4aXN0IGluIHRoZSBsb2NhbCBzdG9yYWdlLlxuICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICogLSBgdmFsdWVgOiBUaGUgdmFsdWUgZnJvbSB0aGUgbG9jYWwgc3RvcmFnZSBvciB0aGUgaW5pdGlhbCB2YWx1ZSBpZiB0aGUga2V5IGRvZXNuJ3QgZXhpc3QuXG4gKiAtIGBzZXRWYWx1ZWA6IEEgZnVuY3Rpb24gdG8gdXBkYXRlIHRoZSB2YWx1ZSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cbiAqIC0gYHJlbW92ZVZhbHVlYDogQSBmdW5jdGlvbiB0byByZW1vdmUgdGhlIHZhbHVlIGZyb20gdGhlIGxvY2FsIHN0b3JhZ2UuXG4gKiAtIGBpc0xvYWRpbmdgOiBBIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgdmFsdWUgaXMgbG9hZGluZy5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBjb25zdCB7IHZhbHVlLCBzZXRWYWx1ZSB9ID0gdXNlTG9jYWxTdG9yYWdlPHN0cmluZz4oXCJteS1rZXlcIik7XG4gKiBjb25zdCB7IHZhbHVlLCBzZXRWYWx1ZSB9ID0gdXNlTG9jYWxTdG9yYWdlPHN0cmluZz4oXCJteS1rZXlcIiwgXCJkZWZhdWx0IHZhbHVlXCIpO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VMb2NhbFN0b3JhZ2U8VD4oa2V5OiBzdHJpbmcsIGluaXRpYWxWYWx1ZT86IFQpIHtcbiAgY29uc3Qge1xuICAgIGRhdGE6IHZhbHVlLFxuICAgIGlzTG9hZGluZyxcbiAgICBtdXRhdGUsXG4gIH0gPSB1c2VQcm9taXNlKFxuICAgIGFzeW5jIChzdG9yYWdlS2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBhd2FpdCBMb2NhbFN0b3JhZ2UuZ2V0SXRlbTxzdHJpbmc+KHN0b3JhZ2VLZXkpO1xuXG4gICAgICByZXR1cm4gdHlwZW9mIGl0ZW0gIT09IFwidW5kZWZpbmVkXCIgPyAoSlNPTi5wYXJzZShpdGVtLCByZXZpdmVyKSBhcyBUKSA6IGluaXRpYWxWYWx1ZTtcbiAgICB9LFxuICAgIFtrZXldLFxuICApO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIHNldFZhbHVlKHZhbHVlOiBUKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG11dGF0ZShMb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlLCByZXBsYWNlcikpLCB7XG4gICAgICAgIG9wdGltaXN0aWNVcGRhdGUodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgYXdhaXQgc2hvd0ZhaWx1cmVUb2FzdChlcnJvciwgeyB0aXRsZTogXCJGYWlsZWQgdG8gc2V0IHZhbHVlIGluIGxvY2FsIHN0b3JhZ2VcIiB9KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiByZW1vdmVWYWx1ZSgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbXV0YXRlKExvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSksIHtcbiAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZSgpIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IHNob3dGYWlsdXJlVG9hc3QoZXJyb3IsIHsgdGl0bGU6IFwiRmFpbGVkIHRvIHJlbW92ZSB2YWx1ZSBmcm9tIGxvY2FsIHN0b3JhZ2VcIiB9KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyB2YWx1ZSwgc2V0VmFsdWUsIHJlbW92ZVZhbHVlLCBpc0xvYWRpbmcgfTtcbn1cbiIsICJleHBvcnQgeyBnZXRBdmF0YXJJY29uIH0gZnJvbSBcIi4vYXZhdGFyXCI7XG5leHBvcnQgeyBnZXRGYXZpY29uIH0gZnJvbSBcIi4vZmF2aWNvblwiO1xuZXhwb3J0IHsgZ2V0UHJvZ3Jlc3NJY29uIH0gZnJvbSBcIi4vcHJvZ3Jlc3NcIjtcbiIsICJpbXBvcnQgdHlwZSB7IEltYWdlIH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuaW1wb3J0IHsgc2xpZ2h0bHlMaWdodGVyQ29sb3IsIHNsaWdodGx5RGFya2VyQ29sb3IgfSBmcm9tIFwiLi9jb2xvclwiO1xuXG5mdW5jdGlvbiBnZXRXaG9sZUNoYXJBbmRJKHN0cjogc3RyaW5nLCBpOiBudW1iZXIpOiBbc3RyaW5nLCBudW1iZXJdIHtcbiAgY29uc3QgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuXG4gIGlmIChOdW1iZXIuaXNOYU4oY29kZSkpIHtcbiAgICByZXR1cm4gW1wiXCIsIGldO1xuICB9XG4gIGlmIChjb2RlIDwgMHhkODAwIHx8IGNvZGUgPiAweGRmZmYpIHtcbiAgICByZXR1cm4gW3N0ci5jaGFyQXQoaSksIGldOyAvLyBOb3JtYWwgY2hhcmFjdGVyLCBrZWVwaW5nICdpJyB0aGUgc2FtZVxuICB9XG5cbiAgLy8gSGlnaCBzdXJyb2dhdGUgKGNvdWxkIGNoYW5nZSBsYXN0IGhleCB0byAweERCN0YgdG8gdHJlYXQgaGlnaCBwcml2YXRlXG4gIC8vIHN1cnJvZ2F0ZXMgYXMgc2luZ2xlIGNoYXJhY3RlcnMpXG4gIGlmICgweGQ4MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4ZGJmZikge1xuICAgIGlmIChzdHIubGVuZ3RoIDw9IGkgKyAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIaWdoIHN1cnJvZ2F0ZSB3aXRob3V0IGZvbGxvd2luZyBsb3cgc3Vycm9nYXRlXCIpO1xuICAgIH1cbiAgICBjb25zdCBuZXh0ID0gc3RyLmNoYXJDb2RlQXQoaSArIDEpO1xuICAgIGlmICgweGRjMDAgPiBuZXh0IHx8IG5leHQgPiAweGRmZmYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkhpZ2ggc3Vycm9nYXRlIHdpdGhvdXQgZm9sbG93aW5nIGxvdyBzdXJyb2dhdGVcIik7XG4gICAgfVxuICAgIHJldHVybiBbc3RyLmNoYXJBdChpKSArIHN0ci5jaGFyQXQoaSArIDEpLCBpICsgMV07XG4gIH1cblxuICAvLyBMb3cgc3Vycm9nYXRlICgweERDMDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4REZGRilcbiAgaWYgKGkgPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJMb3cgc3Vycm9nYXRlIHdpdGhvdXQgcHJlY2VkaW5nIGhpZ2ggc3Vycm9nYXRlXCIpO1xuICB9XG5cbiAgY29uc3QgcHJldiA9IHN0ci5jaGFyQ29kZUF0KGkgLSAxKTtcblxuICAvLyAoY291bGQgY2hhbmdlIGxhc3QgaGV4IHRvIDB4REI3RiB0byB0cmVhdCBoaWdoIHByaXZhdGUgc3Vycm9nYXRlc1xuICAvLyBhcyBzaW5nbGUgY2hhcmFjdGVycylcbiAgaWYgKDB4ZDgwMCA+IHByZXYgfHwgcHJldiA+IDB4ZGJmZikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkxvdyBzdXJyb2dhdGUgd2l0aG91dCBwcmVjZWRpbmcgaGlnaCBzdXJyb2dhdGVcIik7XG4gIH1cblxuICAvLyBSZXR1cm4gdGhlIG5leHQgY2hhcmFjdGVyIGluc3RlYWQgKGFuZCBpbmNyZW1lbnQpXG4gIHJldHVybiBbc3RyLmNoYXJBdChpICsgMSksIGkgKyAxXTtcbn1cblxuY29uc3QgYXZhdGFyQ29sb3JTZXQgPSBbXG4gIFwiI0RDODI5QVwiLCAvLyBQaW5rXG4gIFwiI0Q2NDg1NFwiLCAvLyBSZWRcbiAgXCIjRDQ3NjAwXCIsIC8vIFllbGxvd09yYW5nZVxuICBcIiNEMzZDRERcIiwgLy8gTWFnZW50YVxuICBcIiM1MkE5RTRcIiwgLy8gQXF1YVxuICBcIiM3ODcxRThcIiwgLy8gSW5kaWdvXG4gIFwiIzcwOTIwRlwiLCAvLyBZZWxsb3dHcmVlblxuICBcIiM0M0I5M0FcIiwgLy8gR3JlZW5cbiAgXCIjRUI2QjNFXCIsIC8vIE9yYW5nZVxuICBcIiMyNkI3OTVcIiwgLy8gQmx1ZUdyZWVuXG4gIFwiI0Q4NUE5QlwiLCAvLyBIb3RQaW5rXG4gIFwiI0EwNjdEQ1wiLCAvLyBQdXJwbGVcbiAgXCIjQkQ5NTAwXCIsIC8vIFllbGxvd1xuICBcIiM1Mzg1RDlcIiwgLy8gQmx1ZVxuXTtcblxuLyoqXG4gKiBJY29uIHRvIHJlcHJlc2VudCBhbiBhdmF0YXIgd2hlbiB5b3UgZG9uJ3QgaGF2ZSBvbmUuIFRoZSBnZW5lcmF0ZWQgYXZhdGFyXG4gKiB3aWxsIGJlIGdlbmVyYXRlZCBmcm9tIHRoZSBpbml0aWFscyBvZiB0aGUgbmFtZSBhbmQgaGF2ZSBhIGNvbG9yZnVsIGJ1dCBjb25zaXN0ZW50IGJhY2tncm91bmQuXG4gKlxuICogQHJldHVybnMgYW4gSW1hZ2UgdGhhdCBjYW4gYmUgdXNlZCB3aGVyZSBSYXljYXN0IGV4cGVjdHMgdGhlbS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiA8TGlzdC5JdGVtIGljb249e2dldEF2YXRhckljb24oJ01hdGhpZXUgRHV0b3VyJyl9IHRpdGxlPVwiUHJvamVjdFwiIC8+XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEF2YXRhckljb24oXG4gIG5hbWU6IHN0cmluZyxcbiAgb3B0aW9ucz86IHtcbiAgICAvKipcbiAgICAgKiBDdXN0b20gYmFja2dyb3VuZCBjb2xvclxuICAgICAqL1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogV2hldGhlciB0byB1c2UgYSBncmFkaWVudCBmb3IgdGhlIGJhY2tncm91bmQgb3Igbm90LlxuICAgICAqIEBkZWZhdWx0IHRydWVcbiAgICAgKi9cbiAgICBncmFkaWVudD86IGJvb2xlYW47XG4gIH0sXG4pOiBJbWFnZS5Bc3NldCB7XG4gIGNvbnN0IHdvcmRzID0gbmFtZS50cmltKCkuc3BsaXQoXCIgXCIpO1xuICBsZXQgaW5pdGlhbHM6IHN0cmluZztcbiAgaWYgKHdvcmRzLmxlbmd0aCA9PSAxICYmIGdldFdob2xlQ2hhckFuZEkod29yZHNbMF0sIDApWzBdKSB7XG4gICAgaW5pdGlhbHMgPSBnZXRXaG9sZUNoYXJBbmRJKHdvcmRzWzBdLCAwKVswXTtcbiAgfSBlbHNlIGlmICh3b3Jkcy5sZW5ndGggPiAxKSB7XG4gICAgY29uc3QgZmlyc3RXb3JkRmlyc3RMZXR0ZXIgPSBnZXRXaG9sZUNoYXJBbmRJKHdvcmRzWzBdLCAwKVswXSB8fCBcIlwiO1xuICAgIGNvbnN0IGxhc3RXb3JkRmlyc3RMZXR0ZXIgPSBnZXRXaG9sZUNoYXJBbmRJKHdvcmRzW3dvcmRzLmxlbmd0aCAtIDFdLCAwKVswXSA/PyBcIlwiO1xuICAgIGluaXRpYWxzID0gZmlyc3RXb3JkRmlyc3RMZXR0ZXIgKyBsYXN0V29yZEZpcnN0TGV0dGVyO1xuICB9IGVsc2Uge1xuICAgIGluaXRpYWxzID0gXCJcIjtcbiAgfVxuXG4gIGxldCBiYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcblxuICBpZiAob3B0aW9ucz8uYmFja2dyb3VuZCkge1xuICAgIGJhY2tncm91bmRDb2xvciA9IG9wdGlvbnM/LmJhY2tncm91bmQ7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGluaXRpYWxzQ2hhckluZGV4ID0gMDtcbiAgICBsZXQgW2NoYXIsIGldID0gZ2V0V2hvbGVDaGFyQW5kSShpbml0aWFscywgMCk7XG4gICAgd2hpbGUgKGNoYXIpIHtcbiAgICAgIGluaXRpYWxzQ2hhckluZGV4ICs9IGNoYXIuY2hhckNvZGVBdCgwKTtcbiAgICAgIFtjaGFyLCBpXSA9IGdldFdob2xlQ2hhckFuZEkoaW5pdGlhbHMsIGkgKyAxKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb2xvckluZGV4ID0gaW5pdGlhbHNDaGFySW5kZXggJSBhdmF0YXJDb2xvclNldC5sZW5ndGg7XG4gICAgYmFja2dyb3VuZENvbG9yID0gYXZhdGFyQ29sb3JTZXRbY29sb3JJbmRleF07XG4gIH1cblxuICBjb25zdCBwYWRkaW5nID0gMDtcbiAgY29uc3QgcmFkaXVzID0gNTAgLSBwYWRkaW5nO1xuXG4gIGNvbnN0IHN2ZyA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjEwMHB4XCIgaGVpZ2h0PVwiMTAwcHhcIj5cbiAgJHtcbiAgICBvcHRpb25zPy5ncmFkaWVudCAhPT0gZmFsc2VcbiAgICAgID8gYDxkZWZzPlxuICAgICAgPGxpbmVhckdyYWRpZW50IGlkPVwiR3JhZGllbnRcIiB4MT1cIjAuMjVcIiB4Mj1cIjAuNzVcIiB5MT1cIjBcIiB5Mj1cIjFcIj5cbiAgICAgICAgPHN0b3Agb2Zmc2V0PVwiMCVcIiBzdG9wLWNvbG9yPVwiJHtzbGlnaHRseUxpZ2h0ZXJDb2xvcihiYWNrZ3JvdW5kQ29sb3IpfVwiLz5cbiAgICAgICAgPHN0b3Agb2Zmc2V0PVwiNTAlXCIgc3RvcC1jb2xvcj1cIiR7YmFja2dyb3VuZENvbG9yfVwiLz5cbiAgICAgICAgPHN0b3Agb2Zmc2V0PVwiMTAwJVwiIHN0b3AtY29sb3I9XCIke3NsaWdodGx5RGFya2VyQ29sb3IoYmFja2dyb3VuZENvbG9yKX1cIi8+XG4gICAgICA8L2xpbmVhckdyYWRpZW50PlxuICA8L2RlZnM+YFxuICAgICAgOiBcIlwiXG4gIH1cbiAgICAgIDxjaXJjbGUgY3g9XCI1MFwiIGN5PVwiNTBcIiByPVwiJHtyYWRpdXN9XCIgZmlsbD1cIiR7XG4gICAgICAgIG9wdGlvbnM/LmdyYWRpZW50ICE9PSBmYWxzZSA/IFwidXJsKCNHcmFkaWVudClcIiA6IGJhY2tncm91bmRDb2xvclxuICAgICAgfVwiIC8+XG4gICAgICAke1xuICAgICAgICBpbml0aWFsc1xuICAgICAgICAgID8gYDx0ZXh0IHg9XCI1MFwiIHk9XCI4MFwiIGZvbnQtc2l6ZT1cIiR7XG4gICAgICAgICAgICAgIHJhZGl1cyAtIDFcbiAgICAgICAgICAgIH1cIiBmb250LWZhbWlseT1cIkludGVyLCBzYW5zLXNlcmlmXCIgdGV4dC1hbmNob3I9XCJtaWRkbGVcIiBmaWxsPVwid2hpdGVcIj4ke2luaXRpYWxzLnRvVXBwZXJDYXNlKCl9PC90ZXh0PmBcbiAgICAgICAgICA6IFwiXCJcbiAgICAgIH1cbiAgICA8L3N2Zz5cbiAgYC5yZXBsYWNlQWxsKFwiXFxuXCIsIFwiXCIpO1xuICByZXR1cm4gYGRhdGE6aW1hZ2Uvc3ZnK3htbCwke2VuY29kZVVSSUNvbXBvbmVudChzdmcpfWA7XG59XG4iLCAiZnVuY3Rpb24gaGV4VG9SR0IoaGV4OiBzdHJpbmcpIHtcbiAgbGV0IHIgPSAwO1xuICBsZXQgZyA9IDA7XG4gIGxldCBiID0gMDtcblxuICAvLyAzIGRpZ2l0c1xuICBpZiAoaGV4Lmxlbmd0aCA9PT0gNCkge1xuICAgIHIgPSBwYXJzZUludChgJHtoZXhbMV19JHtoZXhbMV19YCwgMTYpO1xuICAgIGcgPSBwYXJzZUludChgJHtoZXhbMl19JHtoZXhbMl19YCwgMTYpO1xuICAgIGIgPSBwYXJzZUludChgJHtoZXhbM119JHtoZXhbM119YCwgMTYpO1xuXG4gICAgLy8gNiBkaWdpdHNcbiAgfSBlbHNlIGlmIChoZXgubGVuZ3RoID09PSA3KSB7XG4gICAgciA9IHBhcnNlSW50KGAke2hleFsxXX0ke2hleFsyXX1gLCAxNik7XG4gICAgZyA9IHBhcnNlSW50KGAke2hleFszXX0ke2hleFs0XX1gLCAxNik7XG4gICAgYiA9IHBhcnNlSW50KGAke2hleFs1XX0ke2hleFs2XX1gLCAxNik7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNYWxmb3JtZWQgaGV4IGNvbG9yOiAke2hleH1gKTtcbiAgfVxuXG4gIHJldHVybiB7IHIsIGcsIGIgfTtcbn1cblxuZnVuY3Rpb24gcmdiVG9IZXgoeyByLCBnLCBiIH06IHsgcjogbnVtYmVyOyBnOiBudW1iZXI7IGI6IG51bWJlciB9KSB7XG4gIGxldCByU3RyaW5nID0gci50b1N0cmluZygxNik7XG4gIGxldCBnU3RyaW5nID0gZy50b1N0cmluZygxNik7XG4gIGxldCBiU3RyaW5nID0gYi50b1N0cmluZygxNik7XG5cbiAgaWYgKHJTdHJpbmcubGVuZ3RoID09PSAxKSB7XG4gICAgclN0cmluZyA9IGAwJHtyU3RyaW5nfWA7XG4gIH1cbiAgaWYgKGdTdHJpbmcubGVuZ3RoID09PSAxKSB7XG4gICAgZ1N0cmluZyA9IGAwJHtnU3RyaW5nfWA7XG4gIH1cbiAgaWYgKGJTdHJpbmcubGVuZ3RoID09PSAxKSB7XG4gICAgYlN0cmluZyA9IGAwJHtiU3RyaW5nfWA7XG4gIH1cblxuICByZXR1cm4gYCMke3JTdHJpbmd9JHtnU3RyaW5nfSR7YlN0cmluZ31gO1xufVxuXG5mdW5jdGlvbiByZ2JUb0hTTCh7IHIsIGcsIGIgfTogeyByOiBudW1iZXI7IGc6IG51bWJlcjsgYjogbnVtYmVyIH0pIHtcbiAgLy8gTWFrZSByLCBnLCBhbmQgYiBmcmFjdGlvbnMgb2YgMVxuICByIC89IDI1NTtcbiAgZyAvPSAyNTU7XG4gIGIgLz0gMjU1O1xuXG4gIC8vIEZpbmQgZ3JlYXRlc3QgYW5kIHNtYWxsZXN0IGNoYW5uZWwgdmFsdWVzXG4gIGNvbnN0IGNtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcbiAgY29uc3QgY21heCA9IE1hdGgubWF4KHIsIGcsIGIpO1xuICBjb25zdCBkZWx0YSA9IGNtYXggLSBjbWluO1xuICBsZXQgaCA9IDA7XG4gIGxldCBzID0gMDtcbiAgbGV0IGwgPSAwO1xuXG4gIC8vIENhbGN1bGF0ZSBodWVcbiAgLy8gTm8gZGlmZmVyZW5jZVxuICBpZiAoZGVsdGEgPT09IDApIHtcbiAgICBoID0gMDtcbiAgfVxuICAvLyBSZWQgaXMgbWF4XG4gIGVsc2UgaWYgKGNtYXggPT09IHIpIHtcbiAgICBoID0gKChnIC0gYikgLyBkZWx0YSkgJSA2O1xuICB9XG4gIC8vIEdyZWVuIGlzIG1heFxuICBlbHNlIGlmIChjbWF4ID09PSBnKSB7XG4gICAgaCA9IChiIC0gcikgLyBkZWx0YSArIDI7XG4gIH1cbiAgLy8gQmx1ZSBpcyBtYXhcbiAgZWxzZSB7XG4gICAgaCA9IChyIC0gZykgLyBkZWx0YSArIDQ7XG4gIH1cblxuICBoID0gTWF0aC5yb3VuZChoICogNjApO1xuXG4gIC8vIE1ha2UgbmVnYXRpdmUgaHVlcyBwb3NpdGl2ZSBiZWhpbmQgMzYwwrBcbiAgaWYgKGggPCAwKSB7XG4gICAgaCArPSAzNjA7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgbGlnaHRuZXNzXG4gIGwgPSAoY21heCArIGNtaW4pIC8gMjtcblxuICAvLyBDYWxjdWxhdGUgc2F0dXJhdGlvblxuICBzID0gZGVsdGEgPT09IDAgPyAwIDogZGVsdGEgLyAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpO1xuXG4gIC8vIE11bHRpcGx5IGwgYW5kIHMgYnkgMTAwXG4gIHMgPSArKHMgKiAxMDApLnRvRml4ZWQoMSk7XG4gIGwgPSArKGwgKiAxMDApLnRvRml4ZWQoMSk7XG5cbiAgcmV0dXJuIHsgaCwgcywgbCB9O1xufVxuXG5mdW5jdGlvbiBoc2xUb1JHQih7IGgsIHMsIGwgfTogeyBoOiBudW1iZXI7IHM6IG51bWJlcjsgbDogbnVtYmVyIH0pIHtcbiAgLy8gTXVzdCBiZSBmcmFjdGlvbnMgb2YgMVxuICBzIC89IDEwMDtcbiAgbCAvPSAxMDA7XG5cbiAgY29uc3QgYyA9ICgxIC0gTWF0aC5hYnMoMiAqIGwgLSAxKSkgKiBzO1xuICBjb25zdCB4ID0gYyAqICgxIC0gTWF0aC5hYnMoKChoIC8gNjApICUgMikgLSAxKSk7XG4gIGNvbnN0IG0gPSBsIC0gYyAvIDI7XG4gIGxldCByID0gMDtcbiAgbGV0IGcgPSAwO1xuICBsZXQgYiA9IDA7XG5cbiAgaWYgKGggPj0gMCAmJiBoIDwgNjApIHtcbiAgICByID0gYztcbiAgICBnID0geDtcbiAgICBiID0gMDtcbiAgfSBlbHNlIGlmIChoID49IDYwICYmIGggPCAxMjApIHtcbiAgICByID0geDtcbiAgICBnID0gYztcbiAgICBiID0gMDtcbiAgfSBlbHNlIGlmIChoID49IDEyMCAmJiBoIDwgMTgwKSB7XG4gICAgciA9IDA7XG4gICAgZyA9IGM7XG4gICAgYiA9IHg7XG4gIH0gZWxzZSBpZiAoaCA+PSAxODAgJiYgaCA8IDI0MCkge1xuICAgIHIgPSAwO1xuICAgIGcgPSB4O1xuICAgIGIgPSBjO1xuICB9IGVsc2UgaWYgKGggPj0gMjQwICYmIGggPCAzMDApIHtcbiAgICByID0geDtcbiAgICBnID0gMDtcbiAgICBiID0gYztcbiAgfSBlbHNlIGlmIChoID49IDMwMCAmJiBoIDwgMzYwKSB7XG4gICAgciA9IGM7XG4gICAgZyA9IDA7XG4gICAgYiA9IHg7XG4gIH1cbiAgciA9IE1hdGgucm91bmQoKHIgKyBtKSAqIDI1NSk7XG4gIGcgPSBNYXRoLnJvdW5kKChnICsgbSkgKiAyNTUpO1xuICBiID0gTWF0aC5yb3VuZCgoYiArIG0pICogMjU1KTtcblxuICByZXR1cm4geyByLCBnLCBiIH07XG59XG5cbmZ1bmN0aW9uIGhleFRvSFNMKGhleDogc3RyaW5nKSB7XG4gIHJldHVybiByZ2JUb0hTTChoZXhUb1JHQihoZXgpKTtcbn1cblxuZnVuY3Rpb24gaHNsVG9IZXgoaHNsOiB7IGg6IG51bWJlcjsgczogbnVtYmVyOyBsOiBudW1iZXIgfSkge1xuICByZXR1cm4gcmdiVG9IZXgoaHNsVG9SR0IoaHNsKSk7XG59XG5cbmZ1bmN0aW9uIGNsYW1wKHZhbHVlOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikge1xuICByZXR1cm4gbWluIDwgbWF4ID8gKHZhbHVlIDwgbWluID8gbWluIDogdmFsdWUgPiBtYXggPyBtYXggOiB2YWx1ZSkgOiB2YWx1ZSA8IG1heCA/IG1heCA6IHZhbHVlID4gbWluID8gbWluIDogdmFsdWU7XG59XG5cbmNvbnN0IG9mZnNldCA9IDEyO1xuXG5leHBvcnQgZnVuY3Rpb24gc2xpZ2h0bHlEYXJrZXJDb2xvcihoZXg6IHN0cmluZykge1xuICBjb25zdCBoc2wgPSBoZXhUb0hTTChoZXgpO1xuXG4gIHJldHVybiBoc2xUb0hleCh7XG4gICAgaDogaHNsLmgsXG4gICAgczogaHNsLnMsXG4gICAgbDogY2xhbXAoaHNsLmwgLSBvZmZzZXQsIDAsIDEwMCksXG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2xpZ2h0bHlMaWdodGVyQ29sb3IoaGV4OiBzdHJpbmcpIHtcbiAgY29uc3QgaHNsID0gaGV4VG9IU0woaGV4KTtcblxuICByZXR1cm4gaHNsVG9IZXgoe1xuICAgIGg6IGhzbC5oLFxuICAgIHM6IGhzbC5zLFxuICAgIGw6IGNsYW1wKGhzbC5sICsgb2Zmc2V0LCAwLCAxMDApLFxuICB9KTtcbn1cbiIsICJpbXBvcnQgeyBJY29uLCBJbWFnZSB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IFVSTCB9IGZyb20gXCJub2RlOnVybFwiO1xuXG4vKipcbiAqIEljb24gc2hvd2luZyB0aGUgZmF2aWNvbiBvZiBhIHdlYnNpdGUuXG4gKlxuICogQSBmYXZpY29uIChmYXZvcml0ZSBpY29uKSBpcyBhIHRpbnkgaWNvbiBpbmNsdWRlZCBhbG9uZyB3aXRoIGEgd2Vic2l0ZSwgd2hpY2ggaXMgZGlzcGxheWVkIGluIHBsYWNlcyBsaWtlIHRoZSBicm93c2VyJ3MgYWRkcmVzcyBiYXIsIHBhZ2UgdGFicywgYW5kIGJvb2ttYXJrcyBtZW51LlxuICpcbiAqIEBwYXJhbSB1cmwgVGhlIFVSTCBvZiB0aGUgd2Vic2l0ZSB0byByZXByZXNlbnQuXG4gKlxuICogQHJldHVybnMgYW4gSW1hZ2UgdGhhdCBjYW4gYmUgdXNlZCB3aGVyZSBSYXljYXN0IGV4cGVjdHMgdGhlbS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiA8TGlzdC5JdGVtIGljb249e2dldEZhdmljb24oXCJodHRwczovL3JheWNhc3QuY29tXCIpfSB0aXRsZT1cIlJheWNhc3QgV2Vic2l0ZVwiIC8+XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEZhdmljb24oXG4gIHVybDogc3RyaW5nIHwgVVJMLFxuICBvcHRpb25zPzoge1xuICAgIC8qKlxuICAgICAqIFNpemUgb2YgdGhlIEZhdmljb25cbiAgICAgKiBAZGVmYXVsdCA2NFxuICAgICAqL1xuICAgIHNpemU/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogRmFsbGJhY2sgaWNvbiBpbiBjYXNlIHRoZSBGYXZpY29uIGlzIG5vdCBmb3VuZC5cbiAgICAgKiBAZGVmYXVsdCBJY29uLkxpbmtcbiAgICAgKi9cbiAgICBmYWxsYmFjaz86IEltYWdlLkZhbGxiYWNrO1xuICAgIC8qKlxuICAgICAqIEEge0BsaW5rIEltYWdlLk1hc2t9IHRvIGFwcGx5IHRvIHRoZSBGYXZpY29uLlxuICAgICAqL1xuICAgIG1hc2s/OiBJbWFnZS5NYXNrO1xuICB9LFxuKTogSW1hZ2UuSW1hZ2VMaWtlIHtcbiAgLy8gYSBmdW5jIGFkZGluZyBodHRwczovLyB0byB0aGUgVVJMXG4gIC8vIGZvciBjYXNlcyB3aGVyZSB0aGUgVVJMIGlzIG5vdCBhIGZ1bGwgVVJMXG4gIC8vIGUuZy4gXCJyYXljYXN0LmNvbVwiXG4gIGNvbnN0IHdpdGhIdHRwcyA9ICh1cmw6IHN0cmluZykgPT4ge1xuICAgIGlmICghdXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICByZXR1cm4gYGh0dHBzOi8vJHt1cmx9YDtcbiAgICB9XG4gICAgcmV0dXJuIHVybDtcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IHNhbml0aXplID0gKHVybDogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAoIXVybC5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHt1cmx9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1cmw7XG4gICAgfTtcblxuICAgIGNvbnN0IHVybE9iaiA9IHR5cGVvZiB1cmwgPT09IFwic3RyaW5nXCIgPyBuZXcgVVJMKHNhbml0aXplKHVybCkpIDogdXJsO1xuICAgIGNvbnN0IGhvc3RuYW1lID0gdXJsT2JqLmhvc3RuYW1lO1xuXG4gICAgY29uc3QgZmF2aWNvblByb3ZpZGVyOiBcIm5vbmVcIiB8IFwicmF5Y2FzdFwiIHwgXCJhcHBsZVwiIHwgXCJnb29nbGVcIiB8IFwiZHVja0R1Y2tHb1wiIHwgXCJkdWNrZHVja2dvXCIgfCBcImxlZ2FjeVwiID1cbiAgICAgIChwcm9jZXNzLmVudi5GQVZJQ09OX1BST1ZJREVSIGFzIGFueSkgPz8gXCJyYXljYXN0XCI7XG5cbiAgICBzd2l0Y2ggKGZhdmljb25Qcm92aWRlcikge1xuICAgICAgY2FzZSBcIm5vbmVcIjpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzb3VyY2U6IG9wdGlvbnM/LmZhbGxiYWNrID8/IEljb24uTGluayxcbiAgICAgICAgICBtYXNrOiBvcHRpb25zPy5tYXNrLFxuICAgICAgICB9O1xuICAgICAgY2FzZSBcImFwcGxlXCI6XG4gICAgICAgIC8vIHdlIGNhbid0IHN1cHBvcnQgYXBwbGUgZmF2aWNvbnMgYXMgaXQncyBhIG5hdGl2ZSBBUElcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzb3VyY2U6IG9wdGlvbnM/LmZhbGxiYWNrID8/IEljb24uTGluayxcbiAgICAgICAgICBtYXNrOiBvcHRpb25zPy5tYXNrLFxuICAgICAgICB9O1xuICAgICAgY2FzZSBcImR1Y2tkdWNrZ29cIjpcbiAgICAgIGNhc2UgXCJkdWNrRHVja0dvXCI6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc291cmNlOiBgaHR0cHM6Ly9pY29ucy5kdWNrZHVja2dvLmNvbS9pcDMvJHtob3N0bmFtZX0uaWNvYCxcbiAgICAgICAgICBmYWxsYmFjazogb3B0aW9ucz8uZmFsbGJhY2sgPz8gSWNvbi5MaW5rLFxuICAgICAgICAgIG1hc2s6IG9wdGlvbnM/Lm1hc2ssXG4gICAgICAgIH07XG4gICAgICBjYXNlIFwiZ29vZ2xlXCI6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc291cmNlOiBgaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zMi9mYXZpY29ucz9zej0ke29wdGlvbnM/LnNpemUgPz8gNjR9JmRvbWFpbj0ke2hvc3RuYW1lfWAsXG4gICAgICAgICAgZmFsbGJhY2s6IG9wdGlvbnM/LmZhbGxiYWNrID8/IEljb24uTGluayxcbiAgICAgICAgICBtYXNrOiBvcHRpb25zPy5tYXNrLFxuICAgICAgICB9O1xuICAgICAgY2FzZSBcImxlZ2FjeVwiOlxuICAgICAgY2FzZSBcInJheWNhc3RcIjpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc291cmNlOiBgaHR0cHM6Ly9hcGkucmF5LnNvL2Zhdmljb24/dXJsPSR7aG9zdG5hbWV9JnNpemU9JHtvcHRpb25zPy5zaXplID8/IDY0fWAsXG4gICAgICAgICAgZmFsbGJhY2s6IG9wdGlvbnM/LmZhbGxiYWNrID8/IEljb24uTGluayxcbiAgICAgICAgICBtYXNrOiBvcHRpb25zPy5tYXNrLFxuICAgICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgcmV0dXJuIEljb24uTGluaztcbiAgfVxufVxuIiwgImltcG9ydCB7IGVudmlyb25tZW50LCBDb2xvciB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB0eXBlIHsgSW1hZ2UgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5cbmZ1bmN0aW9uIHBvbGFyVG9DYXJ0ZXNpYW4oY2VudGVyWDogbnVtYmVyLCBjZW50ZXJZOiBudW1iZXIsIHJhZGl1czogbnVtYmVyLCBhbmdsZUluRGVncmVlczogbnVtYmVyKSB7XG4gIGNvbnN0IGFuZ2xlSW5SYWRpYW5zID0gKChhbmdsZUluRGVncmVlcyAtIDkwKSAqIE1hdGguUEkpIC8gMTgwLjA7XG5cbiAgcmV0dXJuIHtcbiAgICB4OiBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoYW5nbGVJblJhZGlhbnMpLFxuICAgIHk6IGNlbnRlclkgKyByYWRpdXMgKiBNYXRoLnNpbihhbmdsZUluUmFkaWFucyksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGRlc2NyaWJlQXJjKHg6IG51bWJlciwgeTogbnVtYmVyLCByYWRpdXM6IG51bWJlciwgc3RhcnRBbmdsZTogbnVtYmVyLCBlbmRBbmdsZTogbnVtYmVyKSB7XG4gIGNvbnN0IHN0YXJ0ID0gcG9sYXJUb0NhcnRlc2lhbih4LCB5LCByYWRpdXMsIGVuZEFuZ2xlKTtcbiAgY29uc3QgZW5kID0gcG9sYXJUb0NhcnRlc2lhbih4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUpO1xuXG4gIGNvbnN0IGxhcmdlQXJjRmxhZyA9IGVuZEFuZ2xlIC0gc3RhcnRBbmdsZSA8PSAxODAgPyBcIjBcIiA6IFwiMVwiO1xuXG4gIGNvbnN0IGQgPSBbXCJNXCIsIHN0YXJ0LngsIHN0YXJ0LnksIFwiQVwiLCByYWRpdXMsIHJhZGl1cywgMCwgbGFyZ2VBcmNGbGFnLCAwLCBlbmQueCwgZW5kLnldLmpvaW4oXCIgXCIpO1xuXG4gIHJldHVybiBkO1xufVxuXG4vKipcbiAqIEljb24gdG8gcmVwcmVzZW50IHRoZSBwcm9ncmVzcyBvZiBfc29tZXRoaW5nXy5cbiAqXG4gKiBAcGFyYW0gcHJvZ3Jlc3MgTnVtYmVyIGJldHdlZW4gMCBhbmQgMS5cbiAqIEBwYXJhbSBjb2xvciBIZXggY29sb3IgKGRlZmF1bHQgYFwiI0ZGNjM2M1wiYCkgb3IgQ29sb3IuXG4gKlxuICogQHJldHVybnMgYW4gSW1hZ2UgdGhhdCBjYW4gYmUgdXNlZCB3aGVyZSBSYXljYXN0IGV4cGVjdHMgdGhlbS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiA8TGlzdC5JdGVtIGljb249e2dldFByb2dyZXNzSWNvbigwLjEpfSB0aXRsZT1cIlByb2plY3RcIiAvPlxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRQcm9ncmVzc0ljb24oXG4gIHByb2dyZXNzOiBudW1iZXIsXG4gIGNvbG9yOiBDb2xvciB8IHN0cmluZyA9IENvbG9yLlJlZCxcbiAgb3B0aW9ucz86IHsgYmFja2dyb3VuZD86IENvbG9yIHwgc3RyaW5nOyBiYWNrZ3JvdW5kT3BhY2l0eT86IG51bWJlciB9LFxuKTogSW1hZ2UuQXNzZXQge1xuICBjb25zdCBiYWNrZ3JvdW5kID0gb3B0aW9ucz8uYmFja2dyb3VuZCB8fCAoZW52aXJvbm1lbnQuYXBwZWFyYW5jZSA9PT0gXCJsaWdodFwiID8gXCJibGFja1wiIDogXCJ3aGl0ZVwiKTtcbiAgY29uc3QgYmFja2dyb3VuZE9wYWNpdHkgPSBvcHRpb25zPy5iYWNrZ3JvdW5kT3BhY2l0eSB8fCAwLjE7XG5cbiAgY29uc3Qgc3Ryb2tlID0gMTA7XG4gIGNvbnN0IHBhZGRpbmcgPSA1O1xuICBjb25zdCByYWRpdXMgPSA1MCAtIHBhZGRpbmcgLSBzdHJva2UgLyAyO1xuXG4gIGNvbnN0IHN2ZyA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjEwMHB4XCIgaGVpZ2h0PVwiMTAwcHhcIj5cbiAgICAgIDxjaXJjbGUgY3g9XCI1MFwiIGN5PVwiNTBcIiByPVwiJHtyYWRpdXN9XCIgc3Ryb2tlLXdpZHRoPVwiJHtzdHJva2V9XCIgc3Ryb2tlPVwiJHtcbiAgICAgICAgcHJvZ3Jlc3MgPCAxID8gYmFja2dyb3VuZCA6IGNvbG9yXG4gICAgICB9XCIgb3BhY2l0eT1cIiR7cHJvZ3Jlc3MgPCAxID8gYmFja2dyb3VuZE9wYWNpdHkgOiBcIjFcIn1cIiBmaWxsPVwibm9uZVwiIC8+XG4gICAgICAke1xuICAgICAgICBwcm9ncmVzcyA+IDAgJiYgcHJvZ3Jlc3MgPCAxXG4gICAgICAgICAgPyBgPHBhdGggZD1cIiR7ZGVzY3JpYmVBcmMoXG4gICAgICAgICAgICAgIDUwLFxuICAgICAgICAgICAgICA1MCxcbiAgICAgICAgICAgICAgcmFkaXVzLFxuICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICBwcm9ncmVzcyAqIDM2MCxcbiAgICAgICAgICAgICl9XCIgc3Ryb2tlPVwiJHtjb2xvcn1cIiBzdHJva2Utd2lkdGg9XCIke3N0cm9rZX1cIiBmaWxsPVwibm9uZVwiIC8+YFxuICAgICAgICAgIDogXCJcIlxuICAgICAgfVxuICAgIDwvc3ZnPlxuICBgLnJlcGxhY2VBbGwoXCJcXG5cIiwgXCJcIik7XG4gIHJldHVybiBgZGF0YTppbWFnZS9zdmcreG1sLCR7ZW5jb2RlVVJJQ29tcG9uZW50KHN2Zyl9YDtcbn1cbiIsICJleHBvcnQgeyBPQXV0aFNlcnZpY2UgfSBmcm9tIFwiLi9PQXV0aFNlcnZpY2VcIjtcbmV4cG9ydCB7IHdpdGhBY2Nlc3NUb2tlbiwgZ2V0QWNjZXNzVG9rZW4gfSBmcm9tIFwiLi93aXRoQWNjZXNzVG9rZW5cIjtcblxuZXhwb3J0IHR5cGUgeyBXaXRoQWNjZXNzVG9rZW5Db21wb25lbnRPckZuIH0gZnJvbSBcIi4vd2l0aEFjY2Vzc1Rva2VuXCI7XG5leHBvcnQgdHlwZSB7XG4gIE9uQXV0aG9yaXplUGFyYW1zLFxuICBPQXV0aFNlcnZpY2VPcHRpb25zLFxuICBQcm92aWRlcldpdGhEZWZhdWx0Q2xpZW50T3B0aW9ucyxcbiAgUHJvdmlkZXJPcHRpb25zLFxufSBmcm9tIFwiLi90eXBlc1wiO1xuIiwgImltcG9ydCB7IENvbG9yLCBPQXV0aCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IFBST1ZJREVSX0NMSUVOVF9JRFMgfSBmcm9tIFwiLi9wcm92aWRlcnNcIjtcbmltcG9ydCB0eXBlIHtcbiAgT0F1dGhTZXJ2aWNlT3B0aW9ucyxcbiAgT25BdXRob3JpemVQYXJhbXMsXG4gIFByb3ZpZGVyT3B0aW9ucyxcbiAgUHJvdmlkZXJXaXRoRGVmYXVsdENsaWVudE9wdGlvbnMsXG59IGZyb20gXCIuL3R5cGVzXCI7XG5cbi8qKlxuICogQ2xhc3MgYWxsb3dpbmcgdG8gY3JlYXRlIGFuIE9BdXRoIHNlcnZpY2UgdXNpbmcgdGhlIHRoZSBQS0NFIChQcm9vZiBLZXkgZm9yIENvZGUgRXhjaGFuZ2UpIGZsb3cuXG4gKlxuICogVGhpcyBzZXJ2aWNlIGlzIGNhcGFibGUgb2Ygc3RhcnRpbmcgdGhlIGF1dGhvcml6YXRpb24gcHJvY2VzcywgZmV0Y2hpbmcgYW5kIHJlZnJlc2hpbmcgdG9rZW5zLFxuICogYXMgd2VsbCBhcyBtYW5hZ2luZyB0aGUgYXV0aGVudGljYXRpb24gc3RhdGUuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IG9hdXRoQ2xpZW50ID0gbmV3IE9BdXRoLlBLQ0VDbGllbnQoeyAuLi4gfSk7XG4gKiBjb25zdCBvYXV0aFNlcnZpY2UgPSBuZXcgT0F1dGhTZXJ2aWNlKHtcbiAqICAgY2xpZW50OiBvYXV0aENsaWVudCxcbiAqICAgY2xpZW50SWQ6ICd5b3VyLWNsaWVudC1pZCcsXG4gKiAgIHNjb3BlOiAncmVxdWlyZWQgc2NvcGVzJyxcbiAqICAgYXV0aG9yaXplVXJsOiAnaHR0cHM6Ly9wcm92aWRlci5jb20vb2F1dGgvYXV0aG9yaXplJyxcbiAqICAgdG9rZW5Vcmw6ICdodHRwczovL3Byb3ZpZGVyLmNvbS9vYXV0aC90b2tlbicsXG4gKiAgIHJlZnJlc2hUb2tlblVybDogJ2h0dHBzOi8vcHJvdmlkZXIuY29tL29hdXRoL3Rva2VuJyxcbiAqICAgZXh0cmFQYXJhbWV0ZXJzOiB7ICdhZGRpdGlvbmFsX3BhcmFtJzogJ3ZhbHVlJyB9XG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgY2xhc3MgT0F1dGhTZXJ2aWNlIGltcGxlbWVudHMgT0F1dGhTZXJ2aWNlT3B0aW9ucyB7XG4gIHB1YmxpYyBjbGllbnRJZDogc3RyaW5nO1xuICBwdWJsaWMgc2NvcGU6IHN0cmluZztcbiAgcHVibGljIGNsaWVudDogT0F1dGguUEtDRUNsaWVudDtcbiAgcHVibGljIGV4dHJhUGFyYW1ldGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIHB1YmxpYyBhdXRob3JpemVVcmw6IHN0cmluZztcbiAgcHVibGljIHRva2VuVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyByZWZyZXNoVG9rZW5Vcmw/OiBzdHJpbmc7XG4gIHB1YmxpYyBib2R5RW5jb2Rpbmc/OiBcImpzb25cIiB8IFwidXJsLWVuY29kZWRcIjtcbiAgcHVibGljIHBlcnNvbmFsQWNjZXNzVG9rZW4/OiBzdHJpbmc7XG4gIG9uQXV0aG9yaXplPzogKHBhcmFtczogT25BdXRob3JpemVQYXJhbXMpID0+IHZvaWQ7XG4gIHRva2VuUmVzcG9uc2VQYXJzZXI6IChyZXNwb25zZTogdW5rbm93bikgPT4gT0F1dGguVG9rZW5SZXNwb25zZTtcbiAgdG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXI6IChyZXNwb25zZTogdW5rbm93bikgPT4gT0F1dGguVG9rZW5SZXNwb25zZTtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBPQXV0aFNlcnZpY2VPcHRpb25zKSB7XG4gICAgdGhpcy5jbGllbnRJZCA9IG9wdGlvbnMuY2xpZW50SWQ7XG4gICAgdGhpcy5zY29wZSA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5zY29wZSkgPyBvcHRpb25zLnNjb3BlLmpvaW4oXCIgXCIpIDogb3B0aW9ucy5zY29wZTtcbiAgICB0aGlzLnBlcnNvbmFsQWNjZXNzVG9rZW4gPSBvcHRpb25zLnBlcnNvbmFsQWNjZXNzVG9rZW47XG4gICAgdGhpcy5ib2R5RW5jb2RpbmcgPSBvcHRpb25zLmJvZHlFbmNvZGluZztcbiAgICB0aGlzLmNsaWVudCA9IG9wdGlvbnMuY2xpZW50O1xuICAgIHRoaXMuZXh0cmFQYXJhbWV0ZXJzID0gb3B0aW9ucy5leHRyYVBhcmFtZXRlcnM7XG4gICAgdGhpcy5hdXRob3JpemVVcmwgPSBvcHRpb25zLmF1dGhvcml6ZVVybDtcbiAgICB0aGlzLnRva2VuVXJsID0gb3B0aW9ucy50b2tlblVybDtcbiAgICB0aGlzLnJlZnJlc2hUb2tlblVybCA9IG9wdGlvbnMucmVmcmVzaFRva2VuVXJsO1xuICAgIHRoaXMub25BdXRob3JpemUgPSBvcHRpb25zLm9uQXV0aG9yaXplO1xuICAgIHRoaXMudG9rZW5SZXNwb25zZVBhcnNlciA9IG9wdGlvbnMudG9rZW5SZXNwb25zZVBhcnNlciA/PyAoKHgpID0+IHggYXMgT0F1dGguVG9rZW5SZXNwb25zZSk7XG4gICAgdGhpcy50b2tlblJlZnJlc2hSZXNwb25zZVBhcnNlciA9IG9wdGlvbnMudG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXIgPz8gKCh4KSA9PiB4IGFzIE9BdXRoLlRva2VuUmVzcG9uc2UpO1xuICAgIHRoaXMuYXV0aG9yaXplID0gdGhpcy5hdXRob3JpemUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc2FuYSBPQXV0aCBzZXJ2aWNlIHByb3ZpZGVkIG91dCBvZiB0aGUgYm94LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IGFzYW5hID0gT0F1dGhTZXJ2aWNlLmFzYW5hKHsgc2NvcGU6ICdkZWZhdWx0JyB9KVxuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXNhbmEob3B0aW9uczogUHJvdmlkZXJXaXRoRGVmYXVsdENsaWVudE9wdGlvbnMpIHtcbiAgICByZXR1cm4gbmV3IE9BdXRoU2VydmljZSh7XG4gICAgICBjbGllbnQ6IG5ldyBPQXV0aC5QS0NFQ2xpZW50KHtcbiAgICAgICAgcmVkaXJlY3RNZXRob2Q6IE9BdXRoLlJlZGlyZWN0TWV0aG9kLldlYixcbiAgICAgICAgcHJvdmlkZXJOYW1lOiBcIkFzYW5hXCIsXG4gICAgICAgIHByb3ZpZGVySWNvbjogYGRhdGE6aW1hZ2Uvc3ZnK3htbCwke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyNTFcIiBoZWlnaHQ9XCIyMzJcIiBmaWxsPVwibm9uZVwiPjxwYXRoIGZpbGw9XCIjRjA2QTZBXCIgZD1cIk0xNzkuMzgzIDU0LjM3M2MwIDMwLjAxNy0yNC4zMzcgNTQuMzc0LTU0LjM1NCA1NC4zNzQtMzAuMDM1IDAtNTQuMzczLTI0LjMzOC01NC4zNzMtNTQuMzc0QzcwLjY1NiAyNC4zMzggOTQuOTkzIDAgMTI1LjAyOSAwYzMwLjAxNyAwIDU0LjM1NCAyNC4zMzggNTQuMzU0IDU0LjM3M1pNNTQuMzkzIDEyMi4zM0MyNC4zNzYgMTIyLjMzLjAyIDE0Ni42NjguMDIgMTc2LjY4NWMwIDMwLjAxNyAyNC4zMzcgNTQuMzczIDU0LjM3MyA1NC4zNzMgMzAuMDM1IDAgNTQuMzczLTI0LjMzOCA1NC4zNzMtNTQuMzczIDAtMzAuMDE3LTI0LjMzOC01NC4zNTUtNTQuMzczLTU0LjM1NVptMTQxLjI1MyAwYy0zMC4wMzUgMC01NC4zNzMgMjQuMzM4LTU0LjM3MyA1NC4zNzQgMCAzMC4wMzUgMjQuMzM4IDU0LjM3MyA1NC4zNzMgNTQuMzczIDMwLjAxNyAwIDU0LjM3NC0yNC4zMzggNTQuMzc0LTU0LjM3MyAwLTMwLjAzNi0yNC4zMzgtNTQuMzc0LTU0LjM3NC01NC4zNzRaXCIvPjwvc3ZnPmAsXG4gICAgICAgICl9YCxcbiAgICAgICAgcHJvdmlkZXJJZDogXCJhc2FuYVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJDb25uZWN0IHlvdXIgQXNhbmEgYWNjb3VudFwiLFxuICAgICAgfSksXG4gICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCA/PyBQUk9WSURFUl9DTElFTlRfSURTLmFzYW5hLFxuICAgICAgYXV0aG9yaXplVXJsOiBvcHRpb25zLmF1dGhvcml6ZVVybCA/PyBcImh0dHBzOi8vYXNhbmEub2F1dGgucmF5Y2FzdC5jb20vYXV0aG9yaXplXCIsXG4gICAgICB0b2tlblVybDogb3B0aW9ucy50b2tlblVybCA/PyBcImh0dHBzOi8vYXNhbmEub2F1dGgucmF5Y2FzdC5jb20vdG9rZW5cIixcbiAgICAgIHJlZnJlc2hUb2tlblVybDogb3B0aW9ucy5yZWZyZXNoVG9rZW5VcmwgPz8gXCJodHRwczovL2FzYW5hLm9hdXRoLnJheWNhc3QuY29tL3JlZnJlc2gtdG9rZW5cIixcbiAgICAgIHNjb3BlOiBvcHRpb25zLnNjb3BlLFxuICAgICAgcGVyc29uYWxBY2Nlc3NUb2tlbjogb3B0aW9ucy5wZXJzb25hbEFjY2Vzc1Rva2VuLFxuICAgICAgb25BdXRob3JpemU6IG9wdGlvbnMub25BdXRob3JpemUsXG4gICAgICBib2R5RW5jb2Rpbmc6IG9wdGlvbnMuYm9keUVuY29kaW5nLFxuICAgICAgdG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXI6IG9wdGlvbnMudG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXIsXG4gICAgICB0b2tlblJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVzcG9uc2VQYXJzZXIsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2l0SHViIE9BdXRoIHNlcnZpY2UgcHJvdmlkZWQgb3V0IG9mIHRoZSBib3guXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgZ2l0aHViID0gT0F1dGhTZXJ2aWNlLmdpdGh1Yih7IHNjb3BlOiAncmVwbyB1c2VyJyB9KVxuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ2l0aHViKG9wdGlvbnM6IFByb3ZpZGVyV2l0aERlZmF1bHRDbGllbnRPcHRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBPQXV0aFNlcnZpY2Uoe1xuICAgICAgY2xpZW50OiBuZXcgT0F1dGguUEtDRUNsaWVudCh7XG4gICAgICAgIHJlZGlyZWN0TWV0aG9kOiBPQXV0aC5SZWRpcmVjdE1ldGhvZC5XZWIsXG4gICAgICAgIHByb3ZpZGVyTmFtZTogXCJHaXRIdWJcIixcbiAgICAgICAgcHJvdmlkZXJJY29uOiB7XG4gICAgICAgICAgc291cmNlOiBgZGF0YTppbWFnZS9zdmcreG1sLCR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICAgICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiNjRcIiBoZWlnaHQ9XCI2NFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIj48cGF0aCBmaWxsLXJ1bGU9XCJldmVub2RkXCIgZD1cIk04IDBDMy41OCAwIDAgMy41OCAwIDhjMCAzLjU0IDIuMjkgNi41MyA1LjQ3IDcuNTkuNC4wNy41NS0uMTcuNTUtLjM4IDAtLjE5LS4wMS0uODItLjAxLTEuNDktMi4wMS4zNy0yLjUzLS40OS0yLjY5LS45NC0uMDktLjIzLS40OC0uOTQtLjgyLTEuMTMtLjI4LS4xNS0uNjgtLjUyLS4wMS0uNTMuNjMtLjAxIDEuMDguNTggMS4yMy44Mi43MiAxLjIxIDEuODcuODcgMi4zMy42Ni4wNy0uNTIuMjgtLjg3LjUxLTEuMDctMS43OC0uMi0zLjY0LS44OS0zLjY0LTMuOTUgMC0uODcuMzEtMS41OS44Mi0yLjE1LS4wOC0uMi0uMzYtMS4wMi4wOC0yLjEyIDAgMCAuNjctLjIxIDIuMi44Mi42NC0uMTggMS4zMi0uMjcgMi0uMjcuNjggMCAxLjM2LjA5IDIgLjI3IDEuNTMtMS4wNCAyLjItLjgyIDIuMi0uODIuNDQgMS4xLjE2IDEuOTIuMDggMi4xMi41MS41Ni44MiAxLjI3LjgyIDIuMTUgMCAzLjA3LTEuODcgMy43NS0zLjY1IDMuOTUuMjkuMjUuNTQuNzMuNTQgMS40OCAwIDEuMDctLjAxIDEuOTMtLjAxIDIuMiAwIC4yMS4xNS40Ni41NS4zOEE4LjAxMyA4LjAxMyAwIDAgMCAxNiA4YzAtNC40Mi0zLjU4LTgtOC04elwiLz48L3N2Zz5gLFxuICAgICAgICAgICl9YCxcblxuICAgICAgICAgIHRpbnRDb2xvcjogQ29sb3IuUHJpbWFyeVRleHQsXG4gICAgICAgIH0sXG4gICAgICAgIHByb3ZpZGVySWQ6IFwiZ2l0aHViXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbm5lY3QgeW91ciBHaXRIdWIgYWNjb3VudFwiLFxuICAgICAgfSksXG4gICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCA/PyBQUk9WSURFUl9DTElFTlRfSURTLmdpdGh1YixcbiAgICAgIGF1dGhvcml6ZVVybDogb3B0aW9ucy5hdXRob3JpemVVcmwgPz8gXCJodHRwczovL2dpdGh1Yi5vYXV0aC5yYXljYXN0LmNvbS9hdXRob3JpemVcIixcbiAgICAgIHRva2VuVXJsOiBvcHRpb25zLnRva2VuVXJsID8/IFwiaHR0cHM6Ly9naXRodWIub2F1dGgucmF5Y2FzdC5jb20vdG9rZW5cIixcbiAgICAgIHJlZnJlc2hUb2tlblVybDogb3B0aW9ucy5yZWZyZXNoVG9rZW5VcmwgPz8gXCJodHRwczovL2dpdGh1Yi5vYXV0aC5yYXljYXN0LmNvbS9yZWZyZXNoLXRva2VuXCIsXG4gICAgICBzY29wZTogb3B0aW9ucy5zY29wZSxcbiAgICAgIHBlcnNvbmFsQWNjZXNzVG9rZW46IG9wdGlvbnMucGVyc29uYWxBY2Nlc3NUb2tlbixcbiAgICAgIG9uQXV0aG9yaXplOiBvcHRpb25zLm9uQXV0aG9yaXplLFxuICAgICAgYm9keUVuY29kaW5nOiBvcHRpb25zLmJvZHlFbmNvZGluZyxcbiAgICAgIHRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyLFxuICAgICAgdG9rZW5SZXNwb25zZVBhcnNlcjogb3B0aW9ucy50b2tlblJlc3BvbnNlUGFyc2VyLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdvb2dsZSBPQXV0aCBzZXJ2aWNlIHByb3ZpZGVkIG91dCBvZiB0aGUgYm94LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IGdvb2dsZSA9IE9BdXRoU2VydmljZS5nb29nbGUoe1xuICAgKiAgIGNsaWVudElkOiAnY3VzdG9tLWNsaWVudC1pZCcsXG4gICAqICAgYXV0aG9yaXplVXJsOiAnaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL3YyL2F1dGgnLFxuICAgKiAgIHRva2VuVXJsOiAnaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4nLFxuICAgKiAgIHNjb3BlOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9kcml2ZS5yZWFkb25seScsXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ29vZ2xlKG9wdGlvbnM6IFByb3ZpZGVyT3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgT0F1dGhTZXJ2aWNlKHtcbiAgICAgIGNsaWVudDogbmV3IE9BdXRoLlBLQ0VDbGllbnQoe1xuICAgICAgICByZWRpcmVjdE1ldGhvZDogT0F1dGguUmVkaXJlY3RNZXRob2QuQXBwVVJJLFxuICAgICAgICBwcm92aWRlck5hbWU6IFwiR29vZ2xlXCIsXG4gICAgICAgIHByb3ZpZGVySWNvbjogYGRhdGE6aW1hZ2Uvc3ZnK3htbCwke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgc3R5bGU9XCJkaXNwbGF5OmJsb2NrXCIgdmlld0JveD1cIjAgMCA0OCA0OFwiPjxwYXRoIGZpbGw9XCIjRUE0MzM1XCIgZD1cIk0yNCA5LjVjMy41NCAwIDYuNzEgMS4yMiA5LjIxIDMuNmw2Ljg1LTYuODVDMzUuOSAyLjM4IDMwLjQ3IDAgMjQgMCAxNC42MiAwIDYuNTEgNS4zOCAyLjU2IDEzLjIybDcuOTggNi4xOUMxMi40MyAxMy43MiAxNy43NCA5LjUgMjQgOS41elwiLz48cGF0aCBmaWxsPVwiIzQyODVGNFwiIGQ9XCJNNDYuOTggMjQuNTVjMC0xLjU3LS4xNS0zLjA5LS4zOC00LjU1SDI0djkuMDJoMTIuOTRjLS41OCAyLjk2LTIuMjYgNS40OC00Ljc4IDcuMThsNy43MyA2YzQuNTEtNC4xOCA3LjA5LTEwLjM2IDcuMDktMTcuNjV6XCIvPjxwYXRoIGZpbGw9XCIjRkJCQzA1XCIgZD1cIk0xMC41MyAyOC41OWMtLjQ4LTEuNDUtLjc2LTIuOTktLjc2LTQuNTlzLjI3LTMuMTQuNzYtNC41OWwtNy45OC02LjE5Qy45MiAxNi40NiAwIDIwLjEyIDAgMjRjMCAzLjg4LjkyIDcuNTQgMi41NiAxMC43OGw3Ljk3LTYuMTl6XCIvPjxwYXRoIGZpbGw9XCIjMzRBODUzXCIgZD1cIk0yNCA0OGM2LjQ4IDAgMTEuOTMtMi4xMyAxNS44OS01LjgxbC03LjczLTZjLTIuMTUgMS40NS00LjkyIDIuMy04LjE2IDIuMy02LjI2IDAtMTEuNTctNC4yMi0xMy40Ny05LjkxbC03Ljk4IDYuMTlDNi41MSA0Mi42MiAxNC42MiA0OCAyNCA0OHpcIi8+PHBhdGggZmlsbD1cIm5vbmVcIiBkPVwiTTAgMGg0OHY0OEgwelwiLz48L3N2Zz5gLFxuICAgICAgICApfWAsXG4gICAgICAgIHByb3ZpZGVySWQ6IFwiZ29vZ2xlXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbm5lY3QgeW91ciBHb29nbGUgYWNjb3VudFwiLFxuICAgICAgfSksXG4gICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgIGF1dGhvcml6ZVVybDogb3B0aW9ucy5hdXRob3JpemVVcmwgPz8gXCJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvdjIvYXV0aFwiLFxuICAgICAgdG9rZW5Vcmw6IG9wdGlvbnMudG9rZW5VcmwgPz8gXCJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlblwiLFxuICAgICAgcmVmcmVzaFRva2VuVXJsOiBvcHRpb25zLnRva2VuVXJsLFxuICAgICAgc2NvcGU6IG9wdGlvbnMuc2NvcGUsXG4gICAgICBwZXJzb25hbEFjY2Vzc1Rva2VuOiBvcHRpb25zLnBlcnNvbmFsQWNjZXNzVG9rZW4sXG4gICAgICBib2R5RW5jb2Rpbmc6IG9wdGlvbnMuYm9keUVuY29kaW5nID8/IFwidXJsLWVuY29kZWRcIixcbiAgICAgIG9uQXV0aG9yaXplOiBvcHRpb25zLm9uQXV0aG9yaXplLFxuICAgICAgdG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXI6IG9wdGlvbnMudG9rZW5SZWZyZXNoUmVzcG9uc2VQYXJzZXIsXG4gICAgICB0b2tlblJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVzcG9uc2VQYXJzZXIsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSmlyYSBPQXV0aCBzZXJ2aWNlIHByb3ZpZGVkIG91dCBvZiB0aGUgYm94LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IGppcmEgPSBPQXV0aFNlcnZpY2UuamlyYSh7XG4gICAqICAgY2xpZW50SWQ6ICdjdXN0b20tY2xpZW50LWlkJyxcbiAgICogICBhdXRob3JpemVVcmw6ICdodHRwczovL2F1dGguYXRsYXNzaWFuLmNvbS9hdXRob3JpemUnLFxuICAgKiAgIHRva2VuVXJsOiAnaHR0cHM6Ly9hcGkuYXRsYXNzaWFuLmNvbS9vYXV0aC90b2tlbicsXG4gICAqICAgc2NvcGU6ICdyZWFkOmppcmEtdXNlciByZWFkOmppcmEtd29yayBvZmZsaW5lX2FjY2VzcydcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBqaXJhKG9wdGlvbnM6IFByb3ZpZGVyT3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgT0F1dGhTZXJ2aWNlKHtcbiAgICAgIGNsaWVudDogbmV3IE9BdXRoLlBLQ0VDbGllbnQoe1xuICAgICAgICByZWRpcmVjdE1ldGhvZDogT0F1dGguUmVkaXJlY3RNZXRob2QuV2ViLFxuICAgICAgICBwcm92aWRlck5hbWU6IFwiSmlyYVwiLFxuICAgICAgICBwcm92aWRlckljb246IGBkYXRhOmltYWdlL3N2Zyt4bWwsJHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHdpZHRoPVwiMjM2MVwiIGhlaWdodD1cIjI1MDBcIiB2aWV3Qm94PVwiMi41OSAwIDIxNC4wOTEgMjI0XCI+PGxpbmVhckdyYWRpZW50IGlkPVwiYVwiIHgxPVwiMTAyLjRcIiB4Mj1cIjU2LjE1XCIgeTE9XCIyMTguNjNcIiB5Mj1cIjE3Mi4zOVwiIGdyYWRpZW50VHJhbnNmb3JtPVwibWF0cml4KDEgMCAwIC0xIDAgMjY0KVwiIGdyYWRpZW50VW5pdHM9XCJ1c2VyU3BhY2VPblVzZVwiPjxzdG9wIG9mZnNldD1cIi4xOFwiIHN0b3AtY29sb3I9XCIjMDA1MmNjXCIvPjxzdG9wIG9mZnNldD1cIjFcIiBzdG9wLWNvbG9yPVwiIzI2ODRmZlwiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCB4bGluazpocmVmPVwiI2FcIiBpZD1cImJcIiB4MT1cIjExNC42NVwiIHgyPVwiMTYwLjgxXCIgeTE9XCI4NS43N1wiIHkyPVwiMTMxLjkyXCIvPjxwYXRoIGZpbGw9XCIjMjY4NGZmXCIgZD1cIk0yMTQuMDYgMTA1LjczIDExNy42NyA5LjM0IDEwOC4zMyAwIDM1Ljc3IDcyLjU2IDIuNTkgMTA1LjczYTguODkgOC44OSAwIDAgMCAwIDEyLjU0bDY2LjI5IDY2LjI5TDEwOC4zMyAyMjRsNzIuNTUtNzIuNTYgMS4xMy0xLjEyIDMyLjA1LTMyYTguODcgOC44NyAwIDAgMCAwLTEyLjU5em0tMTA1LjczIDM5LjM5TDc1LjIxIDExMmwzMy4xMi0zMy4xMkwxNDEuNDQgMTEyelwiLz48cGF0aCBmaWxsPVwidXJsKCNhKVwiIGQ9XCJNMTA4LjMzIDc4Ljg4YTU1Ljc1IDU1Ljc1IDAgMCAxLS4yNC03OC42MUwzNS42MiA3Mi43MWwzOS40NCAzOS40NHpcIi8+PHBhdGggZmlsbD1cInVybCgjYilcIiBkPVwibTE0MS41MyAxMTEuOTEtMzMuMiAzMy4yMWE1NS43NyA1NS43NyAwIDAgMSAwIDc4Ljg2TDE4MSAxNTEuMzV6XCIvPjwvc3ZnPmAsXG4gICAgICAgICl9YCxcbiAgICAgICAgcHJvdmlkZXJJZDogXCJqaXJhXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbm5lY3QgeW91ciBKaXJhIGFjY291bnRcIixcbiAgICAgIH0pLFxuICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICBhdXRob3JpemVVcmw6IG9wdGlvbnMuYXV0aG9yaXplVXJsID8/IFwiaHR0cHM6Ly9hdXRoLmF0bGFzc2lhbi5jb20vYXV0aG9yaXplXCIsXG4gICAgICB0b2tlblVybDogb3B0aW9ucy50b2tlblVybCA/PyBcImh0dHBzOi8vYXV0aC5hdGxhc3NpYW4uY29tL29hdXRoL3Rva2VuXCIsXG4gICAgICByZWZyZXNoVG9rZW5Vcmw6IG9wdGlvbnMucmVmcmVzaFRva2VuVXJsLFxuICAgICAgc2NvcGU6IG9wdGlvbnMuc2NvcGUsXG4gICAgICBwZXJzb25hbEFjY2Vzc1Rva2VuOiBvcHRpb25zLnBlcnNvbmFsQWNjZXNzVG9rZW4sXG4gICAgICBvbkF1dGhvcml6ZTogb3B0aW9ucy5vbkF1dGhvcml6ZSxcbiAgICAgIGJvZHlFbmNvZGluZzogb3B0aW9ucy5ib2R5RW5jb2RpbmcsXG4gICAgICB0b2tlblJlZnJlc2hSZXNwb25zZVBhcnNlcjogb3B0aW9ucy50b2tlblJlZnJlc2hSZXNwb25zZVBhcnNlcixcbiAgICAgIHRva2VuUmVzcG9uc2VQYXJzZXI6IG9wdGlvbnMudG9rZW5SZXNwb25zZVBhcnNlcixcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaW5lYXIgT0F1dGggc2VydmljZSBwcm92aWRlZCBvdXQgb2YgdGhlIGJveC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBsaW5lYXIgPSBPQXV0aFNlcnZpY2UubGluZWFyKHsgc2NvcGU6ICdyZWFkIHdyaXRlJyB9KVxuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbGluZWFyKG9wdGlvbnM6IFByb3ZpZGVyV2l0aERlZmF1bHRDbGllbnRPcHRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBPQXV0aFNlcnZpY2Uoe1xuICAgICAgY2xpZW50OiBuZXcgT0F1dGguUEtDRUNsaWVudCh7XG4gICAgICAgIHJlZGlyZWN0TWV0aG9kOiBPQXV0aC5SZWRpcmVjdE1ldGhvZC5XZWIsXG4gICAgICAgIHByb3ZpZGVyTmFtZTogXCJMaW5lYXJcIixcbiAgICAgICAgcHJvdmlkZXJJY29uOiB7XG4gICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICBsaWdodDogYGRhdGE6aW1hZ2Uvc3ZnK3htbCwke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICAgICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIGZpbGw9XCIjMjIyMzI2XCIgd2lkdGg9XCIyMDBcIiBoZWlnaHQ9XCIyMDBcIiB2aWV3Qm94PVwiMCAwIDEwMCAxMDBcIj48cGF0aCBkPVwiTTEuMjI1NDEgNjEuNTIyOGMtLjIyMjUtLjk0ODUuOTA3NDgtMS41NDU5IDEuNTk2MzgtLjg1N0wzOS4zMzQyIDk3LjE3ODJjLjY4ODkuNjg4OS4wOTE1IDEuODE4OS0uODU3IDEuNTk2NEMyMC4wNTE1IDk0LjQ1MjIgNS41NDc3OSA3OS45NDg1IDEuMjI1NDEgNjEuNTIyOFpNLjAwMTg5MTM1IDQ2Ljg4OTFjLS4wMTc2NDM3NS4yODMzLjA4ODg3MjE1LjU1OTkuMjg5NTcxNjUuNzYwNkw1Mi4zNTAzIDk5LjcwODVjLjIwMDcuMjAwNy40NzczLjMwNzUuNzYwNi4yODk2IDIuMzY5Mi0uMTQ3NiA0LjY5MzgtLjQ2IDYuOTYyNC0uOTI1OS43NjQ1LS4xNTcgMS4wMzAxLTEuMDk2My40NzgyLTEuNjQ4MUwyLjU3NTk1IDM5LjQ0ODVjLS41NTE4Ni0uNTUxOS0xLjQ5MTE3LS4yODYzLTEuNjQ4MTc0LjQ3ODItLjQ2NTkxNSAyLjI2ODYtLjc3ODMyIDQuNTkzMi0uOTI1ODg0NjUgNi45NjI0Wk00LjIxMDkzIDI5LjcwNTRjLS4xNjY0OS4zNzM4LS4wODE2OS44MTA2LjIwNzY1IDEuMWw2NC43NzYwMiA2NC43NzZjLjI4OTQuMjg5NC43MjYyLjM3NDIgMS4xLjIwNzcgMS43ODYxLS43OTU2IDMuNTE3MS0xLjY5MjcgNS4xODU1LTIuNjg0LjU1MjEtLjMyOC42MzczLTEuMDg2Ny4xODMyLTEuNTQwN0w4LjQzNTY2IDI0LjMzNjdjLS40NTQwOS0uNDU0MS0xLjIxMjcxLS4zNjg5LTEuNTQwNzQuMTgzMi0uOTkxMzIgMS42Njg0LTEuODg4NDMgMy4zOTk0LTIuNjgzOTkgNS4xODU1Wk0xMi42NTg3IDE4LjA3NGMtLjM3MDEtLjM3MDEtLjM5My0uOTYzNy0uMDQ0My0xLjM1NDFDMjEuNzc5NSA2LjQ1OTMxIDM1LjExMTQgMCA0OS45NTE5IDAgNzcuNTkyNyAwIDEwMCAyMi40MDczIDEwMCA1MC4wNDgxYzAgMTQuODQwNS02LjQ1OTMgMjguMTcyNC0xNi43MTk5IDM3LjMzNzUtLjM5MDMuMzQ4Ny0uOTg0LjMyNTgtMS4zNTQyLS4wNDQzTDEyLjY1ODcgMTguMDc0WlwiLz48L3N2Zz5gLFxuICAgICAgICAgICAgKX1gLFxuICAgICAgICAgICAgZGFyazogYGRhdGE6aW1hZ2Uvc3ZnK3htbCwke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICAgICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIGZpbGw9XCIjZmZmXCIgd2lkdGg9XCIyMDBcIiBoZWlnaHQ9XCIyMDBcIiB2aWV3Qm94PVwiMCAwIDEwMCAxMDBcIj48cGF0aCBkPVwiTTEuMjI1NDEgNjEuNTIyOGMtLjIyMjUtLjk0ODUuOTA3NDgtMS41NDU5IDEuNTk2MzgtLjg1N0wzOS4zMzQyIDk3LjE3ODJjLjY4ODkuNjg4OS4wOTE1IDEuODE4OS0uODU3IDEuNTk2NEMyMC4wNTE1IDk0LjQ1MjIgNS41NDc3OSA3OS45NDg1IDEuMjI1NDEgNjEuNTIyOFpNLjAwMTg5MTM1IDQ2Ljg4OTFjLS4wMTc2NDM3NS4yODMzLjA4ODg3MjE1LjU1OTkuMjg5NTcxNjUuNzYwNkw1Mi4zNTAzIDk5LjcwODVjLjIwMDcuMjAwNy40NzczLjMwNzUuNzYwNi4yODk2IDIuMzY5Mi0uMTQ3NiA0LjY5MzgtLjQ2IDYuOTYyNC0uOTI1OS43NjQ1LS4xNTcgMS4wMzAxLTEuMDk2My40NzgyLTEuNjQ4MUwyLjU3NTk1IDM5LjQ0ODVjLS41NTE4Ni0uNTUxOS0xLjQ5MTE3LS4yODYzLTEuNjQ4MTc0LjQ3ODItLjQ2NTkxNSAyLjI2ODYtLjc3ODMyIDQuNTkzMi0uOTI1ODg0NjUgNi45NjI0Wk00LjIxMDkzIDI5LjcwNTRjLS4xNjY0OS4zNzM4LS4wODE2OS44MTA2LjIwNzY1IDEuMWw2NC43NzYwMiA2NC43NzZjLjI4OTQuMjg5NC43MjYyLjM3NDIgMS4xLjIwNzcgMS43ODYxLS43OTU2IDMuNTE3MS0xLjY5MjcgNS4xODU1LTIuNjg0LjU1MjEtLjMyOC42MzczLTEuMDg2Ny4xODMyLTEuNTQwN0w4LjQzNTY2IDI0LjMzNjdjLS40NTQwOS0uNDU0MS0xLjIxMjcxLS4zNjg5LTEuNTQwNzQuMTgzMi0uOTkxMzIgMS42Njg0LTEuODg4NDMgMy4zOTk0LTIuNjgzOTkgNS4xODU1Wk0xMi42NTg3IDE4LjA3NGMtLjM3MDEtLjM3MDEtLjM5My0uOTYzNy0uMDQ0My0xLjM1NDFDMjEuNzc5NSA2LjQ1OTMxIDM1LjExMTQgMCA0OS45NTE5IDAgNzcuNTkyNyAwIDEwMCAyMi40MDczIDEwMCA1MC4wNDgxYzAgMTQuODQwNS02LjQ1OTMgMjguMTcyNC0xNi43MTk5IDM3LjMzNzUtLjM5MDMuMzQ4Ny0uOTg0LjMyNTgtMS4zNTQyLS4wNDQzTDEyLjY1ODcgMTguMDc0WlwiIC8+PC9zdmc+YCxcbiAgICAgICAgICAgICl9YCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwcm92aWRlcklkOiBcImxpbmVhclwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJDb25uZWN0IHlvdXIgTGluZWFyIGFjY291bnRcIixcbiAgICAgIH0pLFxuICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQgPz8gUFJPVklERVJfQ0xJRU5UX0lEUy5saW5lYXIsXG4gICAgICBhdXRob3JpemVVcmw6IG9wdGlvbnMuYXV0aG9yaXplVXJsID8/IFwiaHR0cHM6Ly9saW5lYXIub2F1dGgucmF5Y2FzdC5jb20vYXV0aG9yaXplXCIsXG4gICAgICB0b2tlblVybDogb3B0aW9ucy50b2tlblVybCA/PyBcImh0dHBzOi8vbGluZWFyLm9hdXRoLnJheWNhc3QuY29tL3Rva2VuXCIsXG4gICAgICByZWZyZXNoVG9rZW5Vcmw6IG9wdGlvbnMucmVmcmVzaFRva2VuVXJsID8/IFwiaHR0cHM6Ly9saW5lYXIub2F1dGgucmF5Y2FzdC5jb20vcmVmcmVzaC10b2tlblwiLFxuICAgICAgc2NvcGU6IG9wdGlvbnMuc2NvcGUsXG4gICAgICBleHRyYVBhcmFtZXRlcnM6IHtcbiAgICAgICAgYWN0b3I6IFwidXNlclwiLFxuICAgICAgfSxcbiAgICAgIG9uQXV0aG9yaXplOiBvcHRpb25zLm9uQXV0aG9yaXplLFxuICAgICAgYm9keUVuY29kaW5nOiBvcHRpb25zLmJvZHlFbmNvZGluZyxcbiAgICAgIHRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyLFxuICAgICAgdG9rZW5SZXNwb25zZVBhcnNlcjogb3B0aW9ucy50b2tlblJlc3BvbnNlUGFyc2VyLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNsYWNrIE9BdXRoIHNlcnZpY2UgcHJvdmlkZWQgb3V0IG9mIHRoZSBib3guXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3Qgc2xhY2sgPSBPQXV0aFNlcnZpY2Uuc2xhY2soeyBzY29wZTogJ2Vtb2ppOnJlYWQnIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzbGFjayhvcHRpb25zOiBQcm92aWRlcldpdGhEZWZhdWx0Q2xpZW50T3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgT0F1dGhTZXJ2aWNlKHtcbiAgICAgIGNsaWVudDogbmV3IE9BdXRoLlBLQ0VDbGllbnQoe1xuICAgICAgICByZWRpcmVjdE1ldGhvZDogT0F1dGguUmVkaXJlY3RNZXRob2QuV2ViLFxuICAgICAgICBwcm92aWRlck5hbWU6IFwiU2xhY2tcIixcbiAgICAgICAgcHJvdmlkZXJJY29uOiBgZGF0YTppbWFnZS9zdmcreG1sLCR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICAgIGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2aWV3Qm94PVwiNzMgNzMgMTI0IDEyNFwiPjxzdHlsZT4uc3Qwe2ZpbGw6I2UwMWU1YX0uc3Qxe2ZpbGw6IzM2YzVmMH0uc3Qye2ZpbGw6IzJlYjY3ZH0uc3Qze2ZpbGw6I2VjYjIyZX08L3N0eWxlPjxwYXRoIGQ9XCJNOTkuNCAxNTEuMmMwIDcuMS01LjggMTIuOS0xMi45IDEyLjktNy4xIDAtMTIuOS01LjgtMTIuOS0xMi45IDAtNy4xIDUuOC0xMi45IDEyLjktMTIuOWgxMi45djEyLjl6TTEwNS45IDE1MS4yYzAtNy4xIDUuOC0xMi45IDEyLjktMTIuOXMxMi45IDUuOCAxMi45IDEyLjl2MzIuM2MwIDcuMS01LjggMTIuOS0xMi45IDEyLjlzLTEyLjktNS44LTEyLjktMTIuOXYtMzIuM3pcIiBjbGFzcz1cInN0MFwiLz48cGF0aCBkPVwiTTExOC44IDk5LjRjLTcuMSAwLTEyLjktNS44LTEyLjktMTIuOSAwLTcuMSA1LjgtMTIuOSAxMi45LTEyLjlzMTIuOSA1LjggMTIuOSAxMi45djEyLjloLTEyLjl6TTExOC44IDEwNS45YzcuMSAwIDEyLjkgNS44IDEyLjkgMTIuOXMtNS44IDEyLjktMTIuOSAxMi45SDg2LjVjLTcuMSAwLTEyLjktNS44LTEyLjktMTIuOXM1LjgtMTIuOSAxMi45LTEyLjloMzIuM3pcIiBjbGFzcz1cInN0MVwiLz48cGF0aCBkPVwiTTE3MC42IDExOC44YzAtNy4xIDUuOC0xMi45IDEyLjktMTIuOSA3LjEgMCAxMi45IDUuOCAxMi45IDEyLjlzLTUuOCAxMi45LTEyLjkgMTIuOWgtMTIuOXYtMTIuOXpNMTY0LjEgMTE4LjhjMCA3LjEtNS44IDEyLjktMTIuOSAxMi45LTcuMSAwLTEyLjktNS44LTEyLjktMTIuOVY4Ni41YzAtNy4xIDUuOC0xMi45IDEyLjktMTIuOSA3LjEgMCAxMi45IDUuOCAxMi45IDEyLjl2MzIuM3pcIiBjbGFzcz1cInN0MlwiLz48cGF0aCBkPVwiTTE1MS4yIDE3MC42YzcuMSAwIDEyLjkgNS44IDEyLjkgMTIuOSAwIDcuMS01LjggMTIuOS0xMi45IDEyLjktNy4xIDAtMTIuOS01LjgtMTIuOS0xMi45di0xMi45aDEyLjl6TTE1MS4yIDE2NC4xYy03LjEgMC0xMi45LTUuOC0xMi45LTEyLjkgMC03LjEgNS44LTEyLjkgMTIuOS0xMi45aDMyLjNjNy4xIDAgMTIuOSA1LjggMTIuOSAxMi45IDAgNy4xLTUuOCAxMi45LTEyLjkgMTIuOWgtMzIuM3pcIiBjbGFzcz1cInN0M1wiLz48L3N2Zz5gLFxuICAgICAgICApfWAsXG4gICAgICAgIHByb3ZpZGVySWQ6IFwic2xhY2tcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ29ubmVjdCB5b3VyIFNsYWNrIGFjY291bnRcIixcbiAgICAgIH0pLFxuICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQgPz8gUFJPVklERVJfQ0xJRU5UX0lEUy5zbGFjayxcbiAgICAgIGF1dGhvcml6ZVVybDogb3B0aW9ucy5hdXRob3JpemVVcmwgPz8gXCJodHRwczovL3NsYWNrLm9hdXRoLnJheWNhc3QuY29tL2F1dGhvcml6ZVwiLFxuICAgICAgdG9rZW5Vcmw6IG9wdGlvbnMudG9rZW5VcmwgPz8gXCJodHRwczovL3NsYWNrLm9hdXRoLnJheWNhc3QuY29tL3Rva2VuXCIsXG4gICAgICByZWZyZXNoVG9rZW5Vcmw6IG9wdGlvbnMudG9rZW5VcmwgPz8gXCJodHRwczovL3NsYWNrLm9hdXRoLnJheWNhc3QuY29tL3JlZnJlc2gtdG9rZW5cIixcbiAgICAgIHNjb3BlOiBcIlwiLFxuICAgICAgZXh0cmFQYXJhbWV0ZXJzOiB7XG4gICAgICAgIHVzZXJfc2NvcGU6IG9wdGlvbnMuc2NvcGUsXG4gICAgICB9LFxuICAgICAgcGVyc29uYWxBY2Nlc3NUb2tlbjogb3B0aW9ucy5wZXJzb25hbEFjY2Vzc1Rva2VuLFxuICAgICAgYm9keUVuY29kaW5nOiBvcHRpb25zLnRva2VuVXJsID8gb3B0aW9ucy5ib2R5RW5jb2RpbmcgPz8gXCJ1cmwtZW5jb2RlZFwiIDogXCJqc29uXCIsXG4gICAgICBvbkF1dGhvcml6ZTogb3B0aW9ucy5vbkF1dGhvcml6ZSxcbiAgICAgIHRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyLFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgIHRva2VuUmVzcG9uc2VQYXJzZXI6XG4gICAgICAgIG9wdGlvbnMudG9rZW5SZXNwb25zZVBhcnNlciA/P1xuICAgICAgICAoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiByZXNwb25zZS5hdXRoZWRfdXNlci5hY2Nlc3NfdG9rZW4sXG4gICAgICAgICAgICBzY29wZTogcmVzcG9uc2UuYXV0aGVkX3VzZXIuc2NvcGUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogWm9vbSBPQXV0aCBzZXJ2aWNlIHByb3ZpZGVkIG91dCBvZiB0aGUgYm94LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IHpvb20gPSBPQXV0aFNlcnZpY2Uuem9vbSh7XG4gICAqICAgY2xpZW50SWQ6ICdjdXN0b20tY2xpZW50LWlkJyxcbiAgICogICBhdXRob3JpemVVcmw6ICdodHRwczovL3pvb20udXMvb2F1dGgvYXV0aG9yaXplJyxcbiAgICogICB0b2tlblVybDogJ2h0dHBzOi8vem9vbS51cy9vYXV0aC90b2tlbicsXG4gICAqICAgc2NvcGU6ICdtZWV0aW5nOndyaXRlJyxcbiAgICogICBwZXJzb25hbEFjY2Vzc1Rva2VuOiAncGVyc29uYWwtYWNjZXNzLXRva2VuJyxcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB6b29tKG9wdGlvbnM6IFByb3ZpZGVyT3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgT0F1dGhTZXJ2aWNlKHtcbiAgICAgIGNsaWVudDogbmV3IE9BdXRoLlBLQ0VDbGllbnQoe1xuICAgICAgICByZWRpcmVjdE1ldGhvZDogT0F1dGguUmVkaXJlY3RNZXRob2QuV2ViLFxuICAgICAgICBwcm92aWRlck5hbWU6IFwiWm9vbVwiLFxuICAgICAgICBwcm92aWRlckljb246IGBkYXRhOmltYWdlL3N2Zyt4bWwsJHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCIwIDAgMzUxLjg0NSA4MFwiPjxwYXRoIGQ9XCJNNzMuNzg2IDc4LjgzNUgxMC44OEExMC44NDIgMTAuODQyIDAgMCAxIC44MzMgNzIuMTIyYTEwLjg0MSAxMC44NDEgMCAwIDEgMi4zNTctMTEuODVMNDYuNzY0IDE2LjdoLTMxLjIzQzYuOTU0IDE2LjY5OSAwIDkuNzQ0IDAgMS4xNjVoNTguMDE0YzQuNDE0IDAgOC4zNTcgMi42MzQgMTAuMDQ2IDYuNzEyYTEwLjg0MyAxMC44NDMgMCAwIDEtMi4zNTYgMTEuODVMMjIuMTMgNjMuMzAyaDM2LjEyMmM4LjU4IDAgMTUuNTM0IDYuOTU1IDE1LjUzNCAxNS41MzRabTI3OC4wNTktNDguNTQ0QzM1MS44NDUgMTMuNTg4IDMzOC4yNTYgMCAzMjEuNTUzIDBjLTguOTM0IDAtMTYuOTc1IDMuODktMjIuNTI0IDEwLjA2M0MyOTMuNDggMy44OSAyODUuNDQgMCAyNzYuNTA1IDBjLTE2LjcwMyAwLTMwLjI5MSAxMy41ODgtMzAuMjkxIDMwLjI5MXY0OC41NDRjOC41NzkgMCAxNS41MzQtNi45NTUgMTUuNTM0LTE1LjUzNHYtMzMuMDFjMC04LjEzNyA2LjYyLTE0Ljc1NyAxNC43NTctMTQuNzU3czE0Ljc1NyA2LjYyIDE0Ljc1NyAxNC43NTd2MzMuMDFjMCA4LjU4IDYuOTU1IDE1LjUzNCAxNS41MzQgMTUuNTM0VjMwLjI5MWMwLTguMTM3IDYuNjItMTQuNzU3IDE0Ljc1Ny0xNC43NTdzMTQuNzU4IDYuNjIgMTQuNzU4IDE0Ljc1N3YzMy4wMWMwIDguNTggNi45NTQgMTUuNTM0IDE1LjUzNCAxNS41MzRWMzAuMjkxWk0yMzguNDQ3IDQwYzAgMjIuMDkxLTE3LjkwOSA0MC00MCA0MHMtNDAtMTcuOTA5LTQwLTQwIDE3LjkwOC00MCA0MC00MCA0MCAxNy45MDkgNDAgNDBabS0xNS41MzQgMGMwLTEzLjUxMi0xMC45NTQtMjQuNDY2LTI0LjQ2Ni0yNC40NjZTMTczLjk4IDI2LjQ4OCAxNzMuOTggNDBzMTAuOTUzIDI0LjQ2NiAyNC40NjYgMjQuNDY2UzIyMi45MTMgNTMuNTEyIDIyMi45MTMgNDBabS03MC42OCAwYzAgMjIuMDkxLTE3LjkwOSA0MC00MCA0MHMtNDAtMTcuOTA5LTQwLTQwIDE3LjkwOS00MCA0MC00MCA0MCAxNy45MDkgNDAgNDBabS0xNS41MzQgMGMwLTEzLjUxMi0xMC45NTQtMjQuNDY2LTI0LjQ2Ni0yNC40NjZTODcuNzY3IDI2LjQ4OCA4Ny43NjcgNDBzMTAuOTU0IDI0LjQ2NiAyNC40NjYgMjQuNDY2UzEzNi42OTkgNTMuNTEyIDEzNi42OTkgNDBaXCIgc3R5bGU9XCJmaWxsOiMwYjVjZmZcIi8+PC9zdmc+YCxcbiAgICAgICAgKX1gLFxuICAgICAgICBwcm92aWRlcklkOiBcInpvb21cIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ29ubmVjdCB5b3VyIFpvb20gYWNjb3VudFwiLFxuICAgICAgfSksXG4gICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgIGF1dGhvcml6ZVVybDogb3B0aW9ucy5hdXRob3JpemVVcmwgPz8gXCJodHRwczovL3pvb20udXMvb2F1dGgvYXV0aG9yaXplXCIsXG4gICAgICB0b2tlblVybDogb3B0aW9ucy50b2tlblVybCA/PyBcImh0dHBzOi8vem9vbS51cy9vYXV0aC90b2tlblwiLFxuICAgICAgcmVmcmVzaFRva2VuVXJsOiBvcHRpb25zLnJlZnJlc2hUb2tlblVybCxcbiAgICAgIHNjb3BlOiBvcHRpb25zLnNjb3BlLFxuICAgICAgcGVyc29uYWxBY2Nlc3NUb2tlbjogb3B0aW9ucy5wZXJzb25hbEFjY2Vzc1Rva2VuLFxuICAgICAgYm9keUVuY29kaW5nOiBvcHRpb25zLmJvZHlFbmNvZGluZyA/PyBcInVybC1lbmNvZGVkXCIsXG4gICAgICBvbkF1dGhvcml6ZTogb3B0aW9ucy5vbkF1dGhvcml6ZSxcbiAgICAgIHRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyOiBvcHRpb25zLnRva2VuUmVmcmVzaFJlc3BvbnNlUGFyc2VyLFxuICAgICAgdG9rZW5SZXNwb25zZVBhcnNlcjogb3B0aW9ucy50b2tlblJlc3BvbnNlUGFyc2VyLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYXRlcyB0aGUgT0F1dGggYXV0aG9yaXphdGlvbiBwcm9jZXNzIG9yIHJlZnJlc2hlcyBleGlzdGluZyB0b2tlbnMgaWYgbmVjZXNzYXJ5LlxuICAgKiBJZiB0aGUgY3VycmVudCB0b2tlbiBzZXQgaGFzIGEgcmVmcmVzaCB0b2tlbiBhbmQgaXQgaXMgZXhwaXJlZCwgdGhlbiB0aGUgZnVuY3Rpb24gd2lsbCByZWZyZXNoIHRoZSB0b2tlbnMuXG4gICAqIElmIG5vIHRva2VucyBleGlzdCwgaXQgd2lsbCBpbml0aWF0ZSB0aGUgT0F1dGggYXV0aG9yaXphdGlvbiBwcm9jZXNzIGFuZCBmZXRjaCB0aGUgdG9rZW5zLlxuICAgKlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBhY2Nlc3MgdG9rZW4gb2J0YWluZWQgZnJvbSB0aGUgYXV0aG9yaXphdGlvbiBmbG93LCBvciBudWxsIGlmIHRoZSB0b2tlbiBjb3VsZCBub3QgYmUgb2J0YWluZWQuXG4gICAqL1xuICBhc3luYyBhdXRob3JpemUoKSB7XG4gICAgY29uc3QgY3VycmVudFRva2VuU2V0ID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0VG9rZW5zKCk7XG4gICAgaWYgKGN1cnJlbnRUb2tlblNldD8uYWNjZXNzVG9rZW4pIHtcbiAgICAgIGlmIChjdXJyZW50VG9rZW5TZXQucmVmcmVzaFRva2VuICYmIGN1cnJlbnRUb2tlblNldC5pc0V4cGlyZWQoKSkge1xuICAgICAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCB0aGlzLnJlZnJlc2hUb2tlbnMoe1xuICAgICAgICAgIHRva2VuOiBjdXJyZW50VG9rZW5TZXQucmVmcmVzaFRva2VuLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJbiB0aGUgY2FzZSB3aGVyZSB0aGUgcmVmcmVzaCB0b2tlbiBmbG93cyBmYWlscywgbm90aGluZyBpcyByZXR1cm5lZCBhbmQgdGhlIGF1dGhvcml6ZSBmdW5jdGlvbiBpcyBjYWxsZWQgYWdhaW4uXG4gICAgICAgIGlmICh0b2tlbnMpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZXRUb2tlbnModG9rZW5zKTtcbiAgICAgICAgICByZXR1cm4gdG9rZW5zLmFjY2Vzc190b2tlbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGN1cnJlbnRUb2tlblNldC5hY2Nlc3NUb2tlbjtcbiAgICB9XG5cbiAgICBjb25zdCBhdXRoUmVxdWVzdCA9IGF3YWl0IHRoaXMuY2xpZW50LmF1dGhvcml6YXRpb25SZXF1ZXN0KHtcbiAgICAgIGVuZHBvaW50OiB0aGlzLmF1dGhvcml6ZVVybCxcbiAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgc2NvcGU6IHRoaXMuc2NvcGUsXG4gICAgICBleHRyYVBhcmFtZXRlcnM6IHRoaXMuZXh0cmFQYXJhbWV0ZXJzLFxuICAgIH0pO1xuXG4gICAgY29uc3QgeyBhdXRob3JpemF0aW9uQ29kZSB9ID0gYXdhaXQgdGhpcy5jbGllbnQuYXV0aG9yaXplKGF1dGhSZXF1ZXN0KTtcbiAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCB0aGlzLmZldGNoVG9rZW5zKHtcbiAgICAgIGF1dGhSZXF1ZXN0LFxuICAgICAgYXV0aG9yaXphdGlvbkNvZGUsXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0aGlzLmNsaWVudC5zZXRUb2tlbnModG9rZW5zKTtcblxuICAgIHJldHVybiB0b2tlbnMuYWNjZXNzX3Rva2VuO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmZXRjaFRva2Vucyh7XG4gICAgYXV0aFJlcXVlc3QsXG4gICAgYXV0aG9yaXphdGlvbkNvZGUsXG4gIH06IHtcbiAgICBhdXRoUmVxdWVzdDogT0F1dGguQXV0aG9yaXphdGlvblJlcXVlc3Q7XG4gICAgYXV0aG9yaXphdGlvbkNvZGU6IHN0cmluZztcbiAgfSkge1xuICAgIGxldCBvcHRpb25zO1xuICAgIGlmICh0aGlzLmJvZHlFbmNvZGluZyA9PT0gXCJ1cmwtZW5jb2RlZFwiKSB7XG4gICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICBwYXJhbXMuYXBwZW5kKFwiY2xpZW50X2lkXCIsIHRoaXMuY2xpZW50SWQpO1xuICAgICAgcGFyYW1zLmFwcGVuZChcImNvZGVcIiwgYXV0aG9yaXphdGlvbkNvZGUpO1xuICAgICAgcGFyYW1zLmFwcGVuZChcImNvZGVfdmVyaWZpZXJcIiwgYXV0aFJlcXVlc3QuY29kZVZlcmlmaWVyKTtcbiAgICAgIHBhcmFtcy5hcHBlbmQoXCJncmFudF90eXBlXCIsIFwiYXV0aG9yaXphdGlvbl9jb2RlXCIpO1xuICAgICAgcGFyYW1zLmFwcGVuZChcInJlZGlyZWN0X3VyaVwiLCBhdXRoUmVxdWVzdC5yZWRpcmVjdFVSSSk7XG5cbiAgICAgIG9wdGlvbnMgPSB7IGJvZHk6IHBhcmFtcyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBvcHRpb25zID0ge1xuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgIGNvZGU6IGF1dGhvcml6YXRpb25Db2RlLFxuICAgICAgICAgIGNvZGVfdmVyaWZpZXI6IGF1dGhSZXF1ZXN0LmNvZGVWZXJpZmllcixcbiAgICAgICAgICBncmFudF90eXBlOiBcImF1dGhvcml6YXRpb25fY29kZVwiLFxuICAgICAgICAgIHJlZGlyZWN0X3VyaTogYXV0aFJlcXVlc3QucmVkaXJlY3RVUkksXG4gICAgICAgIH0pLFxuICAgICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy50b2tlblVybCwgeyBtZXRob2Q6IFwiUE9TVFwiLCAuLi5vcHRpb25zIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJmZXRjaCB0b2tlbnMgZXJyb3I6XCIsIHJlc3BvbnNlVGV4dCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIHdoaWxlIGZldGNoaW5nIHRva2VuczogJHtyZXNwb25zZS5zdGF0dXN9ICgke3Jlc3BvbnNlLnN0YXR1c1RleHR9KVxcbiR7cmVzcG9uc2VUZXh0fWApO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbnMgPSB0aGlzLnRva2VuUmVzcG9uc2VQYXJzZXIoYXdhaXQgcmVzcG9uc2UuanNvbigpKTtcblxuICAgIC8vIFNvbWUgY2xpZW50cyBzdWNoIGFzIExpbmVhciBjYW4gcmV0dXJuIGEgc2NvcGUgYXJyYXkgaW5zdGVhZCBvZiBhIHN0cmluZ1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHRva2Vucy5zY29wZSkgPyB7IC4uLnRva2Vucywgc2NvcGU6IHRva2Vucy5zY29wZS5qb2luKFwiIFwiKSB9IDogdG9rZW5zO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZWZyZXNoVG9rZW5zKHsgdG9rZW4gfTogeyB0b2tlbjogc3RyaW5nIH0pIHtcbiAgICBsZXQgb3B0aW9ucztcbiAgICBpZiAodGhpcy5ib2R5RW5jb2RpbmcgPT09IFwidXJsLWVuY29kZWRcIikge1xuICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xuICAgICAgcGFyYW1zLmFwcGVuZChcImNsaWVudF9pZFwiLCB0aGlzLmNsaWVudElkKTtcbiAgICAgIHBhcmFtcy5hcHBlbmQoXCJyZWZyZXNoX3Rva2VuXCIsIHRva2VuKTtcbiAgICAgIHBhcmFtcy5hcHBlbmQoXCJncmFudF90eXBlXCIsIFwicmVmcmVzaF90b2tlblwiKTtcblxuICAgICAgb3B0aW9ucyA9IHsgYm9keTogcGFyYW1zIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgcmVmcmVzaF90b2tlbjogdG9rZW4sXG4gICAgICAgICAgZ3JhbnRfdHlwZTogXCJyZWZyZXNoX3Rva2VuXCIsXG4gICAgICAgIH0pLFxuICAgICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5yZWZyZXNoVG9rZW5VcmwgPz8gdGhpcy50b2tlblVybCwgeyBtZXRob2Q6IFwiUE9TVFwiLCAuLi5vcHRpb25zIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJyZWZyZXNoIHRva2VucyBlcnJvcjpcIiwgcmVzcG9uc2VUZXh0KTtcbiAgICAgIC8vIElmIHRoZSByZWZyZXNoIHRva2VuIGlzIGludmFsaWQsIHN0b3AgdGhlIGZsb3cgaGVyZSwgbG9nIG91dCB0aGUgdXNlciBhbmQgcHJvbXB0IHRoZW0gdG8gcmUtYXV0aG9yaXplLlxuICAgICAgdGhpcy5jbGllbnQuZGVzY3JpcHRpb24gPSBgJHt0aGlzLmNsaWVudC5wcm92aWRlck5hbWV9IG5lZWRzIHlvdSB0byBzaWduLWluIGFnYWluLiBQcmVzcyDij44gb3IgY2xpY2sgdGhlIGJ1dHRvbiBiZWxvdyB0byBjb250aW51ZS5gO1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQucmVtb3ZlVG9rZW5zKCk7XG4gICAgICBhd2FpdCB0aGlzLmF1dGhvcml6ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0b2tlblJlc3BvbnNlID0gdGhpcy50b2tlblJlZnJlc2hSZXNwb25zZVBhcnNlcihhd2FpdCByZXNwb25zZS5qc29uKCkpO1xuICAgICAgdG9rZW5SZXNwb25zZS5yZWZyZXNoX3Rva2VuID0gdG9rZW5SZXNwb25zZS5yZWZyZXNoX3Rva2VuID8/IHRva2VuO1xuICAgICAgcmV0dXJuIHRva2VuUmVzcG9uc2U7XG4gICAgfVxuICB9XG59XG4iLCAiZXhwb3J0IGNvbnN0IFBST1ZJREVSX0NMSUVOVF9JRFMgPSB7XG4gIGFzYW5hOiBcIjExOTEyMDE3NDU2ODQzMTJcIixcbiAgZ2l0aHViOiBcIjcyMzVmZThkNDIxNTdmMWYzOGMwXCIsXG4gIGxpbmVhcjogXCJjOGZmMzdiOTIyNWMzYzlhZWZkN2Q2NmVhMGU1YjZmMVwiLFxuICBzbGFjazogXCI4NTE3NTY4ODQ2OTIuNTU0NjkyNzI5MDIxMlwiLFxufTtcbiIsICJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBlbnZpcm9ubWVudCwgT0F1dGggfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG5pbXBvcnQgdHlwZSB7IE9BdXRoVHlwZSwgT25BdXRob3JpemVQYXJhbXMgfSBmcm9tIFwiLi90eXBlc1wiO1xuXG5sZXQgdG9rZW46IHN0cmluZyB8IG51bGwgPSBudWxsO1xubGV0IHR5cGU6IE9BdXRoVHlwZSB8IG51bGwgPSBudWxsO1xubGV0IGF1dGhvcml6ZTogUHJvbWlzZTxzdHJpbmc+IHwgbnVsbCA9IG51bGw7XG5sZXQgZ2V0SWRUb2tlbjogUHJvbWlzZTxzdHJpbmcgfCB1bmRlZmluZWQ+IHwgbnVsbCA9IG51bGw7XG5sZXQgb25BdXRob3JpemU6IFByb21pc2U8dm9pZD4gfCBudWxsID0gbnVsbDtcblxudHlwZSBXaXRoQWNjZXNzVG9rZW5QYXJhbWV0ZXJzID0ge1xuICAvKipcbiAgICogQW4gb3B0aW9uYWwgaW5zdGFuY2Ugb2YgYSBQS0NFIENsaWVudCB0aGF0IHlvdSBjYW4gY3JlYXRlIHVzaW5nIFJheWNhc3QgQVBJLlxuICAgKiBUaGlzIGNsaWVudCBpcyB1c2VkIHRvIHJldHVybiB0aGUgYGlkVG9rZW5gIGFzIHBhcnQgb2YgdGhlIGBvbkF1dGhvcml6ZWAgY2FsbGJhY2suXG4gICAqL1xuICBjbGllbnQ/OiBPQXV0aC5QS0NFQ2xpZW50O1xuICAvKipcbiAgICogQSBmdW5jdGlvbiB0aGF0IGluaXRpYXRlcyB0aGUgT0F1dGggdG9rZW4gcmV0cmlldmFsIHByb2Nlc3NcbiAgICogQHJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYW4gYWNjZXNzIHRva2VuLlxuICAgKi9cbiAgYXV0aG9yaXplOiAoKSA9PiBQcm9taXNlPHN0cmluZz47XG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBzdHJpbmcgdGhhdCByZXByZXNlbnRzIGFuIGFscmVhZHkgb2J0YWluZWQgcGVyc29uYWwgYWNjZXNzIHRva2VuXG4gICAqL1xuICBwZXJzb25hbEFjY2Vzc1Rva2VuPzogc3RyaW5nO1xuICAvKipcbiAgICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgb25jZSB0aGUgdXNlciBoYXMgYmVlbiBwcm9wZXJseSBsb2dnZWQgaW4gdGhyb3VnaCBPQXV0aC5cbiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyAtIFBhcmFtZXRlcnMgb2YgdGhlIGNhbGxiYWNrXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnRva2VuIC0gVGhlIHJldHJpZXZlZCBhY2Nlc3MgdG9rZW5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudHlwZSAtIFRoZSBhY2Nlc3MgdG9rZW4ncyB0eXBlIChlaXRoZXIgYG9hdXRoYCBvciBgcGVyc29uYWxgKVxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5pZFRva2VuIC0gVGhlIG9wdGlvbmFsIGlkIHRva2VuLiBUaGUgYGlkVG9rZW5gIGlzIHJldHVybmVkIGlmIGBvcHRpb25zLmNsaWVudGAgaXMgcHJvdmlkZWQgYW5kIGlmIGl0J3MgcmV0dXJuZWQgaW4gdGhlIGluaXRpYWwgdG9rZW4gc2V0LlxuICAgKi9cbiAgb25BdXRob3JpemU/OiAocGFyYW1zOiBPbkF1dGhvcml6ZVBhcmFtcykgPT4gdm9pZDtcbn07XG5cbi8qKlxuICogVGhlIGNvbXBvbmVudCAoZm9yIGEgdmlldy9tZW51LWJhciBjb21tYW5kcykgb3IgZnVuY3Rpb24gKGZvciBhIG5vLXZpZXcgY29tbWFuZCkgdGhhdCBpcyBwYXNzZWQgdG8gd2l0aEFjY2Vzc1Rva2VuLlxuICovXG5leHBvcnQgdHlwZSBXaXRoQWNjZXNzVG9rZW5Db21wb25lbnRPckZuPFQgPSBhbnksIFUgPSBhbnk+ID0gKChwYXJhbXM6IFQpID0+IFByb21pc2U8VT4gfCBVKSB8IFJlYWN0LkNvbXBvbmVudFR5cGU8VD47XG5cbi8qKlxuICogSGlnaGVyLW9yZGVyIGNvbXBvbmVudCB0byB3cmFwIGEgZ2l2ZW4gY29tcG9uZW50IG9yIGZ1bmN0aW9uIGFuZCBzZXQgYW4gYWNjZXNzIHRva2VuIGluIGEgc2hhcmVkIGdsb2JhbCB2YXJpYWJsZS5cbiAqXG4gKiBUaGUgZnVuY3Rpb24gaW50ZXJjZXB0cyB0aGUgY29tcG9uZW50IHJlbmRlcmluZyBwcm9jZXNzIHRvIGVpdGhlciBmZXRjaCBhbiBPQXV0aCB0b2tlbiBhc3luY2hyb25vdXNseVxuICogb3IgdXNlIGEgcHJvdmlkZWQgcGVyc29uYWwgYWNjZXNzIHRva2VuLiBBIGdsb2JhbCB2YXJpYWJsZSB3aWxsIGJlIHRoZW4gc2V0IHdpdGggdGhlIHJlY2VpdmVkIHRva2VuXG4gKiB0aGF0IHlvdSBjYW4gZ2V0IHdpdGggdGhlIGBnZXRBY2Nlc3NUb2tlbmAgZnVuY3Rpb24uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7IERldGFpbCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IE9BdXRoU2VydmljZSwgZ2V0QWNjZXNzVG9rZW4sIHdpdGhBY2Nlc3NUb2tlbiB9IGZyb20gXCJAcmF5Y2FzdC91dGlsc1wiO1xuICpcbiAqIGNvbnN0IGdpdGh1YiA9IE9BdXRoU2VydmljZS5naXRodWIoeyBzY29wZTogXCJub3RpZmljYXRpb25zIHJlcG8gcmVhZDpvcmcgcmVhZDp1c2VyIHJlYWQ6cHJvamVjdFwiIH0pO1xuICpcbiAqIGZ1bmN0aW9uIEF1dGhvcml6ZWRDb21wb25lbnQoKSB7XG4gKiAgY29uc3QgeyB0b2tlbiB9ID0gZ2V0QWNjZXNzVG9rZW4oKTtcbiAqICAuLi5cbiAqIH1cbiAqXG4gKiBleHBvcnQgZGVmYXVsdCB3aXRoQWNjZXNzVG9rZW4oZ2l0aHViKShBdXRob3JpemVkQ29tcG9uZW50KTtcbiAqIGBgYFxuICpcbiAqIEByZXR1cm5zIHtSZWFjdC5Db21wb25lbnRUeXBlPFQ+fSBUaGUgd3JhcHBlZCBjb21wb25lbnQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWNjZXNzVG9rZW48VCA9IGFueSwgVSA9IGFueT4oXG4gIG9wdGlvbnM6IFdpdGhBY2Nlc3NUb2tlblBhcmFtZXRlcnMsXG4pOiA8ViBleHRlbmRzIFdpdGhBY2Nlc3NUb2tlbkNvbXBvbmVudE9yRm48VCwgVT4+KFxuICBmbk9yQ29tcG9uZW50OiBWLFxuKSA9PiBWIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50VHlwZTxUPiA/IFJlYWN0LkZ1bmN0aW9uQ29tcG9uZW50PFQ+IDogKHByb3BzOiBUKSA9PiBQcm9taXNlPFU+O1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBY2Nlc3NUb2tlbjxUPihvcHRpb25zOiBXaXRoQWNjZXNzVG9rZW5QYXJhbWV0ZXJzKSB7XG4gIGlmIChlbnZpcm9ubWVudC5jb21tYW5kTW9kZSA9PT0gXCJuby12aWV3XCIpIHtcbiAgICByZXR1cm4gKGZuOiAocHJvcHM6IFQpID0+IFByb21pc2U8dm9pZD4gfCAoKCkgPT4gdm9pZCkpID0+IHtcbiAgICAgIGNvbnN0IG5vVmlld0ZuID0gYXN5bmMgKHByb3BzOiBUKSA9PiB7XG4gICAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgICB0b2tlbiA9IG9wdGlvbnMucGVyc29uYWxBY2Nlc3NUb2tlbiA/PyAoYXdhaXQgb3B0aW9ucy5hdXRob3JpemUoKSk7XG4gICAgICAgICAgdHlwZSA9IG9wdGlvbnMucGVyc29uYWxBY2Nlc3NUb2tlbiA/IFwicGVyc29uYWxcIiA6IFwib2F1dGhcIjtcbiAgICAgICAgICBjb25zdCBpZFRva2VuID0gKGF3YWl0IG9wdGlvbnMuY2xpZW50Py5nZXRUb2tlbnMoKSk/LmlkVG9rZW47XG5cbiAgICAgICAgICBpZiAob3B0aW9ucy5vbkF1dGhvcml6ZSkge1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5yZXNvbHZlKG9wdGlvbnMub25BdXRob3JpemUoeyB0b2tlbiwgdHlwZSwgaWRUb2tlbiB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZuKHByb3BzKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBub1ZpZXdGbjtcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIChDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8VD4pID0+IHtcbiAgICBjb25zdCBXcmFwcGVkQ29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPFQ+ID0gKHByb3BzKSA9PiB7XG4gICAgICBpZiAob3B0aW9ucy5wZXJzb25hbEFjY2Vzc1Rva2VuKSB7XG4gICAgICAgIHRva2VuID0gb3B0aW9ucy5wZXJzb25hbEFjY2Vzc1Rva2VuO1xuICAgICAgICB0eXBlID0gXCJwZXJzb25hbFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFhdXRob3JpemUpIHtcbiAgICAgICAgICBhdXRob3JpemUgPSBvcHRpb25zLmF1dGhvcml6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRva2VuID0gUmVhY3QudXNlKGF1dGhvcml6ZSk7XG4gICAgICAgIHR5cGUgPSBcIm9hdXRoXCI7XG4gICAgICB9XG5cbiAgICAgIGxldCBpZFRva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAob3B0aW9ucy5jbGllbnQpIHtcbiAgICAgICAgaWYgKCFnZXRJZFRva2VuKSB7XG4gICAgICAgICAgZ2V0SWRUb2tlbiA9IG9wdGlvbnMuY2xpZW50Py5nZXRUb2tlbnMoKS50aGVuKCh0b2tlbnMpID0+IHRva2Vucz8uaWRUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgaWRUb2tlbiA9IFJlYWN0LnVzZShnZXRJZFRva2VuKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMub25BdXRob3JpemUpIHtcbiAgICAgICAgaWYgKCFvbkF1dGhvcml6ZSkge1xuICAgICAgICAgIG9uQXV0aG9yaXplID0gUHJvbWlzZS5yZXNvbHZlKG9wdGlvbnMub25BdXRob3JpemUoeyB0b2tlbjogdG9rZW4hLCB0eXBlLCBpZFRva2VuIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBSZWFjdC51c2Uob25BdXRob3JpemUpO1xuICAgICAgfVxuXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAvLyBAdHMtaWdub3JlIHRvbyBjb21wbGljYXRlZCBmb3IgVFNcbiAgICAgIHJldHVybiA8Q29tcG9uZW50IHsuLi5wcm9wc30gLz47XG4gICAgfTtcblxuICAgIFdyYXBwZWRDb21wb25lbnQuZGlzcGxheU5hbWUgPSBgd2l0aEFjY2Vzc1Rva2VuKCR7Q29tcG9uZW50LmRpc3BsYXlOYW1lIHx8IENvbXBvbmVudC5uYW1lfSlgO1xuXG4gICAgcmV0dXJuIFdyYXBwZWRDb21wb25lbnQ7XG4gIH07XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgYWNjZXNzIHRva2VuIGFuZCBpdHMgdHlwZS4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gbXVzdCBiZSBjYWxsZWQgaW4gYSBjb21wb25lbnQgd3JhcHBlZCB3aXRoIGB3aXRoQWNjZXNzVG9rZW5gLlxuICpcbiAqIFdpbGwgdGhyb3cgYW4gRXJyb3IgaWYgY2FsbGVkIG91dHNpZGUgb2YgYSBmdW5jdGlvbiBvciBjb21wb25lbnQgd3JhcHBlZCB3aXRoIGB3aXRoQWNjZXNzVG9rZW5gXG4gKlxuICogQHJldHVybnMge3sgdG9rZW46IHN0cmluZywgdHlwZTogXCJvYXV0aFwiIHwgXCJwZXJzb25hbFwiIH19IEFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgdG9rZW5gXG4gKiBhbmQgaXRzIGB0eXBlYCwgd2hlcmUgdHlwZSBjYW4gYmUgZWl0aGVyICdvYXV0aCcgZm9yIE9BdXRoIHRva2VucyBvciAncGVyc29uYWwnIGZvciBhXG4gKiBwZXJzb25hbCBhY2Nlc3MgdG9rZW4uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY2Nlc3NUb2tlbigpOiB7XG4gIHRva2VuOiBzdHJpbmc7XG4gIC8qKiBgb2F1dGhgIGZvciBPQXV0aCB0b2tlbnMgb3IgYHBlcnNvbmFsYCBmb3IgcGVyc29uYWwgYWNjZXNzIHRva2VuICovXG4gIHR5cGU6IFwib2F1dGhcIiB8IFwicGVyc29uYWxcIjtcbn0ge1xuICBpZiAoIXRva2VuIHx8ICF0eXBlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZ2V0QWNjZXNzVG9rZW4gbXVzdCBiZSB1c2VkIHdoZW4gYXV0aGVudGljYXRlZCAoZWcuIHVzZWQgaW5zaWRlIGB3aXRoQWNjZXNzVG9rZW5gKVwiKTtcbiAgfVxuXG4gIHJldHVybiB7IHRva2VuLCB0eXBlIH07XG59XG4iLCAiaW1wb3J0IHsgZW52aXJvbm1lbnQsIExhdW5jaFByb3BzLCBMYXVuY2hUeXBlIH0gZnJvbSBcIkByYXljYXN0L2FwaVwiO1xuaW1wb3J0IGZzIGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XG5cbmV4cG9ydCBlbnVtIERlZXBsaW5rVHlwZSB7XG4gIC8qKiBBIHNjcmlwdCBjb21tYW5kICovXG4gIFNjcmlwdENvbW1hbmQgPSBcInNjcmlwdC1jb21tYW5kXCIsXG4gIC8qKiBBbiBleHRlbnNpb24gY29tbWFuZCAqL1xuICBFeHRlbnNpb24gPSBcImV4dGVuc2lvblwiLFxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIGNyZWF0aW5nIGEgZGVlcGxpbmsgdG8gYSBzY3JpcHQgY29tbWFuZC5cbiAqL1xuZXhwb3J0IHR5cGUgQ3JlYXRlU2NyaXB0Q29tbWFuZERlZXBsaW5rT3B0aW9ucyA9IHtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGRlZXBsaW5rLCB3aGljaCBzaG91bGQgYmUgXCJzY3JpcHQtY29tbWFuZFwiLlxuICAgKi9cbiAgdHlwZTogRGVlcGxpbmtUeXBlLlNjcmlwdENvbW1hbmQ7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgY29tbWFuZC5cbiAgICovXG4gIGNvbW1hbmQ6IHN0cmluZztcbiAgLyoqXG4gICAqIElmIHRoZSBjb21tYW5kIGFjY2VwdHMgYXJndW1lbnRzLCB0aGV5IGNhbiBiZSBwYXNzZWQgdXNpbmcgdGhpcyBxdWVyeSBwYXJhbWV0ZXIuXG4gICAqL1xuICBhcmd1bWVudHM/OiBzdHJpbmdbXTtcbn07XG5cbi8qKlxuICogQmFzZSBvcHRpb25zIGZvciBjcmVhdGluZyBhIGRlZXBsaW5rIHRvIGFuIGV4dGVuc2lvbi5cbiAqL1xuZXhwb3J0IHR5cGUgQ3JlYXRlRXh0ZW5zaW9uRGVlcGxpbmtCYXNlT3B0aW9ucyA9IHtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGRlZXBsaW5rLCB3aGljaCBzaG91bGQgYmUgXCJleHRlbnNpb25cIi5cbiAgICovXG4gIHR5cGU/OiBEZWVwbGlua1R5cGUuRXh0ZW5zaW9uO1xuICAvKipcbiAgICogVGhlIGNvbW1hbmQgYXNzb2NpYXRlZCB3aXRoIHRoZSBleHRlbnNpb24uXG4gICAqL1xuICBjb21tYW5kOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBFaXRoZXIgXCJ1c2VySW5pdGlhdGVkXCIsIHdoaWNoIHJ1bnMgdGhlIGNvbW1hbmQgaW4gdGhlIGZvcmVncm91bmQsIG9yIFwiYmFja2dyb3VuZFwiLCB3aGljaCBza2lwcyBicmluZ2luZyBSYXljYXN0IHRvIHRoZSBmcm9udC5cbiAgICovXG4gIGxhdW5jaFR5cGU/OiBMYXVuY2hUeXBlO1xuICAvKipcbiAgICogSWYgdGhlIGNvbW1hbmQgYWNjZXB0cyBhcmd1bWVudHMsIHRoZXkgY2FuIGJlIHBhc3NlZCB1c2luZyB0aGlzIHF1ZXJ5IHBhcmFtZXRlci5cbiAgICovXG4gIGFyZ3VtZW50cz86IExhdW5jaFByb3BzW1wiYXJndW1lbnRzXCJdO1xuICAvKipcbiAgICogSWYgdGhlIGNvbW1hbmQgbWFrZSB1c2Ugb2YgTGF1bmNoQ29udGV4dCwgaXQgY2FuIGJlIHBhc3NlZCB1c2luZyB0aGlzIHF1ZXJ5IHBhcmFtZXRlci5cbiAgICovXG4gIGNvbnRleHQ/OiBMYXVuY2hQcm9wc1tcImxhdW5jaENvbnRleHRcIl07XG4gIC8qKlxuICAgKiBTb21lIHRleHQgdG8gcHJlZmlsbCB0aGUgc2VhcmNoIGJhciBvciBmaXJzdCB0ZXh0IGlucHV0IG9mIHRoZSBjb21tYW5kXG4gICAqL1xuICBmYWxsYmFja1RleHQ/OiBzdHJpbmc7XG59O1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIGNyZWF0aW5nIGEgZGVlcGxpbmsgdG8gYW4gZXh0ZW5zaW9uIGZyb20gYW5vdGhlciBleHRlbnNpb24uXG4gKiBSZXF1aXJlcyBib3RoIHRoZSBvd25lck9yQXV0aG9yTmFtZSBhbmQgZXh0ZW5zaW9uTmFtZS5cbiAqL1xuZXhwb3J0IHR5cGUgQ3JlYXRlSW50ZXJFeHRlbnNpb25EZWVwbGlua09wdGlvbnMgPSBDcmVhdGVFeHRlbnNpb25EZWVwbGlua0Jhc2VPcHRpb25zICYge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIG93bmVyIG9yIGF1dGhvciBvZiB0aGUgZXh0ZW5zaW9uLlxuICAgKi9cbiAgb3duZXJPckF1dGhvck5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBleHRlbnNpb24uXG4gICAqL1xuICBleHRlbnNpb25OYW1lOiBzdHJpbmc7XG59O1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIGNyZWF0aW5nIGEgZGVlcGxpbmsgdG8gYW4gZXh0ZW5zaW9uLlxuICovXG5leHBvcnQgdHlwZSBDcmVhdGVFeHRlbnNpb25EZWVwbGlua09wdGlvbnMgPSBDcmVhdGVJbnRlckV4dGVuc2lvbkRlZXBsaW5rT3B0aW9ucyB8IENyZWF0ZUV4dGVuc2lvbkRlZXBsaW5rQmFzZU9wdGlvbnM7XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgY3JlYXRpbmcgYSBkZWVwbGluay5cbiAqL1xuZXhwb3J0IHR5cGUgQ3JlYXRlRGVlcGxpbmtPcHRpb25zID0gQ3JlYXRlU2NyaXB0Q29tbWFuZERlZXBsaW5rT3B0aW9ucyB8IENyZWF0ZUV4dGVuc2lvbkRlZXBsaW5rT3B0aW9ucztcblxuZnVuY3Rpb24gZ2V0UHJvdG9jb2woKSB7XG4gIHJldHVybiBlbnZpcm9ubWVudC5yYXljYXN0VmVyc2lvbi5pbmNsdWRlcyhcImFscGhhXCIpID8gXCJyYXljYXN0aW50ZXJuYWw6Ly9cIiA6IFwicmF5Y2FzdDovL1wiO1xufVxuXG5mdW5jdGlvbiBnZXRPd25lck9yQXV0aG9yTmFtZSgpIHtcbiAgY29uc3QgcGFja2FnZUpTT04gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oZW52aXJvbm1lbnQuYXNzZXRzUGF0aCwgXCIuLlwiLCBcInBhY2thZ2UuanNvblwiKSwgXCJ1dGY4XCIpKTtcbiAgcmV0dXJuIHBhY2thZ2VKU09OLm93bmVyIHx8IHBhY2thZ2VKU09OLmF1dGhvcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNjcmlwdENvbW1hbmREZWVwbGluayhvcHRpb25zOiBDcmVhdGVTY3JpcHRDb21tYW5kRGVlcGxpbmtPcHRpb25zKTogc3RyaW5nIHtcbiAgbGV0IHVybCA9IGAke2dldFByb3RvY29sKCl9c2NyaXB0LWNvbW1hbmRzLyR7b3B0aW9ucy5jb21tYW5kfWA7XG5cbiAgaWYgKG9wdGlvbnMuYXJndW1lbnRzKSB7XG4gICAgbGV0IHBhcmFtcyA9IFwiXCI7XG4gICAgZm9yIChjb25zdCBhcmcgb2Ygb3B0aW9ucy5hcmd1bWVudHMpIHtcbiAgICAgIHBhcmFtcyArPSBcIiZhcmd1bWVudHM9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnKTtcbiAgICB9XG4gICAgdXJsICs9IFwiP1wiICsgcGFyYW1zLnN1YnN0cmluZygxKTtcbiAgfVxuXG4gIHJldHVybiB1cmw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFeHRlbnNpb25EZWVwbGluayhvcHRpb25zOiBDcmVhdGVFeHRlbnNpb25EZWVwbGlua09wdGlvbnMpOiBzdHJpbmcge1xuICBsZXQgb3duZXJPckF1dGhvck5hbWUgPSBnZXRPd25lck9yQXV0aG9yTmFtZSgpO1xuICBsZXQgZXh0ZW5zaW9uTmFtZSA9IGVudmlyb25tZW50LmV4dGVuc2lvbk5hbWU7XG5cbiAgaWYgKFwib3duZXJPckF1dGhvck5hbWVcIiBpbiBvcHRpb25zICYmIFwiZXh0ZW5zaW9uTmFtZVwiIGluIG9wdGlvbnMpIHtcbiAgICBvd25lck9yQXV0aG9yTmFtZSA9IG9wdGlvbnMub3duZXJPckF1dGhvck5hbWU7XG4gICAgZXh0ZW5zaW9uTmFtZSA9IG9wdGlvbnMuZXh0ZW5zaW9uTmFtZTtcbiAgfVxuXG4gIGxldCB1cmwgPSBgJHtnZXRQcm90b2NvbCgpfWV4dGVuc2lvbnMvJHtvd25lck9yQXV0aG9yTmFtZX0vJHtleHRlbnNpb25OYW1lfS8ke29wdGlvbnMuY29tbWFuZH1gO1xuXG4gIGxldCBwYXJhbXMgPSBcIlwiO1xuICBpZiAob3B0aW9ucy5sYXVuY2hUeXBlKSB7XG4gICAgcGFyYW1zICs9IFwiJmxhdW5jaFR5cGU9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob3B0aW9ucy5sYXVuY2hUeXBlKTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLmFyZ3VtZW50cykge1xuICAgIHBhcmFtcyArPSBcIiZhcmd1bWVudHM9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5hcmd1bWVudHMpKTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLmNvbnRleHQpIHtcbiAgICBwYXJhbXMgKz0gXCImY29udGV4dD1cIiArIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShvcHRpb25zLmNvbnRleHQpKTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLmZhbGxiYWNrVGV4dCkge1xuICAgIHBhcmFtcyArPSBcIiZmYWxsYmFja1RleHQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob3B0aW9ucy5mYWxsYmFja1RleHQpO1xuICB9XG5cbiAgaWYgKHBhcmFtcykge1xuICAgIHVybCArPSBcIj9cIiArIHBhcmFtcy5zdWJzdHJpbmcoMSk7XG4gIH1cblxuICByZXR1cm4gdXJsO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBkZWVwbGluayB0byBhIHNjcmlwdCBjb21tYW5kIG9yIGV4dGVuc2lvbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlZXBsaW5rKG9wdGlvbnM6IENyZWF0ZURlZXBsaW5rT3B0aW9ucyk6IHN0cmluZyB7XG4gIGlmIChvcHRpb25zLnR5cGUgPT09IERlZXBsaW5rVHlwZS5TY3JpcHRDb21tYW5kKSB7XG4gICAgcmV0dXJuIGNyZWF0ZVNjcmlwdENvbW1hbmREZWVwbGluayhvcHRpb25zKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY3JlYXRlRXh0ZW5zaW9uRGVlcGxpbmsob3B0aW9ucyk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBiYXNlRXhlY3V0ZVNRTCB9IGZyb20gXCIuL3NxbC11dGlsc1wiO1xuXG4vKipcbiAqIEV4ZWN1dGVzIGEgU1FMIHF1ZXJ5IG9uIGEgbG9jYWwgU1FMaXRlIGRhdGFiYXNlIGFuZCByZXR1cm5zIHRoZSBxdWVyeSByZXN1bHQgaW4gSlNPTiBmb3JtYXQuXG4gKlxuICogQHBhcmFtIGRhdGFiYXNlUGF0aCAtIFRoZSBwYXRoIHRvIHRoZSBTUUxpdGUgZGF0YWJhc2UgZmlsZS5cbiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBTUUwgcXVlcnkgdG8gZXhlY3V0ZS5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGFuIGFycmF5IG9mIG9iamVjdHMgcmVwcmVzZW50aW5nIHRoZSBxdWVyeSByZXN1bHRzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBjbG9zZU1haW5XaW5kb3csIENsaXBib2FyZCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IGV4ZWN1dGVTUUwgfSBmcm9tIFwiQHJheWNhc3QvdXRpbHNcIjtcbiAqXG4gKiB0eXBlIE1lc3NhZ2UgPSB7IGJvZHk6IHN0cmluZzsgY29kZTogc3RyaW5nIH07XG4gKlxuICogY29uc3QgREJfUEFUSCA9IFwiL3BhdGgvdG8vY2hhdC5kYlwiO1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIENvbW1hbmQoKSB7XG4gKiAgIGNvbnN0IHF1ZXJ5ID0gYFNFTEVDVCBib2R5LCBjb2RlIEZST00gLi4uYFxuICpcbiAqICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCBleGVjdXRlU1FMPE1lc3NhZ2U+KERCX1BBVEgsIHF1ZXJ5KTtcbiAqXG4gKiAgIGlmIChtZXNzYWdlcy5sZW5ndGggPiAwKSB7XG4gKiAgICAgY29uc3QgbGF0ZXN0Q29kZSA9IG1lc3NhZ2VzWzBdLmNvZGU7XG4gKiAgICAgYXdhaXQgQ2xpcGJvYXJkLnBhc3RlKGxhdGVzdENvZGUpO1xuICogICAgIGF3YWl0IGNsb3NlTWFpbldpbmRvdygpO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4ZWN1dGVTUUw8VCA9IHVua25vd24+KGRhdGFiYXNlUGF0aDogc3RyaW5nLCBxdWVyeTogc3RyaW5nKSB7XG4gIHJldHVybiBiYXNlRXhlY3V0ZVNRTDxUPihkYXRhYmFzZVBhdGgsIHF1ZXJ5KTtcbn1cbiIsICJpbXBvcnQgY2hpbGRQcm9jZXNzIGZyb20gXCJub2RlOmNoaWxkX3Byb2Nlc3NcIjtcbmltcG9ydCB7XG4gIGRlZmF1bHRQYXJzaW5nLFxuICBnZXRTcGF3bmVkUHJvbWlzZSxcbiAgZ2V0U3Bhd25lZFJlc3VsdCxcbiAgaGFuZGxlT3V0cHV0LFxuICBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyLFxufSBmcm9tIFwiLi9leGVjLXV0aWxzXCI7XG5cbnR5cGUgQXBwbGVTY3JpcHRPcHRpb25zID0ge1xuICAvKipcbiAgICogQnkgZGVmYXVsdCwgYHJ1bkFwcGxlU2NyaXB0YCByZXR1cm5zIGl0cyByZXN1bHRzIGluIGh1bWFuLXJlYWRhYmxlIGZvcm06IHN0cmluZ3MgZG8gbm90IGhhdmUgcXVvdGVzIGFyb3VuZCB0aGVtLCBjaGFyYWN0ZXJzIGFyZSBub3QgZXNjYXBlZCwgYnJhY2VzIGZvciBsaXN0cyBhbmQgcmVjb3JkcyBhcmUgb21pdHRlZCwgZXRjLiBUaGlzIGlzIGdlbmVyYWxseSBtb3JlIHVzZWZ1bCwgYnV0IGNhbiBpbnRyb2R1Y2UgYW1iaWd1aXRpZXMuIEZvciBleGFtcGxlLCB0aGUgbGlzdHMgYHtcImZvb1wiLCBcImJhclwifWAgYW5kIGB7e1wiZm9vXCIsIHtcImJhclwifX19YCB3b3VsZCBib3RoIGJlIGRpc3BsYXllZCBhcyDigJhmb28sIGJhcuKAmS4gVG8gc2VlIHRoZSByZXN1bHRzIGluIGFuIHVuYW1iaWd1b3VzIGZvcm0gdGhhdCBjb3VsZCBiZSByZWNvbXBpbGVkIGludG8gdGhlIHNhbWUgdmFsdWUsIHNldCBgaHVtYW5SZWFkYWJsZU91dHB1dGAgdG8gYGZhbHNlYC5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgaHVtYW5SZWFkYWJsZU91dHB1dD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBzY3JpcHQgaXMgdXNpbmcgW2BBcHBsZVNjcmlwdGBdKGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9saWJyYXJ5L2FyY2hpdmUvZG9jdW1lbnRhdGlvbi9BcHBsZVNjcmlwdC9Db25jZXB0dWFsL0FwcGxlU2NyaXB0TGFuZ0d1aWRlL2ludHJvZHVjdGlvbi9BU0xSX2ludHJvLmh0bWwjLy9hcHBsZV9yZWYvZG9jL3VpZC9UUDQwMDAwOTgzKSBvciBbYEphdmFTY3JpcHRgXShodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vbGlicmFyeS9hcmNoaXZlL3JlbGVhc2Vub3Rlcy9JbnRlcmFwcGxpY2F0aW9uQ29tbXVuaWNhdGlvbi9STi1KYXZhU2NyaXB0Rm9yQXV0b21hdGlvbi9BcnRpY2xlcy9JbnRyb2R1Y3Rpb24uaHRtbCMvL2FwcGxlX3JlZi9kb2MvdWlkL1RQNDAwMTQ1MDgtQ0gxMTEtU1cxKS5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJBcHBsZVNjcmlwdFwiXG4gICAqL1xuICBsYW5ndWFnZT86IFwiQXBwbGVTY3JpcHRcIiB8IFwiSmF2YVNjcmlwdFwiO1xuICAvKipcbiAgICogQSBTaWduYWwgb2JqZWN0IHRoYXQgYWxsb3dzIHlvdSB0byBhYm9ydCB0aGUgcmVxdWVzdCBpZiByZXF1aXJlZCB2aWEgYW4gQWJvcnRDb250cm9sbGVyIG9iamVjdC5cbiAgICovXG4gIHNpZ25hbD86IEFib3J0U2lnbmFsO1xuICAvKiogSWYgdGltZW91dCBpcyBncmVhdGVyIHRoYW4gYDBgLCB0aGUgcGFyZW50IHdpbGwgc2VuZCB0aGUgc2lnbmFsIGBTSUdURVJNYCBpZiB0aGUgY2hpbGQgcnVucyBsb25nZXIgdGhhbiB0aW1lb3V0IG1pbGxpc2Vjb25kcy5cbiAgICpcbiAgICogQGRlZmF1bHQgMTAwMDBcbiAgICovXG4gIHRpbWVvdXQ/OiBudW1iZXI7XG59O1xuXG4vKipcbiAqIEV4ZWN1dGVzIGFuIEFwcGxlU2NyaXB0IHNjcmlwdC5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgc2hvd0hVRCB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbiAqIGltcG9ydCB7IHJ1bkFwcGxlU2NyaXB0LCBzaG93RmFpbHVyZVRvYXN0IH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gKCkge1xuICogICB0cnkge1xuICogICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJ1bkFwcGxlU2NyaXB0KFxuICogICAgICAgYFxuICogICAgICAgb24gcnVuIGFyZ3ZcbiAqICAgICAgICAgcmV0dXJuIFwiaGVsbG8sIFwiICYgaXRlbSAxIG9mIGFyZ3YgJiBcIi5cIlxuICogICAgICAgZW5kIHJ1blxuICogICAgICAgYCxcbiAqICAgICAgIFtcIndvcmxkXCJdXG4gKiAgICAgKTtcbiAqICAgICBhd2FpdCBzaG93SFVEKHJlcyk7XG4gKiAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gKiAgICAgc2hvd0ZhaWx1cmVUb2FzdChlcnJvciwgeyB0aXRsZTogXCJDb3VsZCBub3QgcnVuIEFwcGxlU2NyaXB0XCIgfSk7XG4gKiAgIH1cbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuQXBwbGVTY3JpcHQ8VCA9IHN0cmluZz4oXG4gIHNjcmlwdDogc3RyaW5nLFxuICBvcHRpb25zPzogQXBwbGVTY3JpcHRPcHRpb25zICYge1xuICAgIHBhcnNlT3V0cHV0PzogUGFyc2VFeGVjT3V0cHV0SGFuZGxlcjxULCBzdHJpbmcsIEFwcGxlU2NyaXB0T3B0aW9ucz47XG4gIH0sXG4pOiBQcm9taXNlPHN0cmluZz47XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuQXBwbGVTY3JpcHQ8VCA9IHN0cmluZz4oXG4gIHNjcmlwdDogc3RyaW5nLFxuICAvKipcbiAgICogVGhlIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBzY3JpcHQuXG4gICAqL1xuICBhcmdzOiBzdHJpbmdbXSxcbiAgb3B0aW9ucz86IEFwcGxlU2NyaXB0T3B0aW9ucyAmIHtcbiAgICBwYXJzZU91dHB1dD86IFBhcnNlRXhlY091dHB1dEhhbmRsZXI8VCwgc3RyaW5nLCBBcHBsZVNjcmlwdE9wdGlvbnM+O1xuICB9LFxuKTogUHJvbWlzZTxzdHJpbmc+O1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1bkFwcGxlU2NyaXB0PFQgPSBzdHJpbmc+KFxuICBzY3JpcHQ6IHN0cmluZyxcbiAgb3B0aW9uc09yQXJncz86XG4gICAgfCBzdHJpbmdbXVxuICAgIHwgKEFwcGxlU2NyaXB0T3B0aW9ucyAmIHtcbiAgICAgICAgcGFyc2VPdXRwdXQ/OiBQYXJzZUV4ZWNPdXRwdXRIYW5kbGVyPFQsIHN0cmluZywgQXBwbGVTY3JpcHRPcHRpb25zPjtcbiAgICAgIH0pLFxuICBvcHRpb25zPzogQXBwbGVTY3JpcHRPcHRpb25zICYge1xuICAgIHBhcnNlT3V0cHV0PzogUGFyc2VFeGVjT3V0cHV0SGFuZGxlcjxULCBzdHJpbmcsIEFwcGxlU2NyaXB0T3B0aW9ucz47XG4gIH0sXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSAhPT0gXCJkYXJ3aW5cIikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkFwcGxlU2NyaXB0IGlzIG9ubHkgc3VwcG9ydGVkIG9uIG1hY09TXCIpO1xuICB9XG5cbiAgY29uc3QgeyBodW1hblJlYWRhYmxlT3V0cHV0LCBsYW5ndWFnZSwgdGltZW91dCwgLi4uZXhlY09wdGlvbnMgfSA9IEFycmF5LmlzQXJyYXkob3B0aW9uc09yQXJncylcbiAgICA/IG9wdGlvbnMgfHwge31cbiAgICA6IG9wdGlvbnNPckFyZ3MgfHwge307XG5cbiAgY29uc3Qgb3V0cHV0QXJndW1lbnRzID0gaHVtYW5SZWFkYWJsZU91dHB1dCAhPT0gZmFsc2UgPyBbXSA6IFtcIi1zc1wiXTtcbiAgaWYgKGxhbmd1YWdlID09PSBcIkphdmFTY3JpcHRcIikge1xuICAgIG91dHB1dEFyZ3VtZW50cy5wdXNoKFwiLWxcIiwgXCJKYXZhU2NyaXB0XCIpO1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbnNPckFyZ3MpKSB7XG4gICAgb3V0cHV0QXJndW1lbnRzLnB1c2goXCItXCIsIC4uLm9wdGlvbnNPckFyZ3MpO1xuICB9XG5cbiAgY29uc3Qgc3Bhd25lZCA9IGNoaWxkUHJvY2Vzcy5zcGF3bihcIm9zYXNjcmlwdFwiLCBvdXRwdXRBcmd1bWVudHMsIHtcbiAgICAuLi5leGVjT3B0aW9ucyxcbiAgICBlbnY6IHsgUEFUSDogXCIvdXNyL2xvY2FsL2JpbjovdXNyL2JpbjovYmluOi91c3Ivc2Jpbjovc2JpblwiIH0sXG4gIH0pO1xuICBjb25zdCBzcGF3bmVkUHJvbWlzZSA9IGdldFNwYXduZWRQcm9taXNlKHNwYXduZWQsIHsgdGltZW91dDogdGltZW91dCA/PyAxMDAwMCB9KTtcblxuICBzcGF3bmVkLnN0ZGluLmVuZChzY3JpcHQpO1xuXG4gIGNvbnN0IFt7IGVycm9yLCBleGl0Q29kZSwgc2lnbmFsLCB0aW1lZE91dCB9LCBzdGRvdXRSZXN1bHQsIHN0ZGVyclJlc3VsdF0gPSBhd2FpdCBnZXRTcGF3bmVkUmVzdWx0PHN0cmluZz4oXG4gICAgc3Bhd25lZCxcbiAgICB7IGVuY29kaW5nOiBcInV0ZjhcIiB9LFxuICAgIHNwYXduZWRQcm9taXNlLFxuICApO1xuICBjb25zdCBzdGRvdXQgPSBoYW5kbGVPdXRwdXQoeyBzdHJpcEZpbmFsTmV3bGluZTogdHJ1ZSB9LCBzdGRvdXRSZXN1bHQpO1xuICBjb25zdCBzdGRlcnIgPSBoYW5kbGVPdXRwdXQoeyBzdHJpcEZpbmFsTmV3bGluZTogdHJ1ZSB9LCBzdGRlcnJSZXN1bHQpO1xuXG4gIHJldHVybiBkZWZhdWx0UGFyc2luZyh7XG4gICAgc3Rkb3V0LFxuICAgIHN0ZGVycixcbiAgICBlcnJvcixcbiAgICBleGl0Q29kZSxcbiAgICBzaWduYWwsXG4gICAgdGltZWRPdXQsXG4gICAgY29tbWFuZDogXCJvc2FzY3JpcHRcIixcbiAgICBvcHRpb25zLFxuICAgIHBhcmVudEVycm9yOiBuZXcgRXJyb3IoKSxcbiAgfSk7XG59XG4iLCAiaW1wb3J0IGNoaWxkUHJvY2VzcyBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XG5pbXBvcnQge1xuICBkZWZhdWx0UGFyc2luZyxcbiAgZ2V0U3Bhd25lZFByb21pc2UsXG4gIGdldFNwYXduZWRSZXN1bHQsXG4gIGhhbmRsZU91dHB1dCxcbiAgUGFyc2VFeGVjT3V0cHV0SGFuZGxlcixcbn0gZnJvbSBcIi4vZXhlYy11dGlsc1wiO1xuXG50eXBlIFBvd2VyU2hlbGxTY3JpcHRPcHRpb25zID0ge1xuICAvKipcbiAgICogQSBTaWduYWwgb2JqZWN0IHRoYXQgYWxsb3dzIHlvdSB0byBhYm9ydCB0aGUgcmVxdWVzdCBpZiByZXF1aXJlZCB2aWEgYW4gQWJvcnRDb250cm9sbGVyIG9iamVjdC5cbiAgICovXG4gIHNpZ25hbD86IEFib3J0U2lnbmFsO1xuICAvKiogSWYgdGltZW91dCBpcyBncmVhdGVyIHRoYW4gYDBgLCB0aGUgcGFyZW50IHdpbGwgc2VuZCB0aGUgc2lnbmFsIGBTSUdURVJNYCBpZiB0aGUgY2hpbGQgcnVucyBsb25nZXIgdGhhbiB0aW1lb3V0IG1pbGxpc2Vjb25kcy5cbiAgICpcbiAgICogQGRlZmF1bHQgMTAwMDBcbiAgICovXG4gIHRpbWVvdXQ/OiBudW1iZXI7XG59O1xuXG4vKipcbiAqIEV4ZWN1dGVzIGEgUG93ZXJTaGVsbCBzY3JpcHQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7IHNob3dIVUQgfSBmcm9tIFwiQHJheWNhc3QvYXBpXCI7XG4gKiBpbXBvcnQgeyBydW5Qb3dlclNoZWxsU2NyaXB0LCBzaG93RmFpbHVyZVRvYXN0IH0gZnJvbSBcIkByYXljYXN0L3V0aWxzXCI7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gKCkge1xuICogICB0cnkge1xuICogICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJ1blBvd2VyU2hlbGxTY3JpcHQoXG4gKiAgICAgICBgXG4gKiAgICAgICBXcml0ZS1Ib3N0IFwiaGVsbG8sIHdvcmxkLlwiXG4gKiAgICAgICBgLFxuICogICAgICk7XG4gKiAgICAgYXdhaXQgc2hvd0hVRChyZXMpO1xuICogICB9IGNhdGNoIChlcnJvcikge1xuICogICAgIHNob3dGYWlsdXJlVG9hc3QoZXJyb3IsIHsgdGl0bGU6IFwiQ291bGQgbm90IHJ1biBQb3dlclNoZWxsXCIgfSk7XG4gKiAgIH1cbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuUG93ZXJTaGVsbFNjcmlwdDxUID0gc3RyaW5nPihcbiAgc2NyaXB0OiBzdHJpbmcsXG4gIG9wdGlvbnM/OiBQb3dlclNoZWxsU2NyaXB0T3B0aW9ucyAmIHtcbiAgICBwYXJzZU91dHB1dD86IFBhcnNlRXhlY091dHB1dEhhbmRsZXI8VCwgc3RyaW5nLCBQb3dlclNoZWxsU2NyaXB0T3B0aW9ucz47XG4gIH0sXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSAhPT0gXCJ3aW4zMlwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUG93ZXJTaGVsbCBpcyBvbmx5IHN1cHBvcnRlZCBvbiBXaW5kb3dzXCIpO1xuICB9XG5cbiAgY29uc3QgeyB0aW1lb3V0LCAuLi5leGVjT3B0aW9ucyB9ID0gb3B0aW9ucyB8fCB7fTtcblxuICBjb25zdCBvdXRwdXRBcmd1bWVudHMgPSBbXCItTm9Mb2dvXCIsIFwiLU5vUHJvZmlsZVwiLCBcIi1Ob25JbnRlcmFjdGl2ZVwiLCBcIi1Db21tYW5kXCIsIFwiLVwiXTtcblxuICBjb25zdCBzcGF3bmVkID0gY2hpbGRQcm9jZXNzLnNwYXduKFwicG93ZXJzaGVsbC5leGVcIiwgb3V0cHV0QXJndW1lbnRzLCB7XG4gICAgLi4uZXhlY09wdGlvbnMsXG4gIH0pO1xuICBjb25zdCBzcGF3bmVkUHJvbWlzZSA9IGdldFNwYXduZWRQcm9taXNlKHNwYXduZWQsIHsgdGltZW91dDogdGltZW91dCA/PyAxMDAwMCB9KTtcblxuICBzcGF3bmVkLnN0ZGluLmVuZChzY3JpcHQpO1xuXG4gIGNvbnN0IFt7IGVycm9yLCBleGl0Q29kZSwgc2lnbmFsLCB0aW1lZE91dCB9LCBzdGRvdXRSZXN1bHQsIHN0ZGVyclJlc3VsdF0gPSBhd2FpdCBnZXRTcGF3bmVkUmVzdWx0PHN0cmluZz4oXG4gICAgc3Bhd25lZCxcbiAgICB7IGVuY29kaW5nOiBcInV0ZjhcIiB9LFxuICAgIHNwYXduZWRQcm9taXNlLFxuICApO1xuICBjb25zdCBzdGRvdXQgPSBoYW5kbGVPdXRwdXQoeyBzdHJpcEZpbmFsTmV3bGluZTogdHJ1ZSB9LCBzdGRvdXRSZXN1bHQpO1xuICBjb25zdCBzdGRlcnIgPSBoYW5kbGVPdXRwdXQoeyBzdHJpcEZpbmFsTmV3bGluZTogdHJ1ZSB9LCBzdGRlcnJSZXN1bHQpO1xuXG4gIHJldHVybiBkZWZhdWx0UGFyc2luZyh7XG4gICAgc3Rkb3V0LFxuICAgIHN0ZGVycixcbiAgICBlcnJvcixcbiAgICBleGl0Q29kZSxcbiAgICBzaWduYWwsXG4gICAgdGltZWRPdXQsXG4gICAgY29tbWFuZDogXCJwb3dlcnNoZWxsLmV4ZVwiLFxuICAgIG9wdGlvbnMsXG4gICAgcGFyZW50RXJyb3I6IG5ldyBFcnJvcigpLFxuICB9KTtcbn1cbiIsICJpbXBvcnQgeyBDYWNoZSB9IGZyb20gXCJAcmF5Y2FzdC9hcGlcIjtcbmltcG9ydCB7IGhhc2gsIHJlcGxhY2VyLCByZXZpdmVyIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG4vKipcbiAqIFdyYXBzIGEgZnVuY3Rpb24gd2l0aCBjYWNoaW5nIGZ1bmN0aW9uYWxpdHkgdXNpbmcgUmF5Y2FzdCdzIENhY2hlIEFQSS5cbiAqIEFsbG93cyBmb3IgY2FjaGluZyBvZiBleHBlbnNpdmUgZnVuY3Rpb25zIGxpa2UgcGFnaW5hdGVkIEFQSSBjYWxscyB0aGF0IHJhcmVseSBjaGFuZ2UuXG4gKlxuICogQHBhcmFtIGZuIC0gVGhlIGFzeW5jIGZ1bmN0aW9uIHRvIGNhY2hlIHJlc3VsdHMgZnJvbVxuICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBjb25maWd1cmF0aW9uIGZvciB0aGUgY2FjaGUgYmVoYXZpb3JcbiAqIEBwYXJhbSBvcHRpb25zLnZhbGlkYXRlIC0gT3B0aW9uYWwgdmFsaWRhdGlvbiBmdW5jdGlvbiBmb3IgY2FjaGVkIGRhdGFcbiAqIEBwYXJhbSBvcHRpb25zLm1heEFnZSAtIE1heGltdW0gYWdlIG9mIGNhY2hlZCBkYXRhIGluIG1pbGxpc2Vjb25kc1xuICogQHJldHVybnMgQW4gYXN5bmMgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uLCBlaXRoZXIgZnJvbSBjYWNoZSBvciBmcmVzaCBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGNvbnN0IGNhY2hlZEZ1bmN0aW9uID0gd2l0aENhY2hlKGZldGNoRXhwZW5zaXZlRGF0YSwge1xuICogICBtYXhBZ2U6IDUgKiA2MCAqIDEwMDAgLy8gQ2FjaGUgZm9yIDUgbWludXRlc1xuICogfSk7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FjaGVkRnVuY3Rpb24ocXVlcnkpO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQ2FjaGU8Rm4gZXh0ZW5kcyAoLi4uYXJnczogYW55KSA9PiBQcm9taXNlPGFueT4+KFxuICBmbjogRm4sXG4gIG9wdGlvbnM/OiB7XG4gICAgLyoqIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgdGhlIGNhY2hlZCBkYXRhIGFuZCByZXR1cm5zIGEgYm9vbGVhbiBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZGF0YSBpcyBzdGlsbCB2YWxpZCBvciBub3QuICovXG4gICAgdmFsaWRhdGU/OiAoZGF0YTogQXdhaXRlZDxSZXR1cm5UeXBlPEZuPj4pID0+IGJvb2xlYW47XG4gICAgLyoqIE1heGltdW0gYWdlIG9mIGNhY2hlZCBkYXRhIGluIG1pbGxpc2Vjb25kcyBhZnRlciB3aGljaCB0aGUgZGF0YSB3aWxsIGJlIGNvbnNpZGVyZWQgaW52YWxpZCAqL1xuICAgIG1heEFnZT86IG51bWJlcjtcbiAgfSxcbik6IEZuICYgeyBjbGVhckNhY2hlOiAoKSA9PiB2b2lkIH0ge1xuICBjb25zdCBjYWNoZSA9IG5ldyBDYWNoZSh7IG5hbWVzcGFjZTogaGFzaChmbikgfSk7XG5cbiAgY29uc3Qgd3JhcHBlZEZuID0gYXN5bmMgKC4uLmFyZ3M6IFBhcmFtZXRlcnM8Rm4+KSA9PiB7XG4gICAgY29uc3Qga2V5ID1cbiAgICAgIGhhc2goYXJncyB8fCBbXSkgKyAob3B0aW9ucyBhcyB1bmtub3duIGFzIHsgaW50ZXJuYWxfY2FjaGVLZXlTdWZmaXg/OiBzdHJpbmcgfSk/LmludGVybmFsX2NhY2hlS2V5U3VmZml4O1xuICAgIGNvbnN0IGNhY2hlZCA9IGNhY2hlLmdldChrZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgdGltZXN0YW1wIH0gPSBKU09OLnBhcnNlKGNhY2hlZCwgcmV2aXZlcik7XG4gICAgICBjb25zdCBpc0V4cGlyZWQgPSBvcHRpb25zPy5tYXhBZ2UgJiYgRGF0ZS5ub3coKSAtIHRpbWVzdGFtcCA+IG9wdGlvbnMubWF4QWdlO1xuICAgICAgaWYgKCFpc0V4cGlyZWQgJiYgKCFvcHRpb25zPy52YWxpZGF0ZSB8fCBvcHRpb25zLnZhbGlkYXRlKGRhdGEpKSkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKC4uLmFyZ3MpO1xuICAgIGNhY2hlLnNldChcbiAgICAgIGtleSxcbiAgICAgIEpTT04uc3RyaW5naWZ5KFxuICAgICAgICB7XG4gICAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVwbGFjZXIsXG4gICAgICApLFxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICB3cmFwcGVkRm4uY2xlYXJDYWNoZSA9ICgpID0+IHtcbiAgICBjYWNoZS5jbGVhcigpO1xuICB9O1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3IgdG9vIGNvbXBsZXggZm9yIFRTXG4gIHJldHVybiB3cmFwcGVkRm47XG59XG4iLCAiaW1wb3J0IHsgZ2V0QXBwbGljYXRpb25zLCBnZXRQcmVmZXJlbmNlVmFsdWVzLCBMb2NhbFN0b3JhZ2UgfSBmcm9tICdAcmF5Y2FzdC9hcGknXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHN0b3JhZ2UoKSB7fVxuXG5zdG9yYWdlLmdldFByZWZlcmVuY2VzID0gYXN5bmMgKCk6IFByb21pc2U8UHJlZmVyZW5jZXM+ID0+IGdldFByZWZlcmVuY2VWYWx1ZXMoKVxuXG5zdG9yYWdlLmdldEJhZGdlcyA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgYXBwcyA9IGF3YWl0IGdldEFwcGxpY2F0aW9ucygpXG4gIGNvbnN0IGJhZGdlcyA9IEpTT04ucGFyc2UoKGF3YWl0IExvY2FsU3RvcmFnZS5nZXRJdGVtKCdiYWRnZXMnKSkgfHwgJ3t9JykgYXMgQmFkZ2VyTGlzdFxuXG4gIE9iamVjdC5lbnRyaWVzKGJhZGdlcykuZm9yRWFjaCgoW2J1bmRsZUlkLCBiYWRnZV0pID0+IHtcbiAgICBjb25zdCBhcHAgPSBhcHBzLmZpbHRlcihhcHAgPT4gYXBwLmJ1bmRsZUlkID09PSBidW5kbGVJZCkucG9wKClcbiAgICBpZiAoIWFwcCkge1xuICAgICAgLy8gUmF5Y2FzdCBpcyBub3QgYXdhcmUgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgICAgZGVsZXRlIGJhZGdlc1tidW5kbGVJZF1cbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBiYWRnZS5hcHAgPSBhcHBcbiAgICBiYWRnZS5zdGF0dXMgPSB7IGNvdW50OiAwLCBpbmRldGVybWluYXRlOiBmYWxzZSB9XG4gIH0pXG5cbiAgcmV0dXJuIGJhZGdlc1xufVxuXG5zdG9yYWdlLnNvcnRCYWRnZXMgPSAoYmFkZ2VzOiBCYWRnZXJMaXN0KSA9PiBPYmplY3QudmFsdWVzKGJhZGdlcylcbiAgLnNvcnQoKGEsIGIpID0+IGEuYXBwLm5hbWUubG9jYWxlQ29tcGFyZShcbiAgICBiLmFwcC5uYW1lLFxuICAgIEludGwuRGF0ZVRpbWVGb3JtYXQoKS5yZXNvbHZlZE9wdGlvbnMoKS5sb2NhbGUsXG4gICAgeyBzZW5zaXRpdml0eTogJ2Jhc2UnIH0sXG4gICkpXG5cbnN0b3JhZ2Uuc2F2ZUJhZGdlID0gYXN5bmMgKGJhZGdlOiBCYWRnZXIpID0+IHtcbiAgY29uc3QgYmFkZ2VzID0gYXdhaXQgc3RvcmFnZS5nZXRCYWRnZXMoKVxuICBiYWRnZXNbYmFkZ2UuYnVuZGxlSWRdID0gYmFkZ2VcbiAgYXdhaXQgTG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JhZGdlcycsIEpTT04uc3RyaW5naWZ5KGJhZGdlcykpXG59XG5cbnN0b3JhZ2UuZGVsZXRlQmFkZ2UgPSBhc3luYyAoYmFkZ2U6IEJhZGdlcikgPT4ge1xuICBjb25zdCBiYWRnZXMgPSBhd2FpdCBzdG9yYWdlLmdldEJhZGdlcygpXG4gIGlmICghYmFkZ2VzW2JhZGdlLmJ1bmRsZUlkXSlcbiAgICByZXR1cm5cblxuICBkZWxldGUgYmFkZ2VzW2JhZGdlLmJ1bmRsZUlkXVxuICBhd2FpdCBMb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmFkZ2VzJywgSlNPTi5zdHJpbmdpZnkoYmFkZ2VzKSlcbn1cblxuc3RvcmFnZS5kZWxldGVBbGxCYWRnZXMgPSBhc3luYyAoKSA9PiBMb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnYmFkZ2VzJylcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztBQ0NBLElBQUFBLGNBQTBFO0E7Ozs7Ozs7QUs0Qm5FLFNBQVMsMENBQ2QsT0FDQSxTQUE2RTtBQUU3RSxRQUFNLFVBQVUsaUJBQWlCLFFBQVEsTUFBTSxVQUFVLE9BQU8sS0FBQTtBQUNoRSxVQUFPLEdBQUEsV0FBQUMsV0FBVTtJQUNmLFFBQU8sR0FBQSxXQUFBQyxPQUFNLE1BQU07SUFDbkIsT0FBTyxTQUFTLFNBQVM7SUFDekIsU0FBUyxTQUFTLFdBQVc7SUFDN0IsZUFBZSxTQUFTLGlCQUFpQiw2Q0FBdUIsS0FBQTtJQUNoRSxpQkFBaUIsU0FBUyxnQkFBZ0IsNkNBQXVCLEtBQUEsSUFBUztFQUM1RSxDQUFBO0FBQ0Y7QUFFQSxJQUFNLCtDQUF5QixDQUFDLFVBQUE7QUFDOUIsTUFBSSxtQkFBbUI7QUFDdkIsTUFBSSxRQUFRO0FBQ1osTUFBSSxlQUFlO0FBQ25CLE1BQUk7QUFDRixVQUFNLGNBQWMsS0FBSyxVQUFNLGVBQUFDLGtCQUFnQixpQkFBQUMsT0FBVSxHQUFBLFdBQUFDLGFBQVksWUFBWSxNQUFNLGNBQUEsR0FBaUIsTUFBQSxDQUFBO0FBQ3hHLFlBQVEsSUFBSSxZQUFZLEtBQUs7QUFDN0IsbUJBQWUsdUJBQXVCLFlBQVksU0FBUyxZQUFZLE1BQU0sSUFBSSxZQUFZLElBQUk7QUFDakcsUUFBSSxDQUFDLFlBQVksU0FBUyxZQUFZLFdBQVcsU0FDL0Msb0JBQW1CO0VBRXZCLFNBQVMsS0FBSztFQUVkO0FBSUEsUUFBTSxZQUFXLEdBQUEsV0FBQUEsYUFBWSxpQkFBaUI7QUFFOUMsUUFBTSxRQUFRLGlCQUFpQixRQUFRLE9BQU8sU0FBUyxPQUFPLFdBQVcsS0FBSyxPQUFPLEtBQUE7QUFFckYsU0FBTztJQUNMLE9BQU8sV0FBVyxjQUFjO0lBQ2hDLFNBQVMsT0FBSztBQUNaLFlBQU0sS0FBSTtBQUNWLFVBQUksU0FDRixFQUFBLEdBQUEsV0FBQUMsV0FBVSxLQUFLLEtBQUE7VUFFZixFQUFBLEdBQUEsV0FBQUMsTUFDRSxvSEFBb0gsbUJBQ2xILEtBQUEsQ0FBQSxrQkFDaUIsVUFBVSxZQUFBLENBQUEsZ0JBQTZCLG1CQUN4RDs7RUFFVixLQUFBOztDQUVELENBQUEsRUFDWTtJQUdUO0VBQ0Y7QUFDRjs7O0FMbEZBLElBQUFDLGdCQUFvQzs7O0FzQ0hwQyxJQUFBQyxjQUFtRTtBQUVwRCxTQUFSLFVBQTJCO0FBQUM7QUFFbkMsUUFBUSxpQkFBaUIsZ0JBQWtDLGlDQUFvQjtBQUUvRSxRQUFRLFlBQVksWUFBWTtBQUM5QixRQUFNLE9BQU8sVUFBTSw2QkFBZ0I7QUFDbkMsUUFBTSxTQUFTLEtBQUssTUFBTyxNQUFNLHlCQUFhLFFBQVEsUUFBUSxLQUFNLElBQUk7QUFFeEUsU0FBTyxRQUFRLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQyxVQUFVLEtBQUssTUFBTTtBQUNwRCxVQUFNLE1BQU0sS0FBSyxPQUFPLENBQUFDLFNBQU9BLEtBQUksYUFBYSxRQUFRLEVBQUUsSUFBSTtBQUM5RCxRQUFJLENBQUMsS0FBSztBQUVSLGFBQU8sT0FBTyxRQUFRO0FBQ3RCO0FBQUEsSUFDRjtBQUNBLFVBQU0sTUFBTTtBQUNaLFVBQU0sU0FBUyxFQUFFLE9BQU8sR0FBRyxlQUFlLE1BQU07QUFBQSxFQUNsRCxDQUFDO0FBRUQsU0FBTztBQUNUO0FBRUEsUUFBUSxhQUFhLENBQUMsV0FBdUIsT0FBTyxPQUFPLE1BQU0sRUFDOUQsS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLElBQUksS0FBSztBQUFBLEVBQ3pCLEVBQUUsSUFBSTtBQUFBLEVBQ04sS0FBSyxlQUFlLEVBQUUsZ0JBQWdCLEVBQUU7QUFBQSxFQUN4QyxFQUFFLGFBQWEsT0FBTztBQUN4QixDQUFDO0FBRUgsUUFBUSxZQUFZLE9BQU8sVUFBa0I7QUFDM0MsUUFBTSxTQUFTLE1BQU0sUUFBUSxVQUFVO0FBQ3ZDLFNBQU8sTUFBTSxRQUFRLElBQUk7QUFDekIsUUFBTSx5QkFBYSxRQUFRLFVBQVUsS0FBSyxVQUFVLE1BQU0sQ0FBQztBQUM3RDtBQUVBLFFBQVEsY0FBYyxPQUFPLFVBQWtCO0FBQzdDLFFBQU0sU0FBUyxNQUFNLFFBQVEsVUFBVTtBQUN2QyxNQUFJLENBQUMsT0FBTyxNQUFNLFFBQVE7QUFDeEI7QUFFRixTQUFPLE9BQU8sTUFBTSxRQUFRO0FBQzVCLFFBQU0seUJBQWEsUUFBUSxVQUFVLEtBQUssVUFBVSxNQUFNLENBQUM7QUFDN0Q7QUFFQSxRQUFRLGtCQUFrQixZQUFZLHlCQUFhLFdBQVcsUUFBUTs7O0F0Q25CbEUsSUFBQUMsc0JBQUE7QUFyQlcsU0FBUixVQUEyQixPQUEyQjtBQUMzRCxRQUFNLEVBQUUsTUFBTSxJQUFJO0FBQ2xCLFFBQU0sRUFBRSxJQUFJLFFBQUksMkJBQWM7QUFDOUIsUUFBTSxDQUFDLE1BQU0sT0FBTyxRQUFJLHdCQUF3QixDQUFDLENBQUM7QUFFbEQsK0JBQVUsTUFBTTtBQUNkLEtBQUMsWUFBWSxRQUFRLFVBQU0sNkJBQWdCLENBQUMsR0FBRztBQUFBLEVBQ2pELEdBQUcsQ0FBQyxDQUFDO0FBRUwsUUFBTSxXQUFXLE9BQU8sV0FBbUI7QUFDekMsUUFBSTtBQUNGLFVBQUk7QUFDRixlQUFPLFdBQVcsTUFBTTtBQUMxQixjQUFRLFVBQVUsTUFBTSxFQUFFLEtBQUssR0FBRztBQUFBLElBQ3BDLFNBQ08sT0FBTztBQUNaLFlBQU0sMENBQWtCLE1BQWdCLE9BQU87QUFBQSxJQUNqRDtBQUFBLEVBQ0Y7QUFFQSxTQUNFO0FBQUEsSUFBQztBQUFBO0FBQUEsTUFDQyxXQUFXLENBQUMsS0FBSztBQUFBLE1BQ2pCLGlCQUFpQixDQUFDLFFBQVEsY0FBYztBQUFBLE1BQ3hDLFNBQ0UsNkNBQUMsMkJBQ0MsdURBQUMsbUJBQU8sWUFBUCxFQUFrQixPQUFNLFVBQVMsVUFBb0IsR0FDeEQ7QUFBQSxNQUdEO0FBQUEsaUJBQVMsNkNBQUMsaUJBQUssYUFBTCxFQUFpQixNQUFNLE1BQU0sSUFBSSxNQUFNO0FBQUEsUUFFakQsQ0FBQyxTQUNBO0FBQUEsVUFBQyxpQkFBSztBQUFBLFVBQUw7QUFBQSxZQUNDLElBQUc7QUFBQSxZQUNILE1BQUs7QUFBQSxZQUVKLGVBQUssSUFBSSxTQUNSO0FBQUEsY0FBQyxpQkFBSyxTQUFTO0FBQUEsY0FBZDtBQUFBLGdCQUVDLE9BQU8sSUFBSSxZQUFZLElBQUk7QUFBQSxnQkFDM0IsT0FBTyxJQUFJO0FBQUEsZ0JBQ1gsTUFBTSxFQUFFLFVBQVUsSUFBSSxLQUFLO0FBQUE7QUFBQSxjQUh0QixJQUFJLFlBQVksSUFBSTtBQUFBLFlBSTNCLENBQ0Q7QUFBQTtBQUFBLFFBQ0g7QUFBQSxRQUdGO0FBQUEsVUFBQyxpQkFBSztBQUFBLFVBQUw7QUFBQSxZQUNDLElBQUc7QUFBQSxZQUNILE9BQU07QUFBQSxZQUNOLE1BQUs7QUFBQSxZQUNMLGNBQWUsQ0FBQyxTQUFTLFFBQVMsTUFBTTtBQUFBO0FBQUEsUUFDMUM7QUFBQSxRQUNBO0FBQUEsVUFBQyxpQkFBSztBQUFBLFVBQUw7QUFBQSxZQUNDLElBQUc7QUFBQSxZQUNILE9BQU07QUFBQSxZQUNOLE1BQUs7QUFBQSxZQUNMLGNBQWUsQ0FBQyxTQUFTLFFBQVMsTUFBTTtBQUFBO0FBQUEsUUFDMUM7QUFBQSxRQUVBLDZDQUFDLGlCQUFLLGFBQUwsRUFBaUIsTUFBSyxJQUFHO0FBQUEsUUFDMUIsNkNBQUMsaUJBQUssV0FBTCxFQUFlO0FBQUEsUUFDaEIsNkNBQUMsaUJBQUssYUFBTCxFQUFpQixNQUFLLElBQUc7QUFBQSxRQUUxQiw2Q0FBQyxpQkFBSyxhQUFMLEVBQWlCLE1BQUssMk1BQTBNO0FBQUE7QUFBQTtBQUFBLEVBQ25PO0FBRUo7OztBRHZFUyxJQUFBQyxzQkFBQTtBQURNLFNBQVIsTUFBdUI7QUFDNUIsU0FBTyw2Q0FBQyxhQUFVO0FBQ3BCOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfYXBpIiwgIiRoZ1VXMSRzaG93VG9hc3QiLCAiJGhnVVcxJFRvYXN0IiwgIiRoZ1VXMSRyZWFkRmlsZVN5bmMiLCAiJGhnVVcxJGpvaW4iLCAiJGhnVVcxJGVudmlyb25tZW50IiwgIiRoZ1VXMSRDbGlwYm9hcmQiLCAiJGhnVVcxJG9wZW4iLCAiaW1wb3J0X3JlYWN0IiwgImltcG9ydF9hcGkiLCAiYXBwIiwgImltcG9ydF9qc3hfcnVudGltZSIsICJpbXBvcnRfanN4X3J1bnRpbWUiXQp9Cg==
